--- occu/WebUI/www/config/cp_maintenance.cgi.orig
+++ occu/WebUI/www/config/cp_maintenance.cgi
@@ -340,10 +340,25 @@
   }
 }
 
+proc execCmd {varName cmd} {
+  upvar 1 $varName variable
+  set rc [catch {eval $cmd} resVar]
+  if {$rc == 0} {
+    set variable $resVar
+  } else {
+    set variable "0"
+  }
+}
+
 proc action_put_page {} {
   global env sid REMOTE_FIRMWARE_SCRIPT LOGLEVELS HMIP_LOGLEVELS REGA_LOGLEVELS RFD_URL HS485D_URL downloadOnly
   http_head
 
+  execCmd USERFSFREE_MB {exec df -m | grep "/usr/local" | awk {{ print $4 }}}
+  set USERFSFREE_GB [format "%.1f" [expr {$USERFSFREE_MB / 1024.0}]]
+  set USERFSFREE_MB_REQ 2048.0
+  set USERFSFREE_GB_REQ [format "%.1f" [expr {$USERFSFREE_MB_REQ / 1024.0}]]
+  
   division {class="popupTitle j_translate"} {
     puts "\${dialogSettingsCMTitle}"
     #puts [isOldCCU]
@@ -392,13 +407,18 @@
               }
             }
             table_row {
+              table_data {align="left"} {colspan="3"} {id="availableUserSpace"} {style="color: green"} {
+                puts "<i>\${dialogSettingsCMLblFreeUserSpace} $USERFSFREE_GB GB ($USERFSFREE_GB_REQ GB \${dialogSettingsCMLblFreeUserSpaceRequired})</i>"
+              }
+            }
+            table_row {
               table_data {align="left"} {colspan="3"} {
                   division {class="popupControls CLASS20905"} {
                   table {
                     table_row {
                       table_data {
                         division {class="CLASS20905" style="display: none"} {id="btnFwDirectDownload"} {} "onClick=\"performDirectDownload();\"" {}
-                        division {class="CLASS20905"}  "onClick=\"performDirectDownload();\"" {puts "\${btnDirectFwUpload}"}
+                        division {class="CLASS20905"} {id="btnFwDirectDownload2"} "onClick=\"performDirectDownload();\"" {puts "\${btnDirectFwUpload}"}
                       }
                     }
                   }
@@ -451,7 +471,7 @@
               td {width="20"} {}
               table_data {align="left"} {colspan="2"} {
                 division {class="popupControls CLASS20905"} {
-                  division {class="CLASS20919" style="width: 150px; margin-left: 20px;"} {onClick="stopHmIPServer();document.firmware_form.submit();showUserHint();"} {
+                  division {class="CLASS20919" style="width: 150px; margin-left: 20px;"} {onClick="stopHmIPServer();document.firmware_form.submit();showUserHint();"} {id="btnSoftwareUpdateUpload"} {
                     puts "\${dialogSettingsCMBtnPerformSoftwareUpdateUpload}"
                   }
                 }
@@ -856,6 +876,20 @@
       }
     }
   }
+  
+  cgi_javascript {
+     puts "var userFreeMB = $USERFSFREE_MB;"
+     puts "var userFreeMBRequired = $USERFSFREE_MB_REQ;"
+     puts {
+       if (userFreeMB < userFreeMBRequired) {
+         jQuery('#availableUserSpace').css({ 'color': 'red', 'font-weight': 'bold' });
+         jQuery('#btnSoftwareUpdateUpload').removeAttr('onclick');
+         jQuery('#btnSoftwareUpdateUpload').css({ 'color': 'gray' });
+         jQuery('#btnFwDirectDownload2').removeAttr('onclick');
+         jQuery('#btnFwDirectDownload2').css({ 'color': 'gray' });
+       }
+     }
+  }
 
   cgi_javascript {
     puts "translatePage('#messagebox');"
--- occu/WebUI/www/webui/js/lang/de/translate.lang.js.orig
+++ occu/WebUI/www/webui/js/lang/de/translate.lang.js
@@ -487,6 +487,8 @@
     "dialogSettingsCMTDErrorProtocol" : "Fehler-<br/>protokoll",
     "dialogSettingsCMLblActualSoftwareVersion" : "Aktuelle Software-Version:",
     "dialogSettingsCMLblAvailableSoftwareVersion" : "Verf%FCgbare Software-Version:",
+    "dialogSettingsCMLblFreeUserSpace" : "Freier Speicher:",
+    "dialogSettingsCMLblFreeUserSpaceRequired" : "mind. erforderlich",
     "dialogSettingsCMLblPerformSoftwareUpdate" : "Software-Update durchf%FChren",
     "dialogSettingsCMLblPerformSoftwareUpdateStep1" : "Schritt 1: Neue Software herunterladen",
     "dialogSettingsCMLblPerformSoftwareUpdateStep2" : "Schritt 2: Heruntergeladene Software ausw%E4hlen",
--- occu/WebUI/www/webui/js/lang/en/translate.lang.js.orig
+++ occu/WebUI/www/webui/js/lang/en/translate.lang.js
@@ -486,6 +486,8 @@
     "dialogSettingsCMTDErrorProtocol" : "Error<br/>log",
     "dialogSettingsCMLblActualSoftwareVersion" : "Current software version:",
     "dialogSettingsCMLblAvailableSoftwareVersion" : "Available software version:",
+    "dialogSettingsCMLblFreeUserSpace" : "Free user space:",
+    "dialogSettingsCMLblFreeUserSpaceRequired" : "required at least",
     "dialogSettingsCMLblPerformSoftwareUpdate" : "Perform software update",
     "dialogSettingsCMLblPerformSoftwareUpdateStep1" : "Step 1: Download new software",
     "dialogSettingsCMLblPerformSoftwareUpdateStep2" : "Step 2: Select downloaded software",
