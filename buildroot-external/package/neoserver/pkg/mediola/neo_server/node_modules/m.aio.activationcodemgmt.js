var m=m||{};m.aio=m.aio||{},m.aio.activationcdemgmt=m.aio.activationcdemgmt||{},m.aio.activationcdemgmt.ActivateManager=function(){var e=require("x.logger.js");this._logger=e.getLogger("m.aio.activationcdemgmt.ActivateManager"),this._configmanager=null,this._serverport=8080,this._serverhost="127.0.0.1",this._serverpath="/creatorneo/activate/feature",process&&"local"==process.env.CLOUD&&(m.aio.activationcdemgmt.ActivateManager.PROTOCOL="http",this._serverpath="/webservice"+this._serverpath);},m.aio.activationcdemgmt.ActivateManager.PROTOCOL="https",m.aio.activationcdemgmt.ActivateManager.prototype={init:function init(e,t,i,n){this._configmanager=e,this._serverhost=t||this._serverhost,this._serverport=i||this._serverport,process&&"local"!=process.env.CLOUD&&80==i&&(this._serverport=443),n&&n();},activateFeature:function activateFeature(e,t,i,n){if(e){if(i){var a=this,o="config/tenants/"+e+"/license",r=this._configmanager;r.execute("read",o,null,function(e,t){e?n&&n(e):t&&t.license?t.valid?a._doRequest(i,t.license,function(e,t){if(e)n&&n(e);else try{var i=JSON.parse(t);r.execute("update",o,{classid:"license",license:i.license},function(e){n&&n(e,i.license);});}catch(e){n&&n(e);}}):n&&n(new Error("tenant license is invalid")):n&&n(new Error("tenant has no license"));});}else n&&n(new Error("invalid activation code"));}else n&&n(new Error("invalid tenant index"));},_doRequest:function _doRequest(e,t,i){var n=this._serverport,a=this._serverpath+"?license="+t+"&code="+e,o=this._serverhost,r=i,s={host:o,port:n,path:a,method:"GET",timeout:2e4,headers:{"User-Agent":"mediola",Connection:"close"}},c="",v=require(m.aio.activationcdemgmt.ActivateManager.PROTOCOL).request(s,function(e){e.setEncoding("binary"),e.on("data",function(e){c+=e;}),e.on("end",function(){r&&(200==e.statusCode?r(null,c):r(new Error(c))),r=null;});});v.on&&"function"==typeof v.on&&v.on("error",function(e){r&&r(e),r=null;}),v.setTimeout&&v.setTimeout(2e4),v.end();}},m.aio.activationcdemgmt.AM=new m.aio.activationcdemgmt.ActivateManager(),"undefined"!=typeof module&&null!=module&&(module.exports=m.aio.activationcdemgmt.AM);