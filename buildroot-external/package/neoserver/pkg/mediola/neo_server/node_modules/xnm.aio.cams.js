function _typeof(obj){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj;}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;},_typeof(obj);}var xnm=xnm||{};xnm.aio=xnm.aio||{},xnm.aio.cams=xnm.aio.cams||{},xnm.aio.cams._moveFromTmp=function(e,t,o){var i=require("fs"),n=i.createReadStream(e),r=i.createWriteStream(t);r.on("error",function(e){XC.debugf(e.message,"error"),o&&o(e);}),n.on("error",function(e){XC.debugf(e.message,"error"),o&&o(e);}),n.on("end",function(){try{i.unlinkSync(e);}catch(e){}o&&o();}),n.pipe(r);},xnm.aio.cams.rename=function(e,t,o,i){var cbWait=function cbWait(){setTimeout(function(){o&&o();},100);};if("undefined"==typeof process||"object"!=_typeof(process.release)||"node"!==process.release.name||"win32"!==process.platform&&!i){var n=require("fs");try{n.renameSync(e,t);}catch(o){return void xnm.aio.cams.rename(e,t,cbWait,!0);}cbWait&&cbWait();}else this._moveFromTmp(e,t,cbWait);},xnm.aio.cams.SystemCam=function(e,t){this._$cam=e,this._options=t,this.jpegurl=this._addAuth("http://"+this._getIP()+e.attr("imageurl")),this.mjpegurl=null,e.attr("mjpegurl")&&(this.mjpegurl=this._addAuth("http://"+this._getIP()+e.attr("mjpegurl")),"true"==e.attr("useurlauth")&&(this.mjpegurl=this._addAuth("http://"+t.user+":"+t.password+"@"+this._getIP()+e.attr("mjpegurl"))),window.XCHost&&window.XCHost.getType&&("node-webkit"==window.XCHost.getType()||"Android"==window.XCHost.getType())&&("doorbird"==e.attr("id")||e.attr("name")&&-1!=e.attr("name").indexOf("DoorBird")||(this.mjpegurl=null))),this.controlurl=null,this.pantilt=!1,"true"==t.pantilt&&(this.pantilt=!0,e.attr("controlurl")&&(this.controlurl=this._addAuth("http://"+this._getIP()+e.attr("controlurl"))),e.attr("controlpostdata")&&(this.controlpostdata=e.attr("controlpostdata"))),e.attr("imagepathurl")&&(this.jpegurl=null,this.mjpegurl=null,this.jpegpathurl=this._addAuth("http://"+this._getIP()+e.attr("imagepathurl")));},xnm.aio.cams.SystemCam.prototype._getIP=function(){var e=this._$cam.attr("port"),t=this._options.address;return t.indexOf(":")<0&&e&&80!=e&&(t+=":"+e),t;},xnm.aio.cams.SystemCam.prototype._addAuth=function(e){var t=this._$cam.attr("auth");if(t){t=(t=t.replace("@user",encodeURIComponent(this._options.user))).replace("@pwd",encodeURIComponent(this._options.password));var o="&";-1==e.indexOf("?")&&(o="?"),e+=o+t;}return e;},xnm.aio.cams.SystemCam.prototype._doRequest=function(e,t,o){var i=require("url").parse(e);i.port||(i.port=80);var n={host:i.hostname,port:i.port,path:i.path,method:"GET",user:this._options.user,password:this._options.password,headers:{"Content-Type":'text/xml; charset="utf-8"',Authorization:"Basic "+new Buffer(this._options.user+":"+this._options.password).toString("base64"),Connection:"close"}};t&&(n.method="POST",n.headers["Content-Length"]=t.length);var r=require("http").request(n,function(e){o&&o(e);});r.on&&r.on("error",function(e){o&&o();}),t&&r.write(t),r.end();},xnm.aio.cams.SystemCam.prototype.executeCommand=function(e){if(this.controlurl){var t=this;this._$cam.find("key").each(function(){var o=$(this);if(o.attr("id")==e){var i=t.controlurl.replace("%@",o.attr("code")),n=null;t.controlpostdata&&(i=t.controlurl,n=t.controlpostdata.replace("%@",o.attr("code"))),t._doRequest(i,n,function(o){var n=500;"left"!=e&&"right"!=e||(n=800),"XS100"==t._$cam.attr("id")?setTimeout(function(){i=t.controlurl.replace("%@","1"),t._doRequest(i);},n):t._$cam.attr("stop")&&setTimeout(function(){i=t.controlurl.replace("%@",t._$cam.attr("stop")),t._doRequest(i);},n/2);});}});}},xnm.aio.cams.JPEGCam=function(e,t,o,i){this._url=e,this._imgPath=o,this._imgPage=i,this._options=t,this._prevDone=!0;},xnm.aio.cams.JPEGCam.prototype._loadImage=function(e){var t=require("fs"),o=this;this._loadImage2Tmp(function(i,n){if(i&&t.existsSync(i)){var r=null;r="object"==(typeof nw==="undefined"?"undefined":_typeof(nw))?nw.App.dataPath+"/../cams/":t.dataPath()+"/cams/";var a="image.jpg";if(o._options&&o._options.imageName&&(a=o._options.imageName),t.mkdirRecursiveSync(r),t.existsSync(r+a)){var s=r+a+"_"+new Date().getTime();xnm.aio.cams.rename(r+a,s,function(){t.existsSync(s)&&t.unlinkSync(s),xnm.aio.cams.rename(i,r+a,function(){e&&e("file://"+r+a+"?"+new Date().getTime());});});}else xnm.aio.cams.rename(i,r+a,function(){e&&e("file://"+r+a+"?"+new Date().getTime());});}else e&&e(null,n);});},xnm.aio.cams.JPEGCam.prototype._loadImage2Tmp=function(e){if(this._url){if(this._prevDone){var t=require("http"),o=(require("fs"),this);this._prevDone=!1,t.getFile(this._url,this._options,function(t,i){t?e&&e(t):(XC.debugf("failed to load "+o._url),e&&e(null,i)),o._prevDone=!0;},null,{encodeURL:!1});}else e&&e();}else XC.debugf("[xnm.aio.cams.JPEGCam._loadImage] No URL set!");},xnm.aio.cams.JPEGCam.prototype._getImagePath=function(e){var t=require("url").parse(this._imgPath);t.port||(t.port=80),this._ip=t.hostname+":"+t.port;var o={host:t.hostname,port:t.port,path:t.path,method:"GET",user:this._options.user,password:this._options.password,headers:{"Content-Type":'text/xml; charset="utf-8"',Authorization:"Basic "+new Buffer(this._options.user+":"+this._options.password).toString("base64"),Connection:"close"}},i=require("http").request(o,function(t){t.setEncoding("utf-8");var o="";t.on("data",function(e){o+=e;}),t.on("end",function(){e&&e(o);});});i.on&&i.on("error",function(t){e&&e();}),i.end();},xnm.aio.cams.JPEGCam.prototype._getImagePage=function(e){var t=require("url").parse(this._imgPage);t.port||(t.port=80),this._ip=t.hostname+":"+t.port;var o={host:t.hostname,port:t.port,path:t.path,method:"GET",user:this._options.user,password:this._options.password,headers:{"Content-Type":'text/xml; charset="utf-8"',Authorization:"Basic "+new Buffer(this._options.user+":"+this._options.password).toString("base64"),Connection:"close"}},i=require("http").request(o,function(t){t.setEncoding("utf-8");var o="";t.on("data",function(e){o+=e;}),t.on("end",function(){200!=t.statusCode?e&&e(new Error("http status code:"+t.statusCode)):e&&e(null,o),e=null;});});i.setTimeout&&i.setTimeout(5e3,function(){e&&e(new Error("timeout")),e=null;}),i.on&&i.on("error",function(t){e&&e(t),e=null;}),i.end();},xnm.aio.cams.JPEGCam.prototype.loadImage=function(e){var t=this;this._imgPath?this._getImagePath(function(o){if(t._url=null,o){var i=o.indexOf('path="'),n=o.lastIndexOf('"');i>-1&&n>i&&(t._url="http://"+t._ip+o.substring(i+6,n));}t._loadImage(e);}):this._imgPage?this._getImagePage(function(o,i){if(!o&&i){t._url=null;var n=i.substr(i.indexOf('<img src="')+10);n=(n=n.substr(0,n.indexOf('"/>'))).substr(2),t._url="http://"+t._ip+n,t._loadImage(e);}else e&&e();}):this._loadImage(e);},xnm.aio.cams.JPEGCam.prototype.loadImage2Tmp=function(e){if(this._imgPath){var t=this;this._getImagePath(function(o){if(t._url=null,o){var i=o.indexOf('path="'),n=o.lastIndexOf('"');i>-1&&n>i&&(t._url="http://"+t._ip+o.substring(i+6,n));}t._loadImage2Tmp(e);});}else this._loadImage2Tmp(e);},xnm.aio.cams.MJPEGCam=function(e,t){this._url=e,this._options=t,this._mjpegClient=null,this._loading=!1;},xnm.aio.cams.MJPEGCam.prototype._loadImage=function(e){var t=require("fs"),o=this;this._loadImage2Tmp(function(i){if(i){if(t.existsSync(i)){var n=null;n="object"==(typeof nw==="undefined"?"undefined":_typeof(nw))?nw.App.dataPath+"/../cams/":t.dataPath()+"/cams/";var r="image.jpg";if(o._options&&o._options.imageName&&(r=o._options.imageName),t.mkdirRecursiveSync(n),t.existsSync(n+r)){var a=n+r+"_"+new Date().getTime();xnm.aio.cams.rename(n+r,a,function(){t.existsSync(a)&&t.unlinkSync(a),xnm.aio.cams.rename(i,n+r,function(){e&&e("file://"+n+r+"?"+new Date().getTime());});});}else xnm.aio.cams.rename(i,n+r,function(){e&&e("file://"+n+r+"?"+new Date().getTime());});}}else e&&e();});},xnm.aio.cams.MJPEGCam.prototype._loadImage2Tmp=function(e){if(this._url){if(!this._mjpegClient){var t=require("x.mjpeg.js");this._mjpegClient=t.getClient(this._url,this._options);}if(this._loading)e&&e();else{require("fs");var o=this;this._loading=!0,this._mjpegClient.getFile(this._url,this._options,function(t){o._loading=!1,t?e&&e(t):(XC.debugf("failed to load "+o._url),e());});}}else e&&e();},xnm.aio.cams.MJPEGCam.prototype.loadImage=function(e){this._loadImage(e);},xnm.aio.cams.MJPEGCam.prototype.loadImage2Tmp=function(e){this._loadImage2Tmp(e);},xnm.aio.cams.FoscamDiscovery=function(){this._sockets=[];var e=require("os"),t=require("dgram");if(e&&e.networkInterfaces){var o=this,i=t.createSocket("udp4");i.bind(9600,"0.0.0.0"),i.on("message",function(e,t){o._receivedData(t.address,e.toString("hex"));});var n=e.networkInterfaces();for(var r in n){for(var a=n[r],s=0;s<a.length;s++){this._addDiscoverSocket(9600,a[s]);}}}else this._addDiscoverSocket(9600,null);},xnm.aio.cams.FoscamDiscovery.prototype._receivedData=function(e,t){XC.debugf("Received camdata from "+e);},xnm.aio.cams.FoscamDiscovery.prototype._addDiscoverSocket=function(e,t){var o=require("dgram"),i=this;if(t){if("IPv4"==t.family&&0==t.internal){var n;(n=o.createSocket("udp4")).on("listening",function(){n.setBroadcast(!0);}),n.bind(e,t.address),this._sockets.push(n);}}else(n=o.createSocket("udp4")).on("message",function(e,t){i._receivedData(t.address,e.toString("hex"));}),this._sockets.push(n);},xnm.aio.cams.FoscamDiscovery.prototype._sendDiscoveryMessages=function(e,t,o,i){for(var n=new Buffer([77,79,95,73,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,4,0,0,0,0,0,0,1]),r=new Buffer([68,72,1,1]),a=0;a<this._sockets.length;a++){this._sockets[a].send(n,0,n.length,1e4,"255.255.255.255"),this._sockets[a].send(r,0,r.length,8600,"255.255.255.255");}},xnm.aio.cams.FoscamDiscovery.prototype.discoverCams=function(){var e=this,t=0,o=setInterval(function(){e._sendDiscoveryMessages(),t++>=4&&clearInterval(o);},250);},xnm.aio.cams.Cam=function(){var Cam=function Cam(e,t){this._options=e,this._camInfo=t;};return Cam.prototype.getIP=function(){if(!this._options)return null;var e=this._options.ip,t=e.indexOf(":");return-1!=t&&(e=e.substr(0,t)),e;},Cam.prototype.getPort=function(){if(!this._options)return null;var e=this._options.port,t=this._options.ip,o=t.indexOf(":");return e||-1==o||(e=parseInt(t.substr(o+1))),e;},Cam.prototype.getUsername=function(){return this._options?this._options.username:null;},Cam.prototype.getPassword=function(){return this._options?this._options.password:null;},Cam.prototype.getVideoInfo=function(e){var t={username:this._options.username,password:this._options.password,jpeg:this.getJPEGURL(),mjpeg:this.getMJPEGURL(),jpegPath:this.getJPEGPathURL(),jpegPage:this.getJPEGPageURL()};e&&e(null,t);},Cam.prototype.getJPEGURL=function(){if(!this._camInfo||!this._camInfo.imageurl)return null;var e=this.getRootUrl()+this._camInfo.imageurl;return this._addAuth(e);},Cam.prototype.getJPEGPathURL=function(){return this._camInfo&&this._camInfo.imagepathurl?this._addAuth(this.getRootUrl()+this._camInfo.imagepathurl):null;},Cam.prototype.getJPEGPageURL=function(){return this._camInfo&&this._camInfo.imagepageurl?this._addAuth(this.getRootUrl()+this._camInfo.imagepageurl):null;},Cam.prototype.getMJPEGURL=function(){if(!this._camInfo||!this._camInfo.mjpegurl)return null;var e=this.getRootUrl()+this._camInfo.mjpegurl;if("true"==this._camInfo.useurlauth){var t="";this._options.username&&(t=this._options.username+":"+(this._options.password?this._options.password:"")),e=this.getRootUrl(t)+this._camInfo.mjpegurl;}return this._addAuth(e);},Cam.prototype.executeCommandCreator=function(e,t,o){this.executeCommand(t.value,o);},Cam.prototype.getStatesCreator=function(e,t,o){o&&o(null,[]);},Cam.prototype.executeCommand=function(e,t){if(e){if("snapshot"!=e){var o=this._buildControlUrl(e);if(o){var i=this._buildPostData(e),n={user:this._options.username,password:this._options.password},r=this;this._doRequest(o,n,i,function(o,i){var n=500;"left"!=e&&"right"!=e||(n=800),"XS100"==r._camInfo.id||"telefunken.XS100"==r._camInfo.link?setTimeout(function(){var e=r._buildControlUrlRaw("1");r._doRequest(e,r._options,null,null);},n):r._camInfo.stop&&setTimeout(function(){var e=r._buildControlUrlRaw(r._camInfo.stop);r._doRequest(e,r._options,null,null);},n/2),t&&t(o,i);});}else t&&t(new Error("build control url error"));}else this.snapshot(t);}else t&&t(new Error("command is empty"));},Cam.prototype.getRootUrl=function(e){var t="http://",o=this._options.ip;"https://"==o.substr(0,8).toLowerCase()?(t="https://",o=o.substr(8)):"http://"==o.substr(0,7).toLowerCase()&&(o=o.substr(7));var i=this._options.port,n=o.indexOf(":");return-1!=n&&(i=o.substr(n+1),o=o.substr(0,n)),i||(i="https://"==t?443:80),t+(e?e+"@":"")+o+":"+i;},Cam.prototype._buildControlUrl=function(e){if(!this._camInfo||!this._camInfo.controlurl)return null;var t=this._decodeXml(this._camInfo.controlurl),o=this._getCommandCode(e);if(!o)return null;o=this._decodeXml(o);var i=this.getRootUrl()+t.replace("%@",o);return this._addAuth(i);},Cam.prototype._buildControlUrlRaw=function(e){if(!this._camInfo||!this._camInfo.controlurl)return null;if(!e)return null;var t=this._decodeXml(this._camInfo.controlurl);e=this._decodeXml(e);var o=this.getRootUrl()+t.replace("%@",e);return this._addAuth(o);},Cam.prototype._buildPostData=function(e){if(!this._camInfo||!this._camInfo.controlpostdata)return null;var t=this._getCommandCode(e);return t?(t=this._decodeXml(t),this._camInfo.controlpostdata.replace("%@",t)):null;},Cam.prototype._getCommandCode=function(e){if(!e||!this._camInfo||!this._camInfo.keys)return null;for(var t=0;t<this._camInfo.keys.length;t++){var o=this._camInfo.keys[t];if(o.id&&o.id==e)return o.code;}return null;},Cam.prototype._addAuth=function(e){if(!this._camInfo||!this._camInfo.auth)return e;var t=this._camInfo.auth;t=(t=this._decodeXml(t)).replace("@user",this._options.username?encodeURIComponent(this._options.username):""),t=this._options&&"instar"==this._options.manufacturer?t.replace("@pwd",this._options.password?this._options.password:""):t.replace("@pwd",this._options.password?encodeURIComponent(this._options.password):"");var o="&";return-1==e.indexOf("?")&&(o="?"),e+=o+t;},Cam.prototype._decodeXml=function(e){return e.replace(/&apos;/g,"'").replace(/&quot;/g,'"').replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&");},Cam.prototype._doRequest=function(e,t,o,i,n){var r=require("url").parse(e),a=require("http");"https"==e.substring(0,5).toLowerCase()&&(a=require("https"),r.port||(r.port=443)),r.port||(r.port=80);var s={host:r.hostname,port:r.port,path:r.path,method:"GET",headers:{"Content-Type":'text/xml; charset="utf-8"',Connection:"close"}};n?s.headers.Authorization=n:t.user&&(t.password||(t.password=""),s.user=t.user,s.password=t.password,s.headers.Authorization="Basic "+new Buffer(t.user+":"+t.password).toString("base64")),o&&(s.method="POST",s.headers["Content-Length"]=o.length);var p=this,d=a.request(s,function(r){r.setEncoding("utf-8");var a="";r.on("data",function(e){a+=e;}),r.on("end",function(){var d;if(XC.debugf("response:"+r.statusCode),401==r.statusCode&&!n&&r.headers&&r.headers["www-authenticate"]&&"Digest "==r.headers["www-authenticate"].substr(0,7)){n=null;var c=require("x.crypt.js");if(n=c.DigestAuth(r.headers["www-authenticate"],s.path,t.user,t.password,s.method))return n+=', opaque=""',XC.debugf("do digest auth:"+n),void p._doRequest(e,t,o,i,n);d=new Error("http response:"+r.statusCode);}else 200!=r.statusCode&&(d=new Error("http response:"+r.statusCode));i&&i(d,a);});});d.on&&d.on("error",function(e){i&&i(e);}),o&&d.write(o),d.end();},Cam.prototype.snapshot=function(e){this.getVideoInfo(function(t,o){if(t)e&&e(t);else{var i={user:o.username,password:o.password};if(o.jpeg||o.jpegPath||o.jpegPage)new xnm.aio.cams.JPEGCam(o.jpeg,i,o.jpegPath,o.jpegPage).loadImage2Tmp(function(t){t?e&&e(null,t):e&&e(new Error("load image error"));});else if(o.mjpeg){new xnm.aio.cams.MJPEGCam(o.mjpeg,i).loadImage2Tmp(function(t){t?e&&e(null,t):e&&e(new Error("load image error"));});}else e&&e(new Error("not support snapshot"));}});},Cam.prototype.equalsTo=function(e){return!!e&&e instanceof Cam&&!(this._options&&!e._options||!this._options&&e._options||!this._options&&!e._options)&&this._options.ip==e._options.ip&&this._options.port==e._options.port&&this._options.username==e._options.username&&this._options.password==e._options.password&&this._options.type==e._options.type&&this._options.model==e._options.model;},Cam;}(),xnm.aio.cams.DoorBird=(DoorBird=function DoorBird(e,t){xnm.aio.cams.Cam.call(this,e,t),this._logger=require("x.logger.js").getLogger("xnm.aio.cams.DoorBird.["+e.username+"@"+e.ip+"]");},DoorBird.prototype=new xnm.aio.cams.Cam(),DoorBird.prototype.constructor=xnm.aio.cams.DoorBird,DoorBird.prototype.getRefId=function(){return this._options.username+":"+this._options.password+"@"+this._options.ip+":"+this._options.port;},DoorBird.prototype.executeCommandCreator=function(e,t,o){this.executeCommand(t,o);},DoorBird.prototype.getStatesCreator=function(e,t,o){this.getStates(function(e,i){var n=[];if(!e&&i)for(var r=0;r<t.length;r++){if(t[r]&&t[r].id){var a="?";if(t[r].status&&t[r].status.value){var s=t[r].status.value;null!=i[s]&&void 0!==i[s]&&(a=i[s],n.push({id:t[r].id,status:a}));}}}o&&o(null,n);});},DoorBird.prototype.executeCommand=function(e,t){if(e&&e.value){if("open_app"==e.value||"open_live"==e.value){if(window&&window.XC&&window.XC.callHost&&window.XCHost&&window.XCHost.getType&&("iOS"==window.XCHost.getType()||"Android"==window.XCHost.getType()))if("open_app"==e.value)window.XC.callHost("SYSTEM","startApp",{scheme:"doorbird://"});else{var o=this._options.username.substr(0,6);window.XC.callHost("SYSTEM","startApp",{scheme:"doorbird://live/"+o});}t&&t();}else if("open_door"==e.value||"open_relay"==e.value||"open_relay_custom"==e.value){var i=e.ext;this.openDoor(i,t);}else"light_on"==e.value?this.lightOn(t):t&&t(new Error("command unknown"));}else t&&t(new Error("command invalid"));},DoorBird.prototype.getStates=function(e){this._logger.log("debug","get states");var t=require("xnm.aio.cams.js").getDoorBirdHandler(),o=t.getMonitor(this._options);o||(this._logger.log("trace","add monitor"),t._udpMonitor.isRunning()||t.startUdpMonitor(),o=t.addMonitor(this._options));var i={ring:!1,motion:!1,ringT:null,ringTStr:null,motionT:null,motionTStr:null},n=o._stateBuffer;if(n){this._logger.log("debug","buffered states in monitor:"+JSON.stringify(n));var r=new Date().getTime();for(var a in n){var s=n[a];s&&s.length&&("motion"==a?1==s[0]&&r-s[1]<=1e4&&(i.motion=!0):"ring"==a?1==s[0]&&r-s[1]<=1e4&&(i.ring=!0):"ringT"==a?(i.ringT=s[0],i.ringTStr=new Date(s[0]).toLocaleString()):"motionT"==a&&(i.motionT=s[0],i.motionTStr=new Date(s[0]).toLocaleString()));}}if(i.ringT)return this._logger.log("debug","return states:"+JSON.stringify(i)),void(e&&e(null,i));var p=this;this.getHistory("doorbell",1,function(t,o,r){null!=o&&(i.ringT=1e3*o,i.ringTStr=new Date(1e3*o).toLocaleString(),n.ringT=[i.ringT]),p._logger.log("debug","return states:"+JSON.stringify(i)),e&&e(null,i);});},DoorBird.prototype.getInfo=function(e){this._doRequest("/bha-api/info.cgi",function(t,o){if(t)e&&e(t);else try{var i=JSON.parse(o);if(!(i&&i.BHA&&i.BHA.VERSION&&i.BHA.VERSION.length&&1==i.BHA.RETURNCODE))return void(e&&e(new Error("info response invaild")));e&&e(null,i.BHA.VERSION[0]);}catch(t){e&&e(t);}});},DoorBird.prototype.openDoor=function(e,t){this._logger.log("debug","open door (relay="+e+")");var o="/bha-api/open-door.cgi";e&&(o+="?r="+encodeURIComponent(e));var i=this;this._doRequest(o,function(o,n){i._logger.log("debug","open door (relay="+e+")"+(o?" failed:"+o.message:" success")),t&&t(o);});},DoorBird.prototype.lightOn=function(e){this._logger.log("debug","light on");var t=this;this._doRequest("/bha-api/light-on.cgi",function(o,i){t._logger.log("debug","light on"+(o?" failed:"+o.message:" success")),e&&e(o);});},DoorBird.prototype.loadHistoryImage=function(e,t,o){this._logger.log("trace","load image "+t+"@"+e);var i=this._options.ip,n=this._options.port;n||(n=80);var r="http://"+i+":"+n+"/bha-api/history.cgi?index="+t+"&event="+e;this._logger.log("trace","load image: "+r);var a={user:this._options.username,password:this._options.password},s=this;require("xnm.aio.cams.js").createJPEGCam(r,a).loadImage(function(i,n){s._logger.log("trace","load image "+t+"@"+e+" finish: file="+i),o&&o(i,n);});},DoorBird.prototype.getHistory=function(e,t,o){var i=this;this._logger.log("trace","get history "+t+"@"+e),this._doRequest("/bha-api/history.cgi?index="+t+"&event="+e,function(n,r,a){if(n)return i._logger.log("trace","get history "+t+"@"+e+" failed:"+n.message),void(o&&o(n));i._logger.log("trace","get history "+t+"@"+e+" headers:"+(a?JSON.stringify(a):"none"));var s=null,p=null;a&&(null!=a["x-count"]&&null!=a["x-count"]&&(s=parseInt(a["x-count"])),null!=a["x-timestamp"]&&null!=a["x-timestamp"]&&(p=parseInt(a["x-timestamp"]))),o&&o(null,p,s);});},DoorBird.prototype._doRequest=function(e,t){var o=this._options.ip,i=this._options.port;i||(i=80);var n="http://"+o+":"+i+e;this._logger.log("trace","send to url:"+n);var r={host:o,port:i,path:e,method:"GET",headers:{Connection:"close"}};this._options.username&&(this._options.password||(this._options.password=""),r.headers.Authorization="Basic "+new Buffer(this._options.username+":"+this._options.password).toString("base64"));var a=require("http").request(r,function(e){e.setEncoding("utf-8");var o="";e.on("data",function(e){o+=e;}),e.on("end",function(){var i;200!=e.statusCode&&(i=new Error("http response:"+e.statusCode)),t&&t(i,o,e.headers);});});a.setTimeout&&a.setTimeout(2e3,function(){a.abort();}),a.on&&a.on("error",function(e){t&&t(e);}),a.end();},DoorBird.Handler=function(){var NativeDecrypter=function NativeDecrypter(){this._logger=require("x.logger.js").getLogger("xnm.aio.cams.DoorBird.Handler.NativeDecrypter");};NativeDecrypter.prototype.decrypt=function(e,t,o){this._logger.log("trace","decrypt data:"+e);var i=t.substr(0,5),n=this;XC.callHost("doorbird","decryptUdpMessage",{data:e,password:i},function(e){n._logger.log("trace","decrypt result:"+JSON.stringify(e)),e?e.error?o&&o(new Error(e.error)):o&&o(null,e):o&&o(new Error("no reponse from xc doorbird module"));});};var NodeJSDecrypter=function NodeJSDecrypter(){this._logger=require("x.logger.js").getLogger("xnm.aio.cams.DoorBird.Handler.NodeJSDecrypter");};NodeJSDecrypter.prototype.decrypt=function(e,t,o){this._logger.log("trace","decrypt data:"+e.substr(0,10)+"...");var i=parseInt(e.substr(8,8),16),n=parseInt(e.substr(16,8),16),r=new Buffer(e.substr(24,32),"hex"),a=new Buffer(e.substr(56,16),"hex"),s=new Buffer(e.substr(72),"hex");t=new Buffer(t.substr(0,5),"utf8");var p=null,d=new Buffer(32);if((p=require("sodium").api).crypto_pwhash_argon2i(d,t,r,i,n,1)){var c=p.crypto_aead_chacha20poly1305_decrypt(s,null,a,d);if(c){var m={intercom_id:c.slice(0,6).toString("utf8"),event:c.slice(6,14).toString("utf8").trim(),timestamp:c.slice(14,18).readInt32BE()};this._logger.log("trace","decrypt result:"+JSON.stringify(m)),o&&o(null,m);}else o&&o(new Error("decrypt failed"));}else o&&o(new Error("password hash failed"));};var NWJSDecrypter=function NWJSDecrypter(){this._logger=require("x.logger.js").getLogger("xnm.aio.cams.DoorBird.Handler.NWJSDecrypter");};NWJSDecrypter.prototype.decrypt=function(e,t,o){this._logger.log("trace","decrypt data:"+e);var i=this,n=parseInt(e.substr(8,8),16),r=parseInt(e.substr(16,8),16),a=new Buffer(e.substr(24,32),"hex"),s=new Buffer(e.substr(56,16),"hex"),p=new Buffer(e.substr(72),"hex");t=new Buffer(t.substr(0,5),"utf8");var d=null,c=new Buffer(32);(d=require("libsodium-wrappers")).ready["catch"](function(e){o&&o(e);}),d.ready.then(function(){var e=null;try{var m=d.crypto_pwhash(c.length,d.from_string(t.toString("utf8")),a,n,r,d.crypto_pwhash_ALG_ARGON2I13);e=d.crypto_aead_chacha20poly1305_decrypt(null,p,null,s,m);}catch(e){return void(o&&o(e));}var l={intercom_id:Buffer.from(e.slice(0,6)).toString("utf8"),event:Buffer.from(e.slice(6,14)).toString("utf8").trim(),timestamp:Buffer.from(e.slice(14,18)).readInt32BE()};i._logger.log("trace","(libsodium-wrappers) decrypt result:"+JSON.stringify(l)),o&&o(null,l);});};var HttpMonitor=function HttpMonitor(e,t){var o=this._gentId(e);this._logger=require("x.logger.js").getLogger("xnm.aio.cams.DoorBird.HttpMonitor.["+o+"]"),this._listener=t,this._doorbird=e,this._running=!1,this._req=null,this._reconnectTO=null,this.reconnTimeout=5,this.dataTimeout=30,this._dataTO=null;};HttpMonitor.prototype._gentId=function(e){return e.username+"@"+e.ip;},HttpMonitor.prototype.start=function(){this._logger.log("debug","start monitor"),this._running||(this._running=!0,this._startHttpMonitor());},HttpMonitor.prototype.stop=function(e){this._logger.log("debug","stop monitor"),this._running?(this._running=!1,this._stopHttpMonitor(),e&&e(null,!0)):e&&e(null,!0);},HttpMonitor.prototype.updateIP=function(e){this._stopHttpMonitor(),this._doorbird.ip=e;var t=this._gentId(this._doorbird);this._logger=require("x.logger.js").getLogger("xnm.aio.cams.DoorBird.HttpMonitor.["+t+"]"),this._startHttpMonitor();},HttpMonitor.prototype._startHttpMonitor=function(){this._logger.log("debug","start http monitor");var e=this._doorbird.ip,t=this._doorbird.port,o=e.indexOf(":");-1==o||t||(t=e.substr(o+1)),t||(t=80);var i="/bha-api/monitor.cgi?ring=doorbell,motionsensor",n=this,r="http://"+e+":"+t+i;this._logger.log("trace","send to url:"+r);var a={host:e,port:t,path:i,method:"GET",headers:{}},s=this._doorbird.username,p=this._doorbird.password;s&&(a.auth=s+":"+(p||""));var d=!1,c=!1,m=require("http").request(a,function(t){t.setEncoding("utf-8"),t.on("data",function(t){d=!0,n._dataTO&&(clearTimeout(n._dataTO),n._dataTO=null),n._dataTO=setTimeout(function(){n._logger.log("warn","monitor data timeout:"+e),m.abort(),c||(c=!0,n._onClose(new Error("data timeout")));},1e3*n.dataTimeout),n._onData(t);}),t.on("end",function(){var e;509==t.statusCode?e=new Error("door bird busy"):200!=t.statusCode&&(e=new Error("door bird monitor reutrn http:"+t.statusCode)),c||(c=!0,n._onClose(e));});});m.setTimeout(2e3,function(){d||(m.abort(),c||(c=!0,n._onClose(new Error("connection timeout"))));}),m.on("error",function(e){c||(c=!0,n._onClose(e));}),m.end(),this._req=m;},HttpMonitor.prototype._stopHttpMonitor=function(){this._logger.log("debug","stop http monitor"),this._dataTO&&(clearTimeout(this._dataTO),this._dataTO=null),this._req&&this._req.abort();},HttpMonitor.prototype._reconnect=function(){this._logger.log("trace","reconnect monitor in "+this.reconnTimeout+" s"),this._reconnectTO&&(clearTimeout(this._reconnectTO),this._reconnectTO=null);var e=this;this._reconnectTO=setTimeout(function(){e._startHttpMonitor();},1e3*this.reconnTimeout);},HttpMonitor.prototype._onData=function(e){this._listener&&this._listener.onHttpData&&this._listener.onHttpData(e);},HttpMonitor.prototype._onClose=function(e){this._logger.log("debug","http monitor closed:"+(e?" err: "+e.message:"")),this._dataTO&&(clearTimeout(this._dataTO),this._dataTO=null),this._running&&this._reconnect();};var UdpMonitor=function UdpMonitor(e){this._logger=require("x.logger.js").getLogger("xnm.aio.cams.DoorBird.Handler.UdpMonitor"),this._sockets=[],this._port=35344,this._running=!1,this._listener=e;};UdpMonitor.prototype.start=function(){this._running||(this._running=!0,this._addDiscoverSocket(this._port,null));},UdpMonitor.prototype.isRunning=function(){return this._running;},UdpMonitor.prototype._addDiscoverSocket=function(e,t){var o,i=require("dgram"),n=this;if(this._logger.log("trace","bind udp monitor on port "+e+(t?" ip "+t.address:"")),t){if("IPv4"==t.family&&0==t.internal){try{o=i.createSocket({reuseAddr:!0,type:"udp4"});}catch(e){o=i.createSocket("udp4");}o.on("listening",function(){o.setBroadcast(!0);}),o.on("message",function(e,t){n._receivedData(t.address,e);}),o.on("error",function(e){n._logger.log("trace","bind udp monitor error "+e.message);}),o.bind(e,t.address),this._sockets.push(o);}}else{try{o=i.createSocket({reuseAddr:!0,type:"udp4"});}catch(e){o=i.createSocket("udp4");}o.on("message",function(e,t){n._receivedData(t.address,e);}),o.on("error",function(e){n._logger.log("trace","bind udp monitor error "+e.message);}),o.bind(e),this._sockets.push(o);}},UdpMonitor.prototype._receivedData=function(e,t){t=t.toString("hex"),this._logger.log("trace","receive data from "+e+" data "+t),this._listener&&this._listener.onUdpData&&this._listener.onUdpData(e,t);};var Monitor=function Monitor(e){var t=e.username+"@"+e.ip;this._logger=require("x.logger.js").getLogger("xnm.aio.cams.DoorBird.Monitor.["+t+"]"),this._useHttpMonitor=this._supportHttpMonitor(),this._doorbirdJSON=e,this._httpMonitor=new HttpMonitor(e,this),this._listeners=[],this._stateBuffer={};};Monitor.prototype._supportHttpMonitor=function(){var e=null;return window&&!window.XCHost&&(e="node-webkit"),window&&window.XCHost&&window.XCHost.getType&&(e=window.XCHost.getType()),"undefined"!=typeof nw||"node-webkit"==e||"undefined"!=typeof process&&null!=process&&"node"==process.title;},Monitor.prototype.getRefId=function(){return doorBird.username+":"+doorBird.password+"@"+doorBird.ip+":"+doorBird.port;},Monitor.prototype.addListener=function(e){e&&-1==this._listeners.indexOf(e)&&this._listeners.push(e);},Monitor.prototype.removeListener=function(e){var t=this._listeners.indexOf(e);-1!=t&&this._listeners.splice(t,1);},Monitor.prototype.start=function(){this._logger.log("debug","start monitor"),this._running||(this._running=!0,this._useHttpMonitor&&this._httpMonitor.start());},Monitor.prototype.stop=function(){this._logger.log("debug","stop monitor"),this._running&&(this._running=!1,this._listeners=[],this._useHttpMonitor&&this._httpMonitor.stop());},Monitor.prototype.updateDoorbird=function(e){if(this._doorbirdJSON&&this._doorbirdJSON.mac&&this._doorbirdJSON.mac==e.mac&&this._doorbirdJSON.ip!=e.ip){this._logger.log("debug","doorbird has new ip:"+e.ip);var t=this._doorbirdJSON.username+"@"+e.ip;this._logger=require("x.logger.js").getLogger("xnm.aio.cams.DoorBird.Monitor.["+t+"]"),this._useHttpMonitor&&this._httpMonitor.updateIP(e.ip);}},Monitor.prototype.onHttpData=function(e){this._logger.log("trace","receive notify:"+e.replace(/(\r\n|\n|\r)/gm,"\\n "));var t=e.indexOf("doorbell:"),o=null,i=null;-1!=t&&(o="H"==(o=e.substr(t+9,1))),-1!=(t=e.indexOf("motionsensor:"))&&(i="H"==(i=e.substr(t+13,1))),this._logger.log("debug","receive http event: ring="+o+" motion="+i),null!=i&&this._onEvent("motion",i),null!=o&&this._onEvent("ring",o);},Monitor.prototype.onUdpData=function(e,t){this._logger.log("trace","decrypt udp data");var o=this._doorbirdJSON;if(!o||!o.password)return this._logger.log("trace","decrypt data failed: no password"),void(t&&t(new Error("no password")));var i=this._getDecrypter();if(!i)return this._logger.log("trace","decrypt data failed: can not find decrypter"),void(t&&t(new Error("can not find decrypter")));var n=this;i.decrypt(e,o.password,function(e,i){n._logger.log("trace","decrypt data "+(e?"failed: "+e.message:"success")),!e&&i&&(o.username&&o.username.indexOf(i.intercom_id),n._logger.log("debug","receive udp event: "+JSON.stringify(i)),"motionsensor"==i.event||"motion"==i.event?n._onEvent("motion",!0):isNaN(parseInt(i.event))||n._onEvent("ring",!0)),t&&t(e,i);});},Monitor.prototype._onEvent=function(e,t){var o=new Date().getTime();this._stateBuffer[e]=[t,o],"ring"==e&&1==t?this._stateBuffer.ringT=[o]:"motion"==e&&1==t&&(this._stateBuffer.motionT=[o]);for(var i=0;i<this._listeners.length;i++){var n=this._listeners[i];if(n.onEvent)try{n.onEvent(e,t);}catch(e){}}},Monitor.prototype._getDecrypter=function(){var e=null;return window&&!window.XCHost&&(e="node-webkit"),window&&window.XCHost&&window.XCHost.getType&&(e=window.XCHost.getType()),"undefined"!=typeof nw?new NWJSDecrypter():"node-webkit"==e||"undefined"!=typeof process&&null!=process&&"node"==process.title?new NodeJSDecrypter():new NativeDecrypter();};var Handler=function Handler(){this._logger=require("x.logger.js").getLogger("xnm.aio.cams.DoorBird.Handler"),this._udpMonitor=new UdpMonitor(this),this._monitors={};};return Handler.prototype.finalize=function(){for(var e in this._monitors){var t=this._monitors[e];t&&t.stop();}this._monitors={};},Handler.prototype.startUdpMonitor=function(){this._udpMonitor.start();},Handler.prototype.addMonitor=function(e){if(e){var t=e.username+":"+e.password+"@"+e.ip,o=this._monitors[t];if(o)throw new Error("monitor already exit");return o=new Monitor(JSON.parse(JSON.stringify(e))),this._monitors[t]=o,o.start(),o;}},Handler.prototype.removeMonitor=function(e){if(e){var t=e.username+":"+e.password+"@"+e.ip,o=this._monitors[t];o&&(o.stop(),delete this._monitors[t]);}},Handler.prototype.getMonitor=function(e){if(!e)return null;var t=e.username+":"+e.password+"@"+e.ip;return this._monitors[t];},Handler.prototype.onUdpData=function(e,t){if(t&&"DEADBE"==t.substr(0,6).toUpperCase()&&"01"==t.substr(6,2)){var o=Object.keys(this._monitors);if(o.length){var i=0,n=this,cb=function cb(){++i<o.length&&n._monitors[o[i]].onUdpData(t,cb);};this._monitors[o[i]].onUdpData(t,cb);}}},Handler;}(),DoorBird),xnm.aio.cams.Foscam=function(e,t){xnm.aio.cams.Cam.call(this,e,t),this._logger=require("x.logger.js").getLogger("xnm.aio.cams.Foscam");},xnm.aio.cams.Foscam.prototype=new xnm.aio.cams.Cam(),xnm.aio.cams.Foscam.prototype.constructor=xnm.aio.cams.Foscam,xnm.aio.cams.Foscam.prototype.executeCommandCreator=function(e,t,o){t?"gotoPreset"==t.value?this._gotoPreset(e,t,o):this.executeCommand(t.value,o):o&&o(new Error("command invalid"));},xnm.aio.cams.Foscam.prototype._gotoPreset=function(e,t,o){if(void 0!==t.ext&&null!=t.ext){if(this._camInfo&&this._camInfo.controlurl){var i,n=this._decodeXml(this._camInfo.controlurl);if("/cgi-bin/CGIProxy.fcgi?cmd=%@"==n?i="ptzGotoPresetPoint&name="+encodeURIComponent(t.ext):"/web/cgi-bin/hi3510/%@"==n&&(i="preset.cgi?-act=goto&-number="+encodeURIComponent(t.ext)),i){var r=this.getRootUrl()+n.replace("%@",i);r=this._addAuth(r);var a={user:this._options.username,password:this._options.password};this._doRequest(r,a,null,function(e,t){o&&o(e,t);});}else o&&o(new Error("unknow preset command"));}else o&&o(new Error("no control url"));}else o&&o(new Error("command ext invalid"));},xnm.aio.cams.Welcome=function(e,t){xnm.aio.cams.Cam.call(this,e,t),this._logger=require("x.logger.js").getLogger("xnm.aio.cams.Welcome");},xnm.aio.cams.Welcome.prototype=new xnm.aio.cams.Cam(),xnm.aio.cams.Welcome.prototype.constructor=xnm.aio.cams.Welcome,xnm.aio.cams.Welcome.prototype.getVideoInfo=function(e){var t=require("xnm.aio.netatmo.js");if(t){var o=t.resolveGateway({refreshToken:this._options.refreshToken});o?o.getCamUrl(this._options.address,function(t,o){t?e&&e(t):e&&e(null,{hls:o});}):e&&e(new Error("netatmo cam info invalid"));}else e&&e(new Error("netatmo module not loaded"));},xnm.aio.cams.Mobotix=function(e,t){xnm.aio.cams.Cam.call(this,e,t),this._logger=require("x.logger.js").getLogger("xnm.aio.cams.Mobotix");},xnm.aio.cams.Mobotix.prototype=new xnm.aio.cams.Cam(),xnm.aio.cams.Mobotix.prototype.constructor=xnm.aio.cams.Mobotix,xnm.aio.cams.Mobotix.prototype.executeCommandCreator=function(e,t,o){if(t){if("gotoPreset"==t.value||"displayMode"==t.value||"customCMD"==t.value){if(void 0===t.ext||null==t.ext)return void(o&&o(new Error("command ext invalid")));var i,n;if("gotoPreset"==t.value){if(!this._camInfo||!this._camInfo.controlurl)return void(o&&o(new Error("no control url")));var r="loadview="+encodeURIComponent(t.ext);i=(n=this._decodeXml(this._camInfo.controlurl)).replace("%@",r);}else if("displayMode"==t.value)switch(n="/control/control?set&section=general&display_mode=",t.ext){case"Full Image":i=n+"simple";break;case"Normal":i=n+"lenscorr_l11";break;case"Surround":i=n+"surround";break;case"Panorama":i=n+"panorama";break;case"Panorama/Focus":i=n+"pano_focus";break;case"Double Panorama":i=n+"pano_dbl";}else i=t.ext;i&&this._sendRequest(i,function(e,t){o&&o(e,t);});}else this.executeCommand(t.value,o);}else o&&o(new Error("command invalid"));},xnm.aio.cams.Mobotix.prototype._gotoPreset=function(e,t,o){if(void 0!==t.ext&&null!=t.ext){if(this._camInfo&&this._camInfo.controlurl){var i="loadview="+encodeURIComponent(t.ext),n=this._decodeXml(this._camInfo.controlurl).replace("%@",i);this._sendRequest(n,function(e,t){o&&o(e,t);});}else o&&o(new Error("no control url"));}else o&&o(new Error("command ext invalid"));},xnm.aio.cams.Mobotix.prototype._sendRequest=function(e,t){var o=this.getRootUrl()+e;o=this._addAuth(o);var i={user:this._options.username,password:this._options.password};this._doRequest(o,i,null,function(e,o){t&&t(e,o);});},xnm.aio.cams.Axis=function(e,t){xnm.aio.cams.Cam.call(this,e,t),this._logger=require("x.logger.js").getLogger("xnm.aio.cams.Mobotix");},xnm.aio.cams.Axis.prototype=new xnm.aio.cams.Cam(),xnm.aio.cams.Axis.prototype.constructor=xnm.aio.cams.Axis,xnm.aio.cams.Axis.prototype.executeCommandCreator=function(e,t,o){t?"playClip"==t.value?this._playClip(e,t,o):"lightOn"==t.value||"lightOff"==t.value?this._setLight(e,t,o):"actOut"==t.value||"deactOut"==t.value?this._setOutput(e,t,o):this.executeCommand(t.value,o):o&&o(new Error("command invalid"));},xnm.aio.cams.Axis.prototype._playClip=function(e,t,o){if(void 0!==t.ext&&null!=t.ext){var i="/axis-cgi/playclip.cgi?clip="+t.ext,n=this.getRootUrl()+i;n=this._addAuth(n);var r={user:this._options.username,password:this._options.password};this._doRequest(n,r,null,function(e,t){o&&o(e,t);});}else o&&o(new Error("command ext invalid"));},xnm.aio.cams.Axis.prototype._setOutput=function(e,t,o){if(void 0!==t.ext&&null!=t.ext){var i=t.ext,n="\\";"actOut"==t.value&&(n="/");var r="/axis-cgi/io/port.cgi?action="+encodeURIComponent(i+":"+n),a=this.getRootUrl()+r;a=this._addAuth(a);var s={user:this._options.username,password:this._options.password};this._doRequest(a,s,null,function(e,t){o&&o(e,t);});}else o&&o(new Error("command ext invalid"));},xnm.aio.cams.Axis.prototype._setLight=function(e,t,o){if(t.value){var i="0";"lightOn"==t.value&&(i="100");var n="/axis-cgi/io/lightcontrol.cgi?action=L1:-"+i,r=this.getRootUrl()+n;r=this._addAuth(r);var a={user:this._options.username,password:this._options.password};this._doRequest(r,a,null,function(e,t){o&&o(e,t);});}else o&&o(new Error("command ext invalid"));},xnm.aio.cams.CAM_INFO={telefunken:{name:"Telefunken",versions:[{id:"XS100",name:"XS100",imageurl:"/snapshot.cgi",mjpegurl:"/videostream.cgi",controlurl:"/decoder_control.cgi?command=%@&amp;onestep=1",auth:"user=@user&amp;pwd=@pwd",pantilt:"true",link:"telefunken.XS100",keys:[{id:"left",code:"4&amp;degree=18"},{id:"right",code:"6&amp;degree=18"},{id:"up",code:"0&amp;degree=15"},{id:"down",code:"2&amp;degree=15"},{id:"switchOn",code:"94"},{id:"switchOff",code:"95"}]}]},konine:{name:"Konine",versions:[{id:"konine",name:"Konine IP Cam",imageurl:"/snapshot.cgi",mjpegurl:"/videostream.cgi",controlurl:"/decoder_control.cgi?command=%@",auth:"user=@user&amp;pwd=@pwd",pantilt:"true",link:"konine.konine",keys:[{id:"left",code:"4&amp;onestep=1"},{id:"right",code:"6&amp;onestep=1"},{id:"up",code:"0&amp;onestep=1"},{id:"down",code:"2&amp;onestep=1"},{id:"switchOn",code:"94&amp;onestep=1"},{id:"switchOff",code:"95&amp;onestep=1"},{id:"call1",code:"31&amp;onestep=0"},{id:"call2",code:"33&amp;onestep=0"},{id:"call3",code:"35&amp;onestep=0"},{id:"call4",code:"37&amp;onestep=0"},{id:"call5",code:"39&amp;onestep=0"},{id:"call6",code:"41&amp;onestep=0"},{id:"call7",code:"43&amp;onestep=0"},{id:"call8",code:"45&amp;onestep=0"},{id:"call9",code:"47&amp;onestep=0"},{id:"call10",code:"49&amp;onestep=0"},{id:"call11",code:"51&amp;onestep=0"},{id:"call12",code:"53&amp;onestep=0"},{id:"call13",code:"55&amp;onestep=0"},{id:"call14",code:"57&amp;onestep=0"},{id:"call15",code:"59&amp;onestep=0"},{id:"call16",code:"61&amp;onestep=0"}]}]},abus:{name:"ABUS",versions:[{id:"tv7204",name:"TV7204",pantilt:"false",link:"dlink.2000"}]},"7links":{name:"7Links",versions:[{id:"PX3615675",name:"PX-3615-675",link:"telefunken.XS100",pantilt:"true"},{id:"robocam1",name:"Robocam 1",imageurl:"/IMAGE.JPG",controlurl:"/PANTILTCONTROL.CGI",controlpostdata:"PanSingleMoveDegree=1&amp;TiltSingleMoveDegree=1&amp;PanTiltSingleMove=%@",pantilt:"true",link:"7links.robocam1",keys:[{id:"left",code:"3"},{id:"right",code:"2"},{id:"up",code:"1"},{id:"down",code:"7"},{id:"home",code:"4"}]},{id:"robocam2",name:"Robocam 2",imageurl:"/cgi/jpg/image.cgi",controlurl:"/users/ptctl.cgi?move=%@",pantilt:"true",link:"7links.robocam2",keys:[{id:"left",code:"left"},{id:"right",code:"right"},{id:"up",code:"up"},{id:"down",code:"down"},{id:"home",code:"h"}]},{id:"730hd",name:"IPC-730HD",imageurl:"/cgi-bin/CGIProxy.fcgi?cmd=snapPicture2",auth:"usr=@user&amp;pwd=@pwd",pantilt:"false",link:"7links.730hd"},{id:"730hd2",name:"IPC-730HD 2",imagepageurl:"/cgi-bin/CGIProxy.fcgi?cmd=snapPicture2",auth:"usr=@user&amp;pwd=@pwd",pantilt:"false",link:"7links.730hd2"},{id:"770hd",name:"IPC-770HD",imageurl:"/cgi-bin/video_snapshot.cgi",mjpegurl:"/cgi-bin/videostream.cgi",controlurl:"/cgi-bin/decoder_control.cgi?type=0&amp;cmd=%@&amp;onestep=1",auth:"user=@user&amp;pwd=@pwd",link:"7links.770hd",pantilt:"true",keys:[{id:"left",code:"2"},{id:"right",code:"3"},{id:"up",code:"0"},{id:"down",code:"1"}]},{id:"vga",name:"Generic Type",link:"telefunken.XS100",pantilt:"true"},{id:"hd",name:"Generic Type HD",link:"7links.770hd",pantilt:"true"}]},dlink:{name:"D-Link",versions:[{id:"dcs930",name:"DCS-930L",imageurl:"/image.jpg",mjpegurl:"/video.cgi",useurlauth:"true",link:"dlink.dcs930"},{id:"dcs942",name:"DCS-942L",imageurl:"/image/jpeg.cgi",mjpegurl:"/video/mjpg.cgi",useurlauth:"true",link:"dlink.dcs942"},{id:"2000",name:"DCS-2000",imageurl:"/cgi-bin/video.jpg?size=2",controlurl:"/cgi-bin/camctrl.cgi?%@",pantilt:"true",link:"dlink.2000",keys:[{id:"home",code:"move=home"},{id:"left",code:"move=left"},{id:"right",code:"move=right"},{id:"up",code:"move=up"},{id:"down",code:"move=down"},{id:"tele",code:"zoom=tele"},{id:"wide",code:"zoom=wide"}]},{id:"dcs2132",name:"DCS-2132L",imageurl:"/dms?nowprofileid=2",useurlauth:"true",link:"dlink.dcs2132"},{id:"dcs935",name:"DCS-935L",link:"dlink.dcs942",pantilt:"false"},{id:"dcs5222",name:"DCS-5222L",imageurl:"/image/jpeg.cgi",mjpegurl:"/video/mjpg.cgi",controlurl:"/cgi/ptdc.cgi?%@",pantilt:"true",link:"dlink.dcs5222",keys:[{id:"home",code:"command=go_home"},{id:"left",code:"command=set_relative_pos&posX=-10&posY=0"},{id:"right",code:"command=set_relative_pos&posX=10&posY=0"},{id:"up",code:"command=set_relative_pos&posX=0&posY=10"},{id:"down",code:"command=set_relative_pos&posX=0&posY=-10 "}]}]},hama:{name:"Hama",versions:[{id:"hwlancam",name:"WLAN IP",link:"telefunken.XS100",pantilt:"false"}]},nueva:{name:"Nueva",versions:[{id:"nueva",name:"NVI Camera",link:"telefunken.XS100",pantilt:"true"},{id:"hd",name:"NVI HD Camera",imageurl:"/snapshot.cgi",mjpegurl:"/videostream.cgi",controlurl:"/decoder_control.cgi?command=%@&amp;onestep=1",auth:"loginuse=@user&amp;loginpas=@pwd",pantilt:"true",link:"nueva.hd",keys:[{id:"left",code:"4&amp;degree=18"},{id:"right",code:"6&amp;degree=18"},{id:"up",code:"0&amp;degree=15"},{id:"down",code:"2&amp;degree=15"}]},{id:"hd_new",name:"NVI New HD Camera",link:"nueva.hd_new",imageurl:"/tmpfs/snap.jpg",controlurl:"/cgi-bin/hi3510/%@",auth:"user=@user&amp;pwd=@pwd",pantilt:"true",keys:[{id:"move_left",code:"ptzctrl.cgi?-step=0&amp;-act=left"},{id:"move_right",code:"ptzctrl.cgi?-step=0&amp;-act=right"},{id:"move_up",code:"ptzctrl.cgi?-step=0&amp;-act=up"},{id:"move_down",code:"ptzctrl.cgi?-step=0&amp;-act=down"},{id:"stop",code:"ptzctrl.cgi?-step=0&amp;-act=stop"},{id:"step_left",code:"ptzctrl.cgi?-step=1&amp;-act=left"},{id:"step_right",code:"ptzctrl.cgi?-step=1&amp;-act=right"},{id:"step_up",code:"ptzctrl.cgi?-step=1&amp;-act=up"},{id:"step_down",code:"ptzctrl.cgi?-step=1&amp;-act=down"},{id:"home",code:"ptzctrl.cgi?-step=0&amp;-act=home"},{id:"horizontal_scan",code:"ptzctrl.cgi?-step=0&amp;-act=hscan"},{id:"vertical_scan",code:"ptzctrl.cgi?-step=0&amp;-act=vscan"},{id:"position_0",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=0"},{id:"position_1",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=1"},{id:"position_2",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=2"},{id:"position_3",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=3"},{id:"position_4",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=4"},{id:"position_5",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=5"},{id:"position_6",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=6"},{id:"position_7",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=7"}]}]},instar:{name:"INSTAR",versions:[{id:"vga",name:"Generic VGA Cam",imageurl:"/snapshot.cgi",mjpegurl:"/videostream.cgi",controlurl:"/decoder_control.cgi?command=%@",auth:"-usr=@user&amp;-pwd=@pwd",pantilt:"true",link:"instar.vga",keys:[{id:"left",code:"4&amp;onestep=1"},{id:"right",code:"6&amp;onestep=1"},{id:"up",code:"0&amp;onestep=1"},{id:"down",code:"2&amp;onestep=1"},{id:"home",code:"25"}]},{id:"hd",name:"Generic HD Cam",link:"instar.hd",imageurl:"/tmpfs/snap.jpg",mjpegurl:"/cgi-bin/hi3510/mjpegstream.cgi?-chn=11",controlurl:"/cgi-bin/hi3510/%@",auth:"-usr=@user&amp;-pwd=@pwd",pantilt:"true",keys:[{id:"move_left",code:"ptzctrl.cgi?-step=0&amp;-act=left"},{id:"move_right",code:"ptzctrl.cgi?-step=0&amp;-act=right"},{id:"move_up",code:"ptzctrl.cgi?-step=0&amp;-act=up"},{id:"move_down",code:"ptzctrl.cgi?-step=0&amp;-act=down"},{id:"stop",code:"ptzctrl.cgi?-step=0&amp;-act=stop"},{id:"step_left",code:"ptzctrl.cgi?-step=1&amp;-act=left"},{id:"step_right",code:"ptzctrl.cgi?-step=1&amp;-act=right"},{id:"step_up",code:"ptzctrl.cgi?-step=1&amp;-act=up"},{id:"step_down",code:"ptzctrl.cgi?-step=1&amp;-act=down"},{id:"home",code:"ptzctrl.cgi?-step=0&amp;-act=home"},{id:"horizontal_scan",code:"ptzctrl.cgi?-step=0&amp;-act=hscan"},{id:"vertical_scan",code:"ptzctrl.cgi?-step=0&amp;-act=vscan"},{id:"position_0",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=0"},{id:"position_1",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=1"},{id:"position_2",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=2"},{id:"position_3",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=3"},{id:"position_4",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=4"},{id:"position_5",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=5"},{id:"position_6",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=6"},{id:"position_7",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=7"}]},{id:"IN-3010",name:"IN-3010",link:"telefunken.XS100",pantilt:"true"},{id:"IN-6012",name:"IN-6012 HD",imageurl:"/tmpfs/snap.jpg",controlurl:"/cgi-bin/hi3510/%@",auth:"usr=@user&amp;pwd=@pwd",pantilt:"true",link:"instar.IN-6012",keys:[{id:"move_left",code:"ptzctrl.cgi?-step=0&amp;-act=left"},{id:"move_right",code:"ptzctrl.cgi?-step=0&amp;-act=right"},{id:"move_up",code:"ptzctrl.cgi?-step=0&amp;-act=up"},{id:"move_down",code:"ptzctrl.cgi?-step=0&amp;-act=down"},{id:"stop",code:"ptzctrl.cgi?-step=0&amp;-act=stop"},{id:"step_left",code:"ptzctrl.cgi?-step=1&amp;-act=left"},{id:"step_right",code:"ptzctrl.cgi?-step=1&amp;-act=right"},{id:"step_up",code:"ptzctrl.cgi?-step=1&amp;-act=up"},{id:"step_down",code:"ptzctrl.cgi?-step=1&amp;-act=down"},{id:"home",code:"ptzctrl.cgi?-step=0&amp;-act=home"},{id:"horizontal_scan",code:"ptzctrl.cgi?-step=0&amp;-act=hscan"},{id:"vertical_scan",code:"ptzctrl.cgi?-step=0&amp;-act=vscan"},{id:"position_0",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=0"},{id:"position_1",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=1"},{id:"position_2",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=2"},{id:"position_3",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=3"},{id:"position_4",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=4"},{id:"position_5",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=5"},{id:"position_6",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=6"},{id:"position_7",code:"preset.cgi?-act=goto&amp;-status=1&amp;-number=7"}]},{id:"IN-8015",name:"IN-8015 Full HD",link:"instar.hd",pantilt:"true"},{id:"IN-9008",name:"IN-9008 Full HD",link:"instar.hd",pantilt:"false"}]},foscam:{name:"Foscam",versions:[{id:"fi8904W",name:"FI8904W",link:"telefunken.XS100",pantilt:"false"},{id:"fi8620",name:"FI8620",imageurl:"/tmpfs/snap.jpg",controlurl:"/web/cgi-bin/hi3510/%@",pantilt:"true",link:"foscam.fi8620",keys:[{id:"left",code:"ytleft.cgi"},{id:"right",code:"ytright.cgi"},{id:"up",code:"ytup.cgi"},{id:"down",code:"ytdown.cgi"}],command:[{type:"int",name:"go to preset",ref:{value:"gotoPreset",ext:"%d"}}]},{id:"fi8602",name:"FI8602",link:"foscam.fi8620",pantilt:"false"},{id:"fi8919W",name:"FI8919W",imageurl:"/snapshot.cgi",mjpegurl:"/videostream.cgi",controlurl:"/decoder_control.cgi?command=%@&amp;onestep=1",auth:"user=@user&amp;pwd=@pwd",pantilt:"true",link:"foscam.fi8919W",keys:[{id:"left",code:"6&amp;degree=18"},{id:"right",code:"4&amp;degree=18"},{id:"up",code:"0&amp;degree=15"},{id:"down",code:"2&amp;degree=15"},{id:"switchOn",code:"94"},{id:"switchOff",code:"95"}]},{id:"fi9826w",name:"FI9826W",pantilt:"true",link:"foscam.fi9900p"},{id:"fi9831w",name:"FI9831W",pantilt:"true",link:"foscam.fi9900p"},{id:"fi9831p",name:"FI9831P V2",imageurl:"/cgi-bin/CGIProxy.fcgi?cmd=snapPicture2",mjpegurl:"/cgi-bin/CGIStream.cgi?cmd=GetMJStream",controlurl:"/cgi-bin/CGIProxy.fcgi?cmd=%@",stop:"ptzStopRun",auth:"usr=@user&amp;pwd=@pwd",pantilt:"true",link:"foscam.fi9831p",keys:[{id:"left",code:"ptzMoveLeft"},{id:"topLeft",code:"ptzMoveTopLeft"},{id:"right",code:"ptzMoveRight"},{id:"topRight",code:"ptzMoveTopRight"},{id:"bottomLeft",code:"ptzMoveBottomLeft"},{id:"bottomRight",code:"ptzMoveBottomRight"},{id:"up",code:"ptzMoveUp"},{id:"down",code:"ptzMoveDown"},{id:"reset",code:"ptzReset"},{id:"zoomIn",code:"zoomIn"},{id:"zoomOut",code:"zoomOut"},{id:"zoomStop",code:"zoomStop"}],command:[{type:"string",name:"go to preset",ref:{value:"gotoPreset",ext:"%s"}}]},{id:"fi9900p",name:"FI9900P",imageurl:"/cgi-bin/CGIProxy.fcgi?cmd=snapPicture2",controlurl:"/cgi-bin/CGIProxy.fcgi?cmd=%@",stop:"ptzStopRun",auth:"usr=@user&amp;pwd=@pwd",pantilt:"false",link:"foscam.fi9900p",keys:[{id:"left",code:"ptzMoveLeft"},{id:"topLeft",code:"ptzMoveTopLeft"},{id:"right",code:"ptzMoveRight"},{id:"topRight",code:"ptzMoveTopRight"},{id:"bottomLeft",code:"ptzMoveBottomLeft"},{id:"bottomRight",code:"ptzMoveBottomRight"},{id:"up",code:"ptzMoveUp"},{id:"down",code:"ptzMoveDown"},{id:"reset",code:"ptzReset"},{id:"zoomIn",code:"zoomIn"},{id:"zoomOut",code:"zoomOut"},{id:"zoomStop",code:"zoomStop"}],command:[{type:"string",name:"go to preset",ref:{value:"gotoPreset",ext:"%s"}}]},{id:"c1",name:"C1",pantilt:"false",link:"foscam.fi9900p"},{id:"c2",name:"C2",pantilt:"false",link:"foscam.fi9900p"},{id:"r2",name:"R2",pantilt:"true",link:"foscam.fi9900p"},{id:"fi86xx",name:"Generic FI86xx Series",pantilt:"true",link:"foscam.fi8620"},{id:"mjpeg",name:"Generic MJPEG Series",pantilt:"true",link:"foscam.fi8919W"},{id:"h264",name:"Generic H.264 Series",pantilt:"true",link:"foscam.fi9900p"}]},edimax:{name:"Edimax",versions:[{id:"3010",name:"IC-3010 Series",imageurl:"/jpg/image.jpg",pantilt:"false",link:"edimax.3010"},{id:"7010",name:"IC-7010 Series",imageurl:"/jpg/image.jpg",mjpegurl:"/mjpg/video.mjpg",controlurl:"/camera-cgi/com/ptz.cgi",controlpostdata:"%@",pantilt:"true",useurlauth:"true",link:"edimax.7010",keys:[{id:"home",code:"move=center"},{id:"left",code:"move=left"},{id:"right",code:"move=right"},{id:"up",code:"move=up"},{id:"down",code:"move=down"},{id:"preset0",code:"gotoserverpresetIndex=0"},{id:"preset1",code:"gotoserverpresetIndex=1"},{id:"preset2",code:"gotoserverpresetIndex=2"},{id:"preset3",code:"gotoserverpresetIndex=3"},{id:"preset4",code:"gotoserverpresetIndex=4"}]},{id:"3030",name:"IC-3030 Series",pantilt:"false",link:"edimax.7010"},{id:"3110",name:"IC-3110 Series",pantilt:"false",link:"edimax.7010"},{id:"3115",name:"IC-3115 Series",pantilt:"false",link:"edimax.7010"},{id:"3116",name:"IC-3116 Series",pantilt:"false",link:"edimax.7010"},{id:"5150w",name:"IC-5150W",pantilt:"false",link:"edimax.7010"},{id:"3140",name:"IC-3140 Series",pantilt:"false",link:"edimax.7010"},{id:"7001",name:"IC-7001 Series",imageurl:"/jpg/image.jpg",mjpegurl:"/mjpg/video.mjpg",controlurl:"/camera-cgi/com/ptz.cgi",controlpostdata:"%@",pantilt:"true",useurlauth:"true",link:"edimax.7001",keys:[{id:"home",code:"move=center"},{id:"left",code:"move=left"},{id:"right",code:"move=right"},{id:"up",code:"move=up"},{id:"down",code:"move=down"},{id:"preset0",code:"gotopresetIndex=0"},{id:"preset1",code:"gotopresetIndex=1"},{id:"preset2",code:"gotopresetIndex=2"},{id:"preset3",code:"gotopresetIndex=3"},{id:"preset4",code:"gotopresetIndex=4"}]},{id:"7100",name:"IC-7100 Series",pantilt:"true",link:"edimax.7010"},{id:"7110",name:"IC-7110 Series",pantilt:"true",link:"edimax.7010"},{id:"7112",name:"IC-7112 Series",pantilt:"true",link:"edimax.7001"},{id:"7112w",name:"IC-7112W",pantilt:"true",link:"edimax.7001"},{id:"7113",name:"IC-7113 Series",pantilt:"true",link:"edimax.7001"},{id:"9110",name:"IC-9110 Series",pantilt:"true",link:"edimax.7010"},{id:"9110w",name:"IC-9110W",pantilt:"false",link:"edimax.7010"},{id:"type1",name:"Generic Type 1 (no PTZ)",pantilt:"false",link:"edimax.3010"},{id:"type2",name:"Generic Type 2 (PTZ)",pantilt:"true",link:"edimax.7001"},{id:"type3",name:"Generic Type 3 (PTZ)",pantilt:"true",link:"edimax.7010"}]},digitus:{name:"DIGITUS",versions:[{id:"plugandview",name:"Plug&View",imagepathurl:"/web/cgi-bin/hi3510/snap.cgi",stop:"ptzstop.cgi",controlurl:"/cgi-bin/hi3510/%@",pantilt:"true",link:"digitus.plugandview",keys:[{id:"left",code:"ptzleft.cgi"},{id:"right",code:"ptzright.cgi"},{id:"up",code:"ptzup.cgi"},{id:"down",code:"ptzdown.cgi"},{id:"home",code:"ptzgotopoint.cgi?&amp;-chn=0&amp;-point=1"}]}]},doorbird:{name:"DoorBird",versions:[{id:"doorbird",name:"DoorBird",imageurl:"/bha-api/video.cgi",mjpegurl:"/bha-api/video.cgi",controlurl:"/bha-api/%@",pantilt:"true",useurlauth:"true",link:"doorbird.doorbird",keys:[{id:"open_door",code:"open-door.cgi"},{id:"light_on",code:"light-on.cgi"}],command:[{type:"string",name:"open relay (custom)",ref:{value:"open_relay_custom",ext:"%s"}}],status:[{type:"enum",name:"door bell ring",ref:{value:"ring",value_t:"door_bell_ring",options:["true","false"]}},{type:"enum",name:"motion detect",ref:{value:"motion",options:["true","false"]}},{type:"int",name:"last ring timestamp",ref:{value:"ringT"}},{type:"string",name:"last ring time",ref:{value:"ringTStr"}}],ipevt:[{type:"enum",name:"door bell ring",ref:{value:"ring",value_t:"door_bell_ring",options:["true"]}},{type:"enum",name:"motion detect",ref:{value:"motion",options:["true"]}}]}]},mobotix:{name:"MOBOTIX",versions:[{id:"general",name:"General Camera",imageurl:"/record/current.jpg",mjpegurl:"/cgi-bin/faststream.jpg?needlength&fps=0",controlurl:"/control/click.cgi?%@",pantilt:"true",link:"mobotix.general",keys:[{id:"up",code:"moverel&x=0&y=50"},{id:"down",code:"moverel&x=0&y=-50"},{id:"left",code:"moverel&x=-50&y=0"},{id:"right",code:"moverel&x=50&y=0"},{id:"center",code:"center"},{id:"zoomIn",code:"zoomrel=-200"},{id:"zoomOut",code:"zoomrel=200"},{id:"1xZoom",code:"zoom=0"}],command:[{type:"int",name:"go to preset",ref:{value:"gotoPreset",ext:"%d",extExtra:"1-127"}},{type:"enum",name:"display mode",ref:{value:"displayMode",ext:"%e",extMeta:["Full Image","Normal","Surround","Panorama","Panorama/Focus","Double Panorama"]}},{type:"string",name:"custom command",ref:{value:"customCMD",ext:"%s"}}]}]},axis:{name:"Axis",versions:[{id:"212",name:"212 PTZ",link:"axis.ptz",pantilt:"true"},{id:"215",name:"215 PTZ",link:"axis.ptz",pantilt:"true"},{id:"m10",name:"M10 Series",link:"axis.general",pantilt:"true"},{id:"m1054",name:"M1054",link:"axis.ptz",pantilt:"true"},{id:"m11",name:"M11 Series",link:"axis.ptz",pantilt:"true"},{id:"m3014",name:"M3014",link:"axis.ptz",pantilt:"true"},{id:"m32",name:"M32 Series",link:"axis.ptz",pantilt:"true"},{id:"m50",name:"M50 Series",link:"axis.ptz",pantilt:"true"},{id:"p1311",name:"P1311",link:"axis.ptz",pantilt:"false"},{id:"p1346",name:"P1346 Series",link:"axis.ptz",pantilt:"true"},{id:"p1347",name:"P1347 Series",link:"axis.ptz",pantilt:"true"},{id:"q1755",name:"Q 1755 Series",link:"axis.ptz",pantilt:"true"},{id:"p33",name:"P33 Series",link:"axis.ptz",pantilt:"true"},{id:"q6034",name:"Q6034",link:"axis.ptz",pantilt:"true"},{id:"ptz",name:"General (PTZ)",imageurl:"/jpg/image.jpg",mjpegurl:"/mjpg/video.mjpg",controlurl:"/axis-cgi/com/ptz.cgi?camera=1&amp;%@",useurlauth:"true",pantilt:"true",link:"axis.ptz",keys:[{id:"home",code:"move=home"},{id:"left",code:"move=left"},{id:"right",code:"move=right"},{id:"up",code:"move=up"},{id:"down",code:"move=down"},{id:"tele",code:"rzoom=1000"},{id:"wide",code:"rzoom=-1000"}],command:[{type:"enum",name:"light on",ref:{value:"lightOn"}},{type:"enum",name:"light off",ref:{value:"lightOff"}},{type:"int",name:"play clip",ref:{value:"playClip",ext:"%d"}},{type:"int",name:"activate output ",ref:{value:"actOut",ext:"%d"}},{type:"int",name:"deactivate output ",ref:{value:"deactOut",ext:"%d"}}]},{id:"general",name:"General",imageurl:"/jpg/image.jpg",mjpegurl:"/mjpg/video.mjpg",controlurl:"/axis-cgi/com/ptz.cgi?camera=1&amp;%@",useurlauth:"true",link:"axis.general",pantilt:"true",command:[{type:"enum",name:"light on",ref:{value:"lightOn"}},{type:"enum",name:"light off",ref:{value:"lightOff"}},{type:"int",name:"play clip",ref:{value:"playClip",ext:"%d"}},{type:"int",name:"activate output ",ref:{value:"actOut",ext:"%d"}},{type:"int",name:"deactivate output ",ref:{value:"deactOut",ext:"%d"}}]}]},generic:{name:"Generic IP Camera",versions:[{id:"type1",name:"Type 1",link:"telefunken.XS100",pantilt:"false"},{id:"type2",name:"Type 2 (PTZ)",link:"telefunken.XS100",pantilt:"true"},{id:"type3",name:"Type 3 (PTZ)",link:"konine.konine",pantilt:"true"},{id:"type4",name:"Type 4",link:"dlink.2000",pantilt:"false"},{id:"type5",name:"Type 5 (PTZ)",link:"7links.770hd",pantilt:"true"},{id:"type6",name:"Type 6",link:"dlink.dcs930",pantilt:"false"},{id:"type7",name:"Type 7",link:"dlink.dcs942",pantilt:"false"},{id:"type8",name:"Type 8 (PTZ)",link:"dlink.2000",pantilt:"true"},{id:"type9",name:"Type 9",link:"dlink.dcs2132",pantilt:"false"},{id:"type10",name:"Type 10 (PTZ)",link:"nueva.hd",pantilt:"true"},{id:"type11",name:"Type 11 (PTZ)",link:"instar.vga",pantilt:"true"},{id:"type12",name:"Type 12 (PTZ)",link:"instar.hd",pantilt:"true"},{id:"type13",name:"Type 13 (PTZ)",pantilt:"true",link:"foscam.fi8620"},{id:"type14",name:"Type 14 (PTZ)",pantilt:"true",link:"foscam.fi8919W"},{id:"type15",name:"Type 15 (PTZ)",pantilt:"true",link:"foscam.fi9826w"},{id:"type16",name:"Type 16",pantilt:"false",link:"edimax.3010"},{id:"type17",name:"Type 17 (PTZ)",pantilt:"true",link:"edimax.7001"},{id:"type18",name:"Type 18 (PTZ)",pantilt:"true",link:"edimax.7010"},{id:"type19",name:"Type 19 (PTZ)",pantilt:"true",link:"digitus.plugandview"},{id:"type20",name:"Type 20 (PTZ)",pantilt:"true",link:"doorbird.doorbird"},{id:"type21",name:"Type 21 (PTZ)",pantilt:"true",link:"mobotix.general"}]}},xnm.aio.cams.DM=function(){var DMError=function DMError(e,t){this.code=e,this.message=t,this.stack=new Error().stack;};return(DMError.prototype=new Error()).name="CamDMError",DMError.prototype.code=0,DMError.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6},{SYS:"cam",getIPDeviceType:function getIPDeviceType(e,t){var o=[];for(var i in xnm.aio.cams.CAM_INFO){if(xnm.aio.cams.CAM_INFO.hasOwnProperty(i)){var n=xnm.aio.cams.CAM_INFO[i];if(t&&t.lm&&t.license&&!t.lm.permitFeature("read",{sys:this.SYS,type:"system",manufacturer:i},t.license))continue;if(n.name){var r={category:"system",type:i,name:n.name,versions:[]};if(n.versions)for(var a=0;a<n.versions.length;a++){var s=n.versions[a];s&&s.id&&s.name&&r.versions.push({model:s.id,name:s.name,link:s.link});}o.push(r);}}}if(e){var p=e.getIPCams();if(p)for(var d=0;d<p.length;d++){var c=p[d],m=$(c).getAttributes();if(m&&m.id&&m.name){if(xnm.aio.cams.CAM_INFO[m.id])continue;if(t&&t.lm&&t.license&&!t.lm.permitFeature("read",{sys:this.SYS,type:"custom",manufacturer:m.id},t.license))continue;var l={category:"custom",type:m.id,name:m.name,versions:[]};o.push(l);var u=$(c).children();if(u)for(var g=0;g<u.length;g++){var h=u[g],f=$(h).getAttributes();f&&f.id&&f.name&&l.versions.push({model:f.id,name:f.name});}}}}return[{sys:this.SYS,name:"IP Camera",types:o}];},createDevice:function createDevice(e,t,o){var i=DMError,n=DMError.ERROR_CODE;e?e.type?e.ip?o(null,e):o(new i(n.INVALID,"ip is invalid")):o(new i(n.INVALID,"type is invalid")):o(new i(n.INVALID,"info is invalid"));},updateDevice:function updateDevice(e,t,o){var i=DMError,n=DMError.ERROR_CODE;e?e.type?e.ip?o(null,e):o(new i(n.INVALID,"ip is invalid")):o(new i(n.INVALID,"type is invalid")):o(new i(n.INVALID,"info is invalid"));},deleteDevice:function deleteDevice(e,t,o){o();},applyUIFilter:function applyUIFilter(e,t,o){var _contains=function _contains(e,t){if("*"==e)return!0;for(var o=!1,i=0;i<e.length;i++){if(e[i]==t){o=!0;break;}}return o;},_filter=function _filter(e,t){var i=[],n=null,r=xnm.aio.cams.DM.getCommandStatusMap(e,o);return r&&(n=function(e,t,o){var i=[];switch(o.catagory){case"command":e.command&&e.command.forEach(function(e){if(_contains(o.elems,e.type)){var t=JSON.parse(JSON.stringify(e));i.push(t);}});break;case"status":e.status&&e.status.forEach(function(e){if(_contains(o.elems,e.type)){var t=JSON.parse(JSON.stringify(e));i.push(t);}});}return i;}(r,0,t),i=i.concat(n)),i;};if(!e.sys)return null;var i=JSON.parse(JSON.stringify(e)),n=null;switch(t.catagory){case"command":n=_filter(e,t),i.command=n;break;case"status":n=_filter(e,t),i.status=n;break;default:return null;}return n&&0!=n.length?i:null;},applyNeoServerFilter:function applyNeoServerFilter(e,t,o){var _contains=function _contains(e,t){if("*"==e)return!0;for(var o=!1,i=0;i<e.length;i++){if(e[i]==t){o=!0;break;}}return o;},_filter=function _filter(e,t){var i=[],n=null,r=xnm.aio.cams.DM.getNeoServerCommandStatusMap(e,o);return r&&(n=function(e,t,o){var i=[];switch(o.catagory){case"command":e.command&&e.command.forEach(function(e){if(_contains(o.elems,e.type)){var t=JSON.parse(JSON.stringify(e));i.push(t);}});break;case"status":e.status&&e.status.forEach(function(e){if(_contains(o.elems,e.type)){var t=JSON.parse(JSON.stringify(e));i.push(t);}});}return i;}(r,0,t),i=i.concat(n)),i;};if(!e.sys)return null;var i=JSON.parse(JSON.stringify(e)),n=null;switch(t.catagory){case"command":n=_filter(e,t),i.command=n;break;case"status":n=_filter(e,t),i.status=n;break;default:return null;}return n&&0!=n.length?i:null;},applyIPEventFilter:function applyIPEventFilter(e,t,o){var i=this.getCamInfo(e,o);return i&&i.ipevt?{ipevt:i.ipevt}:null;},getCamInfo:function getCamInfo(e,t){var _overwriteParam=function _overwriteParam(e,t){for(var o in e){e.hasOwnProperty(o)&&(t[o]=e[o]);}return t;},findSystemCamInfo=function findSystemCamInfo(e){var t=e.type;"tfcam"==e.type&&(t="telefunken");var o,i=xnm.aio.cams.CAM_INFO[t];if(!i)return null;for(var n=0;n<i.versions.length;n++){var r=i.versions[n];if(r&&r.id==e.model){o=r;break;}}if(!o)return null;if(!o.link||o.link==e.type+"."+e.model)return o;var a=o.link.indexOf("."),s=findSystemCamInfo({type:o.link.substr(0,a),model:o.link.substr(a+1)});if(!s)return null;var p=JSON.parse(JSON.stringify(s));return _overwriteParam(o,p);},findUserCamInfo=function findUserCamInfo(e,t){var o,i=t.find('cam[id="'+e.type+'"]');if(i&&i.length>0&&(o=i[0]),!o)return null;var n=$(o).find('version[id="'+e.model+'"]');if(!n||0==n.length)return null;n=n[0];var r=$(n).attr("link");if(!r||r==e.type+"."+e.model)return function(e){for(var t=e.getAttributes(),o=JSON.parse(JSON.stringify(t)),i=e.children(),n=0;n<i.length;n++){var r=$(i[n]);if(r){var a=r.attr("id"),s=r.attr("code");a&&s&&(o.keys||(o.keys=[]),o.keys.push({id:a,code:s}));}}return o;}($(n));var a,s=r.indexOf("."),p=findSystemCamInfo({type:r.substr(0,s),model:r.substr(s+1)});return p||(p=findUserCamInfo({type:r.substr(0,s),model:r.substr(s+1)},t))?(a=JSON.parse(JSON.stringify(p)),_overwriteParam(n,a)):null;};if(!e.type||!e.model)return null;"system"!=e.type&&"custom"!=e.type||!e.manufacturer||((e=JSON.parse(JSON.stringify(e))).type=e.manufacturer);var o=findSystemCamInfo(e);return!o&&t&&(o=findUserCamInfo(e,t)),o;},getCommandStatusMap:function getCommandStatusMap(e,t){var o=this.getCamInfo(e,t);if(!o||!o.pantilt||"false"==o.pantilt)return null;var i={command:[]};if(o.keys)for(var n=0;n<o.keys.length;n++){var r=o.keys[n];i.command.push({type:"enum",name:r.id,ref:{value:r.id}});}return o.command&&(i.command=i.command.concat(o.command)),o.status&&(i.status=o.status),"system"==e.type&&"doorbird"==e.manufacturer&&(e.relays&&e.relays.length&&i.command.push({type:"enum",name:"open relay",ref:{value:"open_relay",ext:"%e",extMeta:e.relays}}),i.command.push({type:"enum",name:"open doorbird app",ref:{value:"open_app",value_t:"open_app_doorbird"}}),i.command.push({type:"enum",name:"open liveview",ref:{value:"open_live"}})),i;},getNeoServerCommandStatusMap:function getNeoServerCommandStatusMap(e,t){var o={command:[]};return(!e||"system"!=e.type||"doorbird"!=e.manufacturer&&"doorbird"!=e.type||"doorbird"!=e.model)&&(!e||"system"!=e.type||"netatmo"!=e.manufacturer&&"netatmo"!=e.type)?(o.command.push({type:"enum",name:"take snapshot",ref:{value:"snapshot"}}),o):o;}};}(),xnm.aio.cams.Handler=function(){var Handler=function Handler(){var e=require("x.logger.js");xnm.aio.cams.DM._logger=e?e.getLogger("xnm.aio.cams.DM"):{log:function log(){}},this._foscamDiscovery=null,this._doorbirdHandler=new xnm.aio.cams.DoorBird.Handler();};return Handler.prototype.devicemanager=xnm.aio.cams.DM,Handler.prototype.registModule=function(e){e.register(xnm.aio.cams.DM.SYS,"cams");},Handler.prototype.resolveDevice=function(e,t){var o=xnm.aio.cams.DM.getCamInfo(e,t);return!e||"system"!=e.type||"doorbird"!=e.manufacturer&&"doorbird"!=e.type||"doorbird"!=e.model?!e||"system"!=e.type||"foscam"!=e.manufacturer&&"foscam"!=e.type?!e||"system"!=e.type||"netatmo"!=e.manufacturer&&"netatmo"!=e.type?!e||"system"!=e.type||"mobotix"!=e.manufacturer&&"mobotix"!=e.type?!e||"system"!=e.type||"axis"!=e.manufacturer&&"axis"!=e.type?new xnm.aio.cams.Cam(e,o):new xnm.aio.cams.Axis(e,o):new xnm.aio.cams.Mobotix(e,o):new xnm.aio.cams.Welcome(e,o):new xnm.aio.cams.Foscam(e,o):new xnm.aio.cams.DoorBird(e,o);},Handler.prototype.getCamJPEGUrl=function(e,t,o){var i=xnm.aio.cams.DM.getCamInfo(e,t),n=new xnm.aio.cams.Cam(e,i),r=o,a=n.getJPEGURL(function(e){a||e?r&&r(null,e):r&&r(new Error("cam has no jpeg url"));});a&&(r&&r(null,{url:a}),r=null);},Handler.prototype.getCamMJPEGUrl=function(e,t,o){var i=xnm.aio.cams.DM.getCamInfo(e,t),n=new xnm.aio.cams.Cam(e,i).getMJPEGURL();o&&o(n?null:new Error("cam has no mjpeg url"),{url:n});},Handler.prototype.getCamVideoInfo=function(e,t,o){var i=this.resolveDevice(e,t);i?i.getVideoInfo(o):o&&o(new Error("no such camera"));},Handler.prototype.getDeviceCommands=function(e,t){var o=xnm.aio.cams.DM.applyUIFilter(e,{catagory:"command",elems:"*"}),i=o?o.command:[];t&&t(null,i);},Handler.prototype.getDeviceStatus=function(e,t){var o=xnm.aio.cams.DM.applyUIFilter(e,{catagory:"status",elems:"*"}),i=o?o.status:[];t&&t(null,i);},Handler.prototype.doCommand=function(e,t,o,i){var n=this.resolveDevice(e,o);n?n.executeCommandCreator(e,t,i):i&&i(new Error("device json format invalid"));},Handler.prototype.doStatus=function(e,t,o,i){var n=this.resolveDevice(t);if(n){var r=[{id:e,device:t,status:o}];n.getStatesCreator(null,r,function(e,t){e?i&&i(e):i&&i(null,t);});}else i&&i(new Error("device json format invalid"));},Handler.prototype.listSystemCam=function(e){var t=xnm.aio.cams.DM.getIPDeviceType();e&&e(null,t||[]);},Handler.prototype.createJPEGCam=function(e,t,o,i){return t&&t._extra&&"system"==t._extra.type&&"doorbird"==t._extra.manufacturer&&"doorbird"==t._extra.model&&t._mjpegurl?new xnm.aio.cams.MJPEGCam(t._mjpegurl,t):new xnm.aio.cams.JPEGCam(e,t,o,i);},Handler.prototype.createSystemCam=function(e,t){return new xnm.aio.cams.SystemCam(e,t);},Handler.prototype.detectCams=function(){this._foscamDiscovery||(this._foscamDiscovery=new xnm.aio.cams.FoscamDiscovery()),this._foscamDiscovery.discoverCams();},Handler.prototype.getDoorBirdHandler=function(){return this._doorbirdHandler;},Handler.prototype.discoverDoorbird=function(e,t){var o=this,i=require("x.mdns.js");i.clearRecordBuffer(),i.discoverServiceWithTimeout("_axis-video._tcp.local",e,function(e,i){if(e)t&&t(e);else{for(var n=[],r=0;r<i.length;r++){var a=i[r];if(a.domain&&"Doorstation"==a.domain.substr(0,11)&&a.ip&&a.ip.length>0){var s={sys:"cam",type:"system",manufacturer:"doorbird",ip:a.ip[0],port:80};a.info&&a.info.macaddress&&(s.mac=a.info.macaddress);var p=o.resolveDevice(s);p&&n.push(p);}}t&&t(null,n);}});},Handler.prototype.finalize=function(e){this._doorbirdHandler&&this._doorbirdHandler.finalize(),e&&e();},Handler.prototype.pause=function(e){this.finalize(e);},Handler;}(),"undefined"!=typeof module&&null!=module&&(module.exports=new xnm.aio.cams.Handler());