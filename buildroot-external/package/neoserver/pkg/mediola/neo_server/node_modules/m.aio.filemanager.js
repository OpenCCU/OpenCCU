var m=m||{};m.aio=m.aio||{},m.aio.filemanager=m.aio.filemanager||{},m.aio.filemanager.Preference={USER_PREFERENCE:".pref",_pref:{},_logger:null,init:function init(e){try{this._logger=require("x.logger.js").getLogger("m.aio.filemanager.Preference");}catch(e){this._logger={log:function log(){}};}var t=require("fs"),r=this._getUserPref();r?t.exists(r,function(i){i?t.stat(r,function(i,n){i?e&&e(i):n.isFile()?t.readFile(r,function(t,r){if(t)e&&e(t);else{if(r.length>0){var i=r.toString("utf8");try{this._pref=JSON.parse(i);}catch(e){this._pref={};}}e&&e();}}.bind(this)):t.unlink(r,function(i){i?e&&e(i):t.open(r,"w",function(t){e&&e(t);});});}.bind(this)):t.open(r,"w",function(t){e(t);});}.bind(this)):e&&e(new Error("pref file path is null"));},save:function save(e,t){this._pref[e]=t,this._saveUserPref();},read:function read(e){return this._pref[e];},_getUserPref:function _getUserPref(){var e=require("path"),t=m.aio.filemanager.FileManager.getAppRootDataPath();return t?t+e.sep+this.USER_PREFERENCE:null;},_saveUserPref:function _saveUserPref(){var e=this._getUserPref(),t=require("fs");if(e){this._logger.log("trace","save user pref:"+e);var r=this;t.writeFile(e,JSON.stringify(this._pref),function(e){e&&r._logger.log("trace","save user pref error:"+e.stack);});}}},m.aio.filemanager.FileManager={_nativeFm:null,init:function init(e,t){e?this._nativeFm?t&&t():(this._nativeFm=e,m.aio.filemanager.Preference.init(function(){t&&t();})):t&&t(new Error("nativeFileManager is null"));},getAppRootDataPath:function getAppRootDataPath(){return this._nativeFm?this._nativeFm.getAppRootDataPath():null;},getAppResourcePath:function getAppResourcePath(){var e=require("path"),t=this.getAppRootDataPath();return t?t+e.sep+"resources":null;},getUserRootDataPath:function getUserRootDataPath(){return this._nativeFm?this._nativeFm.getUserRootDataPath():null;},getUserResourcePath:function getUserResourcePath(){var e=require("path"),t=this.getUserRootDataPath();return t?t+e.sep+"resources":null;},getUserLogPath:function getUserLogPath(){var e=require("path"),t=this.getUserRootDataPath();return t?t+e.sep+"logs":null;},getTmpDir:function getTmpDir(){return this._nativeFm.getTmpDir();},getPref:function getPref(){return m.aio.filemanager.Preference;}},"undefined"!=typeof module&&null!=module&&(module.exports=m.aio.filemanager.FileManager,module.exports.Preference=m.aio.filemanager.Preference);