var xnm=xnm||{};xnm.aio=xnm.aio||{},xnm.aio.neoserver=xnm.aio.neoserver||{},xnm.aio.neoserver.systems=xnm.aio.neoserver.systems||{},xnm.aio.neoserver.systems._SysVar={setVar:function setVar(e,r,t,a,n){var s={id:t,type:r,value:a};e._executeRequest("setVar",s,{timeout:2e4},function(e){n&&n(e);});},delVar:function delVar(e,r,t){var a={id:r};e._executeRequest("delVar",a,{timeout:2e4},function(e){t&&t(e);});},getSysVars:function getSysVars(e,r){e._executeRequest("getStates",null,{timeout:2e4},function(e,t){if(e)r&&r(e);else{var a=[];if(t)for(var n=0;n<t.length;n++){var s=t[n];if(s.adr||s.id)switch(s.type){case xnm.aio.neoserver.systems.Boolean.DM.TYPE:case xnm.aio.neoserver.systems.Int.DM.TYPE:case xnm.aio.neoserver.systems.Float.DM.TYPE:case xnm.aio.neoserver.systems.String.DM.TYPE:a.push({type:s.type,address:s.adr});break;case xnm.aio.neoserver.systems.Task.DM.TYPE:a.push({type:s.type,address:s.id});}}r&&r(null,a);}});}},xnm.aio.neoserver.systems.Boolean={regist:function regist(e,r,t){r&&r.address?xnm.aio.neoserver.systems._SysVar.setVar(e,this.DM.TYPE,r.address,"on",t):t&&t(new Error("regist device option foramt invalid"));},delVar:function delVar(e,r,t){r?xnm.aio.neoserver.systems._SysVar.delVar(e,r,t):t&&t(new Error("address invalid"));},executeCommandCreator:function executeCommandCreator(e,r,t,a){r?t&&t.value?r&&r.address?this._executeCommand(e,r,t,a):a&&a(new Error("device address is empty")):a&&a(new Error("device command is empty")):a&&a(new Error("device is null"));},_executeCommand:function _executeCommand(e,r,t,a){xnm.aio.neoserver.systems._SysVar.setVar(e,this.DM.TYPE,r.address,t.value,a);},handleStateCreator:function handleStateCreator(e,r,t){if(!r||!r.value)return null;var a=this._handleState(e,t);return a?a[r.value]:null;},_handleState:function _handleState(e,r){if(!r.type||"onoff"!=r.type.toLowerCase()||!r.adr||!r.state)return null;if(!e.address)return null;if(!e.address||e.address.toLowerCase()!=r.adr.toLowerCase())return null;var t=r.state;return t&&(t=t.toLowerCase()),{state:t};},generateActionCode:function generateActionCode(e,r){if(!r||!r.address||2!=r.address.length)return null;if(!e)return null;var t;switch(e.value){case"on":t="01";break;case"off":t="00";break;case"toggle":t="0F";break;default:return null;}return r.address+t;},parseActionCode:function parseActionCode(e,r){if(!e||4!=e.length)return null;if(!r||!r.address||2!=r.address.length)return null;var t=e.substr(0,2),a=e.substr(2,2);if(t.toLowerCase()!=r.address.toLowerCase())return null;var n={};switch(a.toUpperCase()){case"01":n.value="on";break;case"00":n.value="off";break;case"0F":n.value="toggle";break;default:return null;}return n;},DM:{TYPE:"ONOFF",MAP:{command:[{type:"enum",name:"on",ref:{value:"on"}},{type:"enum",name:"off",ref:{value:"off"}},{type:"enum",name:"toggle",ref:{value:"toggle"}}],status:[{type:"enum",name:"status",ref:{value:"state",options:["off","on"]}}],ipevt:[{type:"enum",name:"status",ref:{value:"state",options:["off","on"]}}]},getGatewayDeviceType:function getGatewayDeviceType(e){return{type:this.TYPE,name:"Boolean System Variable"};},getCommandStatusMap:function getCommandStatusMap(){return this.MAP;},getIPevtMap:function getIPevtMap(e,r){var t=this.getCommandStatusMap(e);if(!t)return null;var a={ipevt:[]};return t.ipevt&&(a.ipevt=t.ipevt),a;},createDevice:function createDevice(e,r,t){var a=xnm.aio.neoserver.DM.DMError,n=xnm.aio.neoserver.DM.DMError.ERROR_CODE;e.address?t(null,JSON.parse(JSON.stringify(e))):t(new a(n.INVALID,"parameter address is invalid"));},updateDevice:function updateDevice(e,r,t){var a=xnm.aio.neoserver.DM.DMError,n=xnm.aio.neoserver.DM.DMError.ERROR_CODE;e.address?t(null,JSON.parse(JSON.stringify(e))):t(new a(n.INVALID,"parameter address is invalid"));},deleteDevice:function deleteDevice(e,r,t,a){xnm.aio.neoserver.systems.Boolean.delVar(e,r.address,function(){a&&a(null,JSON.parse(JSON.stringify(r)));});}}},xnm.aio.neoserver.systems.Int={regist:function regist(e,r,t){r&&r.address?xnm.aio.neoserver.systems._SysVar.setVar(e,this.DM.TYPE,r.address,"00000000",t):t&&t(new Error("regist device option foramt invalid"));},delVar:function delVar(e,r,t){r?xnm.aio.neoserver.systems._SysVar.delVar(e,r,t):t&&t(new Error("address invalid"));},executeCommandCreator:function executeCommandCreator(e,r,t,a){r?t&&t.value?r&&r.address?this._executeCommand(e,r,t,a):a&&a(new Error("device address is empty")):a&&a(new Error("device command is empty")):a&&a(new Error("device is null"));},_executeCommand:function _executeCommand(e,r,t,a){if("setValue"==t.value){var n=0;null!=t.ext&&void 0!==t.ext&&(n=parseInt(t.ext)),n>2147483647&&(n=2147483647),n<-2147483648&&(n=-2147483648),n=xnm.aio.neoserver.Util.getHexVal(n,8),xnm.aio.neoserver.systems._SysVar.setVar(e,this.DM.TYPE,r.address,n,a);}else a&&a(new Error("unknow command"));},handleStateCreator:function handleStateCreator(e,r,t){if(!r||!r.value)return null;var a=this._handleState(e,t);return a?a[r.value]:null;},_handleState:function _handleState(e,r){if(!r.type||"int"!=r.type.toLowerCase()||!r.adr||!r.state)return null;if(!e.address)return null;if(!e.address||e.address.toLowerCase()!=r.adr.toLowerCase())return null;var t=parseInt(r.state,16);return{state:t=2147483648&t?t-4294967296:t};},DM:{TYPE:"INT",MAP:{command:[{type:"int",name:"set value",ref:{value:"setValue",ext:"%d",extMeta:"-2147483648-2147483647"}}],status:[{type:"int",name:"status",ref:{value:"state",extMeta:"-2147483648-2147483647"}}],ipevt:[{type:"int",name:"status",ref:{value:"state",extMeta:"-2147483648-2147483647"}}]},getGatewayDeviceType:function getGatewayDeviceType(){return{type:this.TYPE,name:"Integer System Variable"};},getCommandStatusMap:function getCommandStatusMap(){return this.MAP;},getIPevtMap:function getIPevtMap(e,r){var t=this.getCommandStatusMap(e);if(!t)return null;var a={ipevt:[]};return t.ipevt&&(a.ipevt=t.ipevt),a;},getActionMap:function getActionMap(){return{command:[]};},createDevice:function createDevice(e,r,t){var a=xnm.aio.neoserver.DM.DMError,n=xnm.aio.neoserver.DM.DMError.ERROR_CODE;e.address?t(null,JSON.parse(JSON.stringify(e))):t(new a(n.INVALID,"parameter address is invalid"));},updateDevice:function updateDevice(e,r,t){var a=xnm.aio.neoserver.DM.DMError,n=xnm.aio.neoserver.DM.DMError.ERROR_CODE;e.address?t(null,JSON.parse(JSON.stringify(e))):t(new a(n.INVALID,"parameter address is invalid"));},deleteDevice:function deleteDevice(e,r,t,a){xnm.aio.neoserver.systems.Int.delVar(e,r.address,function(){a&&a(null,JSON.parse(JSON.stringify(r)));});}}},xnm.aio.neoserver.systems.Float={regist:function regist(e,r,t){r&&r.address?xnm.aio.neoserver.systems._SysVar.setVar(e,this.DM.TYPE,r.address,"00000000",t):t&&t(new Error("regist device option foramt invalid"));},delVar:function delVar(e,r,t){r?xnm.aio.neoserver.systems._SysVar.delVar(e,r,t):t&&t(new Error("address invalid"));},executeCommandCreator:function executeCommandCreator(e,r,t,a){r?t&&t.value?r&&r.address?this._executeCommand(e,r,t,a):a&&a(new Error("device address is empty")):a&&a(new Error("device command is empty")):a&&a(new Error("device is null"));},_executeCommand:function _executeCommand(e,r,t,a){if("setValue"==t.value){var n=0;null!=t.ext&&void 0!==t.ext&&(n=parseFloat(t.ext)),(n=Math.round(100*n))>2147483647&&(n=2147483647),n<-2147483648&&(n=-2147483648),n=xnm.aio.neoserver.Util.getHexVal(n,8),xnm.aio.neoserver.systems._SysVar.setVar(e,this.DM.TYPE,r.address,encodeURI(n),a);}else a&&a(new Error("unknow command"));},handleStateCreator:function handleStateCreator(e,r,t){if(!r||!r.value)return null;var a=this._handleState(e,t);return a?a[r.value]:null;},_handleState:function _handleState(e,r){if(!r.type||"float"!=r.type.toLowerCase()||!r.adr||!r.state)return null;if(!e.address)return null;if(!e.address||e.address.toLowerCase()!=r.adr.toLowerCase())return null;var t=parseInt(r.state,16);return{state:t=((t=2147483648&t?t-4294967296:t)/100).toFixed(2)};},DM:{TYPE:"FLOAT",MAP:{command:[{type:"float",name:"set value",ref:{value:"setValue",ext:"%f",extMeta:"-21474836.48-21474836.47",scale:"0.01"}}],status:[{type:"float",name:"status",ref:{value:"state",extMeta:"-21474836.48-21474836.47",scale:"0.01"}}],ipevt:[{type:"float",name:"status",ref:{value:"state",extMeta:"-21474836.48-21474836.47",scale:"0.01"}}]},getGatewayDeviceType:function getGatewayDeviceType(){return{type:this.TYPE,name:"Float System Variable"};},getCommandStatusMap:function getCommandStatusMap(){return this.MAP;},getIPevtMap:function getIPevtMap(e,r){var t=this.getCommandStatusMap(e);if(!t)return null;var a={ipevt:[]};return t.ipevt&&(a.ipevt=t.ipevt),a;},getActionMap:function getActionMap(){return{command:[]};},createDevice:function createDevice(e,r,t){var a=xnm.aio.neoserver.DM.DMError,n=xnm.aio.neoserver.DM.DMError.ERROR_CODE;e.address?t(null,JSON.parse(JSON.stringify(e))):t(new a(n.INVALID,"parameter address is invalid"));},updateDevice:function updateDevice(e,r,t){var a=xnm.aio.neoserver.DM.DMError,n=xnm.aio.neoserver.DM.DMError.ERROR_CODE;e.address?t(null,JSON.parse(JSON.stringify(e))):t(new a(n.INVALID,"parameter address is invalid"));},deleteDevice:function deleteDevice(e,r,t,a){xnm.aio.neoserver.systems.Float.delVar(e,r.address,function(){a&&a(null,JSON.parse(JSON.stringify(r)));});}}},xnm.aio.neoserver.systems.String={regist:function regist(e,r,t){r&&r.address?xnm.aio.neoserver.systems._SysVar.setVar(e,this.DM.TYPE,r.address,"",t):t&&t(new Error("regist device option foramt invalid"));},delVar:function delVar(e,r,t){r?xnm.aio.neoserver.systems._SysVar.delVar(e,r,t):t&&t(new Error("address invalid"));},executeCommandCreator:function executeCommandCreator(e,r,t,a){r?t&&t.value?r&&r.address?this._executeCommand(e,r,t,a):a&&a(new Error("device address is empty")):a&&a(new Error("device command is empty")):a&&a(new Error("device is null"));},_executeCommand:function _executeCommand(e,r,t,a){if("setValue"==t.value){var n="";null!=t.ext&&void 0!==t.ext&&(n=t.ext),!e._isV5P()&&n.length>15&&(n=n.substr(0,15)),xnm.aio.neoserver.systems._SysVar.setVar(e,this.DM.TYPE,r.address,encodeURI(n),a);}else a&&a(new Error("unknow command"));},handleStateCreator:function handleStateCreator(e,r,t){if(!r||!r.value)return null;var a=this._handleState(e,t);return a?a[r.value]:null;},_handleState:function _handleState(e,r){return r.type&&"string"==r.type.toLowerCase()&&r.adr&&"string"==typeof r.state&&e.address&&e.address&&e.address.toLowerCase()==r.adr.toLowerCase()?{state:r.state}:null;},DM:{TYPE:"STRING",MAP:{command:[{type:"string",name:"set value",ref:{value:"setValue",ext:"%s"}}],status:[{type:"string",name:"status",ref:{value:"state"}}],ipevt:[{type:"string",name:"status",ref:{value:"state"}}]},getGatewayDeviceType:function getGatewayDeviceType(){return{type:this.TYPE,name:"String System Variable"};},getCommandStatusMap:function getCommandStatusMap(){return this.MAP;},getIPevtMap:function getIPevtMap(e,r){var t=this.getCommandStatusMap(e);if(!t)return null;var a={ipevt:[]};return t.ipevt&&(a.ipevt=t.ipevt),a;},getActionMap:function getActionMap(){return{command:[]};},createDevice:function createDevice(e,r,t){var a=xnm.aio.neoserver.DM.DMError,n=xnm.aio.neoserver.DM.DMError.ERROR_CODE;e.address?t(null,JSON.parse(JSON.stringify(e))):t(new a(n.INVALID,"parameter address is invalid"));},updateDevice:function updateDevice(e,r,t){var a=xnm.aio.neoserver.DM.DMError,n=xnm.aio.neoserver.DM.DMError.ERROR_CODE;e.address?t(null,JSON.parse(JSON.stringify(e))):t(new a(n.INVALID,"parameter address is invalid"));},deleteDevice:function deleteDevice(e,r,t,a){xnm.aio.neoserver.systems.String.delVar(e,r.address,function(){a&&a(null,JSON.parse(JSON.stringify(r)));});}}},xnm.aio.neoserver.systems.Task={executeCommandCreator:function executeCommandCreator(e,r,t,a){r?t&&t.value?r&&r.address?this._executeCommand(e,r,t,a):a&&a(new Error("device address is empty")):a&&a(new Error("device command is empty")):a&&a(new Error("device is null"));},_executeCommand:function _executeCommand(e,r,t,a){var n,s;"on"==t.value?(n="SetTaskActive",s={id:r.address,active:!0}):"off"==t.value?(n="SetTaskActive",s={id:r.address,active:!1}):"toggle"==t.value&&(n="ToggleTaskActive",s={id:r.address}),e._executeRequest(n,s,{timeout:2e3},function(e){a&&a(e);});},handleStateCreator:function handleStateCreator(e,r,t){if(!r||!r.value)return null;var a=this._handleState(e,t);return a?a[r.value]:null;},_handleState:function _handleState(e,r){return r.type&&"task"==r.type.toLowerCase()&&r.id&&e.address&&e.address==r.id?{state:r.active?"on":"off"}:null;},DM:{TYPE:"TASK",MAP:{command:[{type:"enum",name:"on",ref:{value:"on"}},{type:"enum",name:"off",ref:{value:"off"}},{type:"enum",name:"toggle",ref:{value:"toggle"}}],status:[{type:"enum",name:"status",ref:{value:"state",options:["off","on"]}}]},getGatewayDeviceType:function getGatewayDeviceType(){return{type:this.TYPE,name:"Task System Variable"};},getCommandStatusMap:function getCommandStatusMap(){return this.MAP;},createDevice:function createDevice(e,r,t){var a=xnm.aio.neoserver.DM.DMError,n=xnm.aio.neoserver.DM.DMError.ERROR_CODE;e.address?t(null,JSON.parse(JSON.stringify(e))):t(new a(n.INVALID,"parameter address is invalid"));},updateDevice:function updateDevice(e,r,t){var a=xnm.aio.neoserver.DM.DMError,n=xnm.aio.neoserver.DM.DMError.ERROR_CODE;e.address?t(null,JSON.parse(JSON.stringify(e))):t(new a(n.INVALID,"parameter address is invalid"));},deleteDevice:function deleteDevice(e,r,t,a){a(null,r);}}},xnm.aio.neoserver.DM={SYS:"neoserver",GATEWAY_MAP:{cloud_forward:{command:[{type:"enum",name:"cloud forward on",ref:{value:"cfOn"}},{type:"enum",name:"cloud forward off",ref:{value:"cfOff"}},{type:"enum",name:"cloud forward toggle",ref:{value:"cfToggle"}}],status:[{type:"enum",name:"cloud forward settings",ref:{value:"cfSetting",options:["off","on"]}}]}},DMError:function(){var DMError=function DMError(e,r){this.code=e,this.message=r,this.stack=new Error().stack;};return(DMError.prototype=new Error()).name="NEOServerDeviceManagerError",DMError.prototype.code=0,DMError.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6},DMError;}(),getSystem:function getSystem(e){if(!e||!e.type)return null;for(var r in xnm.aio.neoserver.systems){if(xnm.aio.neoserver.systems.hasOwnProperty(r)){var t=xnm.aio.neoserver.systems[r];if(t&&t.DM&&t.DM.TYPE&&t.DM.TYPE.toLowerCase()==e.type.toLowerCase())return t;}}return null;},getGatewayType:function getGatewayType(){return{sys:this.SYS,name:"NEO SERVER"};},getGatewayDeviceType:function getGatewayDeviceType(e){var r=[];for(var t in xnm.aio.neoserver.systems){if(xnm.aio.neoserver.systems.hasOwnProperty(t)){var a=xnm.aio.neoserver.systems[t];if(a&&a.DM&&a.DM.getGatewayDeviceType){var n=a.DM.getGatewayDeviceType(e);if(n)if(Array.isArray(n)){for(var s=0;s<n.length;s++){n[s].sys=this.SYS;}r=r.concat(n);}else n.sys=this.SYS,r.push(n);}}}return r;},applyUIFilter:function applyUIFilter(e,r){return this._applyFilter(e,r);},applyIPEventFilter:function applyIPEventFilter(e,r,t,a,n){return this._applyFilter(e,r,n);},applyUIFilterGateway:function applyUIFilterGateway(e,r){var _contains=function _contains(e,r){if("*"==e)return!0;for(var t=!1,a=0;a<e.length;a++){if(e[a]==r){t=!0;break;}}return t;},_filter=function _filter(e,r){var t=[],a=r.elems,n=function(e){return e?xnm.aio.neoserver.DM.GATEWAY_MAP.cloud_forward:null;}(e);if(n)switch(r.catagory){case"command":n.command&&n.command.forEach(function(e){if(_contains(a,e.type)){var r=JSON.parse(JSON.stringify(e));t.push(r);}});break;case"status":n.status&&n.status.forEach(function(e){if(_contains(a,e.type)){var r=JSON.parse(JSON.stringify(e));t.push(r);}});}return t;},t=JSON.parse(JSON.stringify(e)),a=null;switch(r.catagory){case"command":a=_filter(e,r),t.command=a;break;case"status":a=_filter(e,r),t.status=a;break;default:return null;}return a&&0!=a.length?t:null;},_applyFilter:function _applyFilter(e,r,t){var _contains=function _contains(e,r){if("*"==e)return!0;for(var t=!1,a=0;a<e.length;a++){if(e[a]==r){t=!0;break;}}return t;};if(!e.sys)return null;var a=JSON.parse(JSON.stringify(e)),n=function(e,r,t){var a,n=[],s=null,i=xnm.aio.neoserver.DM.getSystem(e);return"ipevt"==r.type?i&&i.DM&&i.DM.getIPevtMap&&(a=i.DM.getIPevtMap(e,t)):"action"==r.catagory&&i&&i.DM&&i.DM.getActionMap&&(a=i.DM.getActionMap(e)),a||i&&i.DM&&i.DM.getCommandStatusMap&&(a=i.DM.getCommandStatusMap(e)),a&&(s=function(e,r,t){var a=[];if("ipevt"==t.type)e.ipevt&&e.ipevt.forEach(function(e){var r=JSON.parse(JSON.stringify(e));a.push(r);});else switch(t.catagory){case"command":e.command&&e.command.forEach(function(e){if(_contains(t.elems,e.type)){var r=JSON.parse(JSON.stringify(e));a.push(r);}});break;case"status":e.status&&e.status.forEach(function(e){if(_contains(t.elems,e.type)){var r=JSON.parse(JSON.stringify(e));a.push(r);}});}return a;}(a,0,r),n=n.concat(s)),n;}(e,r,t);if("ipevt"==r.type)a.ipevt=n;else switch(r.catagory){case"command":a.command=n;break;case"status":a.status=n;}return n&&0!=n.length?a:null;},createGateway:function createGateway(e,r,t){t(null,e);},updateGateway:function updateGateway(e,r,t,a){a(null,r);},deleteGateway:function deleteGateway(e,r,t){t();},createDevice:function createDevice(e,r,t){var a=this.DMError,n=this.DMError.ERROR_CODE;if(e){if(e.gateway){if(e.type){if(r.data&&r.data.gateways&&0!==r.data.gateways.length){var s,i,o=r.data.gateways;for(s=0;s<o.length;s++){if(o[s].index===e.gateway){i=o[s];break;}}if(i){var u=this.getSystem(e,i.info);if(u&&u.DM&&u.DM.createDevice)u.DM.createDevice(e,r,t);else t(null,JSON.parse(JSON.stringify(e)));}else t(new a(n.NOT_FOUND,"gateway with index "+e.gateway+" not exists"));}else t(new a(n.NOT_FOUND,"gateway with index "+e.gateway+" not exists"));}else t(new a(n.INVALID,"type is invalid"));}else t(new a(n.INVALID,"gateway is invalid"));}else t(new a(n.INVALID,"info is invalid"));},updateDevice:function updateDevice(e,r,t){var a=this.DMError,n=this.DMError.ERROR_CODE;if(e){if(e.gateway){if(e.type){if(r.data&&r.data.gateways&&0!==r.data.gateways.length){var s,i,o=r.data.gateways;for(s=0;s<o.length;s++){if(o[s].index===e.gateway){i=o[s];break;}}if(i){var u=this.getSystem(e);if(u&&u.DM&&u.DM.updateDevice)u.DM.updateDevice(e,r,t);else t(null,JSON.parse(JSON.stringify(e)));}else t(new a(n.NOT_FOUND,"gateway with index "+e.gateway+" not exists"));}else t(new a(n.NOT_FOUND,"gateway with index "+e.gateway+" not exists"));}else t(new a(n.INVALID,"type is invalid"));}else t(new a(n.INVALID,"gateway is invalid"));}else t(new a(n.INVALID,"info is invalid"));},deleteDevice:function deleteDevice(e,r,t){var a=this.getSystem(e);if(a&&a.DM&&a.DM.deleteDevice){var n=JSON.parse(JSON.stringify(e));if(!(r&&r.dm&&r.tenant&&r.tenant.index&&e&&e.gateway))return void(t&&t(null,n));var s={filter:"prop",index:e.gateway,"info.sys":"neoserver"};r.dm.execute("read",r.tenant.index,"gateway",s,function(s,i){if(!s&&i&&0!=i.length&&i[0]&&i[0].info){var o=require("xnm.aio.neoserver.js").resolveGateway(i[0].info);a.DM.deleteDevice(o,e,r,t);}else t&&t(null,n);});}else t();}},xnm.aio.neoserver.Handler=function(){var e=require("x.logger.js");xnm.aio.neoserver.DM._logger=e?e.getLogger("xnm.aio.neoserver.DM"):{log:function log(){}};},xnm.aio.neoserver.Handler.prototype.devicemanager=xnm.aio.neoserver.DM,xnm.aio.neoserver.Handler.prototype.registModule=function(e){e.register(xnm.aio.neoserver.DM.SYS,"neoserver");},xnm.aio.neoserver.Handler.prototype.resolveGateway=function(e){var r=require("xnm.aio.gateway.js");if(!e.ip)return null;var t=new r.GatewayV5Plus(e.ip,e.port);return e.username&&(t.user=e.username),e.password&&(t.password=e.password),t._sid=e.sid,t;},xnm.aio.neoserver.Handler.prototype.getDeviceCommands=function(e,r){var t,a=(t=e&&e.ip?xnm.aio.gateway.DM.applyUIFilterGateway(e,{catagory:"command",elems:"*"}):xnm.aio.gateway.DM.applyUIFilter(e,{catagory:"command",elems:"*"}))?t.command:[];r&&r(null,a);},xnm.aio.neoserver.Handler.prototype.getDeviceStatus=function(e,r){var t,a=(t=e&&e.ip?xnm.aio.gateway.DM.applyUIFilterGateway(e,{catagory:"status",elems:"*"}):xnm.aio.gateway.DM.applyUIFilter(e,{catagory:"status",elems:"*"}))?t.status:[];r&&r(null,a);},xnm.aio.neoserver.Handler.prototype.regist=function(e,r,t){var a=this.resolveGateway(e);if(a){var n=xnm.aio.neoserver.DM.getSystem(r);n?n.regist(a,r,t):t&&t(new Error("device type unknown"));}else t&&t(new Error("gateway json format invalid"));},xnm.aio.neoserver.Handler.prototype.doCommand=function(e,r,t,a){var n=this.resolveGateway(e);n?n.executeCommandCreator(r,t,a):a&&a(new Error("gateway json format invalid"));},xnm.aio.neoserver.Handler.prototype.doStatus=function(e,r,t,a,n){var s=this.resolveGateway(r);if(s){var i=[{id:e,device:t,status:a}];s.getStatesCreator(null,i,function(e,r){e?n&&n(e):n&&n(null,r[0]);});}else n&&n(new Error("gateway json format invalid"));},xnm.aio.neoserver.Handler.prototype.getSysVars=function(e,r){if(e){var t=this.resolveGateway(e);t?xnm.aio.neoserver.systems._SysVar.getSysVars(t,r):r&&r(new Error("gateway format invalid"));}else r&&r(new Error("gateway json is null"));},"undefined"!=typeof module&&null!=module&&(module.exports=new xnm.aio.neoserver.Handler());