var xnm=xnm||{};xnm.aio=xnm.aio||{},xnm.aio.yamaha=xnm.aio.yamaha||{},xnm.aio.yamaha.AVR=function(){var AVR=function AVR(e,t,n,a,o){this._logger=require("x.logger.js").getLogger("xnm.aio.yamaha.AVR"),this.ip=e,this.port=t,this.port||(this.port="80"),this.uuid=n,this.name=a,this.model=o,this.timeout=3e3,this.CommandHandler=null;};return AVR.prototype.audioModes=["2ch Stereo","5ch Stereo","Surround Decoder","Standard","Spectacle","Sci-Fi","Adventure","Drama","Mono Movie","Sports","Action Game","Roleplaying Game","Hall in Munich","Hall in Vienna","Chamber","Cellar Club","The Roxy Theatre","The Bottom Line","Music Video"],AVR.prototype.videoModes=["HDMI1","HDMI2","HDMI3","HDMI4","HDMI5","HDMI6","AUDIO1","AUDIO2","AV1","AV2","AV3","AV4","AV5","AV6","TUNER","USB","NET RADIO","Bluetooth","AUX","V-AUX","NET","SERVER","AirPlay","JUKE","Spotify","MusicCast Link","MULTI CH","PHONO","CD","TV","MD/CD-R","BD/HD DVD","DVD","CBL/SAT","DVR","VCR","V-AUX","DOCK","PC/MCX"],AVR.prototype.executeCommandCreator=function(e,t,n){if(t&&t.value){if("openNative"==t.value)return window&&window.XC&&window.XC.callHost&&window.XCHost&&window.XCHost.getType&&("iOS"==window.XCHost.getType()?window.XC.callHost("SYSTEM","startApp",{scheme:"jp.co.yamaha.avkk.avcontroller://"}):"Android"==window.XCHost.getType()&&window.XC.callHost("SYSTEM","startApp",{scheme:"com.yamaha.av.avcontroller"})),void(n&&n());var a="";t.path&&t.path[0]&&"global"!=t.path[0]&&(a=t.path[0]+":");var o=a+t.value;if("sleep"==t.value){if(!t.ext)return void(n&&n(new Error("command sleep ext format invalid")));o+=t.ext.replace(/min/g,"");}else if("setInput"==t.value){if(!t.ext)return void(n&&n(new Error("command setInput ext format invalid")));o=a+t.ext;}else if("audioMode"==t.value){if(!t.ext)return void(n&&n(new Error("command audioMode ext format invalid")));o=a+t.ext;}else if("setTo"==t.value){if(null==t.ext||void 0===t.ext)return void(n&&n(new Error("command setTo ext format invalid")));o+=t.ext;}else if("dlgLevel"==t.value){if(null==t.ext||void 0===t.ext)return void(n&&n(new Error("command dlgLevel ext format invalid")));o+=t.ext;}else if("setVideoPreset"==t.value){if(null==t.ext||void 0===t.ext)return void(n&&n(new Error("command setVideoPreset ext format invalid")));o+=t.ext;}else if("customCMD"==t.value){if(!t.ext)return void(n&&n(new Error("command customCMD ext format invalid")));o=a+t.ext;}if(t.path&&t.path[0]&&"tuner"==t.path[0]&&(o=t.value,"tunerPreset"==t.value)){if(null==t.ext||void 0===t.ext)return void(n&&n(new Error("command tunerPreset ext format invalid")));o="tuner"+t.ext;}this.executeCommand(o,function(e){if(e)n&&n(e);else{if(t.path&&t.path[0]&&"mainzone"==t.path[0]){if("on"==t.value||"off"==t.value||"toggle"==t.value)return void setTimeout(function(){n&&n();},1e3);if("setTo"==t.value||"volumeUp"==t.value||"volumeDown"==t.value)return void setTimeout(function(){n&&n();},10);}n&&n();}});}else n&&n(new Error("command json format invalid"));},AVR.prototype.getStatesCreator=function(e,t,n){for(var a=[],o=0;o<t.length;o++){if(t[o]&&t[o].status&&t[o].status.path&&t[o].status.path[0]){var r=0;switch(t[o].status.path[0]){case"mainzone":r=1;break;case"zone2":r=2;break;case"zone3":r=3;break;case"zone4":r=4;}r&&-1==a.indexOf(r)&&a.push(r);}}this.getStates(a,function(e,a){for(var o=[],r=0;r<t.length;r++){if(t[r]&&t[r].id){var u="?";if(t[r].status&&t[r].status.value){var l="";t[r].status.path&&t[r].status.path[0]&&"global"!=t[r].status.path[0]&&(l=t[r].status.path[0]);var i=t[r].status.value;a&&l&&a[l]&&a[l][i]&&(u=a[l][i]);}o.push({id:t[r].id,status:u});}}n&&n(null,o);});},AVR.prototype._doRequest=function(e,t,n){var a='<?xml version="1.0" encoding="utf-8"?><YAMAHA_AV cmd="'+e+'">';a+=t+"</YAMAHA_AV>";var o=this,r="http://"+this.ip+":"+this.port+"/YamahaRemoteControl/ctrl";this._logger.log("trace","send data:"+a);var u=n;$.ajax({url:r,type:"POST",timeout:this.timeout,data:a,dataType:"text",cache:!0,headers:{"Content-Length":a.length},success:function success(e){o._logger.log("trace","http request success:"+e),u&&(u(null,e),u=null);},error:function error(e,t){var n="http request error:"+(e?e.status:"0")+"-"+t;o._logger.log("trace",n);var a=new Error(n);a.code=e?e.status:0,u&&(u(a),u=null);}});},AVR.prototype._getStateValue=function(e,t,n){var a=null,o=e.find(t);return o.length>0&&(a=$(o[0]).text()),a&&n&&(a=a.toLowerCase()),a;},AVR.prototype._parseStates=function(e,t){var n={};n.power=this._getStateValue(e,"Power_Control Power",!0),"standby"==n.power&&(n.power="off"),n.sleep=this._getStateValue(e,"Power_Control Sleep",!0),n.mute=this._getStateValue(e,"Volume Mute",!0),n.mute||(n.mute=this._getStateValue(e,"Vol Mute",!0));var a=this._getStateValue(e,"Volume Lvl Val");return a||(a=this._getStateValue(e,"Vol Lvl Val")),n.volume=a?(parseFloat(a)/10).toFixed(1):null,n.input=this._getStateValue(e,"Input Input_Sel"),"zone2"!=t&&"zone3"!=t&&"zone4"!=t&&(n.mode=this._getStateValue(e,"Surround Program_Sel Current Sound_Program"),n.enhancer=this._getStateValue(e,"Surround Program_Sel Current Enhancer",!0),n.straight=this._getStateValue(e,"Surround Program_Sel Current Straight",!0),n.direct=this._getStateValue(e,"Sound_Video Pure_Direct Mode",!0),n.bass=this._getStateValue(e,"Sound_Video Extra_Bass",!0),"auto"==n.bass&&(n.bass="on"),n.ypao_volume=this._getStateValue(e,"Sound_Video YPAO_Volume",!0),"auto"==n.ypao_volume&&(n.ypao_volume="on"),n.dlgLevel=this._getStateValue(e,"Sound_Video Dialogue_Adjust Dialogue_Lvl"),n.videoPreset=this._getStateValue(e,"Sound_Video HDMI Video Preset_Sel Current",!0),n.videoPreset&&(n.videoPreset=n.videoPreset.replace("preset ",""))),n;},AVR.prototype.getStates=function(e,t){e&&0!=e.length||(e=[1]);var n={},a=0,o=this,cb=function cb(r,u){var l=e[a];!r&&u&&(1==l?n.mainzone=u.mainzone:2==l?n.zone2=u.zone2:3==l?n.zone3=u.zone3:4==l&&(n.zone4=u.zone4)),++a<e.length?o._getZoneStates(e[a],cb):t&&t(null,n);};this._getZoneStates(e[a],cb);},AVR.prototype._getZoneStates=function(e,t){var n,a,o=this;1==e?(n="Main_Zone",a="mainzone"):2==e?(n="Zone_2",a="zone2"):3==e?(n="Zone_3",a="zone3"):4==e&&(n="Zone_4",a="zone4"),this._doRequest("GET","<"+n+"><Basic_Status>GetParam</Basic_Status></"+n+">",function(e,n){if(e)t&&t(e);else try{var r=$($.parseXML(n));if(!r)return void(t&&t(new Error(a+" status reponse invalid")));var u=r.find("Basic_Status");if(!u||u.length<=0)return void(t&&t(new Error(a+" status reponse has no basic status tag")));var l=$(u[0]),i={};i[a]=o._parseStates(l,a),t&&t(null,i);}catch(e){t&&t(e);}});},AVR.prototype.executeCommand=function(e,t){var n=null,a=!0,o=null,r=e.indexOf(":");r>0&&(o=e.substr(0,r),e=e.substr(r+1));if("on"==e)n="<Power_Control><Power>On</Power></Power_Control>";else if("off"==e||"standby"==e)n="<Power_Control><Power>Standby</Power></Power_Control>";else if("toggle"==e)n="<Power_Control><Power>On/Standby</Power></Power_Control>";else if("mute"==e)n="<Volume><Mute>On</Mute></Volume>";else if("unmute"==e)n="<Volume><Mute>Off</Mute></Volume>";else if("toggleMute"==e)n="<Volume><Mute>On/Off</Mute></Volume>";else if("volumeDown"==e)n="<Volume><Lvl><Val>Down</Val><Exp></Exp><Unit></Unit></Lvl></Volume>";else if("volumeUp"==e)n="<Volume><Lvl><Val>Up</Val><Exp></Exp><Unit></Unit></Lvl></Volume>";else if("enhancerOn"==e)n="<Surround><Program_Sel><Current><Enhancer>On</Enhancer></Current></Program_Sel></Surround>";else if("enhancerOff"==e)n="<Surround><Program_Sel><Current><Enhancer>Off</Enhancer></Current></Program_Sel></Surround>";else if("directOn"==e)n="<Sound_Video><Pure_Direct><Mode>On</Mode></Pure_Direct></Sound_Video>";else if("directOff"==e)n="<Sound_Video><Pure_Direct><Mode>Off</Mode></Pure_Direct></Sound_Video>";else if("extraBassOn"==e)n="<Sound_Video><Extra_Bass>Auto</Extra_Bass></Sound_Video>";else if("extraBassOff"==e)n="<Sound_Video><Extra_Bass>Off</Extra_Bass></Sound_Video>";else if("straightOn"==e)n="<Surround><Program_Sel><Current><Straight>On</Straight></Current></Program_Sel></Surround>";else if("straightOff"==e)n="<Surround><Program_Sel><Current><Straight>Off</Straight></Current></Program_Sel></Surround>";else if("Scene1"==e)n="<Scene><Scene_Sel>Scene 1</Scene_Sel></Scene>";else if("Scene2"==e)n="<Scene><Scene_Sel>Scene 2</Scene_Sel></Scene>";else if("Scene3"==e)n="<Scene><Scene_Sel>Scene 3</Scene_Sel></Scene>";else if("Scene4"==e)n="<Scene><Scene_Sel>Scene 4</Scene_Sel></Scene>";else if("play"==e)n="<Play_Control><Playback>Play</Playback></Play_Control>";else if("pause"==e)n="<Play_Control><Playback>Pause</Playback></Play_Control>";else if("stop"==e)n="<Play_Control><Playback>Stop</Playback></Play_Control>";else if("previous"==e)n="<Play_Control><Playback>Skip Rev</Playback></Play_Control>";else if("next"==e)n="<Play_Control><Playback>Skip Fwd</Playback></Play_Control>";else if("up"==e)n="<Cursor_Control><Cursor>Up</Cursor></Cursor_Control>";else if("down"==e)n="<Cursor_Control><Cursor>Down</Cursor></Cursor_Control>";else if("left"==e)n="<Cursor_Control><Cursor>Left</Cursor></Cursor_Control>";else if("right"==e)n="<Cursor_Control><Cursor>Right</Cursor></Cursor_Control>";else if("enter"==e)n="<Cursor_Control><Cursor>Sel</Cursor></Cursor_Control>";else if("return"==e)n="<Cursor_Control><Cursor>Return</Cursor></Cursor_Control>";else if(0==e.indexOf("sleep"))e=e.replace(/sleep/g,"").toLowerCase(),n="off"==e?"<Power_Control><Sleep>Off</Sleep></Power_Control>":"<Power_Control><Sleep>"+e+" min</Sleep></Power_Control>";else if(0==e.indexOf("dlgLevel"))e=e.replace(/dlgLevel/g,"").toLowerCase(),n="<Sound_Video><Dialogue_Adjust><Dialogue_Lvl>"+e+"</Dialogue_Lvl></Dialogue_Adjust></Sound_Video>";else if(0==e.indexOf("setVideoPreset"))e=e.replace(/setVideoPreset/g,"").toLowerCase(),o="system",n="<Sound_Video><HDMI><Video><Presetl_Sel><Current>"+e+"</Current></Presetl_Sel></Video></HDMI></Sound_Video>";else if(0==e.indexOf("tuner"))a=!1,e=e.replace(/tuner/g,""),n="Up"==e?"<Tuner><Play_Control><Preset><Preset_Sel>Up</Preset_Sel></Preset></Play_Control></Tuner>":"Down"==e?"<Tuner><Play_Control><Preset><Preset_Sel>Down</Preset_Sel></Preset></Play_Control></Tuner>":"AM"==e?"<Tuner><Play_Control><Tuning><Band>AM</Band></Tuning></Play_Control></Tuner>":"FM"==e?"<Tuner><Play_Control><Tuning><Band>FM</Band></Tuning></Play_Control></Tuner>":"<Tuner><Play_Control><Preset><Preset_Sel>"+e+"</Preset_Sel></Preset></Play_Control></Tuner>";else if(-1!=this.videoModes.indexOf(e))n="<Input><Input_Sel>"+e+"</Input_Sel></Input>";else if(-1!=this.audioModes.indexOf(e))n="Straight"==e?"<Surround><Program_Sel><Current><Straight>On</Straight></Current></Program_Sel></Surround>":"<Surround><Program_Sel><Current><Sound_Program>"+e+"</Sound_Program></Current></Program_Sel></Surround>";else if(0==e.indexOf("setTo")||/^-?\d*\.{0,1}\d+$/.test(e)){0==e.indexOf("setTo")&&(e=e.replace(/setTo/g,"")),e=e.replace(/%/g,"");var u=Math.round(10*parseFloat(e));u<-805?u=-805:u>165&&(u=165),n="<Volume><Lvl><Val>"+u+"</Val><Exp>1</Exp><Unit>dB</Unit></Lvl></Volume>";}else a=!1,n=e;a&&(n="system"==o?"<System>"+n+"</System>":"zone2"==o?"<Zone_2>"+n+"</Zone_2>":"zone3"==o?"<Zone_3>"+n+"</Zone_3>":"zone2"==o?"<Zone_4>"+n+"</Zone_4>":"<Main_Zone>"+n+"</Main_Zone>");var l=this;this._doRequest("PUT",n,function(e){if(e&&400==e.code&&-1!=n.indexOf("Volume")){var a=n.replace(/Volume/g,"Vol");l._doRequest("PUT",a,t);}else t&&t(e);});},AVR.prototype.getStateValues=function(e,t){return t;},AVR.prototype.toJSON=function(){var e={sys:xnm.aio.yamaha.DM.SYS,type:"avr",ip:this.ip,port:this.port,uuid:this.uuid,model:this.model};return this.name&&(e.name=this.name),e;},AVR.prototype.equalsTo=function(e){return!!e&&e instanceof AVR&&this.ip==e.ip&&this.port==e.port;},AVR.DEVICE_1_ZONE=["RX-V477","RX-V475","RX-V500D","RX-V473","HTR-4067","HTR-5066","HTR-4066","HTR-5065","HTR-4065"],AVR.DEVICE_2_ZONE=["RX-S600D","RX-S600","RX-A1040","RX-A840","RX-A740","RX-A1030","RX-A830","RX-A730","RX-A1020","RX-A820","RX-A720","RX-A1010","RX-A810","RX-A710","RX-A1000","RX-V1077","RX-V777","RX-V677","RX-V577","RX-V1075","RX-V775","RX-V675","RX-V575","RX-V1073","RX-V773","RX-V673","RX-V573","RX-V1071","RX-V871","RX-V771","RX-V671","RX-V1067","RX-V867","HTR-6067","HTR-5067","HTR-6066","TSR-6750","HTR-7065","HTR-6065","HTR-6064","HTR-9063","HTR-8063"],AVR.DEVICE_3_ZONE=["RX-A2020","RX-A2010","RX-A2000","RX-V2073","RX-V2071","RX-V2067","RX-V2065","RX-V3900","DSP-AX3900","HTR-6295"],AVR.DEVICE_4_ZONE=["CX-A5000","RX-A3040","RX-A2040","RX-A3030","RX-A2030","RX-A3020","RX-A3010","RX-A3000","RX-V3077","RX-V2077","RX-V3075","RX-V2075","RX-V3073","RX-V3071","RX-V3067","RX-Z7","DSP-Z7"],AVR.parseJSON=function(e){return e.ip?new AVR(e.ip,e.port,e.uuid,e.name,e.model):null;},AVR.getZoneCount=function(e){return e&&e.model?-1!=AVR.DEVICE_4_ZONE.indexOf(e.model)?4:-1!=AVR.DEVICE_3_ZONE.indexOf(e.model)?3:-1!=AVR.DEVICE_2_ZONE.indexOf(e.model)?2:1:1;},AVR;}(),xnm.aio.yamaha.DM=function(){var DMError=function DMError(e,t){this.code=e,this.message=t,this.stack=new Error().stack;};(DMError.prototype=new Error()).name="YamahaDMError",DMError.prototype.code=0,DMError.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6};var e={avr:{command:[{type:"root",name:"global",value:"global",children:[{type:"string",name:"custom command",ref:{value:"customCMD",ext:"%s"}},{type:"enum",name:"open yamaha AV Controller",ref:{value:"openNative",value_t:"open_app_yamaha"}}]},{type:"root",name:"tuner",value:"tuner",children:[{type:"enum",name:"preset up",ref:{value:"tunerUp"}},{type:"enum",name:"preset down",ref:{value:"tunerDown"}},{type:"enum",name:"AM",ref:{value:"tunerAM"}},{type:"enum",name:"FM",ref:{value:"tunerFM"}},{type:"int",name:"set preset",ref:{value:"tunerPreset",ext:"%d",extMeta:"1-40",scale:"1"}}]},{type:"root",name:"main zone",value:"mainzone",children:[{type:"enum",name:"power on",ref:{value:"on"}},{type:"enum",name:"power off",ref:{value:"off"}},{type:"enum",name:"toggle power",ref:{value:"toggle"}},{type:"enum",name:"mute",ref:{value:"mute"}},{type:"enum",name:"unmute",ref:{value:"unmute"}},{type:"enum",name:"toggle mute",ref:{value:"toggleMute"}},{type:"enum",name:"enhancer on",ref:{value:"enhancerOn"}},{type:"enum",name:"enhancer off",ref:{value:"enhancerOff"}},{type:"enum",name:"direct on",ref:{value:"directOn"}},{type:"enum",name:"direct off",ref:{value:"directOff"}},{type:"enum",name:"extra bass on",ref:{value:"extraBassOn"}},{type:"enum",name:"extra bass off",ref:{value:"extraBassOff"}},{type:"enum",name:"straight on",ref:{value:"straightOn"}},{type:"enum",name:"straight off",ref:{value:"straightOff"}},{type:"enum",name:"scene 1",ref:{value:"Scene1"}},{type:"enum",name:"scene 2",ref:{value:"Scene2"}},{type:"enum",name:"scene 3",ref:{value:"Scene3"}},{type:"enum",name:"scene 4",ref:{value:"Scene4"}},{type:"enum",name:"sleep",ref:{value:"sleep",ext:"%e",extMeta:["30min","60min","90min","120min","off"]}},{type:"enum",name:"set input",ref:{value:"setInput",ext:"%e",extMeta:["HDMI1","HDMI2","HDMI3","HDMI4","HDMI5","HDMI6","AUDIO1","AUDIO2","AV1","AV2","AV3","AV4","AV5","AV6","TUNER","USB","NET RADIO","Bluetooth","AUX","V-AUX","NET","SERVER","AirPlay","JUKE","Spotify","MusicCast Link","MULTI CH","PHONO","CD","TV","MD/CD-R","BD/HD DVD","DVD","CBL/SAT","DVR","VCR","V-AUX","DOCK","PC/MCX"]}},{type:"enum",name:"set dsp mode",ref:{value:"audioMode",value_t:"setDSPMode",ext:"%e",extMeta:["2ch Stereo","5ch Stereo","Surround Decoder","Standard","Spectacle","Sci-Fi","Adventure","Drama","Mono Movie","Sports","Action Game","Roleplaying Game","Hall in Munich","Hall in Vienna","Chamber","Cellar Club","The Roxy Theatre","The Bottom Line","Music Video"]}},{type:"enum",name:"volume up",ref:{value:"volumeUp"}},{type:"enum",name:"volume down",ref:{value:"volumeDown"}},{type:"float",name:"volume to",ref:{value:"setTo",value_t:"volumeTo",unit:"db",ext:"%f",extMeta:"-80.5-16.5",scale:"0.5"}},{type:"enum",name:"play",ref:{value:"play"}},{type:"enum",name:"pause",ref:{value:"pause"}},{type:"enum",name:"stop",ref:{value:"stop"}},{type:"enum",name:"previous",ref:{value:"previous"}},{type:"enum",name:"next",ref:{value:"next"}},{type:"enum",name:"up",ref:{value:"up"}},{type:"enum",name:"down",ref:{value:"down"}},{type:"enum",name:"left",ref:{value:"left"}},{type:"enum",name:"right",ref:{value:"right"}},{type:"enum",name:"enter",ref:{value:"enter"}},{type:"enum",name:"return",ref:{value:"return"}}]}],status:[{type:"root",name:"main zone",value:"mainzone",children:[{type:"float",name:"volume",ref:{value:"volume",unit:"db",extMeta:"-80.5-16.5",scale:"0.5"}},{type:"enum",name:"power",ref:{value:"power",options:["on","off"]}},{type:"enum",name:"mute",ref:{value:"mute",options:["on","off"]}},{type:"enum",name:"sleep",ref:{value:"sleep",options:["30min","60min","90min","120min","off"]}},{type:"enum",name:"input",ref:{value:"input",options:["HDMI1","HDMI2","HDMI3","HDMI4","HDMI5","HDMI6","AUDIO1","AUDIO2","AV1","AV2","AV3","AV4","AV5","AV6","TUNER","USB","NET RADIO","Bluetooth","AUX","V-AUX","NET","SERVER","AirPlay","JUKE","Spotify","MusicCast Link","MULTI CH","PHONO","MULTI CH","PHONO","CD","TV","MD/CD-R","BD/HD DVD","DVD","CBL/SAT","DVR","VCR","V-AUX","DOCK","PC/MCX"]}},{type:"enum",name:"dsp mode",ref:{value:"mode",options:["2ch Stereo","5ch Stereo","Surround Decoder","Standard","Spectacle","Sci-Fi","Adventure","Drama","Mono Movie","Sports","Action Game","Roleplaying Game","Hall in Munich","Hall in Vienna","Chamber","Cellar Club","The Roxy Theatre","The Bottom Line","Music Video","Straight"]}},{type:"enum",name:"enhancer",ref:{value:"enhancer",options:["on","off"]}},{type:"enum",name:"straight",ref:{value:"straight",options:["on","off"]}},{type:"enum",name:"extra bass",ref:{value:"bass",value_t:"extraBass",options:["on","off"]}},{type:"enum",name:"direct",ref:{value:"direct",value_t:"pureDirect",options:["on","off"]}}]}]},avr_zone_template:{command:[{type:"root",name:"@zone N",value:"zoneN",children:[{type:"enum",name:"power on",ref:{value:"on"}},{type:"enum",name:"power off",ref:{value:"off"}},{type:"enum",name:"toggle power",ref:{value:"toggle"}},{type:"enum",name:"mute",ref:{value:"mute"}},{type:"enum",name:"unmute",ref:{value:"unmute"}},{type:"enum",name:"toggle mute",ref:{value:"toggleMute"}},{type:"enum",name:"sleep",ref:{value:"sleep",ext:"%e",extMeta:["30min","60min","90min","120min","off"]}},{type:"enum",name:"set input",ref:{value:"setInput",ext:"%e",extMeta:["HDMI1","HDMI2","HDMI3","HDMI4","HDMI5","HDMI6","AUDIO1","AUDIO2","AV1","AV2","AV3","AV4","AV5","AV6","TUNER","USB","NET RADIO","Bluetooth","AUX","V-AUX","NET","SERVER","AirPlay","JUKE","Spotify","MusicCast Link"]}},{type:"enum",name:"volume up",ref:{value:"volumeUp"}},{type:"enum",name:"volume down",ref:{value:"volumeDown"}},{type:"float",name:"volume to",ref:{value:"setTo",value_t:"volumeTo",unit:"db",ext:"%f",extMeta:"-80.5-16.5",scale:"0.5"}},{type:"enum",name:"play",ref:{value:"play"}},{type:"enum",name:"pause",ref:{value:"pause"}},{type:"enum",name:"stop",ref:{value:"stop"}},{type:"enum",name:"previous",ref:{value:"previous"}},{type:"enum",name:"next",ref:{value:"next"}},{type:"enum",name:"up",ref:{value:"up"}},{type:"enum",name:"down",ref:{value:"down"}},{type:"enum",name:"left",ref:{value:"left"}},{type:"enum",name:"right",ref:{value:"right"}},{type:"enum",name:"enter",ref:{value:"enter"}},{type:"enum",name:"return",ref:{value:"return"}}]}],status:[{type:"root",name:"zone N",value:"zoneN",children:[{type:"float",name:"volume",ref:{value:"volume",unit:"db",extMeta:"-80.5-16.5",scale:"0.5"}},{type:"enum",name:"power",ref:{value:"power",options:["on","off"]}},{type:"enum",name:"mute",ref:{value:"mute",options:["on","off"]}},{type:"enum",name:"sleep",ref:{value:"sleep",options:["30min","60min","90min","120min","off"]}},{type:"enum",name:"input",ref:{value:"input",options:["HDMI1","HDMI2","HDMI3","HDMI4","HDMI5","HDMI6","AUDIO1","AUDIO2","AV1","AV2","AV3","AV4","AV5","AV6","TUNER","USB","NET RADIO","Bluetooth","AUX","V-AUX","NET","SERVER","AirPlay","JUKE","Spotify","MusicCast Link"]}}]}]},"avr_RX-A3040":{command:[{type:"root",name:"main zone",value:"mainzone",children:[{type:"int",name:"dialogue level",ref:{value:"dlgLevel",ext:"%d",extMeta:"0-3"}},{type:"enum",name:"set HDMI video preset",ref:{value:"setVideoPreset",ext:"%e",extMeta:["1","2","3","4","5","6"]}}]}],status:[{type:"root",name:"main zone",value:"mainzone",children:[{type:"int",name:"dialogue level",ref:{value:"dlgLevel",ext:"%d",extMeta:"0-3"}},{type:"enum",name:"HDMI video preset",ref:{value:"videoPreset",options:["1","2","3","4","5","6"]}}]}]}};return{SYS:"yamaha",getIPDeviceType:function getIPDeviceType(){return[{sys:this.SYS,name:"Yamaha AV Receiver",type:"avr"}];},createDevice:function createDevice(e,t,n){var a=DMError,o=DMError.ERROR_CODE;e?e.ip?n(null,e):n(new a(o.INVALID,"ip is invalid")):n(new a(o.INVALID,"info is invalid"));},updateDevice:function updateDevice(e,t,n){var a=DMError,o=DMError.ERROR_CODE;e?e.ip?n(null,e):n(new a(o.INVALID,"ip is invalid")):n(new a(o.INVALID,"info is invalid"));},deleteDevice:function deleteDevice(e,t,n){n();},applyUIFilter:function applyUIFilter(e,t,n){var _doFilterArr=function _doFilterArr(e,t,n){var a=[];return e.forEach(function(e){if("root"==e.type){var o=JSON.parse(JSON.stringify(e)),r=_doFilterArr(o.children,t,n);r&&r.length>0&&(o.children=r,a.push(o));}else if(function(e,t){if("*"==e)return!0;for(var n=!1,a=0;a<e.length;a++){if(e[a]==t){n=!0;break;}}return n;}(n.elems,e.type)){var u=JSON.parse(JSON.stringify(e));a.push(u);}}),a;},_filter=function _filter(e,t){var a=[],o=null,r=xnm.aio.yamaha.DM.getCommandStatusMap(e,n);return r&&(o=function(e,t,n){var a=[];switch(n.catagory){case"command":e.command&&(a=_doFilterArr(e.command,t,n));break;case"status":e.status&&(a=_doFilterArr(e.status,t,n));}return a;}(r,e,t),a=a.concat(o)),a;};if(!e.sys)return null;var a=JSON.parse(JSON.stringify(e)),o=null;switch(t.catagory){case"command":o=_filter(e,t),a.command=o;break;case"status":o=_filter(e,t),a.status=o;break;default:return null;}return o&&0!=o.length?a:null;},getCommandStatusMap:function getCommandStatusMap(t){if(!t||!t.type)return null;var n=e[t.type];if(!n)return null;n=JSON.parse(JSON.stringify(n));var a=xnm.aio.yamaha.AVR.getZoneCount(t);if(a>1)for(var o=2;o<=a;o++){var r=JSON.parse(JSON.stringify(e.avr_zone_template));r.command[0].name="zone "+o,r.command[0].value="zone"+o,r.status[0].name="zone "+o,r.status[0].value="zone"+o,n.command=n.command.concat(r.command),n.status=n.status.concat(r.status);}if(t.model&&e[t.type+"_"+t.model]){var u=e[t.type+"_"+t.model];u&&(u=JSON.parse(JSON.stringify(u))),u&&u.command&&u.command.forEach(function(e){if(e&&"root"==e.type){var t=function(e,t){if(!e||!t||!t.command)return null;for(var n=0;n<t.command.length;n++){if(t.command[n]&&"root"==t.command[n].type&&t.command[n].value==e)return t.command[n];}return null;}(e.value,n);t?(t.children||(t.children=[]),t.children=t.children.concat(e.children)):n.command.push(e);}else n.command.push(e);}),u&&u.status&&u.status.forEach(function(e){if(e&&"root"==e.type){var t=function(e,t){if(!e||!t||!t.status)return null;for(var n=0;n<t.status.length;n++){if(t.status[n]&&"root"==t.status[n].type&&t.status[n].value==e)return t.status[n];}return null;}(e.value,n);t?(t.children||(t.children=[]),t.children=t.children.concat(e.children)):n.status.push(e);}else n.status.push(e);});}return n;}};}(),xnm.aio.yamaha.Handler=function(){var Handler=function Handler(){this.detectedAVRs={};};return Handler.prototype.devicemanager=xnm.aio.yamaha.DM,Handler.prototype.AVR=xnm.aio.yamaha.AVR,Handler.prototype.registModule=function(e){e.register(this.devicemanager.SYS,"yamaha");},Handler.prototype.resolveDevice=function(e){return e&&"avr"===e.type?xnm.aio.yamaha.AVR.parseJSON(e):null;},Handler.prototype.getDeviceCommands=function(e,t){var n=this.devicemanager.applyUIFilter(e,{catagory:"command",elems:"*"}),a=n?n.command:[];t&&t(null,a);},Handler.prototype.getDeviceStatus=function(e,t){var n=this.devicemanager.applyUIFilter(e,{catagory:"status",elems:"*"}),a=n?n.status:[];t&&t(null,a);},Handler.prototype.doCommand=function(e,t,n){var a=this.resolveDevice(e);a?a.executeCommandCreator(e,t,function(e){n&&n(e);}):n&&n(new Error("device json format invalid"));},Handler.prototype.doStatus=function(e,t,n,a){var o=this.resolveDevice(t);if(o){var r=[{id:e,device:t,status:n}];o.getStatesCreator(null,r,function(e,t){e?a&&a(e):a&&a(null,t[0]);});}else a&&a(new Error("device json format invalid"));},Handler.prototype.discoverDevices=function(e){var t=require("x.upnp.js");if(t){var n=this;t.discoverDevicesWithTimeout(3e3,function(t){if(t.manufacturer&&0==t.manufacturer.indexOf("Yamaha")&&"AV Receiver"==t.modelDescription){var a=function(e){if(!e)return e;var t,n=null;for(t=0;t<xnm.aio.yamaha.AVR.DEVICE_1_ZONE.length;t++){if(n=xnm.aio.yamaha.AVR.DEVICE_1_ZONE[t],-1!=e.indexOf(n))return n;}for(t=0;t<xnm.aio.yamaha.AVR.DEVICE_2_ZONE.length;t++){if(n=xnm.aio.yamaha.AVR.DEVICE_2_ZONE[t],-1!=e.indexOf(n))return n;}for(t=0;t<xnm.aio.yamaha.AVR.DEVICE_3_ZONE.length;t++){if(n=xnm.aio.yamaha.AVR.DEVICE_3_ZONE[t],-1!=e.indexOf(n))return n;}for(t=0;t<xnm.aio.yamaha.AVR.DEVICE_4_ZONE.length;t++){if(n=xnm.aio.yamaha.AVR.DEVICE_4_ZONE[t],-1!=e.indexOf(n))return n;}return e;}(t.modelName),o=new xnm.aio.yamaha.AVR(t.ip,80,t.uuid,t.name,a);n.detectedAVRs["uuid:"+t.uuid]||(n.detectedAVRs["uuid:"+t.uuid]=o),e(o);}});}},Handler.prototype.discoverWithTimeout=function(e,t){var n={};this.discoverDevices(function(e){e&&e.uuid&&!n[e.uuid]&&(n[e.uuid]=e);}),setTimeout(function(){var e=[];for(var a in n){n.hasOwnProperty(a)&&e.push(n[a]);}t&&t(null,e);},e);},Handler.prototype.getStateValues=function(e,t){return new xnm.aio.yamaha.AVR().getStateValues(e.type,t);},Handler.prototype.getDeviceCommandList=function(e,t,n){return[];},Handler;}(),"undefined"!=typeof module&&null!=module&&(module.exports=new xnm.aio.yamaha.Handler());