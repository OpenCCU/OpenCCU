var xnm=xnm||{};xnm.aio=xnm.aio||{},xnm.aio.hcgw=xnm.aio.hcgw||{},xnm.aio.hcgw.Gateway=function(t){this.ip=t,this.port=49880,this.mode=1;},xnm.aio.hcgw.Gateway.prototype._doRequest=function(t,e,a){var n=require("dgram").createSocket("udp4"),i=new Buffer(t);xnm.aio.hcgw._logger.log("debug","[Gateway._doRequest] Sending message to: "+this.ip+":"+this.port),n.send(i,0,i.length,this.port,this.ip,function(t,i){t?xnm.aio.hcgw._logger.log("error","[Gateway._doRequest] "+t.message):xnm.aio.hcgw._logger.log("debug","[Gateway._doRequest] Message sent."),n.close(),a&&setTimeout(function(){a();},Math.floor(e+750));});},xnm.aio.hcgw.Gateway.prototype.sendSignal=function(t,e){null==t.pause&&(0==this.mode?t.pause=t.data[t.data.length-1]*t.timing:t.pause=(t.data[t.data.length-1]/2+1)*t.timing);var a=t.data[t.data.length-1],n="TXP:0,0,";n+=t.repeats+",",n+=t.pause+",",n+=t.timing+",",0==this.mode?n+=t.data.length/2+1+",0,":n+=t.data.length/2+",";for(var i=0;i<t.data.length-1;i++){n+=t.data[i]+",",a+=t.data[i];}0==this.mode?n+=t.data[t.data.length-1]+",0":n+=Math.floor(t.data[t.data.length-1]/2+1)+";",this._doRequest(n,a*t.timing*t.repeats/1e3,e);},xnm.aio.hcgw.Discovery=function(){this.Gateways={},this._sockets=[];var t=require("os");require("dgram");if(t&&t.networkInterfaces){var e=t.networkInterfaces();for(var a in e){for(var n=e[a],i=0;i<n.length;i++){this._addDiscoverSocket(49880,n[i]);}}}else this._addDiscoverSocket(49880,null);},xnm.aio.hcgw.Discovery.prototype._receivedData=function(t,e){var a=e.toString();if(xnm.aio.hcgw._logger.log("debug","[Discovery._receivedData] Received from "+t+": "+a),a.length>5&&a.startsWith("HCGW:")){for(var n=new xnm.aio.hcgw.Gateway(t),i=(a=a.substr(5)).split(";"),r=0;r<i.length;r++){var o=i[r].split(":");2===o.length&&"VC"===o[0]&&"ITECHNO"===o[1]&&(n.mode=0);}this.Gateways[t]=n;}},xnm.aio.hcgw.Discovery.prototype._addDiscoverSocket=function(t,e){var a=require("dgram"),n=this,i=null;if(e){if("IPv4"==e.family&&0==e.internal){try{i=a.createSocket({reuseAddr:!0,type:"udp4"});}catch(t){xnm.aio.hcgw._logger.log("error","[Discovery._addDiscoverSocket] (IPv4, non-internal) "+t.message),i=a.createSocket("udp4");}i.on("error",function(t){t&&("string"==typeof t&&(t=new Error(t)),xnm.aio.hcgw._logger.log("error","[Discovery._addDiscoverSocket] (IPv4, non-internal) socket error: "+t.message));}),i.on("listening",function(){i.setBroadcast(!0);}),i.on("message",function(t,e){n._receivedData(e.address,t.toString());}),i.bind(t,e.address),this._sockets.push(i);}}else{try{i=a.createSocket({reuseAddr:!0,type:"udp4"});}catch(t){xnm.aio.hcgw._logger.log("error","[Discovery._addDiscoverSocket] (no info) "+t.message),i=a.createSocket("udp4");}i.on("error",function(t){t&&("string"==typeof t&&(t=new Error(t)),xnm.aio.hcgw._logger.log("error","[Discovery._addDiscoverSocket] (no info) socket error: "+t.message));}),i.on("message",function(t,e){n._receivedData(e.address,t.toString());}),i.bind(t),this._sockets.push(i);}},xnm.aio.hcgw.Discovery.prototype._sendDiscoveryMessages=function(){xnm.aio.hcgw._logger.log("debug","[Discovery._sendDiscoveryMessages] SEARCH HCGW");for(var t=new Buffer("SEARCH HCGW"),e=0;e<this._sockets.length;e++){this._sockets[e].send(t,0,t.length,49880,"255.255.255.255");}},xnm.aio.hcgw.Discovery.prototype.discoverGateways=function(){var t=this,e=0,a=setInterval(function(){t._sendDiscoveryMessages(),e++>=1&&clearInterval(a);},250);},xnm.aio.hcgw.Handler=function(){xnm.aio.hcgw._logger||(xnm.aio.hcgw._logger=require("x.logger.js").getLogger("xnm.aio.hcgw")),this._Discovery=null;},xnm.aio.hcgw.Handler.prototype.discoverGateways=function(t){var _this=this;this._Discovery||(this._Discovery=new xnm.aio.hcgw.Discovery()),this._Discovery.discoverGateways(),t&&setTimeout(function(){t(_this._Discovery.Gateways);},5e3);},xnm.aio.hcgw.Handler.prototype.getDetectedGateways=function(){return this._Discovery||(this._Discovery=new xnm.aio.hcgw.Discovery()),this._Discovery.Gateways;},xnm.aio.hcgw.Handler.prototype._sendNextGatewaySignal=function(t,e){if(t.length>0){var a=this,n=t.pop();n.gateway.sendSignal(n.signal,function(){a._sendNextGatewaySignal(t,e);});}else e&&e();},xnm.aio.hcgw.Handler.prototype.getSignal=function(t,e,a){var n="";return"ELRO"==t?n=this.getElroSignal(e,a):"IT"==t?n=this.getIntertechnoSignal(e,a):"BS"==t?n=this.getBrennenstuhlSignal(e,a):"BS2"==t?n=this.getBrennenstuhlSignal(e,a,[1,4]):"DY"==t&&(n=this.getDooyaSignal(e,a)),n;},xnm.aio.hcgw.Handler.prototype.sendSignalToGateways=function(t,e,a){var n=[];if(t)for(var i in e){n.push({gateway:e[i],signal:t});}this._sendNextGatewaySignal(n,a);},xnm.aio.hcgw.Handler.prototype.getElroSignal=function(t,e){var a=null;if(6==t.length){var n="0";"on"==e?n="1":"off"==e&&(n="4"),a={data:[],timing:350,repeats:6,pause:null};var i=XC.getBytes(t.substr(0,5)+n,!0);for(var _t=0;_t<i.length;_t++){for(var _e=0;_e<8;_e++){i[_t]&128>>_e?a.data=a.data.concat([3,1]):a.data=a.data.concat([1,3]);}}a.data=a.data.concat([1,32]);}return a;},xnm.aio.hcgw.Handler.prototype.getDooyaSignal=function(t,e){var a=null;if(8==t.length){var n="55";"up"==e||"moveUp"==e?n="11":"down"==e||"moveDown"==e?n="33":"learn"==e&&(n="CC"),a={data:[57,18],timing:91,repeats:10,pause:null};for(var i=XC.getBytes(t+n,!0),r=0;r<i.length;r++){for(var o=0;o<8;o++){i[r]&128>>o?a.data=a.data.concat([8,4]):a.data=a.data.concat([4,8]);}}a.data[a.data.length-1]=120;}return a;},xnm.aio.hcgw.Handler.prototype.getIntertechnoSignal=function(t,e){var a=null,n=t.split(".");if(2==n.length&&(1==n[0].length?t="0"+n[0]+"0"+n[1]+"00":7==n[0].length&&(t=n[0]+n[1])),6==t.length){var _n="0";"on"==e?_n="E":"off"==e&&(_n="6"),a={data:[],timing:89,repeats:5,pause:11125};var _i=XC.getBytes(t.substr(0,5)+_n,!0);for(var _t2=0;_t2<3;_t2++){for(var _e2=0;_e2<8;_e2+=2){_i[_t2]&1<<_e2/2?a.data=a.data.concat([4,12,12,4]):a.data=a.data.concat([4,12,4,12]);}}a.data=a.data.concat([4,125]);}else if(8==t.length){var i=null,r=parseInt(t.substr(6,1),16);r&=-2,"on"==e?r|=1:(0==e.indexOf("dimTo")&&(r|=1,e=e.replace(/dimTo/g,"")),"10"==(e=e.replace(/%/g,""))?i="00":"20"==e?i="10":"30"==e?i="20":"40"==e?i="30":"50"==e?i="50":"60"==e?i="70":"70"==e?i="90":"80"==e?i="B0":"90"==e?i="D0":"100"==e&&(i="F0"));var _n2=null;_n2=null!=i?t.substr(0,6)+r+t.substr(7)+i:t.substr(0,6)+r+t.substr(7),a={data:[],timing:98,repeats:5,pause:10976};var o=XC.getBytes(_n2,!0);a.data=a.data.concat([3,29]);for(var _t3=0;_t3<4;_t3++){for(var _e3=0;_e3<8;_e3++){o[_t3]&128>>_e3?a.data=a.data.concat([3,15,3,3]):a.data=a.data.concat([3,3,3,15]);}}if(5==o.length){a.data[a.data.length-17]=a.data[a.data.length-19]=3;for(var _t4=0;_t4<4;_t4++){o[4]&128>>_t4?a.data=a.data.concat([3,15,3,3]):a.data=a.data.concat([3,3,3,15]);}}a.data=a.data.concat([3,126]);}return a;},xnm.aio.hcgw.Handler.prototype.getBrennenstuhlSignal=function(t,e,a){var n=null;if(6==t.length){var i=XC.getBytes(t,!0);"on"==e||"day"==e?i[2]|=32:"off"!=e&&"night"!=e||(i[2]&=-33);var r=[10,0,4,12,2,14,7,5,1,15,11,13,9,6,3,8];32&i[0]&&(r=[2,12,5,14,7,4,1,15,11,13,6,3,8,9,10,0]);var o=r[15&i[2]],s=r[o^(240&i[2])>>4],d=r[s^15&i[1]],c=r[d^(240&i[1])>>4],l=r[c^15&i[0]];i=[((9^(240&i[0])>>4)<<4)+l,(c<<4)+d,(s<<4)+o],n={data:[],timing:505,repeats:6,pause:0};var h=[2,1],g=[1,2];"day"==e||"night"==e?(n.timing=385,n.repeats=112,n.pause=385,h=[3,1],g=[1,3],n.data=n.data.concat([1,6])):n.data=a?n.data.concat(a):n.data.concat([6,14]);for(var p=0;p<i.length;p++){for(var y=0;y<8;y++){i[p]&128>>y?n.data=n.data.concat(h):n.data=n.data.concat(g);}}}return n;},xnm.aio.hcgw.Handler.prototype.Gateway=xnm.aio.hcgw.Gateway,xnm.aio.hcgw.Gateway.prototype.learn=function(t,e){var _contains=function _contains(t,e){if(!t)return null;for(var a=t.length;a--;){if(t[a]===e)return!0;}return!1;},_getHexVal=function _getHexVal(t,e){for(var a=t.toString(16).toUpperCase();a.length<e;){a="0"+a;}return a;};if(t&&t.type){var a=!0,n=[];if(t.devices)for(var i=t.devices.length;i--;){t.devices[i].address&&n.push(t.devices[i].address);}var r,o=t.address;switch(o&&(a=!1),t.type){case"IT2":for(;a;){a=_contains(n,o=_getHexVal(Math.floor(57070*Math.random())+4369,4)+"008.0");}r={value:"on"};break;case"DY":case"DY2":for(;a;){a=_contains(n,o=_getHexVal(Math.floor(4294967295*Math.random()),8));}r="DY"==t.type?{value:"learn"}:{value:"up"};break;case"BS":case"BS2":for(;a;){a=_contains(n,o=_getHexVal(Math.floor(65535*Math.random()),4)+"01");}r={value:"on"},"heater"==t.data&&(r={value:"day"});break;default:return void(e&&e(new Error("device type invalid")));}var s={type:t.type,data:t.data?t.data:"switch",address:o};this.executeCommandCreator(s,r,function(t){t?e&&e(t):e&&e(null,{address:o});});}else e&&e(new Error("options invalid"));},xnm.aio.hcgw.Gateway.prototype.executeCommandCreator=function(t,e,a){if(e&&e.value){if(t&&t.type&&t.address&&t.data){var n=t.type;"IT2"==n&&(n="IT"),"DY2"==n&&(n="DY");var i=t.address,r=e.value;if("dimTo"==e.value){if(null==e.ext||void 0===e.ext)return void(a&&a(new Error("invalid dimTo command format")));var o=e.ext;"string"==typeof e.ext&&(o=parseInt(e.ext)),r="dimTo"+o,0==o&&(r="off");}var s=require("xnm.aio.hcgw.js"),d=s.getSignal(n,i,r);if(d){var c,l=[];if(s._Discovery&&s._Discovery.Gateways)for(var h in s._Discovery.Gateways){s._Discovery.Gateways.hasOwnProperty(h)&&(this.ip==h&&(c=s._Discovery.Gateways[h]),l.push(s._Discovery.Gateways[h]));}c?c.sendSignal(d,a):0!=l.length?s.sendSignalToGateways(d,l,a):this.sendSignal(d,a),s.discover();}else a&&a(new Error("invalid device address"));}else a&&a(new Error("invalid device format"));}else a&&a(new Error("command json invalid"));},xnm.aio.hcgw.Gateway.prototype.toJSON=function(){return{sys:xnm.aio.hcgw.DM.SYS,ip:this.ip,port:this.port,mode:this.mode};},xnm.aio.hcgw.Gateway.prototype.equalsTo=function(t){return!!t&&t instanceof xnm.aio.hcgw.Gateway&&this.ip==t.ip&&this.port==t.port;},xnm.aio.hcgw.DM={SYS:"hcgw",MAP:{ELRO:{general:{command:[{type:"enum",name:"off",ref:{value:"off"}},{type:"enum",name:"on",ref:{value:"on"}}]}},DY:{shutter:{command:[{type:"enum",name:"up",ref:{value:"up"}},{type:"enum",name:"down",ref:{value:"down"}},{type:"enum",name:"stop",ref:{value:"stop"}}]}},BS:{general:{command:[{type:"enum",name:"on",ref:{value:"on"}},{type:"enum",name:"off",ref:{value:"off"}}]},heater:{command:[{type:"enum",name:"day",ref:{value:"day"}},{type:"enum",name:"night",ref:{value:"night"}}]}},BS2:{general:{command:[{type:"enum",name:"on",ref:{value:"on"}},{type:"enum",name:"off",ref:{value:"off"}}]}},IT:{general:{command:[{type:"enum",name:"on",ref:{value:"on"}},{type:"enum",name:"off",ref:{value:"off"}}]},shutter:{command:[{type:"enum",name:"up",ref:{value:"on"}},{type:"enum",name:"down",ref:{value:"off"}}]},dimmer:{command:[{type:"enum",name:"on",ref:{value:"on"}},{type:"enum",name:"off",ref:{value:"off"}},{type:"int",name:"dim to",ref:{value:"dimTo",ext:"%d",extMeta:"0-100",scale:"10"}}]}}},getGatewayType:function getGatewayType(){return[{sys:this.SYS,name:"brennenstuhl Gateway",vendor:"brennenstuhl"},{sys:this.SYS,name:"intertechno Gateway",vendor:"intertechno"},{sys:this.SYS,name:"HC Gateway",vendor:"hc"}];},getGatewayDeviceType:function getGatewayDeviceType(){return{brennenstuhl:{"RC 3600":{type:"BS",data:["switch","light"]},"RCR 2044":{type:"BS",data:["switch","light"]},"RCR 2044 IP44":{type:"BS",data:["switch","light"]},"RCR 3600":{type:"BS",data:["switch","light"]},"RCR 3600 IP44":{type:"BS",data:["switch","light"]},"RCR CE1 1011 IP20":{type:"BS2",data:["switch","light"]},"RCR CE1 1011 IP44":{type:"BS2",data:["switch","light"]},"RCS 1000N":{type:"ELRO",data:["switch","light"]},"RCS 1044N":{type:"ELRO",data:["switch","light"]},"RCS 2044 N":{type:"ELRO",data:["switch","light"]},"RCS 2044 N IP44":{type:"ELRO",data:["switch","light"]},"RCR EL1 3726":{type:"BS",data:["switch","light"]},"RCR PL1 3726":{type:"BS",data:["switch","light"]}},BAT:{"RC 3500-A IP44 DE":{type:"ELRO",data:["switch","light"]},"RCE AAA1000-A IP44":{type:"ELRO",data:["switch","light"]},"RCE AAA3680-A IP20":{type:"BS",data:["switch","light"]},"RCR 1000N-A":{type:"ELRO",data:["switch","light"]}},ELRO:{AB440D:{type:"ELRO",data:["light"]},AB440ID:{type:"ELRO",data:["light"]},AB440IS:{type:"ELRO",data:["switch","light"]},AB440L:{type:"ELRO",data:["light"]},AB440S:{type:"ELRO",data:["switch","light"]},AB440WD:{type:"ELRO",data:["switch","light"]}},Vivanco:{"FSS 31000W":{type:"ELRO",data:["switch","light"]},"FSS 33600W":{type:"ELRO",data:["switch","light"]}},Xavax:{"GRR-3500":{type:"IT2",data:["switch","light"]},"ITLR-300":{type:"IT2",data:["dimmer"]},"ITLR-3500":{type:"IT2",data:["switch","light"]},"ITR-1500":{type:"IT2",data:["switch","light"]},"LBUR-100":{type:"IT2",data:["light"]}},rohrmotor24:{"RMF Motor":{type:"DY",data:["shutter"]},"RMF-R1":{type:"DY",data:["shutter"]},"RMF-R1 (UP)":{type:"DY",data:["shutter"]},"RMF-R1L (UP)":{type:"DY",data:["shutter"]},"RMF-RS1 (AP/UP)":{type:"DY",data:["shutter"]}},intertechno:{"CMR-300":{type:"IT",data:["light"]},"CMR-1000":{type:"IT",data:["switch","light"]},"CMR-1224":{type:"IT",data:["switch","light"]},"GRR-300":{type:"IT",data:["switch","light"]},"GRR-3500":{type:"IT2",data:["switch","light"]},"IT-300L":{type:"IT2",data:["light"]},"IT-1500":{type:"IT2",data:["switch","light"]},"IT-2300":{type:"IT2",data:["switch","light"]},"IT-3500L":{type:"IT2",data:["switch","light"]},"ITDL-1000":{type:"IT2",data:["switch","light"]},"ITDM-250":{type:"IT2",data:["light"]},"ITE-300":{type:"IT",data:["light"]},"ITE-1000":{type:"IT",data:["switch","light"]},"ITL-150":{type:"IT2",data:["light"]},"ITL-210":{type:"IT2",data:["light"]},"ITL-230":{type:"IT2",data:["switch","light"]},"ITL-250":{type:"IT2",data:["light"]},"ITL-300":{type:"IT2",data:["light"]},"ITL-1000":{type:"IT2",data:["switch","light","shutter"]},"ITL-3500":{type:"IT2",data:["switch","light"]},"ITLR-300":{type:"IT2",data:["dimmer"]},"ITLR-3500":{type:"IT2",data:["switch","light"]},"ITLR-3500T":{type:"IT2",data:["switch","light"]},"ITR-300":{type:"IT",data:["light"]},"ITR-1500":{type:"IT2",data:["switch","light"]},"ITR-3500":{type:"IT",data:["switch","light"]},"ITR-7000":{type:"IT2",data:["switch"]},"ITWR-3500":{type:"IT2",data:["switch","light"]},"LBUR-100":{type:"IT2",data:["light"]},"PA3-1000":{type:"IT",data:["switch","light"]},"PAR-1500":{type:"IT",data:["switch","light"]},"CMR-500":{type:"IT",data:["shutter"]},"ITL-500":{type:"IT2",data:["shutter"]}}};},createGateway:function createGateway(t,e,a){var n=xnm.aio.hcgw.DM.DMError,i=xnm.aio.hcgw.DM.DMError.ERROR_CODE;t?t.ip?(t.port||(t.port=49880),t.vendor||(t.vendor="steckpro"),a(null,t)):a(new n(i.INVALID,"ip is invalid")):a(new n(i.INVALID,"info is invalid"));},updateGateway:function updateGateway(t,e,a,n){var i=xnm.aio.hcgw.DM.DMError,r=xnm.aio.hcgw.DM.DMError.ERROR_CODE;e?e.ip?(e.port||(e.port=49880),e.vendor||(e.vendor="steckpro"),n(null,e)):n(new i(r.INVALID,"ip is invalid")):n(new i(r.INVALID,"update is invalid"));},deleteGateway:function deleteGateway(t,e,a){a();},createDevice:function createDevice(t,e,a){var n=xnm.aio.hcgw.DM.DMError,i=xnm.aio.hcgw.DM.DMError.ERROR_CODE;if(t){if(t.gateway){if(t.type){if(t.address){if(t.data){if(e.data&&e.data.gateways&&0!==e.data.gateways.length){var r,o,s=e.data.gateways;for(r=0;r<s.length;r++){if(s[r].index===t.gateway){o=s[r];break;}}o?a(null,t):a(new n(i.NOT_FOUND,"gateway with index "+t.gateway+" not exists"));}else a(new n(i.NOT_FOUND,"gateway with index "+t.gateway+" not exists"));}else a(new n(i.INVALID,"data is invalid"));}else a(new n(i.INVALID,"address is invalid"));}else a(new n(i.INVALID,"type is invalid"));}else a(new n(i.INVALID,"gateway is invalid"));}else a(new n(i.INVALID,"info is invalid"));},updateDevice:function updateDevice(t,e,a){var n=xnm.aio.hcgw.DM.DMError,i=xnm.aio.hcgw.DM.DMError.ERROR_CODE;if(t){if(t.address){if(t.type){if(t.data){if(e.data&&e.data.gateways&&0!==e.data.gateways.length){var r,o,s=e.data.gateways;for(r=0;r<s.length;r++){if(s[r].index===t.gateway){o=s[r];break;}}o?a(null,t):a(new n(i.NOT_FOUND,"gateway with index "+t.gateway+" not exists"));}else a(new n(i.NOT_FOUND,"gateway with index "+t.gateway+" not exists"));}else a(new n(i.INVALID,"data is invalid"));}else a(new n(i.INVALID,"type is invalid"));}else a(new n(i.INVALID,"address is invalid"));}else a(new n(i.INVALID,"info is invalid"));},deleteDevice:function deleteDevice(t,e,a){a();},applyUIFilter:function applyUIFilter(t,e){var _contains=function _contains(t,e){if("*"==t)return!0;for(var a=!1,n=0;n<t.length;n++){if(t[n]==e){a=!0;break;}}return a;},_filter=function _filter(t,e){var a=[],n=null,i=null;switch(t.type){case"BS":i="heater"==t.data?xnm.aio.hcgw.DM.MAP.BS.heater:xnm.aio.hcgw.DM.MAP.BS.general;break;case"BS2":i=xnm.aio.hcgw.DM.MAP.BS2.general;break;case"ELRO":i=xnm.aio.hcgw.DM.MAP.ELRO.general;break;case"DY":case"DY2":i=xnm.aio.hcgw.DM.MAP.DY.shutter;break;case"IT":case"IT2":i="shutter"==t.data?xnm.aio.hcgw.DM.MAP.IT.shutter:"dimmer"==t.data?xnm.aio.hcgw.DM.MAP.IT.dimmer:xnm.aio.hcgw.DM.MAP.IT.general;}return i&&(n=function(t,e,a){var n=[];switch(a.catagory){case"command":t.command&&t.command.forEach(function(t){if(_contains(a.elems,t.type)){var e=JSON.parse(JSON.stringify(t));n.push(e);}});break;case"status":t.status&&t.status.forEach(function(t){if(_contains(a.elems,t.type)){var e=JSON.parse(JSON.stringify(t));n.push(e);}});}return n;}(i,0,e),a=a.concat(n)),a;};if(!t||null==t.type||void 0===t.type)return null;var a=JSON.parse(JSON.stringify(t)),n=null;switch(e.catagory){case"command":n=_filter(t,e),a.command=n;break;case"status":n=_filter(t,e),a.status=n;break;default:return null;}return n&&0!=n.length?a:null;}},xnm.aio.hcgw.DM.DMError=function(t,e){this.code=t,this.message=e,this.stack=new Error().stack;},xnm.aio.hcgw.DM.DMError.prototype=new Error(),xnm.aio.hcgw.DM.DMError.prototype.name="HCGatewayDMError",xnm.aio.hcgw.DM.DMError.prototype.code=0,xnm.aio.hcgw.DM.DMError.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6},xnm.aio.hcgw.Handler.prototype.devicemanager=xnm.aio.hcgw.DM,xnm.aio.hcgw.Handler.prototype.registModule=function(t){t.register(xnm.aio.hcgw.DM.SYS,"hcgw");},xnm.aio.hcgw.Handler.prototype.resolveGateway=function(t){if(!t.ip)return null;var e=new xnm.aio.hcgw.Gateway(t.ip);return t.port&&(e.port=t.port),null!=t.mode&&void 0!==t.mode&&(e.mode=t.mode),e;},xnm.aio.hcgw.Handler.prototype.getDeviceCommands=function(t,e){var a=xnm.aio.hcgw.DM.applyUIFilter(t,{catagory:"command",elems:"*"}),n=a?a.command:[];e&&e(null,n);},xnm.aio.hcgw.Handler.prototype.doCommand=function(t,e,a,n){var i=this.resolveGateway(t);i?i.executeCommandCreator(e,a,n):n&&n(new Error("gateway json format invalid"));},xnm.aio.hcgw.Handler.prototype.discover=function(t,e){this.discoverGateways(function(a){if(a){var n=[];for(var i in a){if(a.hasOwnProperty(i)){var r=a[i].toJSON();r.vendor=t||"hc",n.push(r);}}e&&e(null,n);}else e&&e(null,[]);});},"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new xnm.aio.hcgw.Handler());