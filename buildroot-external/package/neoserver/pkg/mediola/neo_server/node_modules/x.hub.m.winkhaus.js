function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,"prototype",{writable:false});return Constructor;}var x=x||{};x.hub=x.hub||{},x.hub.m=x.hub.m||{},x.hub.m.winkhaus=x.hub.m.winkhaus||{},x.hub.m.winkhaus.MODULE=require("xnm.aio.winkhaus.js"),x.hub.m.winkhaus.Handler=function(){var Handler=function Handler(){};function _checkDevice(e){var t=e?e.address:null,r=e?e.subtype:null,n=e?e.password:null,o=e?e.user:null;t||_generateError("no address"),r||_generateError("no deviceType"),n||_generateError("no pass"),o||_generateError("no user");}function _generateError(e){throw err=new Error(e),err.code="000000",err;}return Handler.prototype.init=function(e){e&&e();},Handler.prototype.getSystems=function(){return["winkhaus"];},Handler.prototype.executeCommandV6=function(e,t,r,n){try{_checkDevice(e);}catch(e){n&&n(e);}r.id&&delete r.id,"mode"==r.command&&(r.command=r.value,delete r.value),new x.hub.m.winkhaus.Client(e).doRequest("POST","/api/v1/control",null,JSON.stringify(r),n);},Handler.prototype.getStatesV6=function(e,t,r){try{_checkDevice(e);}catch(e){r&&r(e);}new x.hub.m.winkhaus.Client(e).doRequest("GET","/api/v1/getStates",null,null,r);},Handler;}(),"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new x.hub.m.winkhaus.Handler()),x.hub.m.winkhaus.Client=/*#__PURE__*/function(){function WhClient(e){_classCallCheck(this,WhClient);this.REQUESTS_TIMEOUT_MS=2e4,this._logger=require("x.logger.js").getLogger("WhClient"),this.device=e;}_createClass(WhClient,[{key:"doRequest",value:function doRequest(e,t,r,n,o){var u="Basic ".concat(new Buffer("".concat(this.device.user,":").concat(this.device.password)).toString("base64")),s={host:this.device.address,port:this.device.port,path:t,method:e,timeout:this.REQUESTS_TIMEOUT_MS,headers:{Connection:"close","Content-Type":"application/json",Authorization:u},rejectUnauthorized:!1};if(r)for(var i in r){r.hasOwnProperty(i)&&(s.headers[i]=r[i]);}n&&n.length&&(s.headers["Content-Length"]=n.length);var a=require("https"),h=this,l=o,d=a.request(s,function(e){e.setEncoding("utf-8");var t="";e.on("data",function(e){t+=e;}),e.on("end",function(){h._logger.log("debug","request on ".concat(s.path," ==> receive code: ").concat(e.statusCode)),e.statusCode>299&&h._logger.log("debug","response:"+t);try{(t=JSON.parse(t)).XC_SUC&&(t=t.XC_SUC),t.XC_ERR&&(t=t.XC_ERR);}catch(e){}l&&(l(null,t,e),l=null);});});d.on&&d.on("error",function(e){h._logger.log("error","do request error:"+e.message),l&&(l(e),l=null);}),d.setTimeout&&d.setTimeout(this.REQUESTS_TIMEOUT_MS,function(){h._logger.log("error","do request timeout"),d.abort(),l&&(l(new Error("timeout")),l=null);}),n&&(this._logger.log("debug","request body: "+n),d.write(n)),d.end();}}]);return WhClient;}();