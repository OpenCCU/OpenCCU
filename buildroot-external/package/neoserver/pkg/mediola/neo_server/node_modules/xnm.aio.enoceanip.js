var xnm=xnm||{};xnm.aio=xnm.aio||{},xnm.aio.enoceanip=xnm.aio.enoceanip||{},xnm.aio.enoceanip.Util={clearHttpOptionForLog:function clearHttpOptionForLog(e){try{var t=JSON.parse(JSON.stringify(e));if(t.auth&&(t.auth="xxxxxx:xxxxxx"),t.headers)for(var n in headers){if(n&&"authorization"==n.toLocaleLowerCase()){var a=headers[n];if(a){var r=a.indexOf(" ");headers[n]=-1==r?"xxxxxx":a.substr(0,r)+" xxxxxx";}}}return t;}catch(t){return e;}}},xnm.aio.enoceanip.IP_Profiles=function(){var e,t,n=((e=function e(){}).prototype.getMap=function(){return{ipevt:[{type:"enum",name:"button A0 pressed",ref:{value:"btnA0pressed",options:["true"]}},{type:"enum",name:"button A0 released",ref:{value:"btnA0released",options:["true"]}},{type:"enum",name:"button A0 short press",ref:{value:"btnA0shortPress",options:["true"]}},{type:"enum",name:"button A0 long press",ref:{value:"btnA0longPress",options:["true"]}},{type:"enum",name:"button AI pressed",ref:{value:"btnAIpressed",options:["true"]}},{type:"enum",name:"button AI released",ref:{value:"btnAIreleased",options:["true"]}},{type:"enum",name:"button AI short press",ref:{value:"btnAIshortPress",options:["true"]}},{type:"enum",name:"button AI long press",ref:{value:"btnAIlongPress",options:["true"]}},{type:"enum",name:"button B0 pressed",ref:{value:"btnB0pressed",options:["true"]}},{type:"enum",name:"button B0 released",ref:{value:"btnB0released",options:["true"]}},{type:"enum",name:"button B0 short press",ref:{value:"btnB0shortPress",options:["true"]}},{type:"enum",name:"button B0 long press",ref:{value:"btnB0longPress",options:["true"]}},{type:"enum",name:"button BI pressed",ref:{value:"btnBIpressed",options:["true"]}},{type:"enum",name:"button BI released",ref:{value:"btnBIreleased",options:["true"]}},{type:"enum",name:"button BI short press",ref:{value:"btnBIshortPress",options:["true"]}},{type:"enum",name:"button BI long press",ref:{value:"btnBIlongPress",options:["true"]}}]};},e.prototype.resolveState=function(e,t){if(!t||!t.functions)return null;for(var n=null,a=0;a<t.functions.length;a++){var r=t.functions[a];if(r&&r.key)switch(r.key){case"buttonA0":switch(n||(n={}),r.value){case"pressed":n.btnA0pressed=!0;break;case"released":n.btnA0released=!0;}break;case"buttonAI":switch(n||(n={}),r.value){case"pressed":n.btnAIpressed=!0;break;case"released":n.btnAIreleased=!0;}break;case"buttonB0":switch(n||(n={}),r.value){case"pressed":n.btnB0pressed=!0;break;case"released":n.btnB0released=!0;}break;case"buttonBI":switch(n||(n={}),r.value){case"pressed":n.btnBIpressed=!0;break;case"released":n.btnBIreleased=!0;}break;case"multipleButtons":switch(n||(n={}),r.value){case"pressed":n.multiBtnpressed=!0;break;case"released":n.multiBtnreleased=!0;}}}return n;},{Version_0_9:new e()}),a=function(){var Version_0_9=function Version_0_9(){};return Version_0_9.prototype.getMap=function(){return{ipevt:[{type:"enum",name:"button A0 pressed",ref:{value:"btnA0pressed",options:["true"]}},{type:"enum",name:"button A0 released",ref:{value:"btnA0released",options:["true"]}},{type:"enum",name:"button A0 short press",ref:{value:"btnA0shortPress",options:["true"]}},{type:"enum",name:"button A0 long press",ref:{value:"btnA0longPress",options:["true"]}},{type:"enum",name:"button AI pressed",ref:{value:"btnAIpressed",options:["true"]}},{type:"enum",name:"button AI released",ref:{value:"btnAIreleased",options:["true"]}},{type:"enum",name:"button AI short press",ref:{value:"btnAIshortPress",options:["true"]}},{type:"enum",name:"button AI long press",ref:{value:"btnAIlongPress",options:["true"]}},{type:"enum",name:"button B0 pressed",ref:{value:"btnB0pressed",options:["true"]}},{type:"enum",name:"button B0 released",ref:{value:"btnB0released",options:["true"]}},{type:"enum",name:"button B0 short press",ref:{value:"btnB0shortPress",options:["true"]}},{type:"enum",name:"button B0 long press",ref:{value:"btnB0longPress",options:["true"]}},{type:"enum",name:"button BI pressed",ref:{value:"btnBIpressed",options:["true"]}},{type:"enum",name:"button BI released",ref:{value:"btnBIreleased",options:["true"]}},{type:"enum",name:"button BI short press",ref:{value:"btnBIshortPress",options:["true"]}},{type:"enum",name:"button BI long press",ref:{value:"btnBIlongPress",options:["true"]}},{type:"enum",name:"button C0 pressed",ref:{value:"btnC0pressed",options:["true"]}},{type:"enum",name:"button C0 released",ref:{value:"btnC0released",options:["true"]}},{type:"enum",name:"button C0 short press",ref:{value:"btnC0shortPress",options:["true"]}},{type:"enum",name:"button C0 long press",ref:{value:"btnC0longPress",options:["true"]}},{type:"enum",name:"button CI pressed",ref:{value:"btnCIpressed",options:["true"]}},{type:"enum",name:"button CI released",ref:{value:"btnCIreleased",options:["true"]}},{type:"enum",name:"button CI short press",ref:{value:"btnCIshortPress",options:["true"]}},{type:"enum",name:"button CI long press",ref:{value:"btnCIlongPress",options:["true"]}},{type:"enum",name:"button D0 pressed",ref:{value:"btnD0pressed",options:["true"]}},{type:"enum",name:"button D0 released",ref:{value:"btnD0released",options:["true"]}},{type:"enum",name:"button D0 short press",ref:{value:"btnD0shortPress",options:["true"]}},{type:"enum",name:"button D0 long press",ref:{value:"btnD0longPress",options:["true"]}},{type:"enum",name:"button DI pressed",ref:{value:"btnDIpressed",options:["true"]}},{type:"enum",name:"button DI released",ref:{value:"btnDIreleased",options:["true"]}},{type:"enum",name:"button DI short press",ref:{value:"btnDIshortPress",options:["true"]}},{type:"enum",name:"button DI long press",ref:{value:"btnDIlongPress",options:["true"]}}]};},Version_0_9.prototype.resolveState=function(e,t){if(!t||!t.functions)return null;for(var n=null,a=0;a<t.functions.length;a++){var r=t.functions[a];if(r&&r.key)switch(r.key){case"buttonA0":switch(n||(n={}),r.value){case"pressed":n.btnA0pressed=!0;break;case"released":n.btnA0released=!0;}break;case"buttonAI":switch(n||(n={}),r.value){case"pressed":n.btnAIpressed=!0;break;case"released":n.btnAIreleased=!0;}break;case"buttonB0":switch(n||(n={}),r.value){case"pressed":n.btnB0pressed=!0;break;case"released":n.btnB0released=!0;}break;case"buttonBI":switch(n||(n={}),r.value){case"pressed":n.btnBIpressed=!0;break;case"released":n.btnBIreleased=!0;}break;case"buttonC0":switch(n||(n={}),r.value){case"pressed":n.btnC0pressed=!0;break;case"released":n.btnC0released=!0;}break;case"buttonCI":switch(n||(n={}),r.value){case"pressed":n.btnCIpressed=!0;break;case"released":n.btnCIreleased=!0;}break;case"buttonD0":switch(n||(n={}),r.value){case"pressed":n.btnD0pressed=!0;break;case"released":n.btnD0released=!0;}break;case"buttonDI":switch(n||(n={}),r.value){case"pressed":n.btnDIpressed=!0;break;case"released":n.btnDIreleased=!0;}}}return n;},{Version_0_9:new Version_0_9()};}(),r=function(){var Version_0_9=function Version_0_9(){};return Version_0_9.prototype.getMap=function(){return{status:[{type:"enum",name:"water detected",ref:{value:"water",options:["true","false"]}}],ipevt:[{type:"enum",name:"water detected",ref:{value:"water",options:["true","false"]}}]};},Version_0_9.prototype.resolveState=function(e,t){if(!t||!t.functions)return null;for(var n=null,a=0;a<t.functions.length;a++){var r=t.functions[a];r&&r.key&&"liquidDetected"==r.key&&(n||(n={}),n.water=r.value);}return n;},{Version_0_9:new Version_0_9()};}(),o=function(){var Version_0_9=function Version_0_9(){};return Version_0_9.prototype.getMap=function(){return{status:[{type:"enum",name:"alarm",ref:{value:"alarm",options:["off","on"]}},{type:"enum",name:"battery Low",ref:{value:"lowbat",options:["true","false"]}}],ipevt:[{type:"enum",name:"alarm",ref:{value:"alarm",options:["off","on"]}},{type:"enum",name:"battery Low",ref:{value:"lowbat",options:["true","false"]}}]};},Version_0_9.prototype.resolveState=function(e,t){if(!t||!t.functions)return null;for(var n=null,a=0;a<t.functions.length;a++){var r=t.functions[a];r&&r.key&&("alarm"==r.key?(n||(n={}),n.alarm=r.value):"batteryLow"==r.key&&(n||(n={}),n.lowbat=r.value));}return n;},{Version_0_9:new Version_0_9()};}(),s=function(){var Version_0_9=function Version_0_9(){};return Version_0_9.prototype.getMap=function(){return{status:[{type:"enum",name:"handle",ref:{value:"handle",options:["closed","open","up"]}}],ipevt:[{type:"enum",name:"handle",ref:{value:"handle",options:["closed","open","up"]}}]};},Version_0_9.prototype.resolveState=function(e,t){if(!t||!t.functions)return null;for(var n=null,a=0;a<t.functions.length;a++){var r=t.functions[a];r&&r.key&&"handle"==r.key&&(n||(n={}),n.handle=r.value);}return n;},{Version_0_9:new Version_0_9()};}(),u=function(){var Version_0_9=function Version_0_9(){};return Version_0_9.prototype.getMap=function(){return{status:[{type:"float",name:"humidity",ref:{value:"humidity",extMeta:"0-100",scale:.4}},{type:"float",name:"temperature",ref:{value:"temperature",extMeta:"0-40",scale:.16}}],ipevt:[{type:"float",name:"humidity",ref:{value:"humidity",extMeta:"0-100",scale:.4}},{type:"float",name:"temperature",ref:{value:"temperature",extMeta:"0-40",scale:.16}}]};},Version_0_9.prototype.resolveState=function(e,t){if(!t||!t.functions)return null;for(var n=null,a=0;a<t.functions.length;a++){var r=t.functions[a];r&&r.key&&(n||(n={}),n[r.key]=r.value);}return n;},{Version_0_9:new Version_0_9()};}(),i=function(){var Version_0_9=function Version_0_9(){};return Version_0_9.prototype.getMap=function(){return{status:[{type:"int",name:"error code",ref:{value:"errorCode",extMeta:"251-255"}},{type:"int",name:"illumination",ref:{value:"illumination",extMeta:"0-1000"}},{type:"enum",name:"motion detected",ref:{value:"motionDetected",options:["false","true"]}},{type:"float",name:"supply voltage",ref:{value:"supplyVoltage",extMeta:"0-5",scale:.02}}],ipevt:[{type:"int",name:"error code",ref:{value:"errorCode",extMeta:"251-255"}},{type:"int",name:"illumination",ref:{value:"illumination",extMeta:"0-1000"}},{type:"enum",name:"motion detected",ref:{value:"motionDetected",options:["false","true"]}},{type:"float",name:"supply voltage",ref:{value:"supplyVoltage",extMeta:"0-5",scale:.02}}]};},Version_0_9.prototype.resolveState=function(e,t){if(!t||!t.functions)return null;for(var n=null,a=0;a<t.functions.length;a++){var r=t.functions[a];r&&r.key&&(n||(n={}),n[r.key]=r.value);}return n;},{Version_0_9:new Version_0_9()};}(),l=function(){var Version_0_9=function Version_0_9(){};Version_0_9.prototype.getMap=function(){return{status:[{type:"int",name:"setpoint",ref:{value:"setpoint",extMeta:"0-255"}},{type:"float",name:"temperature",ref:{value:"temperature",extMeta:"0-40",scale:.157}}],ipevt:[{type:"int",name:"setpoint",ref:{value:"setpoint",extMeta:"0-255"}},{type:"float",name:"temperature",ref:{value:"temperature",extMeta:"0-40",scale:.157}}]};},Version_0_9.prototype.resolveState=function(e,t){if(!t||!t.functions)return null;for(var n=null,a=0;a<t.functions.length;a++){var r=t.functions[a];r&&r.key&&(n||(n={}),n[r.key]=r.value);}return n;};var Version_0_9_Thermokon=function Version_0_9_Thermokon(){};return Version_0_9_Thermokon.prototype.getMap=function(){return{status:[{type:"float",name:"setpoint",ref:{value:"setpoint",extMeta:"-3-3",scale:.5}},{type:"float",name:"temperature",ref:{value:"temperature",extMeta:"0-40",scale:.1}}],ipevt:[{type:"float",name:"setpoint",ref:{value:"setpoint",extMeta:"-3-3",scale:.5}},{type:"float",name:"temperature",ref:{value:"temperature",extMeta:"0-40",scale:.1}}]};},Version_0_9_Thermokon.prototype.resolveState=function(e,t){if(!t||!t.functions)return null;for(var n=null,a=0;a<t.functions.length;a++){var r=t.functions[a];r&&r.key&&(n||(n={}),n[r.key]=r.value);}return n;},{Version_0_9:new Version_0_9(),Version_0_9_Thermokon:new Version_0_9_Thermokon()};}(),p=function(){var Version_0_9=function Version_0_9(){};return Version_0_9.prototype.getMap=function(){return{command:[{type:"float",name:"set point",ref:{value:"setpoint",ext:"%f",extMeta:"0-40",scale:.5}},{type:"int",name:"set valve",ref:{value:"setvalve",ext:"%d",extMeta:"0-100"}}],status:[{type:"enum",name:"actuator obstructed",ref:{value:"actuatorObstructed",options:["false","true"]}},{type:"enum",name:"battery low",ref:{value:"batteryLow",options:["false","true"]}},{type:"enum",name:"contact",ref:{value:"contact",options:["closed","open"]}},{type:"enum",name:"energy input enabled",ref:{value:"energyInput",options:["false","true"]}},{type:"enum",name:"energy storage charged",ref:{value:"energyStorageCharged",options:["false","true"]}},{type:"enum",name:"service mode",ref:{value:"serviceMode",options:["off","on"]}},{type:"float",name:"temperature",ref:{value:"temperature",extMeta:"0-40",scale:.157}},{type:"int",name:"valve",ref:{value:"valve",extMeta:"0-100"}},{type:"enum",name:"window",ref:{value:"window",options:["closed","open"]}}],ipevt:[{type:"enum",name:"actuator obstructed",ref:{value:"actuatorObstructed",options:["false","true"]}},{type:"enum",name:"battery low",ref:{value:"batteryLow",options:["false","true"]}},{type:"enum",name:"contact",ref:{value:"contact",options:["closed","open"]}},{type:"enum",name:"energy input enabled",ref:{value:"energyInput",options:["false","true"]}},{type:"enum",name:"energy storage charged",ref:{value:"energyStorageCharged",options:["false","true"]}},{type:"enum",name:"service mode",ref:{value:"serviceMode",options:["off","on"]}},{type:"float",name:"temperature",ref:{value:"temperature",extMeta:"0-40",scale:.157}},{type:"int",name:"valve",ref:{value:"valve",extMeta:"0-100"}},{type:"enum",name:"window",ref:{value:"window",options:["closed","open"]}}]};},Version_0_9.prototype.executeCommand=function(e,t,n,a){var r=this.getPutStateBody(e,t);return!!r&&(n.setDeviceState(e.deviceId,r,function(e){a&&a(e);}),!0);},Version_0_9.prototype.getPutStateBody=function(e,t){var n=null;switch(t.value){case"setpoint":n={state:{functions:[{key:"switch",value:"on"}]}};break;case"off":n={state:{functions:[{key:"switch",value:"off"}]}};break;case"query":n={state:{functions:[{key:"query",value:"status"}]}};}return n;},Version_0_9.prototype.resolveState=function(e,t){if(!t||!t.functions)return null;for(var n=null,a=0;a<t.functions.length;a++){var r=t.functions[a];r&&r.key&&("switch"==r.key?(n||(n={}),n.state=r.value):"localControl"==r.key&&(n||(n={}),n.local_control=r.value));}return n;},{Version_0_9:new Version_0_9()};}(),c=((t=function t(){}).prototype.getMap=function(){return{status:[{type:"enum",name:"liquid detected",ref:{value:"liquidDetected",options:["false","true"]}},{type:"float",name:"temperature",ref:{value:"temperature",extMeta:"0-40",scale:.157}}],ipevt:[{type:"enum",name:"liquid detected",ref:{value:"liquidDetected",options:["false","true"]}},{type:"float",name:"temperature",ref:{value:"temperature",extMeta:"0-40",scale:.157}}]};},t.prototype.resolveState=function(e,t){if(!t||!t.functions)return null;for(var n=null,a=0;a<t.functions.length;a++){var r=t.functions[a];r&&r.key&&(n||(n={}),n[r.key]=r.value);}return n;},{Version_0_9_Afriso:new t()}),f=function(){var Version_0_9=function Version_0_9(){};return Version_0_9.prototype.getMap=function(){return{command:[{type:"enum",name:"on",ref:{value:"on"}},{type:"enum",name:"off",ref:{value:"off"}},{type:"enum",name:"toggle",ref:{value:"toggle"}},{type:"enum",name:"query status",ref:{value:"query"}}],status:[{type:"enum",name:"state",ref:{value:"state",options:["off","on"]}},{type:"enum",name:"local control",ref:{value:"local_control",options:["off","on"]}}],ipevt:[{type:"enum",name:"state",ref:{value:"state",options:["off","on"]}},{type:"enum",name:"local control",ref:{value:"local_control",options:["off","on"]}}]};},Version_0_9.prototype.executeCommand=function(e,t,n,a){if(!t||"toggle"!=t.value){var r=this.getPutStateBody(e,t);return!!r&&(n.setDeviceState(e.deviceId,r,function(e){a&&a(e);}),!0);}var o=this;n.getDeviceState(e.deviceId,function(t,r){if(t)a&&a(t);else{var s=o.resolveState(e,r),u="on";s&&"on"==s.state&&(u="off"),o.executeCommand(e,{value:u},n,a);}});},Version_0_9.prototype.getPutStateBody=function(e,t){var n=null;switch(t.value){case"on":n={state:{functions:[{key:"switch",value:"on"}]}};break;case"off":n={state:{functions:[{key:"switch",value:"off"}]}};break;case"query":n={state:{functions:[{key:"query",value:"status"}]}};}return n;},Version_0_9.prototype.resolveState=function(e,t){if(!t||!t.functions)return null;for(var n=null,a=0;a<t.functions.length;a++){var r=t.functions[a];r&&r.key&&("switch"==r.key?(n||(n={}),n.state=r.value):"localControl"==r.key&&(n||(n={}),n.local_control=r.value));}return n;},{Version_0_9:new Version_0_9()};}(),v=function(){var Version_0_9=function Version_0_9(){};return Version_0_9.prototype.getMap=function(){return{command:[{type:"int",name:"dim to",ref:{value:"dimTo",ext:"%d",extMeta:"0-100"}},{type:"enum",name:"stop dim",ref:{value:"stop"}},{type:"enum",name:"toggle",ref:{value:"toggle"}},{type:"enum",name:"query status",ref:{value:"query"}}],status:[{type:"int",name:"state",ref:{value:"state",ext:"%d",extMeta:"0-100"}},{type:"enum",name:"local control",ref:{value:"local_control",options:["off","on"]}}],ipevt:[{type:"int",name:"state",ref:{value:"state",ext:"%d",extMeta:"0-100"}},{type:"enum",name:"local control",ref:{value:"local_control",options:["off","on"]}}]};},Version_0_9.prototype.executeCommand=function(e,t,n,a){if(!t||"toggle"!=t.value){var r=this.getPutStateBody(e,t);return!!r&&(n.setDeviceState(e.deviceId,r,function(e){a&&a(e);}),!0);}var o=this;n.getDeviceState(e.deviceId,function(t,r){if(t)a&&a(t);else{var s=o.resolveState(e,r),u={value:"dimTo",ext:100};s&&s.state&&(u={value:"dimTo",ext:0}),o.executeCommand(e,u,n,a);}});},Version_0_9.prototype.getPutStateBody=function(e,t){var n=null;switch(t.value){case"dimTo":if(void 0===t.ext||null==t.ext)return null;var a=parseInt(t.ext);a<0&&(a=0),a>100&&(a=100),n={state:{functions:[{key:"dimValue",value:a},{key:"rampingMode",value:"switch"}]}};break;case"stop":n={state:{functions:[{key:"dimValue",value:"invalid"},{key:"rampingMode",value:"stop"}]}};break;case"query":n={state:{functions:[{key:"query",value:"status"}]}};}return n;},Version_0_9.prototype.resolveState=function(e,t){if(!t||!t.functions)return null;for(var n=null,a=0;a<t.functions.length;a++){var r=t.functions[a];r&&r.key&&("dimValue"==r.key?(n||(n={}),n.state=r.value):"localControl"==r.key&&(n||(n={}),n.local_control=r.value));}return n;},{Version_0_9:new Version_0_9()};}(),d=function(){var Version_0_9=function Version_0_9(){};return Version_0_9.prototype.getMap=function(){return{command:[{type:"enum",name:"channel 1 on",ref:{value:"ch1on"}},{type:"enum",name:"channel 1 off",ref:{value:"ch1off"}},{type:"enum",name:"channel 1 toggle",ref:{value:"ch1toggle"}},{type:"enum",name:"channel 2 on",ref:{value:"ch2on"}},{type:"enum",name:"channel 2 off",ref:{value:"ch2off"}},{type:"enum",name:"channel 2 toggle",ref:{value:"ch2toggle"}},{type:"enum",name:"all on",ref:{value:"allOn"}},{type:"enum",name:"all off",ref:{value:"allOff"}},{type:"enum",name:"all toggle",ref:{value:"allToggle"}},{type:"enum",name:"query channel 1 status",ref:{value:"ch1query"}},{type:"enum",name:"query channel 2 status",ref:{value:"ch2query"}},{type:"enum",name:"query all status",ref:{value:"allQuery"}}],status:[{type:"enum",name:"channel 1 state",ref:{value:"ch1state",options:["off","on"]}},{type:"enum",name:"channel 2 state",ref:{value:"ch2state",options:["off","on"]}}],ipevt:[{type:"enum",name:"channel 1 state",ref:{value:"ch1state",options:["off","on"]}},{type:"enum",name:"channel 2 state",ref:{value:"ch2state",options:["off","on"]}}]};},Version_0_9.prototype.executeCommand=function(e,t,n,a){if(!t||"ch1toggle"!=t.value&&"ch2toggle"!=t.value&&"allToggle"!=t.value){var r=this.getPutStateBody(e,t);return!!r&&(n.setDeviceState(e.deviceId,r,function(e){a&&a(e);}),!0);}var o=this;n.getDeviceState(e.deviceId,function(r,s){if(r)a&&a(r);else{var u=o.resolveState(e,s),i="ch1on";"ch1toggle"==t.value?(i="ch1on",u&&"on"==u.ch1state&&(i="ch1off")):"ch2toggle"==t.value?(i="ch2on",u&&"on"==u.ch2state&&(i="ch2off")):"allToggle"==t.value&&(i="allOn",u&&"on"==u.ch1state&&"on"==u.ch2state&&(i="allOff")),o.executeCommand(e,{value:i},n,a);}});},Version_0_9.prototype.getPutStateBody=function(e,t){var n=null;switch(t.value){case"ch1on":n={state:{functions:[{key:"channel",value:0},{key:"switch",value:"on"}]}};break;case"ch1off":n={state:{functions:[{key:"channel",value:0},{key:"switch",value:"off"}]}};break;case"ch2on":n={state:{functions:[{key:"channel",value:1},{key:"switch",value:"on"}]}};break;case"ch2off":n={state:{functions:[{key:"channel",value:1},{key:"switch",value:"off"}]}};break;case"allOn":n={state:{functions:[{key:"channel",value:"all"},{key:"switch",value:"on"}]}};break;case"allOff":n={state:{functions:[{key:"channel",value:"all"},{key:"switch",value:"off"}]}};break;case"ch1query":n={state:{functions:[{key:"channel",value:0},{key:"query",value:"status"}]}};break;case"ch2query":n={state:{functions:[{key:"channel",value:1},{key:"query",value:"status"}]}};break;case"allQuery":n={state:{functions:[{key:"channel",value:"all"},{key:"query",value:"status"}]}};}return n;},Version_0_9.prototype.resolveState=function(e,t){if(!t||!t.functions)return null;for(var n=null,a=0;a<t.functions.length;a++){var r=t.functions[a];r&&r.key&&"switch"==r.key&&(n||(n={}),0==r.channel?n.ch1state=r.value:1==r.channel&&(n.ch2state=r.value));}return n;},{Version_0_9:new Version_0_9()};}(),m=function(){var Version_0_9=function Version_0_9(){};return Version_0_9.prototype.getMap=function(){return{command:[{type:"int",name:"move to",ref:{value:"position",ext:"%d",extMeta:"0-100"}},{type:"int",name:"angle to",ref:{value:"angle",ext:"%d",extMeta:"0-100"}},{type:"enum",name:"move up",ref:{value:"moveUp"}},{type:"enum",name:"move down",ref:{value:"moveDown"}},{type:"enum",name:"stop",ref:{value:"stop"}},{type:"enum",name:"query status",ref:{value:"query"}}],status:[{type:"int",name:"position",ref:{value:"position",ext:"%d",extMeta:"0-100"}},{type:"int",name:"angle",ref:{value:"angle",ext:"%d",extMeta:"0-100"}},{type:"enum",name:"locking mode",ref:{value:"lockingMode",options:["block","unblock"]}}],ipevt:[{type:"int",name:"position",ref:{value:"position",ext:"%d",extMeta:"0-100"}},{type:"int",name:"angle",ref:{value:"angle",ext:"%d",extMeta:"0-100"}},{type:"enum",name:"locking mode",ref:{value:"lockingMode",options:["block","unblock"]}}]};},Version_0_9.prototype.executeCommand=function(e,t,n,a){var r=this.getPutStateBody(e,t);return!!r&&(n.setDeviceState(e.deviceId,r,function(e){a&&a(e);}),!0);},Version_0_9.prototype.getPutStateBody=function(e,t){var n=null;switch(t.value){case"moveUp":n={state:{functions:[{key:"position",value:0},{key:"angle",value:0}]}};break;case"moveDown":n={state:{functions:[{key:"position",value:100},{key:"angle",value:100}]}};break;case"position":if(void 0===t.ext||null==t.ext)return null;(a=parseInt(t.ext))<0&&(a=0),a>100&&(a=100),n={state:{functions:[{key:"position",value:a}]}};break;case"angle":if(void 0===t.ext||null==t.ext)return null;var a;(a=parseInt(t.ext))<0&&(a=0),a>100&&(a=100),n={state:{functions:[{key:"angle",value:a}]}};break;case"stop":n={state:{functions:[{key:"stop",value:!0}]}};break;case"query":n={state:{functions:[{key:"query",value:"status"}]}};}return n;},Version_0_9.prototype.resolveState=function(e,t){if(!t||!t.functions)return null;for(var n=null,a=0;a<t.functions.length;a++){var r=t.functions[a];if(r&&r.key)switch(r.key){case"buttonA0":switch(n||(n={}),r.value){case"pressed":n.btnA0pressed=!0;break;case"released":n.btnA0released=!0;}break;case"buttonAI":switch(n||(n={}),r.value){case"pressed":n.btnAIpressed=!0;break;case"released":n.btnAIreleased=!0;}break;case"buttonB0":switch(n||(n={}),r.value){case"pressed":n.btnB0pressed=!0;break;case"released":n.btnB0released=!0;}break;case"buttonBI":switch(n||(n={}),r.value){case"pressed":n.btnBIpressed=!0;break;case"released":n.btnBIreleased=!0;}break;case"buttonC0":switch(n||(n={}),r.value){case"pressed":n.btnC0pressed=!0;break;case"released":n.btnC0released=!0;}break;case"buttonCI":switch(n||(n={}),r.value){case"pressed":n.btnCIpressed=!0;break;case"released":n.btnCIreleased=!0;}break;case"buttonD0":switch(n||(n={}),r.value){case"pressed":n.btnD0pressed=!0;break;case"released":n.btnD0released=!0;}break;case"buttonDI":switch(n||(n={}),r.value){case"pressed":n.btnDIpressed=!0;break;case"released":n.btnDIreleased=!0;}break;default:n||(n={}),n[r.key]=r.value;}}return n;},{Version_0_9:new Version_0_9()};}(),y=function(){var Version_0_9=function Version_0_9(){};return Version_0_9.prototype.getMap=function(){return{status:[{type:"enum",name:"contact",ref:{value:"contact",options:["closed","open"]}}],ipevt:[{type:"enum",name:"contact",ref:{value:"contact",options:["closed","open"]}}]};},Version_0_9.prototype.resolveState=function(e,t){if(!t||!t.functions)return null;for(var n=null,a=0;a<t.functions.length;a++){var r=t.functions[a];r&&r.key&&(n||(n={}),n[r.key]=r.value);}return n;},{Version_0_9:new Version_0_9()};}();return{F6_02_01:n,F6_03_01:a,F6_05_01:r,F6_05_02:o,F6_10_00:s,A5_04_01:u,A5_07_03:i,A5_10_03:l,A5_20_01:p,A5_30_03:c,D2_01_01:f,D2_01_03:v,D2_01_11:d,D2_05_02:m,D5_00_01:y,getPorfile:function getPorfile(e,t,n){var a=e.replace(/-/g,"_").toUpperCase(),r="Version_"+(t+"").replace(/\./g,"_");return n&&this[a]&&this[a][r+"_"+n]?this[a][r+"_"+n]:this[a]?this[a][r]:null;}};}(),xnm.aio.enoceanip.IPClient=function(){var _buildEnOceanIPError=function _buildEnOceanIPError(e,t,n){var a=new Error(n||"enocean ip error");return a.code=e,a.httpStatus=t,a;},_buildError=function _buildError(e,t,n){var a=n||new Error(t||"error");return a.code=e,a;},Client=function Client(e,t,n,a,r){"undefined"==typeof require||null==require?this._logger={log:function log(){}}:this._logger=require("x.logger.js").getLogger("xnm.aio.enoceanip.IPClient"),this._ip=e,this._port=t,this._username=n,this._password=a,this._useHttps=r,this._port||(this._port=8080);};return Client.prototype.getIP=function(){return this._ip;},Client.prototype.getPort=function(){return this._port;},Client.prototype.toJSON=function(){return{ip:this._ip,port:this._port,username:this._username,password:this._password,useHttps:this._useHttps};},Client.prototype.getSystemInfo=function(e){this._doEnoceanIPRequest("GET","/system/info",null,function(t,n){t?e&&e(t):n.systemInfo?e&&e(null,n.systemInfo):e&&e(_buildEnOceanIPError(-1,esponse.header.httpStatus,"invalid get system info response"));});},Client.prototype.getProfiles=function(e){this._doEnoceanIPRequest("GET","/profiles",null,function(t,n){t?e&&e(t):n.profiles?e&&e(null,n.profiles):e&&e(_buildEnOceanIPError(-1,esponse.header.httpStatus,"invalid get profiles response"));});},Client.prototype.getProfileInfo=function(e,t,n){this._doEnoceanIPRequest("GET","/profiles/"+e+(t?"?version="+t:""),null,function(e,t){e?n&&n(e):t.profile?n&&n(null,t.profile):n&&n(_buildEnOceanIPError(-1,esponse.header.httpStatus,"invalid get profile info response"));});},Client.prototype.getDevices=function(e){this._doEnoceanIPRequest("GET","/devices",null,function(t,n){t?e&&e(t):n.devices?e&&e(null,n.devices):e&&e(_buildEnOceanIPError(-1,esponse.header.httpStatus,"invalid get devices response"));});},Client.prototype.getDevicesStream=function(e,t,n,a){var r="/devices/stream";return(e||t||n)&&(r+="?"),e&&(r+="direction="+e+"&"),t&&(r+="delimited="+t+"&"),n&&(r+="output="+n+"&"),this._doEnoceanIPRequest("GET",r,null,function(e,t){e?a&&a(e):t.devices?a&&a(null,t.devices):a&&a(_buildEnOceanIPError(-1,esponse.header.httpStatus,"invalid get devices response"));},!0);},Client.prototype.getDevicesStates=function(e){this._doEnoceanIPRequest("GET","/devices/states",null,function(t,n){t?e&&e(t):n.states?e&&e(null,n.states):e&&e(_buildEnOceanIPError(-1,esponse.header.httpStatus,"invalid get devices states response"));});},Client.prototype.getDevice=function(e,t){this._doEnoceanIPRequest("GET","/devices/"+e,null,function(e,n){e?t&&t(e):n.device?t&&t(null,n.device):t&&t(_buildEnOceanIPError(-1,esponse.header.httpStatus,"invalid get device response"));});},Client.prototype.getDeviceProfile=function(e,t){this._doEnoceanIPRequest("GET","/devices/"+e+"/profile",null,function(e,n){e?t&&t(e):n.profile?t&&t(null,n.profile):t&&t(_buildEnOceanIPError(-1,esponse.header.httpStatus,"invalid get device profile response"));});},Client.prototype.getDeviceState=function(e,t){this._doEnoceanIPRequest("GET","/devices/"+e+"/state",null,function(e,n){e?t&&t(e):n.state?t&&t(null,n.state):t&&t(_buildEnOceanIPError(-1,esponse.header.httpStatus,"invalid get device state response"));});},Client.prototype.setDeviceState=function(e,t,n){this._doEnoceanIPRequest("PUT","/devices/"+e+"/state",t,function(e,t){e?n&&n(e):n&&n(null);});},Client.prototype._doEnoceanIPRequest=function(e,t,n,a,r){this._logger.log("debug","do EnoceanIP "+e+" request with path:"+t+(n?" and json:"+JSON.stringify(n):""));var o=this;return this._doJSONRequest(e,t,null,n,function(e,t){if(o._logger.log("debug","get EnoceanIP response "+(e?"error:"+e.message:JSON.stringify(t))),e)a&&a(_buildEnOceanIPError(e.code,-1,e.message));else if(t.header){var n=t.header.httpStatus,r=t.header.code?t.header.code:0;200!=n&&202!=n&&(e=_buildEnOceanIPError(r,n,t.header.message)),a&&a(e,t);}else a&&a(_buildEnOceanIPError(-1,-1,"enocean ip response has no 'header'"));},r);},Client.prototype._doJSONRequest=function(e,t,n,a,r,o){var s=null;return a&&(s=JSON.stringify(a)),this._doRequest(e,t,n,s,function(e,t,n){if(e)r&&r(e);else{var a=n.statusCode;if(t)try{var o=JSON.parse(t);if(!o)return void(r&&r(_buildError(a,"invalid repsonse")));r&&r(null,o);}catch(e){r&&r(_buildError(a,null,e));}else r&&r(_buildError(a,"repsonse body empty"));}},o);},Client.prototype._doRequest=function(e,t,n,a,r,o){var s={host:this._ip,port:this._port,path:t,method:e,headers:{Connection:"close","Content-Type":"application/json"}};if(n)for(var u in n){n.hasOwnProperty(u)&&(s.headers[u]=n[u]);}(this._username||this._password)&&(s.auth=(this._username?this._username:"")+":"+(this._password?this._password:""),s.headers.Authorization="Basic "+new Buffer((this._username?this._username:"")+":"+(this._password?this._password:"")).toString("base64")),a&&(s.headers["Content-Length"]=a.length);var i=require("http");this._useHttps&&(i=require("https"),"undefined"!=typeof process&&null!=process&&process.env&&(process.env.NODE_TLS_REJECT_UNAUTHORIZED="0")),this._logger.log("trace","do "+(this._useHttps?"HTTPS":"HTTP")+" request:"+JSON.stringify(xnm.aio.enoceanip.Util.clearHttpOptionForLog(s)));var l=this,p=r,c={_headerListener:null,_chunkListener:null,on:function on(e,t){"chunk"==e?this._chunkListener=t:"header"==e&&(this._headerListener=t);},emit:function emit(e,t){try{"chunk"==e&&this._chunkListener?this._chunkListener(t):"header"==e&&this._headerListener&&this._headerListener(t);}catch(e){}}},f=i.request(s,function(e){e.setEncoding("utf-8"),c.emit("header",e);var t="";e.on("data",function(e){t+=e,c.emit("chunk",e);}),e.on("end",function(){l._logger.log("trace","receive code:"+e.statusCode+" headers:"+JSON.stringify(e.headers)+" response:"+t),p&&(p(null,t,e),p=null);});});if(f.on&&f.on("error",function(e){l._logger.log("trace","do request error:"+e.message),p&&(p(_buildError(-1,null,e)),p=null);}),f.setTimeout){var v=2e3;o&&(v=6e5),f.setTimeout(v,function(){l._logger.log("trace","do request timeout"),f.abort(),p&&(p(_buildError(-2,"http timeout")),p=null);});}return a&&(this._logger.log("trace","do request send body:"+a),f.write(a)),f.end(),c;},Client;}(),xnm.aio.enoceanip.DCGW=function(){var DCGW=function DCGW(e,t,n,a,r){xnm.aio.enoceanip.IPClient.call(this,e,t,n,a,r),this._logger=require("x.logger.js").getLogger("xnm.aio.enoceanip.DCGW");};return(DCGW.prototype=new xnm.aio.enoceanip.IPClient()).constructor=DCGW,DCGW.prototype.listDevices=function(e){this.getDevices(function(t,n){if(t)e&&e(t);else if(n&&0!=n.length){for(var a=[],r=0;r<n.length;r++){var o={sys:"dcgw",deviceId:n[r].deviceId,friendlyId:n[r].friendlyId,manufacturer:n[r].manufacturer,location:n[r].location,eeps:n[r].eeps};a.push(o);}e&&e(null,a);}else e&&e(null,[]);});},DCGW.prototype.executeCommandCreator=function(e,t,n){if(e&&e.deviceId&&e.eeps&&0!=e.eeps.length){if(t&&t.value){for(var a=null,r=0;r<e.eeps.length;r++){var o=e.eeps[r],s=xnm.aio.enoceanip.IP_Profiles.getPorfile(o.eep,o.version,o.variation);if(s&&s.executeCommand&&(a=s.executeCommand(e,t,this,n)))break;}a||n&&n(new Error("command unknown"));}else n&&n(new Error("command json invalid"));}else n&&n(new Error("device json invalid"));},DCGW.prototype.getStatesCreator=function(e,t,n){if(t&&0!=t.length){var a=this;this.getDevicesStates(function(e,r){if(e)n&&n(e);else{var o,s={};for(o=0;o<r.length;o++){var u=r[o];if(u&&u.deviceId)for(var i=0;i<t.length;i++){(p=t[i])&&p.device&&p.device.deviceId==u.deviceId&&(s[u.deviceId]||(s[u.deviceId]=a.resolveDeviceState(p.device,u)));}}var l=[];for(o=0;o<t.length;o++){var p;if((p=t[o])&&p.id&&p.device&&p.device.deviceId&&p.status&&p.status.value&&s[p.device.deviceId]){var c=s[p.device.deviceId][p.status.value];void 0!==c&&null!=c&&l.push({id:p.id,status:c});}}n&&n(null,l);}});}else n&&n(null,[]);},DCGW.prototype.resolveDeviceState=function(e,t){var _merge=function _merge(e,t){if(null==e||void 0===e)return t;if(null==t||void 0===t)return e;for(var n in e){e.hasOwnProperty(n)&&(t[n]=e[n]);}return t;};if(!e||!e.eeps||0==e.eeps.length)return null;for(var n=null,a=0;a<e.eeps.length;a++){var r=e.eeps[a],o=xnm.aio.enoceanip.IP_Profiles.getPorfile(r.eep,r.version,r.variation);if(o&&o.resolveState){var s=o.resolveState(e,t);s&&(n=_merge(s,n));}}return n;},DCGW.prototype.toJSON=function(){return{sys:"dcgw",ip:this._ip,port:this._port,username:this._username,password:this._password,useHttps:this._useHttps};},DCGW.prototype.equalsTo=function(e){return!!e&&e instanceof DCGW&&this._ip==e._ip&&this._port==e._port&&this._username==e._username&&this._password==e._password;},DCGW.parseJSON=function(e){return e.ip?new DCGW(e.ip,e.port,e.username,e.password,e.useHttps):null;},DCGW;}(),xnm.aio.enoceanip.DCGW.DM=function(){var DMError=function DMError(e,t){this.code=e,this.message=t,this.stack=new Error().stack;};return(DMError.prototype=new Error()).name="DCGWDMError",DMError.prototype.code=0,DMError.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6},{SYS:"dcgw",getGatewayType:function getGatewayType(){return[{sys:this.SYS,name:"OPUS Gateway",port:8080}];},createGateway:function createGateway(e,t,n){var a=DMError,r=DMError.ERROR_CODE;e?e.ip?n(null,e):n(new a(r.INVALID,"ip is invalid")):n(new a(r.INVALID,"info is invalid"));},updateGateway:function updateGateway(e,t,n,a){var r=DMError,o=DMError.ERROR_CODE;t?t.ip?a(null,t):a(new r(o.INVALID,"ip is invalid")):a(new r(o.INVALID,"update is invalid"));},deleteGateway:function deleteGateway(e,t,n){n();},createDevice:function createDevice(e,t,n){var a=DMError,r=DMError.ERROR_CODE;if(e){if(e.gateway){if(e.deviceId){var o,s,u=t.data.gateways;for(o=0;o<u.length;o++){if(u[o].index===e.gateway){s=u[o];break;}}s?n(null,e):n(new a(r.NOT_FOUND,"gateway with index "+e.gateway+" not exists"));}else n(new a(r.INVALID,"deviceId is invalid"));}else n(new a(r.INVALID,"gateway is invalid"));}else n(new a(r.INVALID,"info is invalid"));},updateDevice:function updateDevice(e,t,n){var a=DMError,r=DMError.ERROR_CODE;if(e){if(e.gateway){if(e.deviceId){var o,s,u=t.data.gateways;for(o=0;o<u.length;o++){if(u[o].index===e.gateway){s=u[o];break;}}s?n(null,e):n(new a(r.NOT_FOUND,"gateway with index "+e.gateway+" not exists"));}else n(new a(r.INVALID,"deviceId is invalid"));}else n(new a(r.INVALID,"gateway is invalid"));}else n(new a(r.INVALID,"info is invalid"));},deleteDevice:function deleteDevice(e,t,n){n();},applyUIFilter:function applyUIFilter(e,t){var n=this,_doFilterArr=function _doFilterArr(e,t,n){var a=[];return e.forEach(function(e){if("root"==e.type){var r=JSON.parse(JSON.stringify(e)),o=_doFilterArr(r.children,t,n);o&&o.length>0&&(r.children=o,a.push(r));}else if(function(e,t){if("*"==e)return!0;for(var n=!1,a=0;a<e.length;a++){if(e[a]==t){n=!0;break;}}return n;}(n.elems,e.type)){var s=JSON.parse(JSON.stringify(e));a.push(s);}}),a;},_filter=function _filter(e,t){var a=[],r=null,o=n.getCommandStatusMap(e);return o&&(r=function(e,t,n){var a=[];switch(n.catagory){case"command":e.command&&(a=_doFilterArr(e.command,t,n));break;case"status":e.status&&(a=_doFilterArr(e.status,t,n));break;case"ipevt":e.ipevt&&(a=_doFilterArr(e.ipevt,t,n));}return a;}(o,e,t),a=a.concat(r)),a;};if(!e.sys)return null;var a=JSON.parse(JSON.stringify(e)),r=null;switch(t.catagory){case"command":r=_filter(e,t),a.command=r;break;case"status":r=_filter(e,t),a.status=r;break;case"ipevt":r=_filter(e,t),a.ipevt=r;break;default:return null;}return r&&0!=r.length?a:null;},applyIPEventFilter:function applyIPEventFilter(e){return e?this.applyUIFilter(e,{catagory:"ipevt",elems:"*"}):null;},getCommandStatusMap:function getCommandStatusMap(e){if(!e||!e.eeps||0==e.eeps.length)return null;for(var t={command:[],status:[],ipevt:[]},n=0;n<e.eeps.length;n++){var a=e.eeps[n],r=xnm.aio.enoceanip.IP_Profiles.getPorfile(a.eep,a.version,a.variation);if(r){var o=r.getMap();o&&("to"!=a.direction&&"both"!=a.direction||o.command&&(t.command=t.command.concat(o.command)),"from"!=a.direction&&"both"!=a.direction||(o.status&&(t.status=t.status.concat(o.status)),o.ipevt&&(t.ipevt=t.ipevt.concat(o.ipevt))));}}return t;}};}(),xnm.aio.enoceanip.Handler=function(){var Handler=function Handler(){};return Handler.prototype.DCGW=xnm.aio.enoceanip.DCGW,Handler.prototype.devicemanager=xnm.aio.enoceanip.DCGW.DM,Handler.prototype.registModule=function(e){e.register(this.devicemanager.SYS,"enoceanip");},Handler.prototype.resolveGateway=function(e){return e&&e.sys==this.devicemanager.SYS?this.DCGW.parseJSON(e):null;},Handler.prototype.getDeviceCommands=function(e,t){if(!e)return null;var n;e.sys==this.devicemanager.SYS&&(n=this.devicemanager.applyUIFilter(e,{catagory:"command",elems:"*"}));var a=n?n.command:[];t&&t(null,a);},Handler.prototype.getDeviceStatus=function(e,t){if(!e)return null;var n;e.sys==this.devicemanager.SYS&&(n=this.devicemanager.applyUIFilter(e,{catagory:"status",elems:"*"}));var a=n?n.status:[];t&&t(null,a);},Handler.prototype.doCommand=function(e,t,n,a){var r=this.resolveGateway(e);r?r.executeCommandCreator(t,n,function(e){a&&a(e);}):a&&a(new Error("gateway json format invalid"));},Handler.prototype.doStatus=function(e,t,n,a,r){var o=this.resolveGateway(t);if(o){var s=[{id:e,device:n,status:a}];o.getStatesCreator(null,s,function(e,t){e?r&&r(e):r&&r(null,t[0]);});}else r&&r(new Error("device json format invalid"));},Handler.prototype.resolveEvent=function(e,t,n){var a=this.resolveGateway(e);return a?a.resolveDeviceState(t,n):null;},Handler.prototype.getDeviceList=function(e,t){var n=this.resolveGateway(e);n?n.listDevices(function(e,n){t&&t(e,n);}):t&&t(new Error("gateway json format invalid"));},Handler.prototype.discover=function(e,t){var n=require("x.mdns.js");n.clearRecordBuffer(),n.discoverServiceWithTimeout("_enocean._tcp.local",e,function(e,n){if(e)t&&t(e);else{for(var a=[],r=0;r<n.length;r++){var o=n[r];if(o.target&&o.ip&&o.ip.length>0){var s=o.target.toLowerCase();if(-1!=s.indexOf("dcgw")||-1!=s.indexOf("opus")){var u=new xnm.aio.enoceanip.DCGW(o.ip[0]);a.push(u);}}}t&&t(e,a);}});},Handler;}(),"undefined"!=typeof module&&null!=module&&(module.exports=new xnm.aio.enoceanip.Handler());