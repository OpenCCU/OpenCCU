var util=require("util"),EventEmitter=require("events"),async=require("async"),x=x||{};x.hub=x.hub||{},x.hub.m=x.hub.m||{},x.hub.m.hm=x.hub.m.hm||{},x.hub.m.hm.CCU_INIT_STATE=!0,x.hub.m.hm.HM_MODULE=require("xnm.aio.hm.js"),x.hub.m.hm.RFDeviceTypes={"HM-PB-4Dis-WM":0,"ZEL STG RM DWT 10":0,"263 155":0,"HM-PB-4Dis-WM-2":0,ASH550I:1,ASH550:1,"HM-WDS10-TH-O":1,"263 158":1,"HM-WDS20-TH-O":1,"HM-WDS40-TH-I":1,"263 157":1,"IS-WDS-TH-OD-S-R3":1,"HM-WDS40-TH-I-2":1,"HM-LC-Bl1-SM":2,"HM-LC-Bl1-FM":2,"HM-LC-Bl1-PB-FM":2,"ZEL STG RM FEP 230V":2,"263 146":2,"HM-LC-BlX":2,"HM-LC-Bl1-SM-2":2,"HM-LC-Bl1-FM-2":2,"HM-LC-Bl1PBU-FM":2,"263 147":2,"HM-CC-RT-DN":3,"HM-CC-RT-DN-BoM":4,"HM-CC-TC":5,"ZEL STG RM FWT":5,"HM-CC-VD":6,"ZEL STG RM FSA":6,CENTRAL:7,"HM-RCV-50":7,"HM-OU-CF-Pl":8,"HM-OU-CFM-Pl":9,"HM-OU-CFM-TW":9,"HM-OU-CM-PCB":10,"HM-LC-AO-SM":11,"HM-LC-Dim1L-Pl":11,"HM-LC-Dim1L-Pl-2":11,"HM-LC-Dim1L-CV":11,"263 132":11,"HM-LC-Dim2L-CV":11,"HM-LC-Dim2L-SM":11,"HSS-DX":11,"HM-LC-Dim1L-Pl-3":11,"HM-LC-Dim1L-CV-2":11,"HM-LC-Dim2L-SM-2":11,"HM-LC-Dim1PWM-CV":12,"HM-LC-Dim1PWM-CV-2":12,"HM-LC-Dim1TPBU-FM":13,"HM-LC-Dim1TPBU-FM-2":13,"263 133":13,"HM-LC-Dim1T-Pl":13,"HM-LC-Dim1T-CV":13,"HM-LC-Dim1T-FM":13,"HM-LC-Dim1T-Pl-3":13,"HM-LC-Dim1T-CV-2":13,"HM-LC-Dim1T-FM-2":13,"HM-LC-Dim2T-SM":13,"HM-LC-Dim2T-SM-2":13,"HM-LC-Dim1T-Pl-2":13,"263 134":13,"HM-LC-Dim1T-DR":13,"HM-LC-Dim1T-FM-LF":13,"OLIGO.smart.iq.HM":11,"HM-Dis-WM55":14,"HM-MOD-EM-8":15,"HM-ES-PMSw1-Pl":16,"HM-ES-PMSw1-Pl-DN-R1":16,"HM-ES-PMSw1-Pl-DN-R2":16,"HM-ES-PMSw1-Pl-DN-R3":16,"HM-ES-PMSw1-Pl-DN-R4":16,"HM-ES-PMSw1-Pl-DN-R5":16,"HM-ES-PMSw1-DR":16,"HM-ES-PMSw1-SM":16,"HM-Dis-TD-T":17,"HM-Sec-Key":18,"HM-Sec-Key-S":18,"HM-Sec-Key-O":18,"HM-Sec-Key-Generic":18,KS550:19,KS888:19,KS550Tech:19,KS550LC:19,"HM-WDS100-C6-O":19,"HM-WDS100-C6-O-2":19,"HM-OU-LED16":20,"HM-OU-X":20,"HM-PB-2-WM55-2":21,"HM-PB-2-WM55":21,"ZEL STG RM WT 2":21,"263 135":21,"HM-PB-2-FM":21,"HM-PBI-4-FM":21,"ZEL STG RM FST UP4":21,"263 145":21,"HM-PBI-X":21,"HM-RC-4-2":21,"HM-PB-6-WM55":21,"HM-RC-8":21,"HM-RC-4":21,"HM-RC-4-3":21,"HM-RC-4-B":21,"HM-RC-P1":21,"HM-RC-Sec3":21,"HM-RC-Sec3-B":21,"HM-RC-Key3":21,"HM-RC-Key3-B":21,"HM-PB-4-WM":21,"HM-PB-2-WM":21,"HM-RC-2-PBU-FM":21,"RC-H":21,atent:21,"ZEL STG RM HS 4":21,"HM-RC-X":21,"BRC-H":21,"HM-RC-SB-X":21,"HM-RC-12":21,"HM-RC-12-B":21,"HM-RC-12-SW":21,"HM-RC-Key4-2":22,"HM-RC-Sec4-2":22,"HM-RC-Key4-3":22,"HM-RC-Sec4-3":22,"HM-RC-19":23,"HM-RC-19-B":23,"HM-RC-19-SW":23,"HM-Sen-RD-O":24,"HM-Sec-RHS":25,"HM-Sec-RHS-2":25,"ZEL STG RM FDK":25,"HM-Sec-xx":25,"HM-LC-Sw1-Pl":26,"HM-LC-Sw1-Pl-2":26,"HM-LC-Sw1-SM":26,"HM-LC-Sw2-SM":26,"HM-LC-Sw4-SM":26,"HM-LC-Sw4-PCB":26,"HM-LC-Sw4-WM":26,"HM-LC-Sw1-FM":26,"263 130":26,"HM-LC-Sw2-FM":26,"HM-LC-Sw1-PB-FM":26,"HM-LC-Sw2-PB-FM":26,"HM-LC-Sw4-DR":26,"HM-LC-Sw2-DR":26,"ZEL STG RM FZS":26,"ZEL STG RM FZS-2":26,"HM-LC-Sw1PBU-FM":26,"HM-LC-Sw2PBU-FM":26,"263 131":26,"HM-MOD-Re-8":26,"HM-LC-Sw1-Ba-PCB":26,"HM-LC-Sw4-Ba-PCB":26,"HM-LC-Sw1-Pl-3":26,"HM-LC-Sw1-SM-2":26,"HM-LC-Sw4-SM-2":26,"HM-LC-Sw4-PCB-2":26,"HM-LC-Sw4-WM-2":26,"HM-LC-Sw1-FM-2":26,"HM-LC-Sw2-FM-2":26,"HM-LC-Sw4-DR-2":26,"HM-LC-Sw2-DR-2":26,"HM-LC-Sw1-Pl-DN-R1":26,"HM-LC-Sw1-Pl-DN-R2":26,"HM-LC-Sw1-Pl-DN-R3":26,"HM-LC-Sw1-Pl-DN-R4":26,"HM-LC-Sw1-Pl-DN-R5":26,"HM-LC-Sw1-DR":26,"HM-LC-Sw1-Pl-CT-R1":26,"HM-LC-Sw1-Pl-CT-R2":26,"HM-LC-Sw1-Pl-CT-R3":26,"HM-LC-Sw1-Pl-CT-R4":26,"HM-LC-Sw1-Pl-CT-R5":26,"HM-LC-Sw1-PCB":26,"HM-LC-Sw1-Pl-OM54":26,"HM-LC-Sw1-SM-ATmega168":26,"HM-LC-Sw4-SM-ATmega168":26,S550IA:27,"HM-WDS30-T-O":27,"HM-Sec-SC":28,"ZEL STG RM FFK":28,"HM-Sec-SC-2":28,"HM-SCI-3-FM":29,"HM-CC-SCD":30,"263 160":30,"HM-Sec-MDIR-3":31,"HM-Sec-MDIR-2":31,"HM-Sec-MDIR":31,"263 162":31,"HM-Sec-MD":31,"HM-Sec-SD":32,"HM-Sec-SD-Generic":32,"HM-Sec-SD-2":32,"HM-Sec-SD-2-Generic":32,"HM-Sec-SFA-SM":33,"HM-Sen-MDIR-SM":34,"HM-Sen-MDIR-O":34,"HM-MD":34,"HM-Sen-MDIR-O-2":34,"HM-Sen-MDIR-O-3":34,"HM-Sen-EP":35,"HM-Sen-X":35,"HM-Sen-Wa-Od":36,"HM-SwI-3-FM":37,"ZEL STG RM FSS UP3":37,"263 144":37,"HM-SwI-X":37,"HM-TC-IT-WM-W-EU":38,"HM-Sec-TiS":39,"HM-WDS30-OT2-SM":40,"HM-WDS30-OT2-SM-2":40,"HM-Sec-WDS":41,"HM-Sec-WDS-2":41,"HM-Sec-Win":42,"HM-Sec-Win-Generic":42,WS550:43,WS888:43,WS550Tech:43,WS550LCB:43,WS550LCW:43,"HM-WDC7000":43,"HMW-IO-12-Sw14-DR":44,"HMW-IO-12-Sw7-DR":45,"HMW-IO-12-FM":46,"HMW-IO-4-FM":46,"HMW-LC-Bl1-DR":47,"HMW-LC-Dim1L-DR":48,"HMW-LC-Sw2-DR":49,"HMW-Sen-SC-12-DR":50,"HMW-Sen-SC-12-FM":50,"HM-CC-VG-1":51,"HM-ES-TX-WM":52,"HM-LC-RGBW-WM":53,"HM-Sec-SD-2-Team":54,"HM-Sen-LI-O":56,"HM-Sec-SCo":28,"HM-Sec-Sir-WM":57,"HM-LC-Ja1PBU-FM":58,"HM-MOD-EM-8Bit":59,"HM-Dis-EP-WM55":60,"HM-Sen-MDIR-WM55":61,"HM-LC-DW-WM":62,"HM-DW-WM":62},x.hub.m.hm.RFDeviceCatagory=[{type:"button",channelNum:"*",channel:"KEY"},{type:"weather"},{type:"blind",channelNum:"*",channel:"BLIND"},{type:"heater2"},{type:"heater3"},{type:"wallthermo"},{type:"heater"},{type:"vbutton",channelNum:"*",channel:"VIRTUAL_KEY"},{type:"gong2"},{type:"gong"},{type:"gong"},{type:"dimmer",channelNum:"*",channel:"DIMMER"},{type:"dimmer",channelNum:"*",channel:"DIMMER"},{type:"dimmer",channelNum:"*",channel:"DIMMER"},{type:"button",channelNum:"*",channel:"KEY"},{type:"mod_em_8",channelNum:"*",channel:"KEY"},{type:"powerswitch"},{type:"switch",channelNum:"*",channel:"SWITCH"},{type:"keymatic"},{type:"weatherstation"},{type:"ou_led16",channelNum:"*",channel:"KEY"},{type:"button",channelNum:"*",channel:"KEY"},{type:"button",channelNum:"*",channel:"KEY"},{type:"button",channelNum:"*",channel:"KEY"},{type:"rain"},{type:"window"},{type:"switch",channelNum:"*",channel:"SWITCH"},{type:"temp"},{type:"contact",channelNum:"*",channel:"SHUTTER_CONTACT"},{type:"contact",channelNum:"*",channel:"SHUTTER_CONTACT"},{type:"co2"},{type:"motion",channelNum:"*",channel:"MOTION_DETECTOR"},{type:"smoke"},{type:"siren",channelNum:"*",channel:"ALARMACTUATOR"},{type:"motion",channelNum:"*",channel:"MOTION_DETECTOR"},{},{type:"capacity"},{type:"switch_interface",channelNum:"*",channel:"SWITCH_INTERFACE"},{type:"wallthermo2"},{type:"tilt",channelNum:"*",channel:"TILT_SENSOR"},{type:"temp2",channel:"WEATHER"},{type:"water",channelNum:"*",channel:"WATERDETECTIONSENSOR"},{},{type:"weather2"},{},{},{},{},{},{},{},{},{type:"energymeter"},{type:"rgb"},{},{type:"switch",channelNum:"*",channel:"SWITCH"},{type:"lux"},{type:"siren2"},{type:"jalousie",channelNum:"*",channel:"JALOUSIE"},{type:"mod_em_8bit"},{type:"button",channelNum:"*",channel:"KEY"},{},{type:"dualwhite"}],x.hub.m.hm.IPDeviceTypes={"HMIP-PS":0,"HmIP-PCBS":0,"HmIP-PCBS-BAT":0,"HMIP-SWDO":1,"HmIP-SWDO-I":1,"HmIP-SWDM":1,"HmIP-SWDM-B2":1,"Contact AA":1,"HMIP-WTH":2,"HmIP-WTH-2":2,"HmIP-STH":2,"HmIP-STHD":2,"HMIP-eTRV":3,"HMIP-eTRV-2":3,"HmIP-eTRV-2-UK":3,"HmIP-eTRV-B":3,"HmIP-eTRV-B1":3,"HmIP-eTRV-B-UK":3,"HmIP-eTRV-C":3,"HMIP-WRC2":4,"HmIP-SMI":5,"HmIP-SMO":5,"HmIP-SMO-A":5,"HmIP-SRH":6,"HmIP-SWSD":7,"HmIP-PSM":8,"Smart Plug AA":8,"HmIP-PSM-PE":8,"HmIP-PSM-UK":8,"HmIP-PSM-IT":8,"HmIP-PSM-CH":8,"HmIP-BSM":9,"HmIP-BDT":10,"HmIP-ASIR":11,"HmIP-KRC4":12,"HmIP-KRCA":12,"HmIP-PDT":13,"HmIP-PDT-UK":13,"HmIP-FSM":14,"HmIP-FSM16":14,"HmIP-BROLL":15,"HmIP-FROLL":15,"HmIP-FBL":16,"HmIP-BBL":16,"HmIP-SPI":17,"HmIP-FDT":18,"HmIP-BWTH":19,"HmIP-BWTH24":19,"HmIP-FAL230-C6":20,"HmIP-FAL24-C6":20,"HmIP-FAL230-C10":20,"HmIP-FAL24-C10":20,"HmIP-WRC6":21,"HmIP-SWO-B":22,"HmIP-SWO-PL":23,"HmIP-SWO-PR":27,"HmIP-STHO":24,"HmIP-STHO-A":24,"HmIP-SPDR":25,"HmIP-SMI55":26,"HmIP-RC8":28,"HmIP-MIOB":0,"HmIP-SWD":31,"HmIP-SAM":32,"HmIP-WGC":33,"HmIP-BSL":34,"HmIP-MOD-TM":35,"HmIP-DBB":36,"HmIP-FCI1":37,"HmIP-FCI6":37,"HmIP-SLO":38,"HmIP-BRC2":4,"HmIP-PMFS":39,"HmIP-MOD-RC8":37,"HmIP-MOD-OC8":1,"HmIP-WRCR":40},x.hub.m.hm.IPDeviceCatagory=[{type:"ip_switch"},{type:"ip_contact"},{type:"ip_wallthermo"},{type:"ip_heater"},{type:"ip_button2"},{type:"ip_motion"},{type:"ip_window"},{type:"ip_smoke"},{type:"ip_powerswitch"},{type:"ip_energyactor"},{type:"ip_dimmer"},{type:"ip_siren"},{type:"ip_button4"},{type:"ip_dimmer2"},{type:"ip_energyactor2"},{type:"ip_blind"},{type:"ip_jalousie"},{type:"ip_presence"},{type:"ip_dimmer3"},{type:"ip_wallthermo2"},{type:"ip_floor_heater"},{type:"ip_button6"},{type:"ip_weather"},{type:"ip_weather2"},{type:"ip_weather3"},{type:"ip_direction"},{type:"ip_motion2"},{type:"ip_weather4"},{type:"ip_button8"},{type:"ip_generic_input"},{type:"ip_analog_output"},{type:"ip_water"},{type:"ip_acce"},{type:"ip_garagedoor"},{type:"ip_bsl"},{type:"ip_tormatic"},{type:"ip_button"},{type:"ip_multi_input_bat"},{type:"ip_lux"},{type:"ip_pmfs"},{type:"ip_rotary"}],x.hub.m.hm.Util={clearHttpOptionForLog:function clearHttpOptionForLog(e){try{var t=JSON.parse(JSON.stringify(e));if(t.auth&&(t.auth="xxxxxx:xxxxxx"),t.headers)for(var a in headers){if(a&&"authorization"==a.toLocaleLowerCase()){var r=headers[a];if(r){var n=r.indexOf(" ");headers[a]=-1==n?"xxxxxx":r.substr(0,n)+" xxxxxx";}}}return t;}catch(t){return e;}}},x.hub.m.hm.Client=function(){var Client=function Client(e,t,a,r,n){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Client"),this.ip=e,this.port=t,this.port||(this.port=2001),this.username=a,this.password=r,this.useHttps=n,this.timeout=2e4,this.xml2js=null;};return Client.prototype._doRequest=function(e,t,a){var r=require("http");this.useHttps&&(r=require("https"));var n={host:this.ip,port:this.port,path:"/",method:e,headers:{"User-Agent":"mediola",Connection:"keep-alive"}};this.username&&(n.auth=this.username+":"+(this.password?this.password:"")),t&&(n.headers["Content-Length"]=t.length);var i=a,s=this;this._logger.log("trace","send http request:"+x.hub.m.hm.Util.clearHttpOptionForLog(n)),this._logger.log("trace","send http data:"+t);var o=r.request(n,function(e){var t="";e.setEncoding("utf-8"),e.on("data",function(e){t+=e;}),e.on("end",function(){s._logger.log("trace","http response status:"+e.statusCode),s._logger.log("trace","http response data:"+t);var a=null;200!=e.statusCode&&(a=new Error("http response "+e.statusCode)),i&&i(a,t,e.statusCode);});});o.on("error",function(e){s._logger.log("trace","http request error:"+e.stack),i&&i(e),i=null;}),o.setTimeout(this.timeout,function(){s._logger.log("trace","http request timeout"),i&&i(new Error("http timeout")),i=null;}),t&&o.write(t),o.end();},Client.prototype._doXMLRpcRequest=function(e,t,a){var r=require("x.xmlrpc.js"),n='<?xml version="1.0" encoding="ISO-8859-1"?><methodCall><methodName>'+e+"</methodName>";n+="<params>";for(var i=0;i<t.length;i++){t[i]&&t[i].type&&null!=t[i].value?n+="<param>"+r.serializeValue(t[i].value,t[i].type)+"</param>":n+="<param>"+r.serializeValue(t[i])+"</param>";}n+="</params></methodCall>",this._doRequest("POST",n,function(e,t){if(e)a&&a(e);else if(t)try{var n=r.deserializeRsp(t);n.error?a&&a(new Error("xml rcp return error:"+n.error.faultString+" @code:"+n.error.faultCode),n.error):a&&a(null,n.params);}catch(e){a&&a(e);}else a&&a(new Error("xml rcp response format invalid"));});},Client.prototype.convertHmIPKeyBase32ToBase16=function(e){e=e.replace(/-/g,"").toUpperCase();for(var t=["0","1","2","3","4","5","6","7","8","9","A","B","C","E","F","G","H","J","K","L","M","N","P","Q","R","S","T","U","W","X","Y","Z"],a=new ArrayBuffer(16),r=new Uint8Array(a),n=0,i=e.length-1,s=0,o=r.length-1,c="";i>=0;){for(var l=0;l<t.length;l++){if(t[l]==e.charAt(i)){n|=l<<s;break;}}for(s+=5,i--;s>8&&o>=0;){r[o]=255&n,n>>=8,s-=8,o--;}}for(l=0;l<r.length;l++){r[l]<16&&(c+="0"),c+=r[l].toString(16);}return c.toUpperCase();},Client.prototype._getValue=function(e){var t=null;if(this.xml2js){if(e["boolean"]&&e["boolean"][0])t=!!parseInt(e["boolean"][0]);else if(e.i4&&e.i4[0])t=parseInt(e.i4[0]);else if(e["double"]&&e["double"][0])t=parseFloat(e["double"][0]);else if(e.array&&e.array[0]&&e.array[0].data&&e.array[0].data[0]&&e.array[0].data[0].value){t=[];var a=e.array[0].data[0].value;for(var r in a){t.push(a[r]);}}else t=e;}else{var n=e,i=e.find("value");if(i.length>0&&(n=$(i[0])),n&&!(t=n.text())&&n.children()&&n.children().length>0){var s=$(n.children()[0]);if("boolean"==s.prop("tagName"))t=!!parseInt(s.text());else if("i4"==s.prop("tagName"))t=parseInt(s.text());else if("double"==s.prop("tagName"))t=parseFloat(s.text());else if("array"==s.prop("tagName")){t=[];for(var o=s.find("data value"),c=0;c<o.length;c++){var l=$(o[c]).text();l&&t.push(l);}}else XC.debugf("unknown valuetype:"),XC.debugf(s.getXMLString());}}return t;},Client.prototype._getStructData=function(e){var t={};if(e.struct&&e.struct[0]&&e.struct[0].member){var a=e.struct[0].member;for(var r in a){a[r].name&&a[r].name[0]&&a[r].value&&a[r].value[0]&&(t[a[r].name[0]]=this._getValue(a[r].value[0]));}}return t;},Client.prototype._waitForNewDevices=function(e,t,a){var r=this;this.getDeviceList(function(n){if(t<=0||Object.keys(n).length>Object.keys(e).length){for(var i in n){e[i]||XC.debugf("new device: "+i);}a&&a(n);}else setTimeout(function(){r._waitForNewDevices(e,t-4,a);},4e3);});},Client.prototype.init=function(e,t,a){this._doXMLRpcRequest("init",[e,t],function(e){a&&a(e);});},Client.prototype.getIP=function(){return this.ip;},Client.prototype.getPort=function(){return this.port;},Client.prototype.setPort=function(e){this.port=e;},Client.prototype.getValue=function(e,t,a,r){var n=[e,t];void 0!==a&&null!=a&&n.push(a),this._doXMLRpcRequest("getValue",n,function(e,t){var a=null;!e&&t?a=t[0]:e&&t&&(a=t),r&&r(e,a);});},Client.prototype.setValue=function(e,t,a,r){this._doXMLRpcRequest("setValue",[e,t,a],function(e){r&&r(e);});},Client.prototype.getParamset=function(e,t,a,r){this._doXMLRpcRequest("getParamset",[e,t,a],function(e,t){var a=null;!e&&t?a=t[0]:e&&t&&(a=t),r&&r(e,a);});},Client.prototype.putParamset=function(e,t,a,r){this._doXMLRpcRequest("putParamset",[e,t,a],function(e,t){var a=null;!e&&t?a=t[0]:e&&t&&(a=t),r&&r(e,a);});},Client.prototype.listDevices=function(e){this._doXMLRpcRequest("listDevices",[],function(t,a){var r=[];!t&&a&&(r=a[0]),e&&e(t,r);});},Client.prototype.deleteDevice=function(e,t,a){this._doXMLRpcRequest("deleteDevice",[e,t],function(e){a&&a(e);});},Client.prototype.setInstallMode=function(e,t,a,r){var n=[];n.push(e),void 0!==t&&null!=t&&n.push(t),void 0!==a&&null!=a&&n.push(a),this._doXMLRpcRequest("setInstallMode",n,function(e){r&&r(e);});},Client.prototype.setInstallModeWithWhitelist=function(e,t,a,r){var n=[];n.push(e),void 0!==t&&null!=t&&n.push(t),void 0!==a&&null!=a&&n.push(a),this._doXMLRpcRequest("setInstallModeWithWhitelist",n,function(e){r&&r(e);});},Client.prototype.addNewDevice=function(e){var t=this;this.getDeviceList(function(a){t._doRequest("setInstallMode",[!0,30,2],function(r){setTimeout(function(){t._waitForNewDevices(a,30,e);},4e3);});});},Client.prototype.addNewDeviceWithSGTN=function(e,t,a){var r=this;this.getDeviceList(function(n){r._doRequest("setInstallModeWithWhitelist",[!0,30,[{ADDRESS:t,KEY_MODE:"LOCAL",KEY:a}]],function(t){setTimeout(function(){r._waitForNewDevices(n,30,e);},4e3);});});},Client.prototype.listBidcosInterfaces=function(e){this._doXMLRpcRequest("listBidcosInterfaces",[],function(t,a){var r=[];!t&&a&&(r=a[0]),e&&e(t,r);});},Client.prototype.reportValueUsage=function(e,t,a,r){this._doXMLRpcRequest("reportValueUsage",[e,t,a],function(e,t){var a;!e&&t&&(a=t[0]),r&&r(e,a);});},Client.prototype.ping=function(e,t){this._doXMLRpcRequest("ping",[e],function(e){t&&t(e);});},Client;}(),x.hub.m.hm.Server=function(){var Server=function Server(e){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Server"),this._port=9099,e&&e>0&&(this._port=e),this._server=null,this._servlet={};};return Server.prototype.getPort=function(){return this._port;},Server.prototype.stop=function(e){this._server?this._server.close():e&&e();},Server.prototype.start=function(e){if(this._server)e&&e();else{var t=e,a=this,r=require("http").createServer(function(e,t){a._logger.log("trace","receive request method:"+e.method),a._logger.log("trace","receive request path:"+e.url),a._logger.log("trace","receive request header:"+JSON.stringify(e.headers));var r="";e.on("data",function(e){r+=e.toString();}),e.on("end",function(){a._logger.log("trace","receive request body:"+r),"POST"==e.method?a._handleRequest(r,e,t):(a._logger.log("trace","send 404 response"),t.writeHead(404,"Not found"),t.end());});});r.on("error",function(e){a._logger.log("trace","xmlrpc server err:"+e.stack),t&&t(e),t=null,a._server=null;}),r.listen(this._port,function(){a._logger.log("trace","xmlrpc server listening on port:"+a._port),a._server=r,t&&t(),t=null;});}},Server.prototype.registServlet=function(e,t){e&&t&&(this._servlet[e]=t);},Server.prototype.unregistServlet=function(e){e&&delete this._servlet[e];},Server.prototype._handleRequest=function(e,t,a){var r=t.url,n=require("x.xmlrpc.js"),i=this;try{var s=n.deserializeReq(e);if("system.multicall"==s.methodName)return void this._handleMultiCall(s.params[0],t,a);if(this._logger.log("debug","receive method call:"+s.methodName),this._logger.log("debug","params:"+JSON.stringify(s.params)),"system.listMethods"==s.methodName){return void this._sendSuccessResponse([["event","listDevices","newDevices","deleteDevices","updateDevice","replaceDevice","readdedDevice"]],a);}if(this._servlet[r])return void this._servlet[r](s.methodName,s.params,function(e,t){e?i._sendErrorResponse(e,a):i._sendSuccessResponse([t],a);});this._sendSuccessResponse([[]],a);}catch(e){this._sendErrorResponse(e,a);}},Server.prototype._handleMultiCall=function(e,t,a){var r=t.url;this._logger.log("trace","---------------------------------"),this._logger.log("trace","receive system.multicall");for(var n=0;n<e.length;n++){var i=e[n];this._logger.log("trace","receive method call:"+i.methodName),this._logger.log("trace","params:"+JSON.stringify(i.params)),this._servlet[r]&&this._servlet[r](i.methodName,i.params);}this._logger.log("trace","---------------------------------"),this._sendSuccessResponse([[]],a);},Server.prototype._sendSuccessResponse=function(e,t){var a=require("x.xmlrpc.js").serializeRsp(null,e);this._logger.log("trace","send xml success response:"+a),t.writeHead(200,{"Content-Type":"text/xml","Content-Length":Buffer.byteLength(a)+""}),t.write(a),t.end();},Server.prototype._sendErrorResponse=function(e,t){var a=require("x.xmlrpc.js"),r=-1;e.errCode&&(r=e.errCode);var n={faultCode:r,faultString:e.message},i=a.serializeRsp(n);this._logger.log("trace","send xml fault response:"+i),t.writeHead(200,{"Content-Type":"text/xml","Content-Length":Buffer.byteLength(i)+""}),t.write(i),t.end();},Server;}(),x.hub.m.hm._Controller=function(){var Controller=function Controller(e,t,a,r,n,i){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Controller"),this._client=new x.hub.m.hm.Client(e,t,a,r,n),this._initStates=i,this["interface"]=null,this._devices={},this._status={},this._learnDeviceCbs=[],this._learnDeviceTO=null,this._readValueCbs={};};util.inherits(Controller,EventEmitter),Controller.prototype.getIP=function(){return this._client.getIP();},Controller.prototype.getPort=function(){return this._client.getPort();},Controller.prototype.setPort=function(e){return this._client.setPort(e);},Controller.prototype.getAllBufferedStates=function(){var e={};for(var t in this._devices){var a=this._devices[t];if(!a.PARENT&&a.CHILDREN?e[t]={device:{type:a.TYPE,"interface":this["interface"],address:a.ADDRESS,channels:{}},states:{}}:a.PARENT&&(e[a.PARENT].device.channels[a.ADDRESS]={type:a.TYPE,address:a.ADDRESS}),a.CHILDREN)for(var r=0,n=a.CHILDREN.length;r<n;r++){var i=a.CHILDREN[r];if(this._status[i])for(var s in e[t].states[i]={},this._status[i]){e[t].states[i][s]=this._status[i][s];}}}return e;},Controller.prototype.getBufferedState=function(e){if(!e)return null;var t=e.indexOf(":");-1!=t&&(e=e.substr(0,t));var a=this._devices[e];if(!a)return null;var r={};if(a.CHILDREN){var n=this;a.CHILDREN.forEach(function(e){if(n._status[e])for(var t in r[e]={},n._status[e]){r[e][t]=n._status[e][t];}});}return r;},Controller.prototype.getBufferedDevices=function(){return this._getDeviceStructs(this._devices);},Controller.prototype.getState=function(e,t,a){var r=this.getBufferedState(e);if(r&&r[e]&&r[e][t]){var n=r[e][t],i=n.value;if(void 0!==i&&null!=i)return void(a&&a(null,n));}this.updateState(e,t,function(e,t){a&&a(e,t);});},Controller.prototype.updateState=function(e,t,a){var r=this;this.readValue(e,t,function(n,i){n?setTimeout(function(){var n,i=r.getBufferedState(e);i&&i[e]&&i[e][t]&&(n=i[e][t]),a&&a(null,n);},1e3):a&&a(null,{value:i,time:new Date().getTime()});});},Controller.prototype.reset=function(e){var t=Object.keys(this._devices),a=[];if(t.forEach(function(e){e&&-1==e.indexOf(":")&&"BidCoS-RF"!=e&&a.push(e);}),0!=a.length){var r=0,n=this,cb=function cb(t){++r<a.length?n.deleteDevice(a[r],cb):e&&e();};this.deleteDevice(a[r],cb);}else e&&e();},Controller.prototype.register=function(e,t,a){if(e){this._logger.log("debug","register:"+t+" to "+e);var r=this;this._client.init(e,t,function(e){r._logger.log("debug","registed:"+t+(e?" err:"+e.message:"")),a&&a(e,e?null:t);});}else a&&a(new Error("arguments invalid"));},Controller.prototype.unregister=function(e,t){e?this._client.init(e,"",function(e){t&&t(e);}):t&&t(new Error("url invalid"));},Controller.prototype.getDevices=function(e){this._client.listDevices(function(t,a){if(t)e&&e(t);else for(var r=0;r<a.length;r++){;}});},Controller.prototype.learnNewDevice=function(e){var t=this._learnDeviceCbs.length;if(e&&-1==this._learnDeviceCbs.indexOf(e)&&this._learnDeviceCbs.push(e),0==t){var a=this;this._learnDeviceTO=setTimeout(function(){var e=a._learnDeviceCbs;a._learnDeviceCbs=[];for(var t=0;t<e.length;t++){var r=e[t];r&&r(new Error("learn device timeout"));}},3e4),this._client.setInstallMode(!0,30,1,function(e){if(e){a._learnDeviceTO&&(clearTimeout(a._learnDeviceTO),a._learnDeviceTO=null);var t=a._learnDeviceCbs;a._learnDeviceCbs=[];for(var r=0;r<t.length;r++){var n=t[r];n&&n(e);}}});}},Controller.prototype.learnNewDeviceSN=function(e,t){var a=this._learnDeviceCbs.length;if(t&&-1==this._learnDeviceCbs.indexOf(t)&&this._learnDeviceCbs.push(t),0==a){var r=this;this._learnDeviceTO=setTimeout(function(){var e=r._learnDeviceCbs;r._learnDeviceCbs=[];for(var t=0;t<e.length;t++){var a=e[t];a&&a(new Error("learn device timeout"));}},3e4),this._client.setInstallMode(!0,30,e,function(e){if(e){r._learnDeviceTO&&(clearTimeout(r._learnDeviceTO),r._learnDeviceTO=null);var t=r._learnDeviceCbs;r._learnDeviceCbs=[];for(var a=0;a<t.length;a++){var n=t[a];n&&n(e);}}});}},Controller.prototype.learnNewIPDevice=function(e,t,a){var r=this._learnDeviceCbs.length;if(a&&-1==this._learnDeviceCbs.indexOf(a)&&this._learnDeviceCbs.push(a),0==r){var n=this;this._learnDeviceTO=setTimeout(function(){var e=n._learnDeviceCbs;n._learnDeviceCbs=[];for(var t=0;t<e.length;t++){var a=e[t];a&&a(new Error("learn device timeout"));}},6e4);var i={ADDRESS:e.replace(/-/g,"").toUpperCase(),KEY_MODE:"LOCAL",KEY:this._convertHmIPKeyBase32ToBase16(t)};this._client.setInstallModeWithWhitelist(!0,60,[i],function(e){if(e){n._learnDeviceTO&&(clearTimeout(n._learnDeviceTO),n._learnDeviceTO=null);var t=n._learnDeviceCbs;n._learnDeviceCbs=[];for(var a=0;a<t.length;a++){var r=t[a];r&&r(e);}}});}},Controller.prototype.learnNewIPDeviceQR=function(e,t){var a=this._learnDeviceCbs.length;if(t&&-1==this._learnDeviceCbs.indexOf(t)&&this._learnDeviceCbs.push(t),0==a){var r=this;this._learnDeviceTO=setTimeout(function(){var e=r._learnDeviceCbs;r._learnDeviceCbs=[];for(var t=0;t<e.length;t++){var a=e[t];a&&a(new Error("learn device timeout"));}},3e4);var n=e.substr(6,24),i=e.substring(e.length-32,e.length),s={ADDRESS:n.replace(/-/g,"").toUpperCase(),KEY_MODE:"LOCAL",KEY:i.toUpperCase()};this._client.setInstallModeWithWhitelist(!0,30,[s],function(e){if(e){r._learnDeviceTO&&(clearTimeout(r._learnDeviceTO),r._learnDeviceTO=null);var t=r._learnDeviceCbs;r._learnDeviceCbs=[];for(var a=0;a<t.length;a++){var n=t[a];n&&n(e);}}});}},Controller.prototype.deleteDevice=function(e,t){if(e){var a=e.indexOf(":");-1!=a&&(e=e.substr(0,a)),this._client.deleteDevice(e,2,t);}else t&&t(new Error("address is empty"));},Controller.prototype.readValue=function(e,t,a){var r=e+"."+t,n=this._readValueCbs[r];n||(n=[],this._readValueCbs[r]=n);var i=n.length;if(a&&-1==n.indexOf(a)&&n.push(a),0==i){var s=this;this._client.getValue(e,t,null,function(a,n){a||s._updateStatusBuffer(e,t,n);var i=s._readValueCbs[r];delete s._readValueCbs[r],i.forEach(function(e){e&&e(a,n);});});}},Controller.prototype.writeValue=function(e,t,a,r){var n=this;this._client.setValue(e,t,a,function(i){i||n._updateStatusBuffer(e,t,a.type?a.value:a),r&&r(i);});},Controller.prototype.getValuesParamset=function(e,t){this._logger.log("trace","getValuesParamset:"+e);var a=this;this._client.getParamset(e,"VALUES",0,function(r,n){if(r)return a._logger.log("trace","getValuesParamset error:"+r.message),void(t&&t(r));if(n){var i=0,s=e.indexOf(":");for(var o in-1!=s&&(i=e.substr(s+1)),n){n.hasOwnProperty(o)&&(0==i?"INSTALL_MODE"!=o&&a._updateStatusBuffer(e,o,n[o]):a._updateStatusBuffer(e,o,n[o]));}}a._logger.log("trace","getValuesParamset finish:"+JSON.stringify(n)),t&&t(null,n);});},Controller.prototype.getParamset=function(e,t,a){this._client.getParamset(e,t,0,function(e,t){a&&a(e,t);});},Controller.prototype.setParamset=function(e,t,a,r){this._client.putParamset(e,t,a,function(e){r&&r(e);});},Controller.prototype.reportValueUsage=function(e,t,a,r){this._client.reportValueUsage(e,t,a,function(e,t){r&&r(e,t);});},Controller.prototype.getDevice=function(e){if(!e)return null;var t=e,a=e.indexOf(":");if(-1!=a&&(t=e.substr(0,a)),!this._devices[t])return null;var r=[],n=this._devices[t];if(r.push(n),n.CHILDREN){var i=this;n.CHILDREN.forEach(function(e){e&&i._devices[e]&&r.push(i._devices[e]);});}var s=this._getDeviceStructs(r);return s?s[t]:null;},Controller.prototype._getDeviceStructs=function(e){if(!e)return null;var t={},a=this;return e.forEach(function(e){if(e.ADDRESS&&e.TYPE)if(!e.PARENT&&e.CHILDREN)t[e.ADDRESS]={type:e.TYPE,"interface":a["interface"],address:e.ADDRESS,channels:{}};else if(e.PARENT){var r=t[e.PARENT];r&&(r.channels[e.ADDRESS]={type:e.TYPE,address:e.ADDRESS});}}),t;},Controller.prototype._updateStatusBuffer=function(e,t,a,r){if("CENTRAL"!=e||"PONG"!=t){var n,i,s=!1;if("PRESS_SHORT"==t||"PRESS_LONG"==t||"PRESS_CONT"==t||"PRESS_LONG_RELEASE"==t)n={},i={value:a,time:new Date().getTime()},s=!0;else{var o=this._status[e];o||(o={},this._status[e]=o);var c=o[t];c||(c={},o[t]=c),n=c,i={value:a,time:r||new Date().getTime()},n&&n.time&&i&&i.time&&n.time>i.time?s=!1:(o[t]=i,s=!0);}var l=this.getDevice(e);s&&this.emit("event",{device:l,"interface":this["interface"],channel:e,datapoint:t,value:i,changed:n.value!=i.value,oldValue:n});var u=e.indexOf(":");if(-1!=u){var h=e.substr(0,u);"1"==e.substr(u+1)&&"STATE"==t&&0==a&&l&&l.channels&&l.channels[h+":2"]&&"POWERMETER"==l.channels[h+":2"].type&&(this._updateStatusBuffer(h+":2","POWER",0),this._updateStatusBuffer(h+":2","CURRENT",0));}}},Controller.prototype._initNewDeviceStates=function(e,t){if(this._initStates){var a=this,_getChannelValues=function _getChannelValues(e,t){e.ADDRESS&&e.PARAMSETS&&-1!=e.PARAMSETS.indexOf("VALUES")?a.getValuesParamset(e.ADDRESS,t):t();},r=0,cb=function cb(){++r<e.length?_getChannelValues(e[r],cb):t&&t();};_getChannelValues(e[r],cb);}else t&&t();},Controller.prototype._convertHmIPKeyBase32ToBase16=function(e){e=e.replace(/-/g,"").toUpperCase();for(var t=["0","1","2","3","4","5","6","7","8","9","A","B","C","E","F","G","H","J","K","L","M","N","P","Q","R","S","T","U","W","X","Y","Z"],a=new ArrayBuffer(16),r=new Uint8Array(a),n=0,i=e.length-1,s=0,o=r.length-1,c="";i>=0;){for(var l=0;l<t.length;l++){if(t[l]==e.charAt(i)){n|=l<<s;break;}}for(s+=5,i--;s>8&&o>=0;){r[o]=255&n,n>>=8,s-=8,o--;}}for(l=0;l<r.length;l++){r[l]<16&&(c+="0"),c+=r[l].toString(16);}return c.toUpperCase();},Controller.prototype._xmlrpcCall=function(e,t,a){this._logger.log("trace","receive call:"+e),this._logger.log("trace","params:"+JSON.stringify(t));var r=[],n=0;switch(e){case"newDevices":if(t[1]){this._initNewDeviceStates(t[1],null);n=0;for(n=0;n<t[1].length;n++){var i=t[1][n];i&&i.ADDRESS&&(this._devices[i.ADDRESS]=i);}var s=this._getDeviceStructs(t[1]);try{this.emit("newDevices",s);}catch(e){}if(!t[1]||!t[1][0]||"HM-RCV-50"!=t[1][0].TYPE){var o=this._learnDeviceCbs;for(this._learnDeviceCbs=[],this._learnDeviceTO&&(clearTimeout(this._learnDeviceTO),this._learnDeviceTO=null),o.length>0&&this._client.setInstallMode(!1,null,null,null),n=0;n<o.length;n++){(l=o[n])&&l(null,s);}}}break;case"readdedDevice":if(t[1]&&t[1][0]){var c=this.getDevice(t[1][0]);(s={})[t[1][0]]=c;o=this._learnDeviceCbs;for(this._learnDeviceCbs=[],this._learnDeviceTO&&(clearTimeout(this._learnDeviceTO),this._learnDeviceTO=null),o.length>0&&this._client.setInstallMode(!1,null,null,null),n=0;n<o.length;n++){var l;(l=o[n])&&l(null,s);}}break;case"listDevices":if(t[1]){var u=[];for(var h in this._devices){this._devices.hasOwnProperty(h)&&this._devices[h]&&u.push(this._devices[h]);}r.push(u);}break;case"deleteDevices":if(t[1])for(n=0;n<t[1].length;n++){var d=t[1][n];d&&(delete this._devices[d],delete this._status[d]);}break;case"event":this._logger.log("trace","get event:"+JSON.stringify(t)),this._updateStatusBuffer(t[1],t[2],t[3]);}a&&a(null,r);};var RFController=function RFController(e,t,a,r,n,i){x.hub.m.hm._Controller.call(this,e,t,a,r,n,i),this["interface"]="BidCos-RF",this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Controller.RF");};(RFController.prototype=new Controller()).constructor=RFController,RFController.prototype.listBidcosInterfaces=function(e){this._client.listBidcosInterfaces(function(t,a){e&&e(t,a);});},RFController.prototype.ping=function(e,t){this._client.ping(e,function(e){t&&t(e);});};var WiredController=function WiredController(e,t,a,r,n,i){x.hub.m.hm._Controller.call(this,e,t,a,r,n,i),this["interface"]="BidCos-Wired",this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Controller.Wired");};util.inherits(WiredController,Controller);var IPController=function IPController(e,t,a,r,n,i){x.hub.m.hm._Controller.call(this,e,t,a,r,n,i),this["interface"]="HmIP-RF",this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Controller.IP");};return util.inherits(IPController,Controller),IPController.prototype.deleteDevice=function(e,t){var a=e.indexOf(":");-1!=a&&(e=e.substr(0,a)),this._client.deleteDevice(e,2,t);},Controller.getController=function(e,t,a){var r=null;switch(e){case"BidCos-RF":r=RFController;break;case"BidCos-Wired":r=WiredController;break;case"HmIP-RF":r=IPController;break;default:return null;}return new r(t.ip,t.port,t.username,t.password,a.useHttps,a.initStates);},Controller;}(),x.hub.m.hm.Monitor=function(){var ControllerMonitor=function ControllerMonitor(e,t,a){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Monitor.ControllerMonitor"),this._type=a,this._monitor=e,this._controller=t,this._xmlrpcServer=null,this._retryWait=1e4,this._retryCount=0,this._retryTO=null,this._state=0,this._err=null;};ControllerMonitor.prototype.start=function(e,t){0==this._state&&(this._xmlrpcServer=e,this._connect(e)),t&&t();},ControllerMonitor.prototype.stop=function(e,t){var a=this._state;this._retryTO&&clearTimeout(this._retryTO),this._retryTO=null,this._state=0,this._err=null,this._retryCount=0,0!=a?this._unregister(e,function(){t&&t();}):t&&t();},ControllerMonitor.prototype.getMonitorState=function(){return{state:this._state,error:this._err?this._err.message:null};},ControllerMonitor.prototype._connect=function(){this._logger.log("info","start regist "+this._type+" monitor at "+this._controller.getIP()+":"+this._controller.getPort()),this._state=1;var e=this;this._register(this._xmlrpcServer,function(t){t?(e._logger.log("warn","regist "+e._type+" monitor at "+e._controller.getIP()+":"+e._controller.getPort()+" error:"+t.message),e._state=3,e._err=t,e._retryCount++,e._retryTO=setTimeout(function(){e._logger.log("trace","retry timeout for regist "+e._type+" monitor at "+e._controller.getIP()+":"+e._controller.getPort()+" expired"),e._connect();},Math.min(6e4,Math.ceil(e._retryCount/10)*e._retryWait))):(e._logger.log("info","regist "+e._type+" monitor at "+e._controller.getIP()+":"+e._controller.getPort()+" success"),e._state=2,e._err=null,e._retryCount=0,e._monitor._onControllerMonitorConnected(e._type));});},ControllerMonitor.prototype._register=function(e,t){var a=this._monitor.localMac.replace(/:/g,""),r="/"+this._monitor.serialNumber,n=e.getPort(),i="http://"+this._monitor.localIP+":"+(n||80)+r;this._controller.register(i,this._monitor.serialNumber+"_"+this._controller.getPort()+"_"+a,t);},ControllerMonitor.prototype._unregister=function(e,t){var a="/"+this._monitor.serialNumber,r=e.getPort(),n="http://"+this._monitor.localIP+":"+(r||80)+a;this._controller.unregister(n,t);};var PinPongHandler=function PinPongHandler(e){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Monitor.PinPongHandler"),this._monitor=e,this._pingWait=3e4,this._pingTO=null,this._pingMiss=0;};PinPongHandler.prototype.start=function(){this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null),this._pingMiss=0,this._startPingTO();},PinPongHandler.prototype.stop=function(){this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null),this._pingMiss=0;},PinPongHandler.prototype._startPingTO=function(){var e=this;this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null),this._pingTO=setTimeout(function(){e._pingMiss++,e._pingMiss<4?(e._ping(),e._startPingTO()):e._pingFail();},this._pingWait);},PinPongHandler.prototype._ping=function(e){var t=this._monitor._rfController;if(t){this._logger.log("trace","send PING");t.ping(this._monitor.localMac,function(t){e&&e(t);});}else e&&e(new Error("no rf controller for ping"));},PinPongHandler.prototype._pingFail=function(){this._logger.log("warn","PING Fail"),this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null),this._pingMiss=0,this._monitor._onPingFail();},PinPongHandler.prototype._onPong=function(){this._pingMiss=0;};var Monitor=function Monitor(e,t){this.ip=e.ip,this.serialNumber=e.uuid,this.ccuType=e.type,this.ccuType||(this.ccuType=2),this.localIP=t?t.localIP:null,this.localMac=t?t.localMac:null,this.isChip=!!t&&"chip"==t.localChip,this.isCCU3=!!t&&"ccu3"==t.localChip,this.persistant=!!t&&t.persistant,this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Monitor");var a={ip:this.ip,port:null,username:e.username,password:e.password},r={useHttps:!1,initStates:!!this.isChip};a.port=this.isCCU3?32001:2001,this._rfController=x.hub.m.hm._Controller.getController("BidCos-RF",a,r),this._rfController.on("event",this._onEvent.bind(this)),this._rfController.on("newDevices",this._onNewDevices.bind(this)),a.port=this.isCCU3?32010:2010,this._ipController=x.hub.m.hm._Controller.getController("HmIP-RF",a,r),this._ipController.on("event",this._onEvent.bind(this)),this._ipController.on("newDevices",this._onNewDevices.bind(this)),a.port=this.isCCU3?32e3:2e3,this._wiredController=x.hub.m.hm._Controller.getController("BidCos-Wired",a,r),this._wiredController.on("event",this._onEvent.bind(this)),this._wiredController.on("newDevices",this._onNewDevices.bind(this)),this._rfMonitor=null,this._ipMonitor=null,this._wiredMonitor=null,this._pingpong=new PinPongHandler(this),this._xmlrpcServer=null,this._manager=null,this._pingTO=null,this._pingMiss=0,this._rfRegisted=!1,this._ipRegisted=!1,this._wiredRegisted=!1,this._reconnectTO=null,this._reconnectCount=0;};return util.inherits(Monitor,EventEmitter),Monitor.prototype.getMonitorState=function(e){var t={chip:this.isChip};if(this._rfMonitor){var a=this._rfMonitor.getMonitorState();t.bidcos=a;}if(this._ipMonitor){var r=this._ipMonitor.getMonitorState();t.hmip=r;}if(this._wiredMonitor){var n=this._wiredMonitor.getMonitorState();t.bidcos_wired=n;}t.bidcos&&2==t.bidcos.state?this._rfController.listBidcosInterfaces(function(a,r){r&&(t.info=r),e&&e(null,t);}):e&&e(null,t);},Monitor.prototype.getAllBufferedStates=function(){var e,t={},a=this._rfController.getAllBufferedStates();if(a)for(e in a){a.hasOwnProperty(e)&&(t[e]=a[e]);}var r=this._wiredController.getAllBufferedStates();if(r)for(e in r){r.hasOwnProperty(e)&&(t[e]=r[e]);}var n=this._ipController.getAllBufferedStates();if(n)for(e in n){n.hasOwnProperty(e)&&(t[e]=n[e]);}return t;},Monitor.prototype.getBufferedDevice=function(e,t){var a=null;switch(e){case"BidCos-RF":a=this._rfController;break;case"BidCos-Wired":a=this._wiredController;break;case"HmIP-RF":a=this._ipController;break;default:return null;}return a.getDevice(t);},Monitor.prototype.getState=function(e,t){if(!(e&&e["interface"]&&e.channel&&e.datapoint))return t&&t(new Error("argument invalid")),null;var a=null;switch(e["interface"]){case"BidCos-RF":a=this._rfController;break;case"BidCos-Wired":a=this._wiredController;break;case"HmIP-RF":a=this._ipController;break;default:return null;}a.getState(e.channel,e.datapoint,t);},Monitor.prototype.updateState=function(e,t){if(!(e&&e["interface"]&&e.channel&&e.datapoint))return t&&t(new Error("argument invalid")),null;var a=null;switch(e["interface"]){case"BidCos-RF":a=this._rfController;break;case"BidCos-Wired":a=this._wiredController;break;case"HmIP-RF":a=this._ipController;break;default:return null;}a.updateState(e.channel,e.datapoint,t);},Monitor.prototype.init=function(e,t){this._logger.log("info","init monitor ("+this.ip+")"),this._xmlrpcServer=e,this._init(t);},Monitor.prototype._init=function(e){var t=this;this.getSerialNumber(function(a){a?e&&e(a):t.register(t._xmlrpcServer,function(){e&&e();});});},Monitor.prototype.update=function(e,t,a,r){a&&this.serialNumber!=a&&(this.serialNumber=a);var n=this;e&&this.ip!=e||t&&this.localIP!=t?this.unregister(this._xmlrpcServer,function(){n.ip=e,n.localIP=t,n.register(n._xmlrpcServer,r);}):r&&r();},Monitor.prototype.finalize=function(e){this.removeAllListeners(),this._manager&&this._manager.deleteMonitor(this.ip),this._pingTO&&(clearTimeout(this._pingTO),this._pingTO=null),this._reconnectTO&&(clearTimeout(this._reconnectTO),this._reconnectTO=null),this.unregister(this._xmlrpcServer,function(){e&&e();});},Monitor.prototype.getSerialNumber=function(e){var t=this;global&&"CCU3"==global.PLATFORM?(this._rfController.setPort(32001),t.getRFInterfaces(function(a,r){if(a)return t._rfController.setPort(2001),void t.getRFInterfaces(function(a,r){a?e&&e():(t.serialNumber=r[0].ADDRESS,e&&e(null,t.serialNumber));});t._ipController.setPort(32010),t._wiredController.setPort(32e3),t.serialNumber=r[0].ADDRESS,e&&e(null,t.serialNumber);})):this.getRFInterfaces(function(a,r){a?e&&e():(t.serialNumber=r[0].ADDRESS,e&&e(null,t.serialNumber));});},Monitor.prototype.getRFInterfaces=function(e){this._rfController.listBidcosInterfaces(function(t,a){e&&e(t,a);});},Monitor.prototype.register=function(e,t){var a=this,r="/"+this.serialNumber;e.registServlet(r,function(e,t,r){a._xmlrpcCall(e,t,r);}),this._rfMonitor=new ControllerMonitor(this,this._rfController,"rf"),this._ipMonitor=new ControllerMonitor(this,this._ipController,"ip"),this._wiredMonitor=new ControllerMonitor(this,this._wiredController,"wired"),this._rfMonitor.start(e),this._ipMonitor.start(e),this.isChip||this._wiredMonitor.start(e),t&&t();},Monitor.prototype.unregister=function(e,t){var a="/"+this.serialNumber;e.unregistServlet(a),this._rfMonitor.stop(e),this._ipMonitor.stop(e),this.isChip||this._wiredMonitor.stop(e),t&&t();},Monitor.prototype._onControllerMonitorConnected=function(e){"rf"==e&&this._pingpong.start();},Monitor.prototype._onPingFail=function(){var e=this;this.unregister(this._xmlrpcServer,function(){e.register(e._xmlrpcServer,function(){});});},Monitor.prototype._onPong=function(){this._pingpong._onPong();},Monitor.prototype.reset=function(e){var t=this;this._rfController.reset(function(){t._ipController.reset(function(){t._wiredController.reset(function(){e&&e();});});});},Monitor.prototype.learnRF=function(e){this._rfController.learnNewDevice(function(t,a){e&&e(t,a);});},Monitor.prototype.learnRFSN=function(e,t){this._rfController.learnNewDeviceSN(e,function(e,a){t&&t(e,a);});},Monitor.prototype.learnIP=function(e,t,a){this._ipController.learnNewIPDevice(e,t,function(e,t){a&&a(e,t);});},Monitor.prototype.learnIPQR=function(e,t){this._ipController.learnNewIPDeviceQR(e,function(e,a){t&&t(e,a);});},Monitor.prototype.deleteDevice=function(e,t,a){if(!e||!t)return a&&a(new Error("argument invalid")),null;var r=null;switch(e){case"BidCos-RF":r=this._rfController;break;case"BidCos-Wired":r=this._wiredController;break;case"HmIP-RF":r=this._ipController;break;default:return void(a&&a(new Error("no such interface")));}r.deleteDevice(t,a);},Monitor.prototype.getDevices=function(e){var t=0;this._rfController&&t++,this._ipController&&t++,this._wiredController&&t++;var a=[],cb=function cb(r){t--,r?e&&e(r):0==t&&e&&e(null,a);},r=this;this._rfController&&this._rfController.getBufferedDevices(function(e,t){if(e)return cb&&cb(e),void(cb=null);a=a.concat(r._parseDevices(t,"BidCos-RF")),cb&&cb();}),this._ipController&&this._ipController.getBufferedDevices(function(e,t){if(e)return cb&&cb(e),void(cb=null);a=a.concat(r._parseDevices(t,"HmIP-RF")),cb&&cb();}),this._wiredController&&this._wiredController.getBufferedDevices(function(e,t){if(e)return cb&&cb(e),void(cb=null);a=a.concat(r._parseDevices(t,"BidCos-Wired")),cb&&cb();});},Monitor.prototype.getParamset=function(e,t,a,r){if(e&&t&&a){var n=null;switch(e){case"BidCos-RF":n=this._rfController;break;case"BidCos-Wired":n=this._wiredController;break;case"HmIP-RF":n=this._ipController;break;default:return void(r&&r(new Error("unknow interface")));}n.getParamset(t,a,function(e,t){r&&r(e,t);});}else r&&r(new Error("argument invalid"));},Monitor.prototype.setParamset=function(e,t,a,r,n){if(e&&t&&a&&r){var i=null;switch(e){case"BidCos-RF":i=this._rfController;break;case"BidCos-Wired":i=this._wiredController;break;case"HmIP-RF":i=this._ipController;break;default:return void(n&&n(new Error("unknow interface")));}i.setParamset(t,a,r,function(e,t){n&&n(e,t);});}else n&&n(new Error("argument invalid"));},Monitor.prototype.readValue=function(e,t,a,r){if(e&&t&&a){var n=null;switch(e){case"BidCos-RF":n=this._rfController;break;case"BidCos-Wired":n=this._wiredController;break;case"HmIP-RF":n=this._ipController;break;default:return void(r&&r(new Error("unknow interface")));}n.readValue(t,a,function(e,t){r&&r(e,t);});}else r&&r(new Error("argument invalid"));},Monitor.prototype.writeValue=function(e,t,a,r,n){if(e&&t&&a){var i=null;switch(e){case"BidCos-RF":i=this._rfController;break;case"BidCos-Wired":i=this._wiredController;break;case"HmIP-RF":i=this._ipController;break;default:return void(n&&n(new Error("unknow interface")));}i.writeValue(t,a,r,function(e){n&&n(e);});}else n&&n(new Error("argument invalid"));},Monitor.prototype.reportValueUsage=function(e,t,a,r){if(e&&t&&a){var n=null;switch(e){case"BidCos-RF":n=this._rfController;break;case"BidCos-Wired":n=this._wiredController;break;case"HmIP-RF":n=this._ipController;break;default:return void(r&&r(new Error("unknow interface")));}n.reportValueUsage(t,a,1,function(e,t){r&&r(e,t);});}else r&&r(new Error("argument invalid"));},Monitor.prototype.updateStatusBuffer=function(e,t,a,r,n){if(e&&t&&a){var i=null;switch(e){case"BidCos-RF":i=this._rfController;break;case"BidCos-Wired":i=this._wiredController;break;case"HmIP-RF":i=this._ipController;break;default:return;}i._updateStatusBuffer(t,a,r,n);}},Monitor.prototype._parseDevices=function(e,t){t||(t="BidCos-RF");var a=new(require("xnm.aio.hm.js").CCU)(),r={};for(var n in e){if(e.hasOwnProperty(n)){var i=e[n],s={typename:"DEVICE",hsstype:i.TYPE,address:i.ADDRESS,"interface":t,rfAddr:i.RF_ADDRESS,channels:{}};if(i.CHILDREN)for(var o=0,c=i.CHILDREN.length;o<c;o++){var l=i.CHILDREN[o],u=e[l];s.channels[l]={hsstype:u.TYPE,address:l};}r[n]=s;}}return a._parseDevices(r);},Monitor.prototype._xmlrpcCall=function(e,t,a){if(this._logger.log("trace","receive call:"+e),this._logger.log("trace","params:"+JSON.stringify(t)),"event"==e&&"CENTRAL"==t[1]&&"PONG"==t[2])return this._onPong(),void(a&&a(null,[]));var r=t[0].split("_");if(r.length>=3){var n=r[1];-1!=n.indexOf("2001")&&this._rfController?this._rfController._xmlrpcCall(e,t,a):-1!=n.indexOf("2010")&&this._ipController?this._ipController._xmlrpcCall(e,t,a):-1!=n.indexOf("2000")&&this._wiredController?this._wiredController._xmlrpcCall(e,t,a):a&&a(null,[]);}else a&&a(null,[]);},Monitor.prototype._onNewDevices=function(e){this._logger.log("debug","find new devices"),this._logger.log("debug",JSON.stringify(e)),this.emit("new_devices",e);},Monitor.prototype._onEvent=function(e){this._logger.log("trace","receive event:"+JSON.stringify(e)),this._logger.log("debug","EVENT:\t"+e["interface"]+"\t"+e.device.type+"\t"+e.channel+"\t"+e.datapoint+"\t"+e.value.value),e.ip=this.ip,e.serialNumber=this.serialNumber,this.emit("event",e,this);},Monitor;}(),x.hub.m.hm.MonitorManager=function(){var MM=function MM(){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.MonitorManager"),this._monitors=[],this._xmlrpcServer=null,this._tmpMonitors={},this._monitorEvtListener=this.onDeviceEvent.bind(this);};return MM.prototype.init=function(e,t){this._xmlrpcServer=e,t&&t();},MM.prototype.startMonitorForIP=function(e,t,a){var r={ip:e},n={localIP:t};this.startMonitor(r,n,a);},MM.prototype.startMonitor=function(e,t,a){if(this._xmlrpcServer){if(e&&e.ip){var r=this.getMonitor(e.ip,e.uuid);if(r)a&&a();else if(t||(t={}),t.localIP||(t.localIP=x.hub.m.hm._Util.getLocalIP(null,e.ip)),t.localIP){t.localMac||(t.localMac=x.hub.m.hm._Util.getLocalMac(t.localIP));var n=e.ip;this._tmpMonitors[n]||(this._tmpMonitors[n]=[]);var i=this._tmpMonitors[n].length,s=this._tmpMonitors[n];if(a||(a=function a(){}),-1==s.indexOf(a)&&s.push(a),!(i>0)){var o=this;(r=new x.hub.m.hm.Monitor(e,t))._manager=this,r.init(this._xmlrpcServer,function(e){e||(o._monitors.push(r),r.on("event",o._monitorEvtListener));var t=o._tmpMonitors[n];delete o._tmpMonitors[n],t.forEach(function(t){t&&t(e);});});}}else a&&a(new Error("local ip address invalid"));}else a&&a(new Error("gateway invalid"));}else a&&a(new Error("xml rpc server not started"));},MM.prototype.getAllMonitor=function(){return this._monitors;},MM.prototype.getMonitor=function(e,t){var a=null,r=null;return this._monitors.forEach(function(n){n&&n.ip==e&&(a=n),n&&n.serialNumber==t&&(r=n);}),r||a;},MM.prototype.getMonitorStates=function(e){if(0!=this._monitors.length){var t=this,a=0,r=[],cb=function cb(n,i){!n&&i&&(i.ip=t._monitors[a].ip,i.serialNumber=t._monitors[a].serialNumber,r.push(i)),++a<t._monitors.length?t._monitors[a].getMonitorState(cb):e&&e(null,r);};this._monitors[a].getMonitorState(cb);}else e&&e(null,[]);},MM.prototype.deleteMonitor=function(e){for(var t=-1,a=0,r=this._monitors.length;a<r;a++){var n=this._monitors[a];if(n&&n.ip==e){t=a;break;}}-1!=a&&this._monitors.splice(t,1);},MM.prototype.onFindHomeMatic=function(e,t,a){var r=this.getMonitor(null,a),n=this.getMonitor(e);if(n)return n.update(e,t,a),void(r&&r!=n&&(r.finalize(),this.deleteMonitor(r.ip)));r&&(r.finalize(),this.deleteMonitor(r.ip)),this.startMonitorForIP(e,t);},MM.prototype.onDeviceEvent=function(e,t){require("x.hub.m.hm.js").onDeviceEvent(e,t.isChip);},MM;}(),x.hub.m.hm._Channel=function(){var e={map:[],getReadableDpts:function getReadableDpts(){var e=[];return this.map.forEach(function(t){t&&t.dpt&&t.state&&t.state.length>0&&-1==e.indexOf(t.dpt)&&e.push(t.dpt);}),e;},getDptFromState:function getDptFromState(e){var t=null;return this.map.forEach(function(a){a&&a.dpt&&a.state&&-1!=a.state.indexOf(e)&&(t=a.dpt);}),t;},getDptFromCommand:function getDptFromCommand(e){var t=null;return this.map.forEach(function(a){a&&a.dpt&&a.command&&-1!=a.command.indexOf(e)&&(t=a.dpt);}),t;}};return{"HmIP-RF":{T_MAINTENANCE:{map:[{dpt:"UNREACH",state:["timeout"],event:["timeout"]},{dpt:"LOW_BAT",state:["lowbat"],event:["lowbat"]},{dpt:"SABOTAGE",state:["sabotage"],event:["sabotage"]},{dpt:"OPERATING_VOLTAGE",state:["voltage"],event:["voltage"]},{dpt:"ERROR_CODE",state:["errorCode"],event:["errorCode"]},{dpt:"SENSOR_ERROR",state:["sensorError"],event:["sensorError"]},{dpt:"ACTUAL_TEMPERATURE",state:["maintainTemp"],event:["maintainTemp"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){switch(e){case"UNREACH":return{timeout:t};case"LOW_BAT":return{lowbat:t};case"SABOTAGE":return{sabotage:t};case"OPERATING_VOLTAGE":return{voltage:parseFloat(t)};case"ERROR_CODE":return{errorCode:parseInt(t)};case"ACTUAL_TEMPERATURE":return{maintainTemp:parseFloat(t)};}return null;}},MAINTENANCE:{map:[{dpt:"UNREACH",state:["timeout"],event:["timeout"]},{dpt:"LOW_BAT",state:["lowbat"],event:["lowbat"]},{dpt:"SABOTAGE",state:["sabotage"],event:["sabotage"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){switch(e){case"UNREACH":return{timeout:t};case"LOW_BAT":return{lowbat:t};case"SABOTAGE":return{sabotage:t};}return null;}},MAINTENANCE_BAT_EL:{map:[{dpt:"UNREACH",state:["timeout"],event:["timeout"]},{dpt:"LOW_BAT",state:["lowbat"],event:["lowbat"]},{dpt:"SABOTAGE",state:["sabotage"],event:["sabotage"]},{dpt:"OPERATING_VOLTAGE",state:["voltage"],event:["voltage"]},{dpt:"ERROR_CODE",state:["errorCode"],event:["errorCode"]},{dpt:"SENSOR_ERROR",state:["sensorError"],event:["sensorError"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){switch(e){case"UNREACH":return{timeout:t};case"LOW_BAT":return{lowbat:t};case"SABOTAGE":return{sabotage:t};case"OPERATING_VOLTAGE":return{voltage:parseFloat(t)};case"ERROR_CODE":return{errorCode:parseInt(t)};case"SENSOR_ERROR":return{sensorError:t};}return null;}},MAINTENANCE_BAT_CL:{map:[{dpt:"UNREACH",state:["timeout"],event:["timeout"]},{dpt:"LOW_BAT",state:["lowbat"],event:["lowbat"]},{dpt:"ERROR_NON_FLAT_POSITIONING",state:["sabotage"],event:["sabotage"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){switch(e){case"UNREACH":return{timeout:t};case"LOW_BAT":return{lowbat:t};case"ERROR_NON_FLAT_POSITIONING":return{sabotage:t};}return null;}},SWITCH_TRANSMITTER:{map:[{dpt:"STATE",state:["switchTState"],event:["switchTState"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){var a=null;if("STATE"===e)a=1==t?{switchTState:"on"}:0==t?{switchTState:"off"}:{switchTState:"?"};return a;}},SWITCH_VIRTUAL_RECEIVER:{map:[{dpt:"STATE",state:["switchState"],event:["switchState"],command:["on","off","toggle"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){var a=null;if("STATE"===e)a=1==t?{switchState:"on"}:0==t?{switchState:"off"}:{switchState:"?"};return a;},executeCommand:function executeCommand(t,a,r,n,i){var s,o=e.getDptFromCommand.call(this,n);if("onFor"==n.substr(0,5)&&(o="STATE"),o)switch(n){case"on":t.writeValue(a,r,o,!0,i);break;case"off":t.writeValue(a,r,o,!1,i);break;case"toggle":t.getState({"interface":a,channel:r,datapoint:o},function(e,n){if(e)i&&i(e);else if(n){var s=!0;n.value&&(s=!1),t.writeValue(a,r,o,s,i);}else i&&i(new Error("get switch current value return invalid"));});break;default:if("onFor"==n.substr(0,5))return s=parseFloat(n.substr(5)),isNaN(s)?void(i&&i(new Error("onFor command invalid"))):(o="ON_TIME",void t.writeValue(a,r,o,{type:"double",value:s},function(e){e?i&&i(e):(o="STATE",t.writeValue(a,r,o,!0,i));}));i&&i(new Error("no such command"));}else i&&i(new Error("can not find datapoint for command:"+n));}},ENERGIE_METER_TRANSMITTER:{map:[{dpt:"ENERGY_COUNTER",state:["meterEnergyCounter"],event:["meterEnergyCounter"]},{dpt:"POWER",state:["meterPower"],event:["meterPower"]},{dpt:"CURRENT",state:["meterCurrent"],event:["meterCurrent"]},{dpt:"VOLTAGE",state:["meterVoltage"],event:["meterVoltage"]},{dpt:"FREQUENCY",state:["meterFrequency"],event:["meterFrequency"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){switch(e){case"ENERGY_COUNTER":return{meterEnergyCounter:parseFloat(t).toFixed(2)};case"POWER":return{meterPower:parseFloat(t).toFixed(2)};case"CURRENT":return{meterCurrent:parseFloat(t).toFixed(2)};case"VOLTAGE":return{meterVoltage:parseFloat(t).toFixed(2)};case"FREQUENCY":return{meterFrequency:parseFloat(t).toFixed(2)};}return null;}},DIMMER_TRANSMITTER:{map:[{dpt:"LEVEL",state:["dimmerTLevel"],event:["dimmerTLevel"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){var a=null;switch(e){case"LEVEL":a={dimmerTLevel:Math.round(100*parseFloat(t))};break;case"COLOR":a={dimmerTColor:["off","blue","green","torqoise","red","purple","yellow","white"][parseInt(t)]};}return a;}},DIMMER_VIRTUAL_RECEIVER:{map:[{dpt:"LEVEL",state:["dimmerLevel"],event:["dimmerLevel"],command:["dimOff","dimUp","dimDown","dimTo","toggleTo"]},{dpt:"COLOR",state:["dimmerColor"],event:["dimmerColor"],command:["colorTo"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){var a=null;if("LEVEL"===e)a={dimmerLevel:Math.round(100*parseFloat(t))};return a;},executeCommand:function executeCommand(t,a,r,n,i){if(n){var s,o;if("dimOff"==n.substr(0,6))s="dimOff";else if("dimUp"==n.substr(0,5))s="dimUp",o=n.substr(5);else if("dimDown"==n.substr(0,7))s="dimDown",o=n.substr(7);else if("dimTo"==n.substr(0,5)){if(s="dimTo",!(o=n.substr(5)))return void(i&&i(new Error("dimTo has no value")));}else if("toggleTo"==n.substr(0,8)){if(s="toggleTo",!(o=n.substr(8)))return void(i&&i(new Error("toggleTo has no value")));}else if("colorTo"==n.substr(0,7)&&(s="colorTo",!(o=n.substr(7))))return void(i&&i(new Error("colorTo has no value")));var c=e.getDptFromCommand.call(this,s);if(c)switch(s){case"dimOff":t.writeValue(a,r,c,{type:"double",value:0},i);break;case"dimUp":o||(o=10),o=parseInt(o)/100,t.getState({"interface":a,channel:r,datapoint:c},function(e,n){e?i&&i(e):void 0!==n&&null!=n?((o=n.value+o)>1&&(o=1),t.writeValue(a,r,c,{type:"double",value:o},i)):i&&i(new Error("get dimmer current value return invalid"));});break;case"dimDown":o||(o=10),o=parseInt(o)/100,t.getState({"interface":a,channel:r,datapoint:c},function(e,n){e?i&&i(e):void 0!==n&&null!=n?((o=n.value-o)<0&&(o=0),t.writeValue(a,r,c,{type:"double",value:o},i)):i&&i(new Error("get dimmer current value return invalid"));});break;case"toggleTo":o=parseInt(o)/100,t.getState({"interface":a,channel:r,datapoint:c},function(e,n){e?i&&i(e):n?(n.value&&(o=0),t.writeValue(a,r,c,{type:"double",value:o},i)):i&&i(new Error("get switch current value return invalid"));});break;case"dimTo":o=parseInt(o)/100,t.writeValue(a,r,c,{type:"double",value:o},i);break;case"colorTo":o=o.toLowerCase();if(-1==(o=["off","blue","green","torqoise","red","purple","yellow","white"].indexOf(o)))return void(i&&i(new Error("unknown color")));t.writeValue(a,r,c,{type:"double",value:o},i);break;default:i&&i(new Error("no such command"));}else i&&i(new Error("can not find datapoint for command:"+n));}else i&&i(new Error("command in null"));}},MOTIONDETECTOR_TRANSCEIVER:{map:[{dpt:"RESET_MOTION",command:["reset"]},{dpt:"MOTION",state:["state"],event:["state"]},{dpt:"ILLUMINATION",state:["illumination"],event:["illumination"]},{dpt:"MOTION_DETECTION_ACTIVE",state:["active"],event:["active"],command:["activate","deactivate","toggleActivate"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){var a=null;switch(e){case"MOTION":a={state:t?"on":"off"};break;case"ILLUMINATION":a={illumination:t};break;case"MOTION_DETECTION_ACTIVE":a={active:t};}return a;},executeCommand:function executeCommand(t,a,r,n,i){if(n){var s=e.getDptFromCommand.call(this,n);if(s)switch(n){case"reset":case"activate":t.writeValue(a,r,s,!0,i);break;case"deactivate":t.writeValue(a,r,s,!1,i);break;case"toggleActivate":t.getState({"interface":a,channel:r,datapoint:s},function(e,n){if(e)i&&i(e);else if(n){var o=!0;n.value&&(o=!1),t.writeValue(a,r,s,o,i);}else i&&i(new Error("get switch current value return invalid"));});break;default:i&&i(new Error("no such command"));}else i&&i(new Error("can not find datapoint for command:"+n));}else i&&i(new Error("command in null"));}},KEY_TRANRECEIVER:{map:[{dpt:"PRESS_SHORT",event:["pressShort"]},{dpt:"PRESS_LONG",event:["pressLong"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){var a=null;switch(e){case"PRESS_SHORT":a={pressShort:!0};break;case"PRESS_LONG":a={pressLong:!0};}return a;}},ALARM_SWITCH_VIRTUAL_RECEIVER:{map:[{dpt:"ACOUSTIC_ALARM_SELECTION",command:["setAudio"]},{dpt:"OPTICAL_ALARM_SELECTION",command:["setVisual"]},{dpt:"DURATION_UNIT",command:["setDuraionUnit"]},{dpt:"DURATION_VALUE",command:["setDuraion"]},{dpt:"STATE",state:["state"],event:["state"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){var a=null;if("STATE"===e)a=1==t?{state:"on"}:0==t?{state:"off"}:{state:"?"};return a;},executeCommand:function executeCommand(t,a,r,n,i){if(n){var s,o=null;if("triggerAlarm"!=n.substr(0,12)||(o="triggerAlarm",s=n.substr(12))){if(e.getDptFromCommand.call(this,o)||"triggerAlarm"==o){if("triggerAlarm"===o){var c=s.split(",");if(c.length<4)return void(i&&i(new Error("triggerAlarm format invalid")));t.writeValue(a,r,"ACOUSTIC_ALARM_SELECTION",{type:"double",value:parseInt(c[0])},function(e,n){e?i&&i(e):t.writeValue(a,r,"OPTICAL_ALARM_SELECTION",{type:"double",value:parseInt(c[1])},function(e,n){e?i&&i(e):t.writeValue(a,r,"DURATION_VALUE",{type:"double",value:parseInt(c[2])},function(e,n){e?i&&i(e):t.writeValue(a,r,"DURATION_UNIT",{type:"double",value:parseInt(c[3])},i);});});});}else i&&i(new Error("no such command"));}else i&&i(new Error("can not find datapoint for command:"+n));}else i&&i(new Error("triggerAlarm format invalid"));}else i&&i(new Error("command in null"));}},HEATING_CLIMATECONTROL_TRANSCEIVER:{map:[{dpt:"SET_POINT_TEMPERATURE",command:["tempTo","tempUp","tempDown"],state:["state"],event:["state"]},{dpt:"HUMIDITY",state:["hum"],event:["hum"]},{dpt:"CONTROL_MODE",command:["auto","manu"]},{dpt:"FROST_PROTECTION",state:["frost"],event:["frost"]},{dpt:"SET_POINT_MODE",state:["mode"],event:["mode"]},{dpt:"ACTIVE_PROFILE",command:["setProfile"],state:["profile"],event:["profile"]},{dpt:"WINDOW_STATE",command:["winOpen","winClose"],state:["window"],event:["window"]},{dpt:"ACTUAL_TEMPERATURE",state:["temp"],event:["temp"]},{dpt:"BOOST_MODE",command:["boostOn","boostOff"],state:["boost"],event:["boost"]},{dpt:"LEVEL",command:["setValve","valveUp","valveDown"],state:["valve"],event:["valve"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){var a={};switch(e){case"ACTIVE_PROFILE":a.profile=parseInt(t);break;case"ACTUAL_TEMPERATURE":a.temp=parseFloat(t);break;case"BOOST_MODE":a.boost=t;break;case"FROST_PROTECTION":a.frost=t;break;case"HUMIDITY":a.hum=parseInt(t);break;case"SET_POINT_MODE":0==t?a.mode="auto":1==t&&(a.mode="manu");break;case"SET_POINT_TEMPERATURE":a.state=parseFloat(t);break;case"LEVEL":a.valve=Math.round(100*parseFloat(t));break;case"WINDOW_STATE":switch(t){case 0:a.window="closed";break;case 1:a.window="open";}break;default:return null;}return a;},executeCommand:function executeCommand(t,a,r,n,i){if(n){var s,o=n;if("tempTo"==n.substr(0,6)){if(o="tempTo",!(s=n.substr(6)))return void(i&&i(new Error("tempTo has no value")));}else if("tempUp"==n.substr(0,6))o="tempUp",s=n.substr(6);else if("tempDown"==n.substr(0,8))o="tempDown",s=n.substr(8);else if("setProfile"==n.substr(0,10)){if(o="setProfile",!(s=n.substr(10)))return void(i&&i(new Error("setProfile has no value")));}else if("setValve"==n.substr(0,8)){if(o="setValve",!(s=n.substr(8)))return void(i&&i(new Error("setValve has no value")));}else"valveUp"==n.substr(0,7)?(o="valveUp",s=n.substr(7)):"valveDown"==n.substr(0,9)&&(o="valveDown",s=n.substr(9));var c=e.getDptFromCommand.call(this,o);if(c)switch(o){case"tempTo":if(s=parseFloat(s),isNaN(s))return void(i&&i(new Error("tempTo value invalid")));s>30.5&&(s=30.5),s<4.5&&(s=4.5),t.writeValue(a,r,c,{type:"double",value:s},i);break;case"tempUp":if(s||(s=1),s=parseFloat(s),isNaN(s))return void(i&&i(new Error("tempUp value invalid")));t.getState({"interface":a,channel:r,datapoint:c},function(e,n){e?i&&i(e):void 0!==n&&null!=n?((s=n.value+s)>30.5&&(s=30.5),t.writeValue(a,r,c,{type:"double",value:s},i)):i&&i(new Error("get dimmer current value return invalid"));});break;case"tempDown":if(s||(s=1),s=parseFloat(s),isNaN(s))return void(i&&i(new Error("tempDown value invalid")));t.getState({"interface":a,channel:r,datapoint:c},function(e,n){e?i&&i(e):void 0!==n&&null!=n?((s=n.value-s)<4.5&&(s=4.5),t.writeValue(a,r,c,{type:"double",value:s},i)):i&&i(new Error("get dimmer current value return invalid"));});break;case"auto":t.writeValue(a,r,c,{type:"double",value:0},i);break;case"manu":t.writeValue(a,r,c,{type:"double",value:1},i);break;case"setProfile":if(s=parseInt(s),isNaN(s))return void(i&&i(new Error("setTemp value invalid")));t.writeValue(a,r,c,s,i);break;case"winOpen":t.writeValue(a,r,c,1,i);break;case"winClose":t.writeValue(a,r,c,0,i);break;case"boostOn":t.writeValue(a,r,c,!0,i);break;case"boostOff":t.writeValue(a,r,c,!1,i);break;case"setValve":if(s=parseInt(s),isNaN(s))return void(i&&i(new Error("setValve value invalid")));(s/=100)>1&&(s=1),s<0&&(s=0),t.writeValue(a,r,c,{type:"double",value:s},i);break;case"valveUp":if(s||(s=10),s=parseInt(s),isNaN(s))return void(i&&i(new Error("tempUp value invalid")));s/=100,t.getState({"interface":a,channel:r,datapoint:c},function(e,n){e?i&&i(e):void 0!==n&&null!=n?((s=n.value+s)>1&&(s=1),t.writeValue(a,r,c,{type:"double",value:s},i)):i&&i(new Error("get dimmer current value return invalid"));});break;case"valveDown":if(s||(s=10),s=parseInt(s),isNaN(s))return void(i&&i(new Error("tempUp value invalid")));s/=100,t.getState({"interface":a,channel:r,datapoint:c},function(e,n){e?i&&i(e):void 0!==n&&null!=n?((s=n.value-s)<0&&(s=0),t.writeValue(a,r,c,{type:"double",value:s},i)):i&&i(new Error("get dimmer current value return invalid"));});break;default:i&&i(new Error("no such command"));}else i&&i(new Error("can not find datapoint for command:"+n));}else i&&i(new Error("command in null"));}},SHUTTER_CONTACT_TRANSCEIVER:{map:[{dpt:"STATE",state:["state"],event:["state"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){var a=null;if("STATE"===e)a={state:0==t?"closed":"open"};return a;}},SMOKE_DETECTOR:{map:[{dpt:"SMOKE_DETECTOR_COMMAND",command:["reservedAlarmOff","intrusionAlarmOff","intrusionAlarmOn","smokeTest","commTest","commTestRepeated"]},{dpt:"SMOKE_DETECTOR_ALARM_STATUS",state:["state"],event:["state"]},{dpt:"SMOKE_DETECTOR_ALARM_STATUS",state:["alarmDetail"],event:["alarmDetail"]},{dpt:"SMOKE_DETECTOR_TEST_RESULT",state:["testResult"],event:["testResult"]},{dpt:"ERROR_CODE",state:["error"],event:["error"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){var a=null;switch(e){case"SMOKE_DETECTOR_ALARM_STATUS":(a={state:0==t?"ok":"smoke"}).alarmDetail=t;break;case"SMOKE_DETECTOR_TEST_RESULT":switch(t){case 0:a={testResult:"none"};break;case 1:a={testResult:"smoke_ok"};break;case 2:a={testResult:"smoke_nok"};break;case 3:a={testResult:"comm_sent"};break;case 4:a={testResult:"comm_ok"};}break;case"ERROR_CODE":a={error:t};}return a;},executeCommand:function executeCommand(t,a,r,n,i){if(n){var s,o=e.getDptFromCommand.call(this,n);if(o)switch(n){case"reservedAlarmOff":case"intrusionAlarmOff":case"intrusionAlarmOn":case"smokeTest":case"commTest":case"commTestRepeated":switch(n){case"reservedAlarmOff":s=0;break;case"intrusionAlarmOff":s=1;break;case"intrusionAlarmOn":s=2;break;case"smokeTest":s=3;break;case"commTest":s=4;break;case"commTestRepeated":s=5;}t.writeValue(a,r,o,s,i);break;default:i&&i(new Error("no such command"));}else i&&i(new Error("can not find datapoint for command:"+n));}else i&&i(new Error("command in null"));}},ROTARY_HANDLE_TRANSCEIVER:{map:[{dpt:"STATE",state:["state"],event:["state"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){var a=null;if("STATE"===e)switch(t){case 0:a={state:"closed"};break;case 1:a={state:"tilted"};break;case 2:a={state:"open"};}return a;}},SHUTTER_TRANSMITTER:{map:[{dpt:"LEVEL",state:["blindTLevel"],event:["blindTLevel"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){var a=null;if("LEVEL"===e)a={blindTLevel:Math.round(100*parseFloat(t))};return a;}},SHUTTER_VIRTUAL_RECEIVER:{map:[{dpt:"STOP",command:["stop"]},{dpt:"LEVEL",state:["blindLevel"],event:["blindLevel"],command:["moveUp","moveDown","stepUp","stepDown","moveTo"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){var a=null;if("LEVEL"===e)a={blindLevel:Math.round(100*parseFloat(t))};return a;},executeCommand:function executeCommand(t,a,r,n,i){if(n){var s,o;if("moveUp"==n.substr(0,6))s="moveUp";else if("moveDown"==n.substr(0,8))s="moveDown",o=n.substr(8);else if("stepUp"==n.substr(0,6))s="stepUp",o=n.substr(6);else if("stepDown"==n.substr(0,8))s="stepDown",o=n.substr(8);else if("moveTo"==n.substr(0,6)){if(s="moveTo",!(o=n.substr(6)))return void(i&&i(new Error("moveTo has no value")));}else"stop"==n.substr(0,4)&&(s="stop");var c=e.getDptFromCommand.call(this,s);if(c)switch(s){case"moveUp":t.writeValue(a,r,c,{type:"double",value:1},i);break;case"moveDown":t.writeValue(a,r,c,{type:"double",value:0},i);break;case"stop":t.writeValue(a,r,c,!0,i);break;case"stepUp":o||(o=5),o=parseInt(o)/100,t.getState({"interface":a,channel:r,datapoint:c},function(e,n){e?i&&i(e):void 0!==n&&null!=n?((o=n.value+o)>1&&(o=1),t.writeValue(a,r,c,{type:"double",value:o},i)):i&&i(new Error("get dimmer current value return invalid"));});break;case"stepDown":o||(o=5),o=parseInt(o)/100,t.getState({"interface":a,channel:r,datapoint:c},function(e,n){e?i&&i(e):void 0!==n&&null!=n?((o=n.value-o)<0&&(o=0),t.writeValue(a,r,c,{type:"double",value:o},i)):i&&i(new Error("get dimmer current value return invalid"));});break;case"moveTo":o=parseInt(o)/100,t.writeValue(a,r,c,{type:"double",value:o},i);break;default:i&&i(new Error("no such command"));}else i&&i(new Error("can not find datapoint for command:"+n));}else i&&i(new Error("command in null"));}},BLIND_TRANSMITTER:{map:[{dpt:"LEVEL",state:["blindTPos"],event:["blindTPos"]},{dpt:"LEVEL_2",state:["lamellaTPos"],event:["lamellaTPos"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){var a=null;switch(e){case"LEVEL":a={blindTPos:Math.round(100*parseFloat(t))};break;case"LEVEL_2":a={lamellaTPos:Math.round(100*parseFloat(t))};}return a;}},BLIND_VIRTUAL_RECEIVER:{map:[{dpt:"STOP",command:["stop"]},{dpt:"LEVEL",state:["blindPos"],event:["blindPos"],command:["moveUp","moveDown","stepUp","stepDown","moveTo"]},{dpt:"LEVEL_2",state:["lamellaPos"],event:["lamellaPos"],command:["lamellaUp","lamellaDown","lamellaStepUp","lamellaStepDown","lamellaTo"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){var a=null;switch(e){case"LEVEL":a={blindPos:Math.round(100*parseFloat(t))};break;case"LEVEL_2":a={lamellaPos:Math.round(100*parseFloat(t))};}return a;},executeCommand:function executeCommand(t,a,r,n,i){if(n){var s,o;if(s=n,"lamellaStepUp"==n.substr(0,13))s="lamellaStepUp",o=n.substr(13);else if("lamellaStepDown"==n.substr(0,15))s="lamellaStepDown",o=n.substr(15);else if("lamellaTo"==n.substr(0,9)){if(s="lamellaTo",!(o=n.substr(9)))return void(i&&i(new Error("lamellaTo has no value")));}else if("stepUp"==n.substr(0,6))s="stepUp",o=n.substr(6);else if("stepDown"==n.substr(0,8))s="stepDown",o=n.substr(8);else if("moveTo"==n.substr(0,6)){if(s="moveTo",!(o=n.substr(6)))return void(i&&i(new Error("moveTo has no value")));}else"stop"==n.substr(0,4)&&(s="stop");var c=e.getDptFromCommand.call(this,s);if(c)switch(s){case"moveUp":case"moveDown":t.writeValue(a,r,"LEVEL_2",{type:"double",value:"moveUp"==s?1:0},function(e){e?i&&i(e):t.writeValue(a,r,"LEVEL",{type:"double",value:"moveUp"==s?1:0},function(e){i&&i(e);});});break;case"stop":t.writeValue(a,r,c,!0,i);break;case"moveTo":o=parseInt(o)/100,t.writeValue(a,r,"LEVEL",{type:"double",value:o},i);break;case"lamellaUp":case"lamellaDown":t.getState({"interface":a,channel:r,datapoint:"LEVEL"},function(e,n){e?i&&i(e):t.writeValue(a,r,"LEVEL",{type:"double",value:n.value},function(e){e?i&&i(e):t.writeValue(a,r,"LEVEL_2",{type:"double",value:"lamellaUp"==s?1:0},function(e){i&&i(e);});});});break;case"stepUp":case"stepDown":o||(o=5),o=parseInt(o)/100,t.getState({"interface":a,channel:r,datapoint:"LEVEL"},function(e,n){e?i&&i(e):void 0!==n&&null!=n?((o="stepUp"==s?n.value+o:n.value-o)>1&&(o=1),o<0&&(o=0),t.writeValue(a,r,"LEVEL",{type:"double",value:o},i)):i&&i(new Error("get jalousie current value return invalid"));});break;case"lamellaStepUp":case"lamellaStepDown":o||(o=5),o=parseInt(o)/100,t.getState({"interface":a,channel:r,datapoint:"LEVEL"},function(e,n){if(e)i&&i(e);else if(void 0!==n&&null!=n){var c=n.value;t.getState({"interface":a,channel:r,datapoint:"LEVEL_2"},function(e,n){e?i&&i(e):void 0!==n&&null!=n?((o="lamellaStepUp"==s?n.value+o:n.value-o)>1&&(o=1),o<0&&(o=0),t.writeValue(a,r,"LEVEL_2",{type:"double",value:o},function(e){e?i&&i(e):t.writeValue(a,r,"LEVEL",{type:"double",value:c},i);})):i&&i(new Error("get jalousie current value return invalid"));});}else i&&i(new Error("get jalousie current value return invalid"));});break;case"lamellaTo":o=parseInt(o)/100,t.writeValue(a,r,"LEVEL_2",{type:"double",value:o},i);break;default:i&&i(new Error("no such command"));}else i&&i(new Error("can not find datapoint for command:"+n));}else i&&i(new Error("command in null"));}},PRESENCEDETECTOR_TRANSCEIVER:{map:[{dpt:"RESET_PRESENCE",command:["reset"]},{dpt:"PRESENCE_DETECTION_STATE",state:["state"],event:["state"]},{dpt:"ILLUMINATION",state:["illumination"],event:["illumination"]},{dpt:"CURRENT_ILLUMINATION",state:["current_illumination"],event:["current_illumination"]},{dpt:"PRESENCE_DETECTION_ACTIVE",state:["active"],event:["active"],command:["activate","deactivate","toggleActivate"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){var a=null;switch(e){case"PRESENCE_DETECTION_STATE":a={state:t?"on":"off"};break;case"ILLUMINATION":a={illumination:t};break;case"CURRENT_ILLUMINATION":a={current_illumination:t};break;case"PRESENCE_DETECTION_ACTIVE":a={active:t};}return a;},executeCommand:function executeCommand(t,a,r,n,i){if(n){var s=e.getDptFromCommand.call(this,n);if(s)switch(n){case"reset":case"activate":t.writeValue(a,r,s,!0,i);break;case"deactivate":t.writeValue(a,r,s,!1,i);break;case"toggleActivate":t.getState({"interface":a,channel:r,datapoint:s},function(e,n){if(e)i&&i(e);else if(n){var o=!0;n.value&&(o=!1),t.writeValue(a,r,s,o,i);}else i&&i(new Error("get switch current value return invalid"));});break;default:i&&i(new Error("no such command"));}else i&&i(new Error("can not find datapoint for command:"+n));}else i&&i(new Error("command in null"));}},CLIMATECONTROL_FLOOR_DIRECT_TRANSMITTER:{map:[{dpt:"EMERGENCY_OPERATION",state:["cl_fd_emergencyOP"],event:["cl_fd_emergencyOP"]},{dpt:"FROST_PROTECTION",state:["cl_fd_frostProtection"],event:["cl_fd_frostProtection"]},{dpt:"STATE",state:["cl_fd_state"],event:["cl_fd_state"]},{dpt:"HUMIDITY_ALARM",state:["cl_fd_humidityAlarm"],event:["cl_fd_humidityAlarm"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){var a=null;switch(e){case"EMERGENCY_OPERATION":a={cl_fd_emergencyOP:t};break;case"FROST_PROTECTION":a={cl_fd_frostProtection:t};break;case"STATE":a=1==t?{cl_fd_state:"on"}:0==t?{cl_fd_state:"off"}:{cl_fd_state:"?"};break;case"HUMIDITY_ALARM":a={cl_fd_humidityAlarm:t};}return a;}},CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER:{map:[{dpt:"HUMIDITY_LIMITER",state:["cl_fp_humidityLimiter"],event:["cl_fp_humidityLimiter"]},{dpt:"EMERGENCY_OPERATION",state:["cl_fp_emergencyOP"],event:["cl_fp_emergencyOP"]},{dpt:"FROST_PROTECTION",state:["cl_fp_frostProtection"],event:["cl_fp_frostProtection"]},{dpt:"STATE",state:["cl_fp_state"],event:["cl_fp_state"]},{dpt:"DEW_POINT_ALARM",state:["cl_fp_dewPointAlarm"],event:["cl_fp_dewPointAlarm"]},{dpt:"EXTERNAL_CLOCK",state:["cl_fp_externalClock"],event:["cl_fp_externalClock"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){var a=null;switch(e){case"HUMIDITY_LIMITER":a={cl_fp_humidityLimiter:t};break;case"EMERGENCY_OPERATION":a={cl_fp_emergencyOP:t};break;case"FROST_PROTECTION":a={cl_fp_frostProtection:t};break;case"STATE":a=1==t?{cl_fp_state:"on"}:0==t?{cl_fp_state:"off"}:{cl_fp_state:"?"};break;case"DEW_POINT_ALARM":a={cl_fp_dewPointAlarm:t};break;case"EXTERNAL_CLOCK":a={cl_fp_externalClock:t};}return a;}},CLIMATECONTROL_FLOOR_TRANSCEIVER:{map:[{dpt:"HUMIDITY_LIMITER",state:["cl_f_humidityLimiter"],event:["cl_f_humidityLimiter"]},{dpt:"EMERGENCY_OPERATION",state:["cl_f_emergencyOP"],event:["cl_f_emergencyOP"]},{dpt:"FROST_PROTECTION",state:["cl_f_frostProtection"],event:["cl_f_frostProtection"]},{dpt:"STATE",state:["cl_f_state"],event:["cl_f_state"]},{dpt:"DEW_POINT_ALARM",state:["cl_f_dewPointAlarm"],event:["cl_f_dewPointAlarm"]},{dpt:"EXTERNAL_CLOCK",state:["cl_f_externalClock"],event:["cl_f_externalClock"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){var a=null;switch(e){case"HUMIDITY_LIMITER":a={cl_f_humidityLimiter:t};break;case"EMERGENCY_OPERATION":a={cl_f_emergencyOP:t};break;case"FROST_PROTECTION":a={cl_f_frostProtection:t};break;case"STATE":a=1==t?{cl_f_state:"on"}:0==t?{cl_f_state:"off"}:{cl_f_state:"?"};break;case"DEW_POINT_ALARM":a={cl_f_dewPointAlarm:t};break;case"EXTERNAL_CLOCK":a={cl_f_externalClock:t};}return a;}},WEATHER_TRANSMIT:{map:[{dpt:"ACTUAL_TEMPERATURE",state:["weatherActualTemp"],event:["weatherActualTemp"]},{dpt:"HUMIDITY",state:["weatherHum"],event:["weatherHum"]},{dpt:"ILLUMINATION",state:["weatherIllu"],event:["weatherIllu"]},{dpt:"SUNSHINEDURATION",state:["weatherSunD"],event:["weatherSunD"]},{dpt:"SUNSHINEDURATION_OVERFLOW",state:["weatherSunDOF"],event:["weatherSunDOF"]},{dpt:"SUNSHINE_THRESHOLD_OVERRUN",state:["weatherSunTOR"],event:["weatherSunTOR"]},{dpt:"WIND_SPEED",state:["weatherWindS"],event:["weatherWindS"]},{dpt:"WIND_THRESHOLD_OVERRUN",state:["weatherWindTOR"],event:["weatherWindTOR"]},{dpt:"WIND_DIR",state:["weatherWindD"],event:["weatherWindD"]},{dpt:"WIND_DIR_RANGE",state:["weatherWindDR"],event:["weatherWindDR"]},{dpt:"RAINING",state:["weatherRain"],event:["weatherRain"]},{dpt:"RAIN_COUNTER",state:["weatherRainC"],event:["weatherRainC"]},{dpt:"RAIN_COUNTER_OVERFLOW",state:["weatherRainCOF"],event:["weatherRainCOF"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){var a=null;switch(e){case"ACTUAL_TEMPERATURE":a={weatherActualTemp:t};break;case"HUMIDITY":a={weatherHum:t};break;case"ILLUMINATION":a={weatherIllu:t};break;case"SUNSHINEDURATION":a={weatherSunD:t};break;case"SUNSHINEDURATION_OVERFLOW":a={weatherSunDOF:t};break;case"SUNSHINE_THRESHOLD_OVERRUN":a={weatherSunTOR:t};break;case"WIND_SPEED":a={weatherWindS:t};break;case"WIND_THRESHOLD_OVERRUN":a={weatherWindTOR:t};break;case"RAINING":a={weatherRain:t};break;case"RAIN_COUNTER":a={weatherRainC:t};break;case"RAIN_COUNTER_OVERFLOW":a={weatherRainCOF:t};break;case"WIND_DIR":a={weatherWindD:t};break;case"WIND_DIR_RANGE":a={weatherWindDR:t};}return a;}},CLIMATE_TRANSCEIVER:{map:[{dpt:"ACTUAL_TEMPERATURE",state:["temperature"],event:["temperature"]},{dpt:"HUMIDITY",state:["humidity"],event:["humidity"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){var a=null;switch(e){case"ACTUAL_TEMPERATURE":a={temperature:t};break;case"HUMIDITY":a={humidity:t};}return a;}},PASSAGE_DETECTOR_DIRECTION_TRANSMITTER:{map:[{dpt:"CURRENT_PASSAGE_DIRECTION",state:["current_direction"],event:["current_direction"]},{dpt:"LAST_PASSAGE_DIRECTION",state:["last_direction"],event:["last_direction"]},{dpt:"PASSAGE_COUNTER_OVERFLOW",state:["passage_counter_overflow"],event:["passage_counter_overflow"]},{dpt:"PASSAGE_COUNTER_VALUE",state:["passage_counter"],event:["passage_counter"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){var a=null;switch(e){case"CURRENT_PASSAGE_DIRECTION":a={current_direction:t};break;case"LAST_PASSAGE_DIRECTION":a={last_direction:t};break;case"PASSAGE_COUNTER_OVERFLOW":a={passage_counter_overflow:t};break;case"PASSAGE_COUNTER_VALUE":a={passage_counter:t};}return a;}},GENERIC_INPUT_TRANSMITER:{map:[{dpt:"CHANGE_OVER",state:["genInputChangeOver"],event:["genInputChangeOver"]},{dpt:"EXTERNAL_CLOCK",state:["genInputExtClock"],event:["genInputExtClock"]},{dpt:"HUMIDITY_LIMITER",state:["genInputHumidityLimiter"],event:["genInputHumidityLimiter"]},{dpt:"STATE",state:["genInputState"],event:["genInputState"]},{dpt:"TACTILE_SWITCH",state:["genInputTactileSwitch"],event:["genInputTactileSwitch"]},{dpt:"TEMPERATURE_LIMITER",state:["genInputTempLimiter"],event:["genInputTempLimiter"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){var a=null;switch(e){case"CHANGE_OVER":a={genInputChangeOver:t};break;case"EXTERNAL_CLOCK":a={genInputExtClock:t};break;case"HUMIDITY_LIMITER":a={genInputHumidityLimiter:t};break;case"STATE":a=1==t?{genInputState:"on"}:0==t?{genInputState:"off"}:{genInputState:"?"};break;case"TACTILE_SWITCH":a={genInputTactileSwitch:t};break;case"TEMPERATURE_LIMITER":a={genInputTempLimiter:t};}return a;}},ANALOG_OUTPUT_TRANSCEIVER:{map:[{dpt:"LEVEL",state:["outputLevel"],event:["outputLevel"],command:["outputOff","outputUp","outputDown","outputTo","toggleTo"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){var a=null;if("LEVEL"===e)a={outputLevel:Math.round(100*parseFloat(t))};return a;},executeCommand:function executeCommand(t,a,r,n,i){if(n){var s,o;if("outputOff"==n.substr(0,9))s="outputOff";else if("outputUp"==n.substr(0,8))s="outputUp",o=n.substr(8);else if("outputDown"==n.substr(0,10))s="outputDown",o=n.substr(10);else if("outputTo"==n.substr(0,8)){if(s="outputTo",!(o=n.substr(8)))return void(i&&i(new Error("outputTo has no value")));}else if("toggleTo"==n.substr(0,8)){if(s="toggleTo",!(o=n.substr(8)))return void(i&&i(new Error("toggleTo has no value")));}else isNaN(parseInt(n))||(s="outputTo",o=parseInt(n));var c=e.getDptFromCommand.call(this,s);if(c)switch(s){case"outputOff":t.writeValue(a,r,c,{type:"double",value:0},i);break;case"outputUp":o||(o=10),o=parseInt(o)/100,t.getState({"interface":a,channel:r,datapoint:c},function(e,n){e?i&&i(e):void 0!==n&&null!=n?((o=n.value+o)>1&&(o=1),t.writeValue(a,r,c,{type:"double",value:o},i)):i&&i(new Error("get dimmer current value return invalid"));});break;case"outputDown":o||(o=10),o=parseInt(o)/100,t.getState({"interface":a,channel:r,datapoint:c},function(e,n){e?i&&i(e):void 0!==n&&null!=n?((o=n.value-o)<0&&(o=0),t.writeValue(a,r,c,{type:"double",value:o},i)):i&&i(new Error("get dimmer current value return invalid"));});break;case"toggleTo":o=parseInt(o)/100,t.getState({"interface":a,channel:r,datapoint:c},function(e,n){e?i&&i(e):n?(n.value&&(o=0),t.writeValue(a,r,c,{type:"double",value:o},i)):i&&i(new Error("get switch current value return invalid"));});break;case"outputTo":o=parseInt(o)/100,t.writeValue(a,r,c,{type:"double",value:o},i);break;default:i&&i(new Error("no such command"));}else i&&i(new Error("can not find datapoint for command:"+n));}else i&&i(new Error("command in null"));}},WATER_DETECTION_TRANSMITTER:{map:[{dpt:"ALARMSTATE",state:["alarm"],event:["alarm"]},{dpt:"MOISTURE_DETECTED",state:["moisture"],event:["moisture"]},{dpt:"WATERLEVEL_DETECTED",state:["water"],event:["water"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){var a=null;switch(e){case"ALARMSTATE":a={alarm:t};break;case"MOISTURE_DETECTED":a={moisture:t};break;case"WATERLEVEL_DETECTED":a={water:t};}return a;}},ACCELERATION_TRANSCEIVER:{map:[{dpt:"MOTION",state:["motion"],event:["motion"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){var a=null;if("MOTION"===e)a={motion:t};return a;}},DOOR_RECEIVER:{map:[{dpt:"DOOR_STATE",state:["doorState"],event:["doorState"]},{dpt:"DOOR_COMMAND",command:["open","close","partialOpen","stop"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){var a=null;if("DOOR_STATE"===e)a=0==(t=parseInt(t))?{doorState:"closed"}:1==t?{doorState:"open"}:2==t?{doorState:"ventilation"}:{doorState:"unknown"};return a;},executeCommand:function executeCommand(t,a,r,n,i){if(n){var s=e.getDptFromCommand.call(this,n);if(s)switch(n){case"open":t.writeValue(a,r,s,{type:"double",value:1},i);break;case"stop":t.writeValue(a,r,s,{type:"double",value:2},i);break;case"close":t.writeValue(a,r,s,{type:"double",value:3},i);break;case"partialOpen":t.writeValue(a,r,s,{type:"double",value:4},i);break;default:i&&i(new Error("no such command"));}else i&&i(new Error("can not find datapoint for command:"+n));}else i&&i(new Error("command in null"));}},SIMPLE_SWITCH_RECEIVER:{map:[{dpt:"STATE",state:["state"],event:["state"],command:["on","off","toggle"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){var a=null;if("STATE"===e)a=1==t?{state:"on"}:0==t?{state:"off"}:{state:"?"};return a;},executeCommand:function executeCommand(t,a,r,n,i){var s=e.getDptFromCommand.call(this,n);if(s)switch(n){case"on":t.writeValue(a,r,s,!0,i);break;case"off":t.writeValue(a,r,s,!1,i);break;case"toggle":t.getState({"interface":a,channel:r,datapoint:s},function(e,n){if(e)i&&i(e);else if(n){var o=!0;n.value&&(o=!1),t.writeValue(a,r,s,o,i);}else i&&i(new Error("get switch current value return invalid"));});break;default:i&&i(new Error("no such command"));}else i&&i(new Error("can not find datapoint for command:"+n));}},MULTI_MODE_INPUT_TRANSMITTER:{map:[{dpt:"STATE",state:["state"],event:["state"]},{dpt:"PRESS_SHORT",event:["pressShort"]},{dpt:"PRESS_LONG",event:["pressLong"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){var a=null;switch(e){case"STATE":a=1==t?{state:"on"}:0==t?{state:"off"}:{state:"?"};break;case"PRESS_SHORT":a={pressShort:!0};break;case"PRESS_LONG":a={pressLong:!0};}return a;}},BRIGHTNESS_TRANSMITTER:{map:[{dpt:"AVERAGE_ILLUMINATION",state:["avgIllu"],event:["avgIllu"]},{dpt:"CURRENT_ILLUMINATION",state:["illu"],event:["illu"]},{dpt:"HIGHEST_ILLUMINATION",state:["maxIllu"],event:["maxIllu"]},{dpt:"LOWEST_ILLUMINATION",state:["minIllu"],event:["minIllu"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){var a=null;switch(e){case"AVERAGE_ILLUMINATION":a={avgIllu:parseFloat(parseFloat(t).toFixed(2))};break;case"CURRENT_ILLUMINATION":a={illu:parseFloat(parseFloat(t).toFixed(2))};break;case"HIGHEST_ILLUMINATION":a={maxIllu:parseFloat(parseFloat(t).toFixed(2))};break;case"LOWEST_ILLUMINATION":a={minIllu:parseFloat(parseFloat(t).toFixed(2))};}return a;}},POWER_MAINS_TRANSMITTER:{map:[{dpt:"POWER_MAINS_FAILURE",state:["powerMainsFailure"],event:["powerMainsFailure"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){var a=null;if("POWER_MAINS_FAILURE"===e)a={powerMainsFailure:t};return a;}},ANALOG_INPUT_TRANSMITTER:{map:[{dpt:"VOLTAGE",state:["voltage"],event:["voltage"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){var a=null;if("VOLTAGE"===e)a={voltage:parseFloat(t)};return a;}}},"BidCos-RF":{MAINTENANCE:{device:"maintenance",map:[{dpt:"LOWBAT",state:["lowbat"],event:["lowbat"]},{dpt:"UNREACH",state:["timeout"],event:["timeout"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){switch(e){case"LOWBAT":return{lowbat:t};case"UNREACH":return{timeout:t};default:return null;}}},KEY:{device:"button",map:[{dpt:"PRESS_SHORT",event:["pressShort"],command:["pressShort"]},{dpt:"PRESS_LONG",event:["pressLong"],command:["pressLong"]},{dpt:"PRESS_LONG_RELEASE",event:["pressLongRel"]},{dpt:"PRESS_CONT",event:["pressCont"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){switch(e){case"PRESS_SHORT":return{pressShort:t};case"PRESS_LONG":return{pressLong:t};case"PRESS_CONT":return{pressCont:t};case"PRESS_LONG_RELEASE":return{pressLongRel:t};default:return null;}},executeCommand:function executeCommand(t,a,r,n,i){var s=e.getDptFromCommand.call(this,n);switch(n){case"pressShort":case"pressLong":t.writeValue(a,r,s,!0,i);break;default:i&&i(new Error("no such command"));}}},SWITCH_INTERFACE:{device:"switch_interface",map:[{dpt:"PRESS",event:["press"],command:["press"]}],parseDptState:function parseDptState(e,t){return"PRESS"===e?{press:!0}:null;},executeCommand:function executeCommand(t,a,r,n,i){var s=e.getDptFromCommand.call(this,n);if("press"===n)t.writeValue(a,r,s,!0,i);else i&&i(new Error("no such command"));}},SHUTTER_CONTACT:{device:"contact",map:[{dpt:"STATE",state:["state"],event:["state"]},{dpt:"ERROR",state:["error"],event:["error"]},{dpt:"LOWBAT",state:["lowbat"],event:["lowbat"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){switch(e){case"STATE":return{state:t?"open":"closed"};case"ERROR":return{error:1==t?"sabotage":"no_error"};case"LOWBAT":return{lowbat:t};default:return null;}}},JALOUSIE:{device:"jalousie",map:[{dpt:"LEVEL",state:["jalState"],event:["jalState"],command:["moveUp","moveDown","stepUp","stepDown","%d"]},{dpt:"STOP",command:["stop"]},{dpt:"LEVEL_SLATS",state:["jalLmlState"],event:["jalLmlState"],command:["lamellaUp","lamellaDown","lamellaStepUp","lamellaStepDown","lamellaTo%d"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){var a=null;switch(e){case"LEVEL":a={jalState:t=Math.round(100*parseFloat(t))};break;case"LEVEL_SLATS":a={jalLmlState:t=Math.round(100*parseFloat(t))};}return a;},executeCommand:function executeCommand(t,a,r,n,i){var s=e.getDptFromCommand.call(this,n);switch(n){case"moveUp":case"lamellaUp":t.writeValue(a,r,s,{type:"double",value:1},i);break;case"moveDown":case"lamellaDown":t.writeValue(a,r,s,{type:"double",value:0},i);break;case"stepUp":t.getState({"interface":a,channel:r,datapoint:s},function(e,n){if(e)i&&i(e);else if(n){var o=n.value+.05;o>1&&(o=1),t.writeValue(a,r,s,{type:"double",value:o},function(e){e?i&&i(e):(t.updateStatusBuffer(a,r,s,o,new Date().getTime()+1e3),i&&i());});}else i&&i(new Error("get current jalousie state result invalid"));});break;case"stepDown":t.getState({"interface":a,channel:r,datapoint:s},function(e,n){if(e)i&&i(e);else if(n){var o=n.value-.05;o<0&&(o=0),t.writeValue(a,r,s,{type:"double",value:o},function(e){e?i&&i(e):(t.updateStatusBuffer(a,r,s,o,new Date().getTime()+1e3),i&&i());});}else i&&i(new Error("get current blind state result invalid"));});break;case"stop":t.writeValue(a,r,s,!0,i);break;case"lamellaStepUp":t.getState({"interface":a,channel:r,datapoint:s},function(e,n){if(e)i&&i(e);else if(n){var o=n.value+.05;o>1&&(o=1),t.writeValue(a,r,s,{type:"double",value:o},function(e){e?i&&i(e):(t.updateStatusBuffer(a,r,s,o,new Date().getTime()+1e3),i&&i());});}else i&&i(new Error("get current lamella state result invalid"));});break;case"lamellaStepDown":t.getState({"interface":a,channel:r,datapoint:s},function(e,n){if(e)i&&i(e);else if(n){var o=n.value-.05;o<0&&(o=0),t.writeValue(a,r,s,{type:"double",value:o},function(e){e?i&&i(e):(t.updateStatusBuffer(a,r,s,o,new Date().getTime()+1e3),i&&i());});}else i&&i(new Error("get current lamella state result invalid"));});break;default:var o;"lamellaTo"==n.substr(0,9)?(n=n.substr(9),o=parseInt(n),o/=100,s="LEVEL_SLATS",t.writeValue(a,r,s,{type:"double",value:o},function(e){e?i&&i(e):(t.updateStatusBuffer(a,r,s,o,new Date().getTime()+1e3),i&&i());})):"moveTo"==n.substr(0,6)||n.match(/^[-+]?[0-9]+$/)?("moveTo"==n.substr(0,6)&&(n=n.substr(6)),o=parseInt(n),o/=100,s="LEVEL",t.writeValue(a,r,s,{type:"double",value:o},function(e){e?i&&i(e):(t.updateStatusBuffer(a,r,s,o,new Date().getTime()+1e3),i&&i());})):i&&i(new Error("no such command"));}}},MOD_EM8BIT_TRANSMITTER:{map:[{dpt:"STATE",state:["state8bit"],event:["state8bit"]},{dpt:"LOWBAT",state:["lowbat"],event:["lowbat"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){var a=null;switch(e){case"STATE":a={state8bit:t=parseInt(t)};break;case"LOWBAT":a={lowbat:t};}return a;}},KEYMATIC:{device:"keymatic",map:[{dpt:"STATE",state:["state"],event:["state"],command:["open","close"]},{dpt:"OPEN",command:["openDoor"]},{dpt:"STATE_UNCERTAIN",state:["uncertain"],event:["uncertain"]},{dpt:"ERROR",state:["error"],event:["error"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){switch(e){case"STATE":return{state:t?"open":"closed"};case"STATE_UNCERTAIN":return{uncertain:t};case"ERROR":switch(t){case 0:t="no_error";break;case 1:t="cluth_failure";break;case 2:t="motor_aborted";}return{error:t};}return null;},executeCommand:function executeCommand(t,a,r,n,i){var s=e.getDptFromCommand.call(this,n);switch(n){case"open":case"openDoor":t.writeValue(a,r,s,!0,i);break;case"close":t.writeValue(a,r,s,!1,i);break;default:i&&i(new Error("no such command"));}}},MOTION_DETECTOR:{device:"motion",map:[{dpt:"BRIGHTNESS",state:["bri"],event:["bri"]},{dpt:"MOTION",state:["state"],event:["state"]},{dpt:"ERROR",state:["error"],event:["error"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){var a={};switch(e){case"BRIGHTNESS":a.bri=t;break;case"MOTION":a.state=t?"motion":"ok";break;case"ERROR":a.error=t?"sabotage":"no_error";break;default:return null;}return a;}},DUAL_WHITE_BRIGHTNESS:{device:"dualwhite",map:[{dpt:"DIRECTION",state:["direction"],event:["direction"]},{dpt:"ERROR_OVERHEAT",state:["error_overheat"],event:["error_overheat"]},{dpt:"ERROR_REDUCED",state:["error_reduced"],event:["error_reduced"]},{dpt:"LEVEL",state:["bri"],event:["bri"],command:["off","dimUp","dimDown","toggle","dimTo%d"]},{dpt:"LEVEL_REAL",state:["bri_real"],event:["bri_real"]},{dpt:"OLD_LEVEL",command:["on"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){var a={};switch(e){case"DIRECTION":a.direction=t;break;case"ERROR_OVERHEAT":a.error_overheat=!!t;break;case"ERROR_REDUCED":a.error_reduced=!!t;break;case"LEVEL":a.bri=Math.round(100*parseFloat(t));break;case"LEVEL_REAL":a.bri_real=Math.round(100*parseFloat(t));break;default:return null;}return a;},executeCommand:function executeCommand(t,a,r,n,i){var s=e.getDptFromCommand.call(this,n);switch(n){case"on":t.writeValue(a,r,s,!0,i);break;case"off":t.writeValue(a,r,s,{type:"double",value:0},i);break;case"dimUp":t.getState({"interface":a,channel:r,datapoint:s},function(e,n){if(e)i&&i(e);else if(n){var o=n.value+.05;o>1&&(o=1),t.writeValue(a,r,s,{type:"double",value:o},function(e){e?i&&i(e):(t.updateStatusBuffer(a,r,s,o,new Date().getTime()+1e3),i&&i());});}else i&&i(new Error("get current jalousie state result invalid"));});break;case"dimDown":t.getState({"interface":a,channel:r,datapoint:s},function(e,n){if(e)i&&i(e);else if(n){var o=n.value-.05;o<0&&(o=0),t.writeValue(a,r,s,{type:"double",value:o},function(e){e?i&&i(e):(t.updateStatusBuffer(a,r,s,o,new Date().getTime()+1e3),i&&i());});}else i&&i(new Error("get current blind state result invalid"));});break;case"toggle":s="LEVEL",t.getState({"interface":a,channel:r,datapoint:s},function(e,n){e?i&&i(e):n?0!=n.value?t.writeValue(a,r,s,{type:"double",value:0},i):t.writeValue(a,r,"OLD_LEVEL",!0,i):i&&i(new Error("get current dimmer state result invalid"));});break;default:var o;"dimTo"==n.substr(0,5)?(n=n.substr(5),o=parseInt(n),o/=100,s="LEVEL",t.writeValue(a,r,s,{type:"double",value:o},function(e){e?i&&i(e):(t.updateStatusBuffer(a,r,s,o,new Date().getTime()+1e3),i&&i());})):i&&i(new Error("no such command"));}}},DUAL_WHITE_COLOR:{device:"dualwhite",map:[{dpt:"DIRECTION",state:["color_direction"],event:["color_direction"]},{dpt:"LEVEL",state:["color"],event:["color"],command:["colorOff","colorUp","colorDown","colorToggle","colorTo%d"]},{dpt:"LEVEL_REAL",state:["color_real"],event:["color_real"]},{dpt:"OLD_LEVEL",command:["colorOn"]}],getReadableDpts:e.getReadableDpts,getDptFromState:e.getDptFromState,parseDptState:function parseDptState(e,t){var a={};switch(e){case"DIRECTION":a.direction=t;break;case"LEVEL":a.color=Math.round(100*parseFloat(t));break;case"LEVEL_REAL":a.color_real=Math.round(100*parseFloat(t));break;default:return null;}return a;},executeCommand:function executeCommand(t,a,r,n,i){var s=e.getDptFromCommand.call(this,n);switch(n){case"colorOn":t.writeValue(a,r,s,!0,i);break;case"colorOff":t.writeValue(a,r,s,{type:"double",value:0},i);break;case"colorUp":t.getState({"interface":a,channel:r,datapoint:s},function(e,n){if(e)i&&i(e);else if(n){var o=n.value+.05;o>1&&(o=1),t.writeValue(a,r,s,{type:"double",value:o},function(e){e?i&&i(e):(t.updateStatusBuffer(a,r,s,o,new Date().getTime()+1e3),i&&i());});}else i&&i(new Error("get current jalousie state result invalid"));});break;case"colorDown":t.getState({"interface":a,channel:r,datapoint:s},function(e,n){if(e)i&&i(e);else if(n){var o=n.value-.05;o<0&&(o=0),t.writeValue(a,r,s,{type:"double",value:o},function(e){e?i&&i(e):(t.updateStatusBuffer(a,r,s,o,new Date().getTime()+1e3),i&&i());});}else i&&i(new Error("get current blind state result invalid"));});break;case"colorToggle":s="LEVEL",t.getState({"interface":a,channel:r,datapoint:s},function(e,n){e?i&&i(e):n?0!=n.value?t.writeValue(a,r,s,{type:"double",value:0},i):t.writeValue(a,r,"OLD_LEVEL",!0,i):i&&i(new Error("get current dimmer state result invalid"));});break;default:var o;"colorTo"==n.substr(0,7)?(n=n.substr(7),o=parseInt(n),o/=100,s="LEVEL",t.writeValue(a,r,s,{type:"double",value:o},function(e){e?i&&i(e):(t.updateStatusBuffer(a,r,s,o,new Date().getTime()+1e3),i&&i());})):i&&i(new Error("no such command"));}}}}};}(),x.hub.m.hm._Device=function(){var Device=function Device(e,t,a){this.deviceType=e,this.deviceIF=t,this.deviceAdr=a,this.legacyType=null;};Device.prototype.initStates=function(e,t){var a=this._getReadableDpts();this._initDptStates(e,a,t);},Device.prototype._getReadableDpts=function(){return[];},Device.prototype._getDptFromRef=function(e){return null;},Device.prototype._initDptStates=function(e,t,a){if(t&&0!=t.length){var r=0,n=this,cb=function cb(i,s){++r!=t.length?e.readValue(n.deviceIF,t[r].channel,t[r].dpt,cb):a&&a();};e.readValue(this.deviceIF,t[r].channel,t[r].dpt,cb);}else a&&a();},Device.prototype.parseDptState=function(e,t,a){return null;},Device.prototype.toLegacyAdr=function(){return this.deviceType+"."+this.deviceIF+"."+this.deviceAdr;},Device.prototype.toLegacyType=function(){return this.legacyType;},Device.prototype.getSerial=function(){var e=this.deviceAdr,t=this.deviceAdr.indexOf(":");return-1!=t&&(e=e.substr(0,t)),e;},Device.prototype.parseChnState=function(e,t){var a={};for(var r in t){var n=this.parseDptState(e,r,t[r].value);if(n){var i={},s=t[r].time;for(var o in n){i[o]={value:n[o],time:s};}a=x.hub.m.hm._Util.mergeObj(a,i);}}return a;},Device.prototype.parseStates=function(e){var t={};for(var a in e){var r=this.parseChnState(a,e[a]);r&&(t=x.hub.m.hm._Util.mergeObj(t,r));}return t;},Device.prototype.executeCommand=function(e,t,a){a&&a();},Device.prototype.getState=function(e,t,a){var r;if("timeout"===t)r={channel:this.deviceAdr+":0",dataPoint:"UNREACH"};else r=this._getDptFromRef(t);if(r){var n=this;e.getState({"interface":this.deviceIF,channel:r.channel,datapoint:r.dataPoint},function(e,i){if(e)a&&a(e);else if(i){var s=n.parseDptState(r.channel,r.dataPoint,i.value);s?a&&a(null,{value:s[t],time:i.time}):a&&a(null,null);}else a&&a(null,null);});}else a&&a(new Error("no such state"));},Device.prototype.isButton=function(){return!1;};var Maintenance=function Maintenance(e,t,a){Device.call(this,e,t,a),this.channel=0,this.legacyType="maintenance";};util.inherits(Maintenance,Device),Maintenance.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["BidCos-RF"].MAINTENANCE.getReadableDpts();return a&&a.forEach(function(a){e.push({channel:t.deviceAdr+":0",dpt:a});}),e;},Maintenance.prototype._getDptFromRef=function(e){var t={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(e){case"lowbat":t.channel=0,t.dataPoint="LOWBAT";break;case"timeout":t.channel=0,t.dataPoint="UNREACH";break;default:return null;}return t;},Maintenance.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;if(i!=this.channel)return null;var o={};return"UNREACH"==t?o.timeout=a:"LOWBAT"==t?o.lowbat=a:o["0_"+t.toLowerCase()]=a,o;};var Button=function Button(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="button";};util.inherits(Button,Device),Button.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"}];},Button.prototype._getDptFromRef=function(e){var t=this.deviceAdr;-1==t.indexOf(":")&&this.channel&&(t+=":"+this.channel);var a={channel:t,dataPoint:null};switch(e){case"lowbat":a.channel=0,a.dataPoint="LOWBAT";break;case"timeout":a.channel=0,a.dataPoint="UNREACH";break;default:return null;}return a;},Button.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;if(0!=i&&i!=this.channel)return null;if(0==i){var o={};return"UNREACH"==t?o.timeout=a:"LOWBAT"==t?o.lowbat=a:o["0_"+t.toLowerCase()]=a,o;}switch(t){case"PRESS_SHORT":return{pressShort:a};case"PRESS_LONG":return{pressLong:a};case"PRESS_CONT":return{pressCont:a};case"PRESS_LONG_RELEASE":return{pressLongRel:a};default:return null;}},Button.prototype.isButton=function(){return!0;},Button.prototype.claimEvent=function(e,t){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);var r=this;e.reportValueUsage(this.deviceIF,a,"PRESS_SHORT",function(n,i){n&&console.error("button claim PRESS_SHORT event error:"+n.stack),e.reportValueUsage(r.deviceIF,a,"PRESS_LONG",function(e,a){e&&console.error("button claim PRESS_LONG event error:"+e.stack),t&&t();});});};var VirtaulButton=function VirtaulButton(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="button";};util.inherits(VirtaulButton,Device),VirtaulButton.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"}];},VirtaulButton.prototype._getDptFromRef=function(e){var t=this.deviceAdr;-1==t.indexOf(":")&&this.channel&&(t+=":"+this.channel);var a={channel:t,dataPoint:null};switch(e){case"lowbat":a.channel=0,a.dataPoint="LOWBAT";break;case"timeout":a.channel=0,a.dataPoint="UNREACH";break;default:return null;}return a;},VirtaulButton.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;if(0!=i&&i!=this.channel)return null;if(0==i){var o={};return"UNREACH"==t?o.timeout=a:"LOWBAT"==t?o.lowbat=a:o["0_"+t.toLowerCase()]=a,o;}switch(t){case"PRESS_SHORT":return{pressShort:a};case"PRESS_LONG":return{pressLong:a};case"PRESS_CONT":return{pressCont:a};case"PRESS_LONG_RELEASE":return{pressLongRel:a};default:return null;}},VirtaulButton.prototype.isButton=function(){return!1;},VirtaulButton.prototype.claimEvent=function(e,t){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);var r=this;e.reportValueUsage(this.deviceIF,a,"PRESS_SHORT",function(n,i){n&&console.error("button claim PRESS_SHORT event error:"+n.stack),e.reportValueUsage(r.deviceIF,a,"PRESS_LONG",function(e,a){e&&console.error("button claim PRESS_LONG event error:"+e.stack),t&&t();});});};var Switch=function Switch(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="switch";};util.inherits(Switch,Device),Switch.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.channel,dpt:"WORKING"}];},Switch.prototype._getDptFromRef=function(e){var t=this.deviceAdr;-1==t.indexOf(":")&&this.channel&&(t+=":"+this.channel);var a={channel:t,dataPoint:null};switch(e){case"lowbat":a.channel=0,a.dataPoint="LOWBAT";break;case"timeout":a.channel=0,a.dataPoint="UNREACH";break;case"state":a.dataPoint="STATE";break;case"inhibit":a.dataPoint="INHIBIT";break;case"working":a.dataPoint="WORKING";break;default:return null;}return a;},Switch.prototype.executeCommand=function(e,t,a){var r,n=this.deviceAdr;-1==n.indexOf(":")&&this.channel&&(n+=":"+this.channel);var i,s=this;switch(t){case"on":r="STATE",e.writeValue(this.deviceIF,n,r,!0,a);break;case"off":r="STATE",e.writeValue(this.deviceIF,n,r,!1,a);break;case"toggle":r="STATE",e.getState({"interface":this.deviceIF,channel:n,datapoint:r},function(t,i){if(t)a&&a(t);else if(i){var o=!0;i.value&&(o=!1),e.writeValue(s.deviceIF,n,r,o,a);}else a&&a(new Error("get switch current value return invalid"));});break;default:if("onFor"==t.substr(0,5))return i=parseFloat(t.substr(5)),isNaN(i)?void(a&&a(new Error("onFor command invalid"))):(r="ON_TIME",void e.writeValue(this.deviceIF,n,r,{type:"double",value:i},function(t){t?a&&a(t):(r="STATE",e.writeValue(s.deviceIF,n,r,!0,a));}));a&&a(new Error("no such command"));}},Switch.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n,i=e.substr(0,r),s=e.substr(r+1),o=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(o=this.deviceAdr.substr(0,r)),i!=o)return null;if(0!=s&&s!=this.channel)return null;if(0==s){var c={};return"UNREACH"==t?c.timeout=a:"LOWBAT"==t?c.lowbat=a:c["0_"+t.toLowerCase()]=a,c;}switch(t){case"STATE":return 1==a?n="on":0==a&&(n="off"),{state:n};case"INHIBIT":return{inhibit:a};case"WORKING":return{working:a};default:return null;}},Switch.prototype.getConfig=function(e,t){var a=this.deviceAdr+":"+this.channel;e.getParamset(this.deviceIF,a,"MASTER",function(e,r){if(e)t&&t(e);else{var n={},i=null;r&&(i={AES_ACTIVE:r.AES_ACTIVE}),n[a]=i,t&&t(e,n);}});},Switch.prototype.setConfig=function(e,t,a){if(t){var r=this.deviceAdr+":"+this.channel,n=t[r];if(n){var i={};i.AES_ACTIVE=n.AES_ACTIVE,e.setParamset(this.deviceIF,r,"MASTER",i,function(e){a&&a(e);});}else a&&a(new Error("config data not complete"));}else a&&a(new Error("config data invalid"));};var Dimmer=function Dimmer(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="dimmer";};util.inherits(Dimmer,Device),Dimmer.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"LEVEL"}];},Dimmer.prototype._getDptFromRef=function(e){var t=this.deviceAdr;-1==t.indexOf(":")&&this.channel&&(t+=":"+this.channel);var a={channel:t,dataPoint:null};switch(e){case"timeout":a.channel=0,a.dataPoint="UNREACH";break;case"state":a.dataPoint="LEVEL";break;case"levelReal":a.dataPoint="LEVEL_REAL";break;case"inhibit":a.dataPoint="INHIBIT";break;case"working":a.dataPoint="WORKING";break;case"direction":a.dataPoint="DIRECTION";break;default:return null;}return a;},Dimmer.prototype.executeCommand=function(e,t,a){var r,n=this.deviceAdr+":"+this.channel,i=this,s=null;switch(t){case"on":r="OLD_LEVEL",e.writeValue(this.deviceIF,n,r,!0,a);break;case"off":r="LEVEL",e.writeValue(this.deviceIF,n,r,{type:"double",value:0},a);break;case"dimUp":r="LEVEL",e.getState({"interface":this.deviceIF,channel:n,datapoint:r},function(t,s){if(t)a&&a(t);else if(s){var o=s.value+.05;o>1&&(o=1),e.writeValue(i.deviceIF,n,r,{type:"double",value:o},a);}else a&&a(new Error("get current dimmer state result invalid"));});break;case"dimDown":r="LEVEL",e.getState({"interface":this.deviceIF,channel:n,datapoint:r},function(t,s){if(t)a&&a(t);else if(s){var o=s.value-.05;o<0&&(o=0),e.writeValue(i.deviceIF,n,r,{type:"double",value:o},a);}else a&&a(new Error("get current dimmer state result invalid"));});break;case"toggle":r="LEVEL",e.getState({"interface":this.deviceIF,channel:n,datapoint:r},function(t,s){t?a&&a(t):s?0!=s.value?e.writeValue(i.deviceIF,n,r,{type:"double",value:0},a):e.writeValue(i.deviceIF,n,"OLD_LEVEL",!0,a):a&&a(new Error("get current dimmer state result invalid"));});break;default:if("toggleTo"==t.substr(0,8))return s=parseInt(t.substr(8)),isNaN(s)?void(a&&a(new Error("toggleTo command invalid"))):(r="LEVEL",s/=100,void e.getState({"interface":this.deviceIF,channel:n,datapoint:r},function(t,o){if(t)a&&a(t);else if(o){var c=s;o.value&&(c=0),e.writeValue(i.deviceIF,n,r,{type:"double",value:c},a);}else a&&a(new Error("get current dimmer state result invalid"));}));"onTo"==t.substr(0,4)||t.match(/^[-+]?[0-9]+$/)?("onTo"==t.substr(0,4)&&(t=t.substr(4)),s=parseInt(t),s/=100,r="LEVEL",e.writeValue(this.deviceIF,n,r,{type:"double",value:s},a)):a&&a(new Error("no such command"));}},Dimmer.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;if(0!=i&&i!=this.channel)return null;if(0==i){var o={};return"UNREACH"==t?o.timeout=a:o["0_"+t.toLowerCase()]=a,o;}switch(t){case"LEVEL":return{state:Math.round(100*parseFloat(a))};case"LEVEL_REAL":return{levelReal:Math.round(100*parseFloat(a))};case"INHIBIT":return{inhibit:a};case"WORKING":return{working:a};case"DIRECTION":return{direction:a};default:return null;}};var Blind=function Blind(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="blind";};util.inherits(Blind,Device),Blind.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"LEVEL"},{channel:this.deviceAdr+":"+this.channel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.channel,dpt:"WORKING"},{channel:this.deviceAdr+":"+this.channel,dpt:"DIRECTION"}];},Blind.prototype._getDptFromRef=function(e){var t=this.deviceAdr;-1==t.indexOf(":")&&this.channel&&(t+=":"+this.channel);var a={channel:t,dataPoint:null};switch(e){case"timeout":a.channel=0,a.dataPoint="UNREACH";break;case"state":a.dataPoint="LEVEL";break;case"inhibit":a.dataPoint="INHIBIT";break;case"working":a.dataPoint="WORKING";break;case"direction":a.dataPoint="DIRECTION";break;default:return null;}return a;},Blind.prototype.executeCommand=function(e,t,a){var r,n=this.deviceAdr+":"+this.channel,i=this,s=0;switch("stepUpFor"==t.substr(0,9)?((s=t.substr(9))||(s=1),s=parseFloat(s),t="stepUpFor"):"stepUp"==t.substr(0,6)?((s=t.substr(6))||(s=5),s=parseInt(s)/100,t="stepUp"):"stepDownFor"==t.substr(0,11)?((s=t.substr(11))||(s=1),s=parseFloat(s),t="stepDownFor"):"stepDown"==t.substr(0,8)&&((s=t.substr(8))||(s=5),s=parseInt(s)/100,t="stepDown"),t){case"stepUp":r="LEVEL",e.getState({"interface":this.deviceIF,channel:n,datapoint:r},function(t,o){if(t)a&&a(t);else if(o){s||(s=.05);var c=o.value+s;c>1&&(c=1),e.writeValue(i.deviceIF,n,r,{type:"double",value:c},function(t){t?a&&a(t):(e.updateStatusBuffer(i.deviceIF,n,r,c,new Date().getTime()+1e3),a&&a());});}else a&&a(new Error("get current blind state result invalid"));});break;case"stepDown":r="LEVEL",e.getState({"interface":this.deviceIF,channel:n,datapoint:r},function(t,o){if(t)a&&a(t);else if(o){s||(s=.05);var c=o.value-s;c<0&&(c=0),e.writeValue(i.deviceIF,n,r,{type:"double",value:c},function(t){t?a&&a(t):(e.updateStatusBuffer(i.deviceIF,n,r,c,new Date().getTime()+1e3),a&&a());});}else a&&a(new Error("get current blind state result invalid"));});break;case"stepUpFor":r="LEVEL",e.writeValue(this.deviceIF,n,r,{type:"double",value:1},function(t){t?a&&a(t):setTimeout(function(){r="STOP",e.writeValue(i.deviceIF,n,r,!0,a);},1e3*s);});break;case"stepDownFor":r="LEVEL",e.writeValue(this.deviceIF,n,r,{type:"double",value:0},function(t){t?a&&a(t):setTimeout(function(){r="STOP",e.writeValue(i.deviceIF,n,r,!0,a);},1e3*s);});break;case"up":r="LEVEL",e.writeValue(this.deviceIF,n,r,{type:"double",value:1},a);break;case"down":r="LEVEL",e.writeValue(this.deviceIF,n,r,{type:"double",value:0},a);break;case"stop":r="STOP",e.writeValue(this.deviceIF,n,r,!0,a);break;default:if("moveTo"==t.substr(0,6)||t.match(/^[-+]?[0-9]+$/)){"moveTo"==t.substr(0,6)&&(t=t.substr(6));var o=parseInt(t);o/=100,r="LEVEL",e.writeValue(this.deviceIF,n,r,{type:"double",value:o},function(t){t?a&&a(t):(e.updateStatusBuffer(i.deviceIF,n,r,o,new Date().getTime()+1e3),a&&a());});}else a&&a(new Error("no such command"));}},Blind.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;if(0!=i&&i!=this.channel)return null;if(0==i){var o={};return"UNREACH"==t?o.timeout=a:o["0_"+t.toLowerCase()]=a,o;}switch(t){case"LEVEL":return{state:Math.round(100*parseFloat(a))};case"INHIBIT":return{inhibit:a};case"WORKING":return{working:a};case"DIRECTION":return{direction:a};default:return null;}},Blind.prototype.getConfig=function(e,t){var a=this.deviceAdr+":"+this.channel;e.getParamset(this.deviceIF,a,"MASTER",function(e,r){if(e)t&&t(e);else{var n={},i=null;r&&(i={CHANGE_OVER_DELAY:r.CHANGE_OVER_DELAY,REFERENCE_RUNNING_TIME_BOTTOM_TOP:r.REFERENCE_RUNNING_TIME_BOTTOM_TOP,REFERENCE_RUNNING_TIME_TOP_BOTTOM:r.REFERENCE_RUNNING_TIME_TOP_BOTTOM,REFERENCE_RUN_COUNTER:r.REFERENCE_RUN_COUNTER}),n[a]=i,t&&t(e,n);}});},Blind.prototype.setConfig=function(e,t,a){if(t){var r=this.deviceAdr+":"+this.channel,n=t[r];if(n){var i={};i.CHANGE_OVER_DELAY={__rpcValueType:"double",__rpcValue:n.CHANGE_OVER_DELAY},i.REFERENCE_RUNNING_TIME_BOTTOM_TOP={__rpcValueType:"double",__rpcValue:n.REFERENCE_RUNNING_TIME_BOTTOM_TOP},i.REFERENCE_RUNNING_TIME_TOP_BOTTOM={__rpcValueType:"double",__rpcValue:n.REFERENCE_RUNNING_TIME_TOP_BOTTOM},i.REFERENCE_RUN_COUNTER=n.REFERENCE_RUN_COUNTER,e.setParamset(this.deviceIF,r,"MASTER",i,function(e){a&&a(e);});}else a&&a(new Error("config data not complete"));}else a&&a(new Error("config data invalid"));};var PowerSwitch=function PowerSwitch(e,t,a){Switch.call(this,e,t,a),this.legacyType="powerswitch",this.powChannel=2;};util.inherits(PowerSwitch,Switch),PowerSwitch.prototype._getReadableDpts=function(){var e=Switch.prototype._getReadableDpts.call(this);return e.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"BOOT"}),e.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"ENERGY_COUNTER"}),e.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"POWER"}),e.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"CURRENT"}),e.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"VOLTAGE"}),e.push({channel:this.deviceAdr+":"+this.powChannel,dpt:"FREQUENCY"}),e;},PowerSwitch.prototype._getDptFromRef=function(e){var t={channel:this.deviceAdr,dataPoint:null};switch(e){case"timeout":t.channel=0,t.dataPoint="UNREACH";break;case"state":t.channel=t.channel+":1",t.dataPoint="STATE";break;case"inhibit":t.channel=t.channel+":1",t.dataPoint="INHIBIT";break;case"working":t.channel=t.channel+":1",t.dataPoint="WORKING";break;case"boot":t.channel=t.channel+":2",t.dataPoint="BOOT";break;case"energy_counter":t.channel=t.channel+":2",t.dataPoint="ENERGY_COUNTER";break;case"power":t.channel=t.channel+":2",t.dataPoint="POWER";break;case"current":t.channel=t.channel+":2",t.dataPoint="CURRENT";break;case"voltage":t.channel=t.channel+":2",t.dataPoint="VOLTAGE";break;case"frequency":t.channel=t.channel+":2",t.dataPoint="FREQUENCY";break;default:return null;}return t;},PowerSwitch.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n,i=e.substr(0,r),s=e.substr(r+1);return i!=this.deviceAdr?null:0==s?(n={},"UNREACH"==t?n.timeout=a:n["0_"+t.toLowerCase()]=a,n):"1"==s?Switch.prototype.parseDptState.call(this,e,t,a):"2"==s?((n={})[t.toLowerCase()]=a,n):null;},PowerSwitch.prototype.getConfig=function(e,t){var a=this,r=null;Switch.prototype.getConfig.call(this,e,function(n,i){n?t&&t(n):(r=i,a._getCh2Config(e,function(e,a){if(e)t&&t(e);else{for(var n in a){a.hasOwnProperty(n)&&(r[n]=a[n]);}t&&t(null,r);}}));});},PowerSwitch.prototype.setConfig=function(e,t,a){if(t){var r=Object.keys(t);if(r&&0!=r.length){var n=this;async.eachSeries(r,function(a,r){var i=a.indexOf(":");-1==i&&r(new Error("channel address is null"));var s=a.substr(i+1);1==s?Switch.prototype.setConfig.call(n,e,t,r):2==s?n._setCh2Config(e,t[a],r):r(new Error("unknow channel:"+s));},function(e){a&&a(e);});}else a&&a(new Error("config data not complete"));}else a&&a(new Error("config data invalid"));},PowerSwitch.prototype._getCh2Config=function(e,t){var a=this.deviceAdr+":2";e.getParamset(this.deviceIF,a,"MASTER",function(e,r){if(e)t&&t(e);else{var n={},i=null;r&&(i={AES_ACTIVE:r.AES_ACTIVE}),n[a]=i,t&&t(e,n);}});},PowerSwitch.prototype._setCh2Config=function(e,t,a){if(t){var r=this.deviceAdr+":2",n={};n.AES_ACTIVE=t.AES_ACTIVE,e.setParamset(this.deviceIF,r,"MASTER",n,function(e){a&&a(e);});}else a&&a(new Error("config data invalid"));};var Weather=function Weather(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="weather";};util.inherits(Weather,Device),Weather.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.channel,dpt:"HUMIDITY"}];},Weather.prototype._getDptFromRef=function(e){var t={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(e){case"lowbat":t.channel=0,t.dataPoint="LOWBAT";break;case"timeout":t.channel=0,t.dataPoint="UNREACH";break;case"temp":t.dataPoint="TEMPERATURE";break;case"hum":t.dataPoint="HUMIDITY";break;default:return null;}return t;},Weather.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;if(0!=i&&i!=this.channel)return null;if(0==i){var o={};return"UNREACH"==t?o.timeout=a:"LOWBAT"==t?o.lowbat=a:o["0_"+t.toLowerCase()]=a,o;}switch(t){case"TEMPERATURE":return{temp:parseFloat(a)};case"HUMIDITY":return{hum:parseInt(a)};default:return null;}};var Weather2=function Weather2(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="weather2";};util.inherits(Weather2,Weather),Weather2.prototype._getReadableDpts=function(){var e=Weather.prototype._getReadableDpts.call(this);return e.push({channel:this.deviceAdr+":"+this.channel,dpt:"AIR_PRESSURE"}),e;},Weather2.prototype._getDptFromRef=function(e){var t={channel:this.deviceAdr+":"+this.channel,dataPoint:null};return"air"!==e?Weather.prototype._getDptFromRef.call(this,e):(t.dataPoint="AIR_PRESSURE",t);},Weather2.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;if(0!=i&&i!=this.channel)return null;if(0==i){var o={};return"UNREACH"==t?o.timeout=a:"LOWBAT"==t?o.lowbat=a:o["0_"+t.toLowerCase()]=a,o;}o=Weather.prototype.parseDptState.call(this,e,t,a);if("AIR_PRESSURE"===t)o||(o={}),o.air=parseInt(a);return o;};var WeatherStation=function WeatherStation(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="weatherstation";};util.inherits(WeatherStation,Device),WeatherStation.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.channel,dpt:"HUMIDITY"},{channel:this.deviceAdr+":"+this.channel,dpt:"RAINING"},{channel:this.deviceAdr+":"+this.channel,dpt:"RAIN_COUNTER"},{channel:this.deviceAdr+":"+this.channel,dpt:"WIND_SPEED"},{channel:this.deviceAdr+":"+this.channel,dpt:"WIND_DIRECTION"},{channel:this.deviceAdr+":"+this.channel,dpt:"WIND_DIRECTION_RANGE"},{channel:this.deviceAdr+":"+this.channel,dpt:"SUNSHINEDURATION"},{channel:this.deviceAdr+":"+this.channel,dpt:"BRIGHTNESS"}];},WeatherStation.prototype._getDptFromRef=function(e){var t={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(e){case"lowbat":t.channel=0,t.dataPoint="LOWBAT";break;case"timeout":t.channel=0,t.dataPoint="UNREACH";break;case"temp":t.dataPoint="TEMPERATURE";break;case"hum":t.dataPoint="HUMIDITY";break;case"rain":t.dataPoint="RAINING";break;case"rainC":t.dataPoint="RAIN_COUNTER";break;case"windS":t.dataPoint="WIND_SPEED";break;case"windD":t.dataPoint="WIND_DIRECTION";break;case"windDR":t.dataPoint="WIND_DIRECTION_RANGE";break;case"sunD":t.dataPoint="SUNSHINEDURATION";break;case"bri":t.dataPoint="BRIGHTNESS";break;default:return null;}return t;},WeatherStation.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;if(0!=i&&i!=this.channel)return null;var o={};if(0==i)return"UNREACH"==t?o.timeout=a:"LOWBAT"==t?o.lowbat=a:o["0_"+t.toLowerCase()]=a,o;switch(t){case"TEMPERATURE":o.temp=parseFloat(a);break;case"HUMIDITY":o.hum=parseInt(a);break;case"RAINING":o.rain=a;break;case"RAIN_COUNTER":o.rainC=parseFloat(a);break;case"WIND_SPEED":o.windS=parseFloat(a);break;case"WIND_DIRECTION":o.windD=a;break;case"WIND_DIRECTION_RANGE":o.windDR=a;break;case"SUNSHINEDURATION":o.sunD=a;break;case"BRIGHTNESS":o.bri=a;break;default:return null;}return o;};var Heater=function Heater(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="heater";};util.inherits(Heater,Device),Heater.prototype._getReadableDpts=function(){var e=[];return e.push({channel:this.deviceAdr+":0",dpt:"UNREACH"}),e.push({channel:this.deviceAdr+":"+this.channel,dpt:"VALVE_STATE"}),e.push({channel:this.deviceAdr+":"+this.channel,dpt:"ERROR"}),e;},Heater.prototype._getDptFromRef=function(e){var t={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(e){case"timeout":t.channel=0,t.dataPoint="UNREACH";break;case"error":t.dataPoint="ERROR";break;case"state":t.dataPoint="VALVE_STATE";break;default:return null;}return t;},Heater.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o={};if(0==i)return"UNREACH"==t?o.timeout=a:o["0_"+t.toLowerCase()]=a,o;if(i==this.channel){switch(t){case"ERROR":switch(a){case 0:o.error="no_error";break;case 1:o.error="VALVE_DRIVE_BLOCKED";break;case 2:o.error="VALVE_DRIVE_LOOSE";break;case 3:o.error="ADJUSTING_RANGE_TO_SMALL";break;case 4:o.error="lowbat";}break;case"VALVE_STATE":o.state=a;}return o;}return null;};var Heater2=function Heater2(e,t,a){Device.call(this,e,t,a),this.channel=4,this.legacyType="thermostat";};util.inherits(Heater2,Device),Heater2.prototype._getReadableDpts=function(){var e=[];return e.push({channel:this.deviceAdr+":"+this.channel,dpt:"CONTROL_MODE"}),e.push({channel:this.deviceAdr+":"+this.channel,dpt:"FAULT_REPORTING"}),e.push({channel:this.deviceAdr+":"+this.channel,dpt:"BATTERY_STATE"}),e.push({channel:this.deviceAdr+":"+this.channel,dpt:"BOOST_STATE"}),e.push({channel:this.deviceAdr+":"+this.channel,dpt:"ACTUAL_TEMPERATURE"}),e.push({channel:this.deviceAdr+":"+this.channel,dpt:"SET_TEMPERATURE"}),e;},Heater2.prototype._getDptFromRef=function(e){var t={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(e){case"mode":t.dataPoint="CONTROL_MODE";break;case"error":t.dataPoint="FAULT_REPORTING";break;case"batLvl":t.dataPoint="BATTERY_STATE";break;case"valveLvl":t.dataPoint="VALVE_STATE";break;case"boostTime":t.dataPoint="BOOST_STATE";break;case"act_temp":t.dataPoint="ACTUAL_TEMPERATURE";break;case"state":t.dataPoint="SET_TEMPERATURE";break;default:return null;}return t;},Heater2.prototype.executeCommand=function(e,t,a){var r,n=this.deviceAdr+":"+this.channel,i=this;switch(t){case"setAuto":r="AUTO_MODE",e.writeValue(this.deviceIF,n,r,!0,function(t){t||e.updateStatusBuffer(i.deviceIF,n,"CONTROL_MODE",0),a&&a(t);});break;case"setManu":r="SET_TEMPERATURE",e.getState({"interface":this.deviceIF,channel:n,datapoint:r},function(t,s){t?a&&a(t):(r="MANU_MODE",e.writeValue(i.deviceIF,n,r,{type:"double",value:s.value},function(t){t||e.updateStatusBuffer(i.deviceIF,n,"CONTROL_MODE",1),a&&a(t);}));});break;case"setBoost":r="BOOST_MODE",e.writeValue(this.deviceIF,n,r,!0,function(t){t||e.updateStatusBuffer(i.deviceIF,n,"CONTROL_MODE",3),a&&a(t);});break;case"tempUp":r="SET_TEMPERATURE",e.getState({"interface":this.deviceIF,channel:n,datapoint:r},function(t,s){if(t)a&&a(t);else if(s){var o=s.value+.5;o>30.5&&(o=30.5),e.writeValue(i.deviceIF,n,r,{type:"double",value:o},a);}else a&&a(new Error("get current temp state result invalid"));});break;case"tempDown":r="SET_TEMPERATURE",e.getState({"interface":this.deviceIF,channel:n,datapoint:r},function(t,s){if(t)a&&a(t);else if(s){var o=s.value-.5;o<4.5&&(o=4.5),e.writeValue(i.deviceIF,n,r,{type:"double",value:o},a);}else a&&a(new Error("get current temp state result invalid"));});break;default:if("tempTo"==t.substr(0,6)||t.match(/^[-+]?[0-9]*\.?[0-9]+$/)){"tempTo"==t.substr(0,6)&&(t=t.substr(6));var s=parseFloat(t);r="SET_TEMPERATURE",e.writeValue(this.deviceIF,n,r,{type:"double",value:s},a);}else a&&a(new Error("no such command"));}},Heater2.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o={};if(0==i)return o["0_"+t.toLowerCase()]=a,o;if(i==this.channel){switch(t){case"CONTROL_MODE":switch(a){case 0:o.mode="auto";break;case 1:o.mode="manu";break;case 2:o.mode="party";break;case 3:o.mode="boost";}break;case"FAULT_REPORTING":switch(a){case 0:o.error="no_error";break;case 1:o.error="valve_tight";break;case 2:o.error="ADJUSTING_RANGE_TOO_LARGE";break;case 3:o.error="ADJUSTING_RANGE_TOO_SMALL";break;case 4:o.error="comm_error";break;case 5:o.error="";break;case 6:o.error="lowbat";break;case 7:o.error="VALVE_ERROR_POSITION";}break;case"BATTERY_STATE":o.batLvl=a;break;case"VALVE_STATE":o.valveLvl=a;break;case"BOOST_STATE":o.boostTime=a;break;case"ACTUAL_TEMPERATURE":o.act_temp=a;break;case"SET_TEMPERATURE":o.state=a;break;default:return null;}return o;}return null;};var Heater3=function Heater3(e,t,a){Device.call(this,e,t,a),this.channel=4,this.legacyType="thermostat";};util.inherits(Heater3,Heater2),Heater3.prototype._getReadableDpts=function(){var e=Heater2.prototype._getReadableDpts.callback(this);return e.push({channel:this.deviceAdr+":"+this.channel,dpt:"WINDOW_STATE"}),e;},Heater3.prototype._getDptFromRef=function(e){var t={channel:this.deviceAdr+":"+this.channel,dataPoint:null};return"window"!==e?Heater2.prototype._getDptFromRef.call(this,e):(t.dataPoint="WINDOW_STATE",t);},Heater3.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o={};return 0==i?(o["0_"+t.toLowerCase()]=a,o):i==this.channel?"WINDOW_STATE"===t?(o.window=a?"closed":"open",o):Heater2.prototype.parseDptState.call(this,e,t,a):null;};var WallThermo=function WallThermo(e,t,a){Device.call(this,e,t,a),this.weatherChannel=1,this.thermoChannel=2,this.legacyType="wallthermo";};util.inherits(WallThermo,Device),WallThermo.prototype._getReadableDpts=function(){var e=[];return e.push({channel:this.deviceAdr+":0",dpt:"UNREACH"}),e.push({channel:this.deviceAdr+":0",dpt:"LOWBAT"}),e.push({channel:this.deviceAdr+":"+this.weatherChannel,dpt:"TEMPERATURE"}),e.push({channel:this.deviceAdr+":"+this.weatherChannel,dpt:"HUMIDITY"}),e.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"SETPOINT"}),e.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"ADJUSTING_COMMAND"}),e.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"ADJUSTING_DATA"}),e;},WallThermo.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t,dataPoint:null};switch(e){case"timeout":a.channel=t+":0",a.dataPoint="UNREACH";break;case"lowbat":a.channel=t+":0",a.dataPoint="LOWBAT";break;case"temp":a.channel=t+":1",a.dataPoint="TEMPERATURE";break;case"hum":a.channel=t+":1",a.dataPoint="HUMIDITY";break;case"state":a.channel=t+":2",a.dataPoint="SETPOINT";break;case"adjusting_command":a.channel=t+":2",a.dataPoint="ADJUSTING_COMMAND";break;case"adjusting_data":a.channel=t+":2",a.dataPoint="ADJUSTING_DATA";break;default:return null;}return a;},WallThermo.prototype.executeCommand=function(e,t,a){var r,n=this.deviceAdr+":"+this.thermoChannel;switch(t){case"tempUp":r="SETPOINT",e.getState({"interface":this.deviceIF,channel:n,datapoint:r},function(t,i){if(t)a&&a(t);else if(i){var s=i.value+.5;s>30&&(s=30),e.writeValue(self.deviceIF,n,r,{type:"double",value:s},a);}else a&&a(new Error("get current temp state result invalid"));});break;case"tempDown":r="SETPOINT",e.getState({"interface":this.deviceIF,channel:n,datapoint:r},function(t,i){if(t)a&&a(t);else if(i){var s=i.value-.5;s<6&&(s=6),e.writeValue(self.deviceIF,n,r,{type:"double",value:s},a);}else a&&a(new Error("get current temp state result invalid"));});break;default:if("tempTo"==t.substr(0,6)||t.match(/^[-+]?[0-9]*\.?[0-9]+$/)){"tempTo"==t.substr(0,6)&&(t=t.substr(6));var i=parseFloat(t);r="SETPOINT",e.writeValue(this.deviceIF,n,r,{type:"double",value:i},a);}else a&&a(new Error("no such command"));}},WallThermo.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1);if(n!=this.deviceAdr)return null;var s={};if(0==i)return"UNREACH"==t?s.timeout=a:"LOWBAT"==t?s.lowbat=a:s["0_"+t.toLowerCase()]=a,s;if("1"==i){switch(t){case"TEMPERATURE":s.temp=a;break;case"HUMIDITY":s.hum=a;}return s;}if("2"==i){switch(t){case"SETPOINT":s.state=a;break;case"ADJUSTING_COMMAND":s.adjusting_command=a;break;case"ADJUSTING_DATA":s.adjusting_data=a;}return s;}return null;};var WallThermo2=function WallThermo2(e,t,a){Device.call(this,e,t,a),this.thermoChannel=2,this.legacyType="wallthermostat";};util.inherits(WallThermo2,Device),WallThermo2.prototype._getReadableDpts=function(){var e=[];return e.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"CONTROL_MODE"}),e.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"LOWBAT_REPORTING"}),e.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"COMMUNICATION_REPORTING"}),e.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"WINDOW_OPEN_REPORTING"}),e.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"BATTERY_STATE"}),e.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"BOOST_STATE"}),e.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"ACTUAL_TEMPERATURE"}),e.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"ACTUAL_HUMIDITY"}),e.push({channel:this.deviceAdr+":"+this.thermoChannel,dpt:"SET_TEMPERATURE"}),e;},WallThermo2.prototype._getDptFromRef=function(e){var t={channel:this.deviceAdr+":"+this.thermoChannel,dataPoint:null};switch(e){case"mode":t.dataPoint="CONTROL_MODE";break;case"lowbat":t.dataPoint="LOWBAT_REPORTING";break;case"comm":t.dataPoint="COMMUNICATION_REPORTING";break;case"window":t.dataPoint="WINDOW_OPEN_REPORTING";break;case"batLvl":t.dataPoint="BATTERY_STATE";break;case"boostTime":t.dataPoint="BOOST_STATE";break;case"temp":t.dataPoint="ACTUAL_TEMPERATURE";break;case"hum":t.dataPoint="ACTUAL_HUMIDITY";break;case"state":t.dataPoint="SET_TEMPERATURE";break;default:return null;}return t;},WallThermo2.prototype.executeCommand=function(e,t,a){var r,n=this.deviceAdr+":"+this.thermoChannel,i=this;switch(t){case"setAuto":r="AUTO_MODE",e.writeValue(this.deviceIF,n,r,!0,function(t){t||e.updateStatusBuffer(i.deviceIF,n,"CONTROL_MODE",0),a&&a(t);});break;case"setManu":r="SET_TEMPERATURE",e.getState({"interface":this.deviceIF,channel:n,datapoint:r},function(t,s){t?a&&a(t):(r="MANU_MODE",e.writeValue(i.deviceIF,n,r,{type:"double",value:s.value},function(t){t||e.updateStatusBuffer(i.deviceIF,n,"CONTROL_MODE",1),a&&a(t);}));});break;case"setBoost":r="BOOST_MODE",e.writeValue(this.deviceIF,n,r,!0,function(t){t||e.updateStatusBuffer(i.deviceIF,n,"CONTROL_MODE",3),a&&a(t);});break;case"tempUp":r="SET_TEMPERATURE",e.getState({"interface":this.deviceIF,channel:n,datapoint:r},function(t,s){if(t)a&&a(t);else if(s){var o=s.value+.5;o>30.5&&(o=30.5),e.writeValue(i.deviceIF,n,r,{type:"double",value:o},a);}else a&&a(new Error("get current temp state result invalid"));});break;case"tempDown":r="SET_TEMPERATURE",e.getState({"interface":this.deviceIF,channel:n,datapoint:r},function(t,s){if(t)a&&a(t);else if(s){var o=s.value-.5;o<4.5&&(o=4.5),e.writeValue(i.deviceIF,n,r,{type:"double",value:o},a);}else a&&a(new Error("get current temp state result invalid"));});break;default:if("tempTo"==t.substr(0,6)||t.match(/^[-+]?[0-9]*\.?[0-9]+$/)){"tempTo"==t.substr(0,6)&&(t=t.substr(6));var s=parseFloat(t);r="SET_TEMPERATURE",e.writeValue(this.deviceIF,n,r,{type:"double",value:s},a);}else if("setWeekProfile"==t.substr(0,14)){s=parseInt(t.substr(14));var o={WEEK_PROGRAM_POINTER:s-=1};e.setParamset(this.deviceIF,this.deviceAdr,"MASTER",o,function(e){a&&a(e);});}else a&&a(new Error("no such command"));}},WallThermo2.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1);if(n!=this.deviceAdr)return null;var s={};if(0==i)return s["0_"+t.toLowerCase()]=a,s;if("2"==i){switch(t){case"CONTROL_MODE":switch(a){case 0:s.mode="auto";break;case 1:s.mode="manu";break;case 2:s.mode="party";break;case 3:s.mode="boost";}break;case"LOWBAT_REPORTING":s.lowbat=a;break;case"COMMUNICATION_REPORTING":s.comm=a;break;case"WINDOW_OPEN_REPORTING":s.window=a;break;case"BATTERY_STATE":s.batLvl=a;break;case"BOOST_STATE":s.boostTime=a;break;case"ACTUAL_TEMPERATURE":s.temp=a;break;case"ACTUAL_HUMIDITY":s.hum=a;break;case"SET_TEMPERATURE":s.state=a;}return s;}return null;};var Contact=function Contact(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="contact";};util.inherits(Contact,Device),Contact.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"LOWBAT"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR"}];},Contact.prototype._getDptFromRef=function(e){var t=this.deviceAdr;-1==t.indexOf(":")&&this.channel&&(t+=":"+this.channel);var a={channel:t,dataPoint:null};switch(e){case"timeout":a.channel=0,a.dataPoint="UNREACH";break;case"state":a.dataPoint="STATE";break;case"error":a.dataPoint="ERROR";break;case"lowbat":a.dataPoint="LOWBAT";break;default:return null;}return a;},Contact.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;if(0!=i&&i!=this.channel)return null;if(0==i){var o={};return"UNREACH"==t?o.timeout=a:o["0_"+t.toLowerCase()]=a,o;}switch(t){case"STATE":return{state:a?"open":"closed"};case"ERROR":return{error:1==a?"sabotage":"no_error"};case"LOWBAT":return{lowbat:a};default:return null;}};var Rain=function Rain(e,t,a){Device.call(this,e,t,a),this.rainChannel=1,this.heatChannel=2,this.legacyType="rain";};util.inherits(Rain,Device),Rain.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.rainChannel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.heatChannel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.heatChannel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.heatChannel,dpt:"WORKING"}];},Rain.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t,dataPoint:null};switch(e){case"timeout":a.channel=0,a.dataPoint="UNREACH";break;case"rain":a.channel=t+":"+this.rainChannel,a.dataPoint="STATE";break;case"heat":a.channel=t+":"+this.heatChannel,a.dataPoint="STATE";break;case"inhibit":a.channel=t+":"+this.heatChannel,a.dataPoint="INHIBIT";break;case"working":a.channel=t+":"+this.heatChannel,a.dataPoint="WORKING";break;default:return null;}return a;},Rain.prototype.executeCommand=function(e,t,a){var r,n=this.deviceAdr;-1==n.indexOf(":")&&this.heatChannel&&(n+=":"+this.heatChannel);var i=this;switch(t){case"heaterOn":r="STATE",e.writeValue(this.deviceIF,n,r,!0,a);break;case"heaterOff":r="STATE",e.writeValue(this.deviceIF,n,r,!1,a);break;case"heaterToggle":r="STATE",e.getState({"interface":this.deviceIF,channel:n,datapoint:r},function(t,s){if(t)a&&a(t);else if(s){var o=!0;s.value&&(o=!1),e.writeValue(i.deviceIF,n,r,o,a);}else a&&a(new Error("get switch current value return invalid"));});break;default:a&&a(new Error("no such command"));}},Rain.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o={};if(0==i)return"UNREACH"==t?o.timeout=a:o["0_"+t.toLowerCase()]=a,o;if(1==i)return"STATE"!==t?null:(o.rain=1==a?"rain":"dry",o);if(2==i){switch(t){case"STATE":o.heat=a?"on":"off";break;case"INHIBIT":o.inhibit=a;break;case"WORKING":o.working=a;break;default:return null;}return o;}};var Gong=function Gong(e,t,a){Device.call(this,e,t,a),this.ledChannel=1,this.chimeChannel=2,this.legacyType="gong2";};util.inherits(Gong,Device),Gong.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.ledChannel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.ledChannel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.ledChannel,dpt:"WORKING"},{channel:this.deviceAdr+":"+this.chimeChannel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.chimeChannel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.chimeChannel,dpt:"WORKING"}];},Gong.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t,dataPoint:null};switch(e){case"timeout":a.channel=0,a.dataPoint="UNREACH";break;case"led":a.channel=t+":"+this.ledChannel,a.dataPoint="STATE";break;case"led_inhibit":a.channel=t+":"+this.ledChannel,a.dataPoint="INHIBIT";break;case"led_working":a.channel=t+":"+this.ledChannel,a.dataPoint="WORKING";break;case"chime":a.channel=t+":"+this.chimeChannel,a.dataPoint="STATE";break;case"chime_inhibit":a.channel=t+":"+this.chimeChannel,a.dataPoint="INHIBIT";break;case"chime_working":a.channel=t+":"+this.chimeChannel,a.dataPoint="WORKING";break;default:return null;}return a;},Gong.prototype.executeCommand=function(e,t,a){var r,n;switch(t){case"ledOn":r=this.deviceAdr+":"+this.ledChannel,n="STATE",e.writeValue(this.deviceIF,r,n,!0,a);break;case"ledOff":r=this.deviceAdr+":"+this.ledChannel,n="STATE",e.writeValue(this.deviceIF,r,n,!1,a);break;case"chimeOn":r=this.deviceAdr+":"+this.chimeChannel,n="STATE",e.writeValue(this.deviceIF,r,n,!0,a);break;case"chimeOff":r=this.deviceAdr+":"+this.chimeChannel,n="STATE",e.writeValue(this.deviceIF,r,n,!1,a);break;default:a&&a(new Error("no such command"));}},Gong.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o={};if(0==i)return"UNREACH"==t?o.timeout=a:o["0_"+t.toLowerCase()]=a,o;if(1==i){switch(t){case"STATE":o.led=a?"on":"off";break;case"INHIBIT":o.led_inhibit=a;break;case"WORKING":o.led_working=a;break;default:return null;}return o;}if(2==i){switch(t){case"STATE":o.chime=a?"on":"off";break;case"INHIBIT":o.chime_inhibit=a;break;case"WORKING":o.chime_working=a;break;default:return null;}return o;}};var Gong2=function Gong2(e,t,a){Device.call(this,e,t,a),this.ledChannel=1,this.chimeChannel=2,this.legacyType="gong";};util.inherits(Gong2,Gong),Gong2.prototype.executeCommand=function(e,t,a){var r,n,i;if(0==t.indexOf("vChannel")){var s=t.substr(8);s=parseInt(s),r=this.deviceAdr+":"+this.chimeChannel,n="SUBMIT",e.writeValue(this.deviceIF,r,n,"0.8,1,5,"+s,a);}else if(0==t.indexOf("setChime")){var o=t.substr(8);s=parseInt(s),r=this.deviceAdr+":"+this.chimeChannel,n="SUBMIT",e.writeValue(this.deviceIF,r,n,o,a);}else 0==t.indexOf("ledGreen")?((i=t.substr(8))||(i=10),r=this.deviceAdr+":"+this.ledChannel,n="SUBMIT",e.writeValue(this.deviceIF,r,n,"1,10,"+i+",34",a)):0==t.indexOf("ledRed")?((i=t.substr(6))||(i=10),r=this.deviceAdr+":"+this.ledChannel,n="SUBMIT",e.writeValue(this.deviceIF,r,n,"1,10,"+i+",18",a)):Gong.prototype.executeCommand.call(this,e,t,a);};var Window=function Window(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="window";};util.inherits(Window,Device),Window.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR"},{channel:this.deviceAdr+":"+this.channel,dpt:"LOWBAT"}];},Window.prototype._getDptFromRef=function(e){var t={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(e){case"timeout":t.channel=0,t.dataPoint="UNREACH";break;case"state":t.dataPoint="STATE";break;case"error":t.dataPoint="ERROR";break;case"lowbat":t.dataPoint="LOWBAT";break;default:return null;}return t;},Window.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o={};if(0==i)return"UNREACH"==t?o.timeout=a:o["0_"+t.toLowerCase()]=a,o;switch(t){case"STATE":switch(a){case 0:o.state="closed";break;case 1:o.state="tilted";break;case 2:o.state="open";}break;case"ERROR":switch(a){case 0:o.error="no_error";break;case 1:case 7:o.error="sabotage";}break;case"LOWBAT":o.lowbat=a;break;default:return null;}return o;};var Temperature=function Temperature(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="temp";};util.inherits(Temperature,Device),Temperature.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"TEMPERATURE"}];},Temperature.prototype._getDptFromRef=function(e){var t={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(e){case"lowbat":t.channel=0,t.dataPoint="LOWBAT";break;case"timeout":t.channel=0,t.dataPoint="UNREACH";break;case"temp":t.dataPoint="TEMPERATURE";break;default:return null;}return t;},Temperature.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;if(0!=i&&i!=this.channel)return null;if(0==i){var o={};return"UNREACH"==t?o.timeout=a:"LOWBAT"==t?o.lowbat=a:o["0_"+t.toLowerCase()]=a,o;}return"TEMPERATURE"===t?{temp:parseFloat(a)}:null;};var Temperature2=function Temperature2(e,t,a){Device.call(this,e,t,a),this.temp1=1,this.temp2=2,this.tempDiff12=3,this.tempDiff21=4,this.legacyType="temp2";};util.inherits(Temperature2,Device),Temperature2.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.temp1,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.temp1,dpt:"LOWBAT"},{channel:this.deviceAdr+":"+this.temp2,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.tempDiff12,dpt:"TEMPERATURE"},{channel:this.deviceAdr+":"+this.tempDiff21,dpt:"TEMPERATURE"}];},Temperature2.prototype._getDptFromRef=function(e){var t={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(e){case"timeout":t.channel=0,t.dataPoint="UNREACH";break;case"lowbat":t.channel=this.temp1,t.dataPoint="LOWBAT";break;case"temp1":t.channel=this.temp1,t.dataPoint="TEMPERATURE";break;case"temp2":t.channel=this.temp2,t.dataPoint="TEMPERATURE";break;case"tempDiff12":t.channel=this.tempDiff12,t.dataPoint="TEMPERATURE";break;case"tempDiff21":t.channel=this.tempDiff21,t.dataPoint="TEMPERATURE";break;default:return null;}return t;},Temperature2.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o={};if(0==i)return"UNREACH"==t?o.timeout=a:o["0_"+t.toLowerCase()]=a,o;switch(t){case"LOWBAT":return{lowbat:a};case"TEMPERATURE":return 1==i?{temp1:parseFloat(a)}:2==i?{temp2:parseFloat(a)}:3==i?{tempDiff12:parseFloat(a)}:4==i?{tempDiff21:parseFloat(a)}:null;default:return null;}};var CO2=function CO2(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="co2";};util.inherits(CO2,Device),CO2.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"}];},CO2.prototype._getDptFromRef=function(e){var t={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(e){case"timeout":t.channel=0,t.dataPoint="UNREACH";break;case"state":t.dataPoint="STATE";break;default:return null;}return t;},CO2.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;if(0!=i&&i!=this.channel)return null;var o={};if(0==i)return"UNREACH"==t?o.timeout=a:o["0_"+t.toLowerCase()]=a,o;if("STATE"!==t)return null;switch(a){case 0:o.state="normal";break;case 1:o.state="medium";break;case 2:o.state="high";}return o;};var Motion=function Motion(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="motion";};util.inherits(Motion,Device),Motion.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"BRIGHTNESS"},{channel:this.deviceAdr+":"+this.channel,dpt:"MOTION"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR"}];},Motion.prototype._getDptFromRef=function(e){var t={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(e){case"lowbat":t.channel=0,t.dataPoint="LOWBAT";break;case"timeout":t.channel=0,t.dataPoint="UNREACH";break;case"bri":t.dataPoint="BRIGHTNESS";break;case"state":t.dataPoint="MOTION";break;case"error":t.dataPoint="ERROR";break;default:return null;}return t;},Motion.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;if(0!=i&&i!=this.channel)return null;var o={};if(0==i)return"UNREACH"==t?o.timeout=a:"LOWBAT"==t?o.lowbat=a:o["0_"+t.toLowerCase()]=a,o;switch(t){case"BRIGHTNESS":o.bri=a;break;case"MOTION":o.state=a?"motion":"ok";break;case"ERROR":o.error=a?"sabotage":"no_error";break;default:return null;}return o;};var Smoke=function Smoke(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="smoke";};util.inherits(Smoke,Device),Smoke.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"}];},Smoke.prototype._getDptFromRef=function(e){var t={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(e){case"lowbat":t.channel=0,t.dataPoint="LOWBAT";break;case"timeout":t.channel=0,t.dataPoint="UNREACH";break;case"state":t.dataPoint="STATE";break;default:return null;}return t;},Smoke.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;if(0!=i&&i!=this.channel)return null;var o={};return 0==i?("UNREACH"==t?o.timeout=a:"LOWBAT"==t?o.lowbat=a:o["0_"+t.toLowerCase()]=a,o):"STATE"!==t?null:(o.state=a?"smoke":"ok",o);};var Siren=function Siren(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="siren";};util.inherits(Siren,Device),Siren.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR_POWER"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR_SABOTAGE"},{channel:this.deviceAdr+":"+this.channel,dpt:"ERROR_BATTERY"},{channel:this.deviceAdr+":"+this.channel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.channel,dpt:"WORKING"},{channel:this.deviceAdr+":"+this.channel,dpt:"LOWBAT"}];},Siren.prototype._getDptFromRef=function(e){var t={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(e){case"timeout":t.channel=0,t.dataPoint="UNREACH";break;case"state":t.dataPoint="STATE";break;case"error_power":t.dataPoint="ERROR_POWER";break;case"error_sabotage":t.dataPoint="ERROR_SABOTAGE";break;case"error_battery":t.dataPoint="ERROR_BATTERY";break;case"inhibit":t.dataPoint="INHIBIT";break;case"working":t.dataPoint="WORKING";break;default:return null;}return t;},Siren.prototype.executeCommand=function(e,t,a){var r,n=this.deviceAdr+":"+this.channel,i=this;switch(t){case"on":r="STATE",e.writeValue(this.deviceIF,n,r,!0,a);break;case"off":r="STATE",e.writeValue(this.deviceIF,n,r,!1,a);break;case"toggle":r="STATE",e.getState({"interface":this.deviceIF,channel:n,datapoint:r},function(t,s){if(t)a&&a(t);else{var o=!0;s.value&&(o=!1),e.writeValue(i.deviceIF,n,r,o,a);}});break;default:a&&a(new Error("no such command"));}},Siren.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;if(0!=i&&i!=this.channel)return null;var o={};if(0==i)return"UNREACH"==t?o.timeout=a:o["0_"+t.toLowerCase()]=a,o;switch(t){case"STATE":o.state=a?"on":"off";break;case"ERROR_POWER":o.error_power=a?"power_failure":"no_error";break;case"ERROR_SABOTAGE":o.error_sabotage=a?"sabotage":"no_error";break;case"ERROR_BATTERY":o.error_battery=a?"battery_defect":"no_error";break;case"INHIBIT":o.inhibit=a;break;case"WORKING":o.working=a;break;default:return null;}return o;};var Capacity=function Capacity(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="capacity";};util.inherits(Capacity,Device),Capacity.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"FILLING_LEVEL"}];},Capacity.prototype._getDptFromRef=function(e){var t={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(e){case"lowbat":t.channel=0,t.dataPoint="LOWBAT";break;case"timeout":t.channel=0,t.dataPoint="UNREACH";break;case"state":t.dataPoint="FILLING_LEVEL";break;default:return null;}return t;},Capacity.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;if(0!=i&&i!=this.channel)return null;var o={};return 0==i?("UNREACH"==t?o.timeout=a:"LOWBAT"==t?o.lowbat=a:o["0_"+t.toLowerCase()]=a,o):"FILLING_LEVEL"!==t?null:(o.state=a,o);};var SwitchInterface=function SwitchInterface(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="switch_interface";};util.inherits(SwitchInterface,Device),SwitchInterface.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"}];},SwitchInterface.prototype._getDptFromRef=function(e){var t=this.deviceAdr;-1==t.indexOf(":")&&this.channel&&(t+=":"+this.channel);var a={channel:t,dataPoint:null};switch(e){case"lowbat":a.channel=0,a.dataPoint="LOWBAT";break;case"timeout":a.channel=0,a.dataPoint="UNREACH";break;default:return null;}return a;},SwitchInterface.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;if(0!=i&&i!=this.channel)return null;if(0==i){var o={};return"UNREACH"==t?o.timeout=a:"LOWBAT"==t?o.lowbat=a:o["0_"+t.toLowerCase()]=a,o;}return"PRESS"===t?{press:a}:null;},SwitchInterface.prototype.isButton=function(){return!0;},SwitchInterface.prototype.claimEvent=function(e,t){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);e.reportValueUsage(this.deviceIF,a,"PRESS",function(e,a){e&&console.error("switch interface claim PRESS event error:"+e.stack),t&&t();});};var Tilt=function Tilt(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="tilt";};util.inherits(Tilt,Device),Tilt.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"LOWBAT"}];},Tilt.prototype._getDptFromRef=function(e){var t={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(e){case"timeout":t.channel=0,t.dataPoint="UNREACH";break;case"state":t.dataPoint="STATE";break;case"lowbat":t.dataPoint="LOWBAT";break;default:return null;}return t;},Tilt.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;if(0!=i&&i!=this.channel)return null;var o={};if(0==i)return"UNREACH"==t?o.timeout=a:o["0_"+t.toLowerCase()]=a,o;switch(t){case"STATE":o.state=a?"open":"closed";break;case"LOWBAT":o.lowbat=a;break;default:return null;}return o;};var Water=function Water(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="water";};util.inherits(Water,Device),Water.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.channel,dpt:"LOWBAT"}];},Water.prototype._getDptFromRef=function(e){var t={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(e){case"timeout":t.channel=0,t.dataPoint="UNREACH";break;case"state":t.dataPoint="STATE";break;case"lowbat":t.dataPoint="LOWBAT";break;default:return null;}return t;},Water.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;if(0!=i&&i!=this.channel)return null;var o={};if(0==i)return"UNREACH"==t?o.timeout=a:o["0_"+t.toLowerCase()]=a,o;switch(t){case"STATE":switch(a){case 0:o.state="ok";break;case 1:o.state="moist";break;case 2:o.state="water";}break;case"LOWBAT":o.lowbat=a;break;default:return null;}return o;};var EnergyMeter=function EnergyMeter(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="energymeter";};util.inherits(EnergyMeter,Device),EnergyMeter.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"BOOT"},{channel:this.deviceAdr+":"+this.channel,dpt:"GAS_ENERGY_COUNTER"},{channel:this.deviceAdr+":"+this.channel,dpt:"GAS_POWER"},{channel:this.deviceAdr+":"+this.channel,dpt:"ENERGY_COUNTER"},{channel:this.deviceAdr+":"+this.channel,dpt:"POWER"}];},EnergyMeter.prototype._getDptFromRef=function(e){var t={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(e){case"lowbat":t.channel=0,t.dataPoint="LOWBAT";break;case"timeout":t.channel=0,t.dataPoint="UNREACH";break;case"boot":t.dataPoint="BOOT";break;case"gas_energy":t.dataPoint="GAS_ENERGY_COUNTER";break;case"gas_power":t.dataPoint="GAS_POWER";break;case"energy":t.dataPoint="ENERGY_COUNTER";break;case"power":t.dataPoint="POWER";break;default:return null;}return t;},EnergyMeter.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;if(0!=i&&i!=this.channel)return null;var o={};if(0==i)return"UNREACH"==t?o.timeout=a:"LOWBAT"==t?o.lowbat=a:o["0_"+t.toLowerCase()]=a,o;switch(t){case"BOOT":o.boot=a;break;case"GAS_ENERGY_COUNTER":o.gas_energy=a;break;case"GAS_POWER":o.gas_power=a;break;case"ENERGY_COUNTER":o.energy=a;break;case"POWER":o.power=a;break;default:return null;}return o;};var RGB=function RGB(e,t,a){Device.call(this,e,t,a),this.dimChannel=1,this.rgbChannel=2,this.autoChannel=3,this.legacyType="rgb";};util.inherits(RGB,Device),RGB.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.dimChannel,dpt:"LEVEL"},{channel:this.deviceAdr+":"+this.rgbChannel,dpt:"COLOR"},{channel:this.deviceAdr+":"+this.autoChannel,dpt:"PROGRAM"}];},RGB.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t,dataPoint:null};switch(e){case"timeout":a.channel=0,a.dataPoint="UNREACH";break;case"state":a.channel=t+":"+this.dimChannel,a.dataPoint="LEVEL";break;case"color":a.channel=t+":"+this.rgbChannel,a.dataPoint="COLOR";break;case"program":a.channel=t+":"+this.autoChannel,a.dataPoint="PROGRAM";break;case"inhibit":a.channel=t+":"+this.dimChannel,a.dataPoint="INHIBIT";break;case"working":a.channel=t+":"+this.dimChannel,a.dataPoint="WORKING";break;case"direction":a.channel=t+":"+this.dimChannel,a.dataPoint="DIRECTION";break;default:return null;}return a;},RGB.prototype.executeCommand=function(e,t,a){var r,n,i=this;switch(t){case"on":r=this.deviceAdr+":"+this.dimChannel,n="OLD_LEVEL",e.writeValue(this.deviceIF,r,n,!0,a);break;case"off":r=this.deviceAdr+":"+this.dimChannel,n="LEVEL",e.writeValue(this.deviceIF,r,n,{type:"double",value:0},a);break;case"white":r=this.deviceAdr+":"+this.rgbChannel,n="COLOR",e.writeValue(this.deviceIF,r,n,200,a);break;case"dimUp":r=this.deviceAdr+":"+this.dimChannel,n="LEVEL",e.getState({"interface":this.deviceIF,channel:r,datapoint:n},function(t,s){if(t)a&&a(t);else if(s){var o=s.value+.05;o>1&&(o=1),e.writeValue(i.deviceIF,r,n,{type:"double",value:o},a);}else a&&a(new Error("get current dimmer state result invalid"));});break;case"dimDown":r=this.deviceAdr+":"+this.dimChannel,n="LEVEL",e.getState({"interface":this.deviceIF,channel:r,datapoint:n},function(t,s){if(t)a&&a(t);else if(s){var o=s.value-.05;o<0&&(o=0),e.writeValue(i.deviceIF,r,n,{type:"double",value:o},a);}else a&&a(new Error("get current dimmer state result invalid"));});break;default:if("onTo"==t.substr(0,4)||t.match(/^[-+]?[0-9]+$/)){"onTo"==t.substr(0,4)&&(t=t.substr(4));var s=parseInt(t);r=this.deviceAdr+":"+this.dimChannel,s/=100,n="LEVEL",e.writeValue(this.deviceIF,r,n,{type:"double",value:s},a);}else if("setProg"==t.substr(0,7)){t=t.substr(7);s=parseInt(t);r=this.deviceAdr+":"+this.autoChannel,n="PROGRAM",e.writeValue(this.deviceIF,r,n,s,a);}else if("setRampTime"==t.substr(0,11)){t=t.substr(11);s=parseFloat(t);r=this.deviceAdr+":"+this.dimChannel,n="RAMP_TIME",e.writeValue(this.deviceIF,r,n,{type:"double",value:s},a);}else if(t.toLowerCase().match(/^([0-9a-f]{6})$/i)){var o=parseInt(t.substr(0,2),16),c=parseInt(t.substr(2,2),16),l=parseInt(t.substr(4,2),16),u=0,h=this._RGBToHSV(o,c,l);u=h[1]<.1?200:Math.round(h[0]/1.8),r=this.deviceAdr+":"+this.rgbChannel,n="COLOR",e.writeValue(this.deviceIF,r,n,u,a);}else a&&a(new Error("no such command"));}},RGB.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;if(0!=i&&i!=this.dimChannel&&i!=this.rgbChannel&&i!=this.autoChannel)return null;var o={};if(0==i)return"UNREACH"==t?o.timeout=a:o["0_"+t.toLowerCase()]=a,o;switch(t){case"LEVEL":o.state=100*parseFloat(a);break;case"COLOR":o.color=a;break;case"PROGRAM":o.program=a;break;case"INHIBIT":o.inhibit=a;break;case"WORKING":o.working=a;break;case"DIRECTION":o.direction=a;break;default:return null;}return o;},RGB.prototype._RGBToHSV=function(e,t,a){e/=255,t/=255,a/=255;var r=Math.min(e,Math.min(t,a)),n=Math.max(e,Math.max(t,a));return r==n?[0,0,r]:[60*((e==r?3:a==r?1:5)-(e==r?t-a:a==r?e-t:a-e)/(n-r)),(n-r)/n,n];};var LUX=function LUX(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="lux";};util.inherits(LUX,Device),LUX.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"LOWBAT"},{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"LUX"}];},LUX.prototype._getDptFromRef=function(e){var t={channel:this.deviceAdr+":"+this.channel,dataPoint:null};switch(e){case"lowbat":t.channel=0,t.dataPoint="LOWBAT";break;case"timeout":t.channel=0,t.dataPoint="UNREACH";break;case"state":t.dataPoint="LUX";break;default:return null;}return t;},LUX.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;if(0!=i&&i!=this.channel)return null;var o={};return 0==i?("UNREACH"==t?o.timeout=a:"LOWBAT"==t?o.lowbat=a:o["0_"+t.toLowerCase()]=a,o):"LUX"!==t?null:(o.state=a,o);};var Siren2=function Siren2(e,t,a){Device.call(this,e,t,a),this.swChannel1=1,this.swChannel2=2,this.panicChannel=3,this.armingChannel=4,this.legacyType="siren2";};util.inherits(Siren2,Device),Siren2.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":0",dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.swChannel1,dpt:"STATE"},{channel:this.deviceAdr+":"+this.swChannel2,dpt:"STATE"},{channel:this.deviceAdr+":"+this.panicChannel,dpt:"STATE"},{channel:this.deviceAdr+":"+this.armingChannel,dpt:"ARMSTATE"},{channel:this.deviceAdr+":"+this.armingChannel,dpt:"INHIBIT"},{channel:this.deviceAdr+":"+this.armingChannel,dpt:"WORKING"},{channel:this.deviceAdr+":"+this.armingChannel,dpt:"ERROR_SABOTAGE"},{channel:this.deviceAdr+":"+this.armingChannel,dpt:"LOWBAT"}];},Siren2.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t,dataPoint:null};switch(e){case"timeout":a.channel=0,a.dataPoint="UNREACH";break;case"switchSensorInState":a.channel=t+":"+this.swChannel1,a.dataPoint="STATE";break;case"switchSensorExState":a.channel=t+":"+this.swChannel2,a.dataPoint="STATE";break;case"switchPanicState":a.channel=t+":"+this.panicChannel,a.dataPoint="STATE";break;case"arming":a.channel=t+":"+this.armingChannel,a.dataPoint="ARMSTATE";break;case"inhibit":a.channel=t+":"+this.armingChannel,a.dataPoint="INHIBIT";break;case"working":a.channel=t+":"+this.armingChannel,a.dataPoint="WORKING";break;case"sabotage":a.channel=t+":"+this.armingChannel,a.dataPoint="ERROR_SABOTAGE";break;case"lowbat":a.channel=t+":"+this.armingChannel,a.dataPoint="LOWBAT";break;default:return null;}return a;},Siren2.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o={};if(0==i)return"UNREACH"==t?o.timeout=a:o["0_"+t.toLowerCase()]=a,o;if(1==i)return"STATE"!==t?null:(o.switchSensorInState=a?"on":"off",o);if(2==i)return"STATE"!==t?null:(o.switchSensorExState=a?"on":"off",o);if(3==i)return"STATE"!==t?null:(o.switchPanicState=a?"on":"off",o);if(4==i){switch(t){case"ARMSTATE":switch(a){case 0:o.arming="disarmed";break;case 1:o.arming="ex_armed";break;case 2:o.arming="all_armed";break;case 3:o.arming="blocked";}break;case"INHIBIT":o.inhibit=a;break;case"WORKING":o.working=a;break;case"ERROR_SABOTAGE":switch(a){case 0:o.sabotage="no_error";break;case 1:o.sabotage="ex_armed";}break;case"LOWBAT":o.lowbat=a;break;default:return null;}return o;}},Siren2.prototype.executeCommand=function(e,t,a){var r,n,i=this;switch(t){case"switchSensorInOn":n="STATE",r=this.deviceAdr+":"+this.swChannel1,e.writeValue(this.deviceIF,r,n,!0,a);break;case"switchSensorInOff":n="STATE",r=this.deviceAdr+":"+this.swChannel1,e.writeValue(this.deviceIF,r,n,!1,a);break;case"switchSensorInToggle":n="STATE",r=this.deviceAdr+":"+this.swChannel1,e.getState({"interface":this.deviceIF,channel:r,datapoint:n},function(t,s){if(t)a&&a(t);else{var o=!0;s.value&&(o=!1),e.writeValue(i.deviceIF,r,n,o,a);}});break;case"switchSensorExOn":n="STATE",r=this.deviceAdr+":"+this.swChannel2,e.writeValue(this.deviceIF,r,n,!0,a);break;case"switchSensorExOff":n="STATE",r=this.deviceAdr+":"+this.swChannel2,e.writeValue(this.deviceIF,r,n,!1,a);break;case"switchSensorExToggle":n="STATE",r=this.deviceAdr+":"+this.swChannel2,e.getState({"interface":this.deviceIF,channel:r,datapoint:n},function(t,s){if(t)a&&a(t);else{var o=!0;s.value&&(o=!1),e.writeValue(i.deviceIF,r,n,o,a);}});break;case"switchPanicOn":n="STATE",r=this.deviceAdr+":"+this.panicChannel,e.writeValue(this.deviceIF,r,n,!0,a);break;case"switchPanicOff":n="STATE",r=this.deviceAdr+":"+this.panicChannel,e.writeValue(this.deviceIF,r,n,!1,a);break;case"switchPanicToggle":n="STATE",r=this.deviceAdr+":"+this.panicChannel,e.getState({"interface":this.deviceIF,channel:r,datapoint:n},function(t,s){if(t)a&&a(t);else{var o=!0;s.value&&(o=!1),e.writeValue(i.deviceIF,r,n,o,a);}});break;case"armingDisarm":n="ARMSTATE",r=this.deviceAdr+":"+this.armingChannel,e.writeValue(this.deviceIF,r,n,0,a);break;case"armingIntern":n="ARMSTATE",r=this.deviceAdr+":"+this.armingChannel,e.writeValue(this.deviceIF,r,n,1,a);break;case"armingAll":n="ARMSTATE",r=this.deviceAdr+":"+this.armingChannel,e.writeValue(this.deviceIF,r,n,2,a);break;default:a&&a(new Error("no such command"));}};var Jalousie=function Jalousie(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="jalousie";};util.inherits(Jalousie,Device),Jalousie.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["BidCos-RF"];e.push({channel:this.deviceAdr+":0",dpt:"UNREACH"});var r=a.JALOUSIE.getReadableDpts();return r&&r.forEach(function(a){e.push({channel:t.deviceAdr+":3",dpt:a});}),e;},Jalousie.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t+":"+this.channel,dataPoint:null},r=x.hub.m.hm._Channel["BidCos-RF"];if("timeout"===e)a.channel=t+":0",a.dataPoint="UNREACH";else if(a.channel=t+":"+this.channel,a.dataPoint=r.JALOUSIE.getDptFromState(e),!a.dataPoint)return null;return a;},Jalousie.prototype.executeCommand=function(e,t,a){var r=this.deviceAdr+":"+this.channel;x.hub.m.hm._Channel["BidCos-RF"].JALOUSIE.executeCommand(e,this.deviceIF,r,t,a);},Jalousie.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o=x.hub.m.hm._Channel["BidCos-RF"],c=null;return 0==i?"UNREACH"==t?{timeout:a}:((c={})["0_"+t.toLowerCase()]=a,c):i==this.channel?o.JALOUSIE.parseDptState(t,a):null;};var MOD_EM_8bit=function MOD_EM_8bit(e,t,a){Device.call(this,e,t,a),this.keyChannel1=1,this.keyChannel2=2,this.em8bitChannel=3,this.legacyType="mod_em_8bit";};util.inherits(MOD_EM_8bit,Device),MOD_EM_8bit.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["BidCos-RF"];e.push({channel:this.deviceAdr+":0",dpt:"UNREACH"});var r=a.KEY.getReadableDpts();return r&&r.forEach(function(a){e.push({channel:t.deviceAdr+":1",dpt:a}),e.push({channel:t.deviceAdr+":2",dpt:a});}),(r=a.MOD_EM8BIT_TRANSMITTER.getReadableDpts())&&r.forEach(function(a){e.push({channel:t.deviceAdr+":3",dpt:a});}),e;},MOD_EM_8bit.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t+":"+this.channel,dataPoint:null};x.hub.m.hm._Channel["BidCos-RF"];switch(e){case"timeout":a.channel=t+":0",a.dataPoint="UNREACH";break;case"lowbat":a.channel=t+":3",a.dataPoint="LOWBAT";break;case"state8bit":a.channel=t+":3",a.dataPoint="STATE";break;default:return null;}return a;},MOD_EM_8bit.prototype.executeCommand=function(e,t,a){var r,n=x.hub.m.hm._Channel["BidCos-RF"];switch(t){case"ch1pressShort":r=this.deviceAdr+":"+this.keyChannel1,n.KEY.executeCommand(e,this.deviceIF,r,"pressShort",a);break;case"ch1pressLong":r=this.deviceAdr+":"+this.keyChannel1,n.KEY.executeCommand(e,this.deviceIF,r,"pressLong",a);break;case"ch2pressShort":r=this.deviceAdr+":"+this.keyChannel2,n.KEY.executeCommand(e,this.deviceIF,r,"pressShort",a);break;case"ch2pressLong":r=this.deviceAdr+":"+this.keyChannel2,n.KEY.executeCommand(e,this.deviceIF,r,"pressLong",a);break;default:a&&a(new Error("no such command"));}},MOD_EM_8bit.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o,c=x.hub.m.hm._Channel["BidCos-RF"],l=null;return 0==i?"UNREACH"==t?{timeout:a}:((l={})["0_"+t.toLowerCase()]=a,l):i==this.keyChannel1?((o=c.KEY.parseDptState(t,a))&&(l={},o.pressShort&&(l.ch1pressShort=!0),o.pressLong&&(l.ch1pressLong=!0),void 0!==o.pressCont&&null!=o.pressCont&&(l.ch1pressCont=!0),o.pressLongRel&&(l.ch1pressLongRel=!0)),l):i==this.keyChannel2?((o=c.KEY.parseDptState(t,a))&&(l={},o.pressShort&&(l.ch2pressShort=!0),o.pressLong&&(l.ch2pressLong=!0),void 0!==o.pressCont&&null!=o.pressCont&&(l.ch2pressCont=!0),o.pressLongRel&&(l.ch2pressLongRel=!0)),l):i==this.em8bitChannel?c.MOD_EM8BIT_TRANSMITTER.parseDptState(t,a):null;},MOD_EM_8bit.prototype.isButton=function(){return!0;},MOD_EM_8bit.prototype.claimEvent=function(e,t){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);var r=this;e.reportValueUsage(this.deviceIF,a+":1","PRESS_SHORT",function(n,i){n&&console.error("button claim PRESS_SHORT event error:"+n.stack),e.reportValueUsage(r.deviceIF,a+":1","PRESS_LONG",function(n,i){n&&console.error("button claim PRESS_LONG event error:"+n.stack),e.reportValueUsage(r.deviceIF,a+":2","PRESS_SHORT",function(n,i){n&&console.error("button claim PRESS_SHORT event error:"+n.stack),e.reportValueUsage(r.deviceIF,a+":2","PRESS_LONG",function(e,a){t&&t();});});});});};var MOD_EM_8=function MOD_EM_8(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="mod_em_8";};util.inherits(MOD_EM_8,Device),MOD_EM_8.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["BidCos-RF"],r=a.KEY.getReadableDpts();return r&&r.forEach(function(a){e.push({channel:t.deviceAdr+":"+t.channel,dpt:a});}),(r=a.SWITCH_INTERFACE.getReadableDpts())&&r.forEach(function(a){e.push({channel:t.deviceAdr+":"+t.channel,dpt:a});}),(r=a.SHUTTER_CONTACT.getReadableDpts())&&r.forEach(function(a){"ERROR"!=a&&e.push({channel:t.deviceAdr+":"+t.channel,dpt:a});}),e;},MOD_EM_8.prototype._getDptFromRef=function(e){var t={channel:this.deviceAdr+":"+this.channel,dataPoint:null};x.hub.m.hm._Channel["BidCos-RF"];switch(e){case"state":t.dataPoint="STATE";break;case"lowbat":t.dataPoint="LOWBAT";break;default:return null;}return t;},MOD_EM_8.prototype.executeCommand=function(e,t,a){var r=x.hub.m.hm._Channel["BidCos-RF"],n=this.deviceAdr+":"+this.channel;switch(t){case"pressShort":r.KEY.executeCommand(e,this.deviceIF,n,"pressShort",a);break;case"pressLong":r.KEY.executeCommand(e,this.deviceIF,n,"pressLong",a);break;case"press":r.SWITCH_INTERFACE.executeCommand(e,this.deviceIF,n,"press",a);break;default:a&&a(new Error("no such command"));}},MOD_EM_8.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o,c=x.hub.m.hm._Channel["BidCos-RF"],l=null;return i==this.channel&&(l={},(o=c.KEY.parseDptState(t,a))&&(o.pressShort&&(l.pressShort=!0),o.pressLong&&(l.pressLong=!0),void 0!==o.pressCont&&null!=o.pressCont&&(l.pressCont=!0),o.pressLongRel&&(l.pressCont=!0)),(o=c.SWITCH_INTERFACE.parseDptState(t,a))&&o.press&&(l.press=!0),(o=c.SHUTTER_CONTACT.parseDptState(t,a))&&(o.state&&(l.state=o.state),void 0!==o.lowbat&&null!=o.lowbat&&(l.lowbat=o.lowbat))),l;},MOD_EM_8.prototype.isButton=function(){return!0;},MOD_EM_8.prototype.claimEvent=function(e,t){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);var r=this;e.reportValueUsage(this.deviceIF,a,"PRESS_SHORT",function(n,i){n&&console.error("button claim PRESS_SHORT event error:"+n.stack),e.reportValueUsage(r.deviceIF,a,"PRESS_LONG",function(n,i){n&&console.error("button claim PRESS_LONG event error:"+n.stack),e.reportValueUsage(r.deviceIF,a,"PRESS",function(e,a){e&&console.error("button claim PRESS_SHORT event error:"+e.stack),t&&t();});});});};var KeyMatic=function KeyMatic(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="keymatic";};util.inherits(KeyMatic,Device),KeyMatic.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["BidCos-RF"],r=a.MAINTENANCE.getReadableDpts();return r&&r.forEach(function(a){e.push({channel:t.deviceAdr+":0",dpt:a});}),(r=a.KEYMATIC.getReadableDpts())&&r.forEach(function(a){e.push({channel:t.deviceAdr+":1",dpt:a});}),e;},KeyMatic.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t+":"+this.channel,dataPoint:null};x.hub.m.hm._Channel["BidCos-RF"];switch(e){case"timeout":a.channel=t+":0",a.dataPoint="UNREACH";break;case"lowbat":a.channel=t+":0",a.dataPoint="LOWBAT";break;case"state":a.channel=t+":1",a.dataPoint="STATE";break;case"uncertain":a.channel=t+":1",a.dataPoint="STATE_UNCERTAIN";break;case"error":a.channel=t+":1",a.dataPoint="ERROR";break;default:return null;}return a;},KeyMatic.prototype.executeCommand=function(e,t,a){var r,n=x.hub.m.hm._Channel["BidCos-RF"];switch(t){case"open":r=this.deviceAdr+":"+this.channel,n.KEYMATIC.executeCommand(e,this.deviceIF,r,"open",a);break;case"close":r=this.deviceAdr+":"+this.channel,n.KEYMATIC.executeCommand(e,this.deviceIF,r,"close",a);break;case"openDoor":r=this.deviceAdr+":"+this.channel,n.KEYMATIC.executeCommand(e,this.deviceIF,r,"openDoor",a);break;default:a&&a(new Error("no such command"));}},KeyMatic.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o=x.hub.m.hm._Channel["BidCos-RF"],c=null;return 0==i?"UNREACH"==t||"LOWBAT"==t?o.MAINTENANCE.parseDptState(t,a):((c={})["0_"+t.toLowerCase()]=a,c):i==this.channel?o.KEYMATIC.parseDptState(t,a):null;};var OU_LED16=function OU_LED16(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="ou_led16";};util.inherits(OU_LED16,Device),OU_LED16.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":"+this.channel,dpt:"LED_STATUS"}];},OU_LED16.prototype._getDptFromRef=function(e){var t=this.deviceAdr;-1==t.indexOf(":")&&this.channel&&(t+=":"+this.channel);var a={channel:t,dataPoint:null};return"led"!==e?null:(a.dataPoint="LED_STATUS",a);},OU_LED16.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;if(0!=i&&i!=this.channel)return null;if(0==i){var o={};return"UNREACH"==t?o.timeout=a:"LOWBAT"==t?o.lowbat=a:o["0_"+t.toLowerCase()]=a,o;}if("LED_STATUS"!==t)return null;switch(a){case 0:return{led:"off"};case 1:return{led:"red"};case 2:return{led:"green"};case 3:return{led:"orange"};default:return null;}},OU_LED16.prototype.executeCommand=function(e,t,a){var r,n=this.deviceAdr;-1==n.indexOf(":")&&this.channel&&(n+=":"+this.channel);switch(t){case"pressShort":r="PRESS_SHORT",e.writeValue(this.deviceIF,n,r,!0,a);break;case"ledOff":r="LED_STATUS",e.writeValue(this.deviceIF,n,r,0,a);break;case"ledRed":r="LED_STATUS",e.writeValue(this.deviceIF,n,r,1,a);break;case"ledGreen":r="LED_STATUS",e.writeValue(this.deviceIF,n,r,2,a);break;case"ledOrange":r="LED_STATUS",e.writeValue(this.deviceIF,n,r,3,a);break;case"ledSleepOff":r="LED_SLEEP_MODE",e.writeValue(this.deviceIF,n,r,0,a);break;case"ledSleepOn":r="LED_SLEEP_MODE",e.writeValue(this.deviceIF,n,r,1,a);break;default:a&&a(new Error("no such command"));}},OU_LED16.prototype.isButton=function(){return!0;},OU_LED16.prototype.claimEvent=function(e,t){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);e.reportValueUsage(this.deviceIF,a,"PRESS_SHORT",function(e,a){e&&console.error("button claim PRESS_SHORT event error:"+e.stack),t&&t();});};var HM_Dis_EP_WM55=function HM_Dis_EP_WM55(e,t,a){Device.call(this,e,t,a),this.channel=3,this.legacyType="hm_dis_ep_wm55";};util.inherits(HM_Dis_EP_WM55,Device),HM_Dis_EP_WM55.prototype.executeCommand=function(e,t,a){var r;if("submit"==t.substr(0,6)){var n=t.substr(6);r=this.deviceAdr+":"+this.channel,"SUBMIT",e.writeValue(this.deviceIF,r,"SUBMIT",n,a);}else a&&a(new Error("no such command"));};var HM_LC_DW_WM=function HM_LC_DW_WM(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="dualwhite";};util.inherits(HM_LC_DW_WM,Device),HM_LC_DW_WM.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["BidCos-RF"],r=a.MAINTENANCE.getReadableDpts();return r&&r.forEach(function(a){"UNREACH"==a&&e.push({channel:t.deviceAdr+":0",dpt:a});}),(r=a.DUAL_WHITE_BRIGHTNESS.getReadableDpts())&&r.forEach(function(a){e.push({channel:t.deviceAdr+":1",dpt:a});}),(r=a.DUAL_WHITE_COLOR.getReadableDpts())&&r.forEach(function(a){e.push({channel:t.deviceAdr+":2",dpt:a});}),e;},HM_LC_DW_WM.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t+":"+this.channel,dataPoint:null},r=x.hub.m.hm._Channel["BidCos-RF"];switch(e){case"timeout":a.channel=t+":0",a.dataPoint=r.MAINTENANCE.getDptFromState(e);break;case"bri":case"bri_real":case"error_overheat":case"error_reduced":case"direction":a.channel=t+":1",a.dataPoint=r.DUAL_WHITE_BRIGHTNESS.getDptFromState(e);break;case"color":case"color_real":case"color_direction":a.channel=t+":2",a.dataPoint=r.DIMMER_VIRTUAL_RECEIVER.getDptFromState(e);break;default:return null;}return a;},HM_LC_DW_WM.prototype.executeCommand=function(e,t,a){var r=x.hub.m.hm._Channel["BidCos-RF"],n=t;switch(n){case"off":case"on":case"toggle":case"dimUp":case"dimDown":r.DUAL_WHITE_BRIGHTNESS.executeCommand(e,this.deviceIF,this.deviceAdr+":1",n,a);break;case"colorOff":case"colorOn":case"colorToggle":case"colorUp":case"colorDown":r.DUAL_WHITE_COLOR.executeCommand(e,this.deviceIF,this.deviceAdr+":2",n,a);break;default:"dimTo"==n.substr(0,5)?r.DUAL_WHITE_BRIGHTNESS.executeCommand(e,this.deviceIF,this.deviceAdr+":1",n,a):"colorTo"==n.substr(0,7)?r.DUAL_WHITE_COLOR.executeCommand(e,this.deviceIF,this.deviceAdr+":2",n,a):a&&a(new Error("no such command"));}},HM_LC_DW_WM.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o=x.hub.m.hm._Channel["BidCos-RF"],c=null;return 0==i?"UNREACH"==t?o.MAINTENANCE.parseDptState(t,a):((c={})["0_"+t.toLowerCase()]=a,c):1==i?o.DUAL_WHITE_BRIGHTNESS.parseDptState(t,a):2==i?o.DUAL_WHITE_COLOR.parseDptState(t,a):null;};var IPSwitch=function IPSwitch(e,t,a){Switch.call(this,e,t,a),this.channel=3,this.legacyType="ip_switch";};util.inherits(IPSwitch,Switch);var IPContact=function IPContact(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="ip_contact";};util.inherits(IPContact,Device),IPContact.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["HmIP-RF"],r=a.MAINTENANCE_BAT_EL.getReadableDpts();return r&&r.forEach(function(a){e.push({channel:t.deviceAdr+":0",dpt:a});}),(r=a.SHUTTER_CONTACT_TRANSCEIVER.getReadableDpts())&&r.forEach(function(a){e.push({channel:t.deviceAdr+":1",dpt:a});}),e;},IPContact.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t+":"+this.channel,dataPoint:null},r=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case"timeout":case"lowbat":case"sabotage":a.channel=t+":0",a.dataPoint=r.MAINTENANCE_BAT_EL.getDptFromState(e);break;case"state":a.channel=t+":1",a.dataPoint=r.SHUTTER_CONTACT_TRANSCEIVER.getDptFromState(e);break;default:return null;}return a;},IPContact.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o=x.hub.m.hm._Channel["HmIP-RF"],c=null;return 0==i?"UNREACH"==t||"LOW_BAT"==t||"SABOTAGE"==t?o.MAINTENANCE_BAT_EL.parseDptState(t,a):((c={})["0_"+t.toLowerCase()]=a,c):1==i?o.SHUTTER_CONTACT_TRANSCEIVER.parseDptState(t,a):null;};var IPHeater=function IPHeater(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="ip_heater";};util.inherits(IPHeater,Device),IPHeater.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["HmIP-RF"],r=a.MAINTENANCE_BAT_EL.getReadableDpts();return r&&r.forEach(function(a){"SABOTAGE"!=a&&e.push({channel:t.deviceAdr+":0",dpt:a});}),(r=a.HEATING_CLIMATECONTROL_TRANSCEIVER.getReadableDpts())&&r.forEach(function(a){"HUMIDITY"!=a&&e.push({channel:t.deviceAdr+":1",dpt:a});}),e;},IPHeater.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t+":"+this.channel,dataPoint:null},r=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case"timeout":case"lowbat":a.channel=t+":0",a.dataPoint=r.MAINTENANCE_BAT_EL.getDptFromState(e);break;case"profile":case"temp":case"boost":case"frost":case"mode":case"state":case"window":a.channel=t+":1",a.dataPoint=r.HEATING_CLIMATECONTROL_TRANSCEIVER.getDptFromState(e);break;default:return null;}return a;},IPHeater.prototype.executeCommand=function(e,t,a){var r=this.deviceAdr+":"+this.channel;x.hub.m.hm._Channel["HmIP-RF"].HEATING_CLIMATECONTROL_TRANSCEIVER.executeCommand(e,this.deviceIF,r,t,a);},IPHeater.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o=x.hub.m.hm._Channel["HmIP-RF"],c=null;return 0==i?"UNREACH"==t||"LOW_BAT"==t?o.MAINTENANCE.parseDptState(t,a):((c={})["0_"+t.toLowerCase()]=a,c):1==i?o.HEATING_CLIMATECONTROL_TRANSCEIVER.parseDptState(t,a):c;};var IPPowerSwitch=function IPPowerSwitch(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="ip_powerswitch";};util.inherits(IPPowerSwitch,Device),IPPowerSwitch.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["HmIP-RF"],r=a.MAINTENANCE.getReadableDpts();return r&&r.forEach(function(a){"UNREACH"==a&&e.push({channel:t.deviceAdr+":0",dpt:a});}),(r=a.SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&r.forEach(function(a){e.push({channel:t.deviceAdr+":3",dpt:a});}),(r=a.ENERGIE_METER_TRANSMITTER.getReadableDpts())&&r.forEach(function(a){e.push({channel:t.deviceAdr+":6",dpt:a});}),e;},IPPowerSwitch.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t+":"+this.channel,dataPoint:null},r=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case"timeout":a.channel=t+":0",a.dataPoint=r.MAINTENANCE.getDptFromState(e);break;case"switchState":a.channel=t+":3",a.dataPoint=r.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case"meterVoltage":case"meterEnergyCounter":case"meterFrequency":case"meterPower":case"meterCurrent":a.channel=t+":6",a.dataPoint=r.ENERGIE_METER_TRANSMITTER.getDptFromState(e);break;default:return null;}return a;},IPPowerSwitch.prototype.executeCommand=function(e,t,a){var r=null,n=x.hub.m.hm._Channel["HmIP-RF"];switch(t){case"on":r=this.deviceAdr+":3",n.SWITCH_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,r,"on",a);break;case"off":r=this.deviceAdr+":3",n.SWITCH_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,r,"off",a);break;case"toggle":r=this.deviceAdr+":3",n.SWITCH_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,r,"toggle",a);break;default:if("onFor"==t.substr(0,5))return r=this.deviceAdr+":3",void n.SWITCH_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,r,t,a);a&&a(new Error("no such command"));}},IPPowerSwitch.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o=x.hub.m.hm._Channel["HmIP-RF"],c=null;return 0==i?"UNREACH"==t?o.MAINTENANCE.parseDptState(t,a):((c={})["0_"+t.toLowerCase()]=a,c):3==i?o.SWITCH_VIRTUAL_RECEIVER.parseDptState(t,a):6==i?o.ENERGIE_METER_TRANSMITTER.parseDptState(t,a):null;};var IPEnergyActor=function IPEnergyActor(e,t,a){Device.call(this,e,t,a),this.channel=1,this._chKeyTransceivers=[],"HmIP-BSM"==e&&(this._chKeyTransceivers=[1,2]),this.legacyType="ip_energyactor";};util.inherits(IPEnergyActor,Device),IPEnergyActor.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["HmIP-RF"],r=a.MAINTENANCE.getReadableDpts();return r&&r.forEach(function(a){"UNREACH"==a&&e.push({channel:t.deviceAdr+":0",dpt:a});}),(r=a.SWITCH_TRANSMITTER.getReadableDpts())&&r.forEach(function(a){e.push({channel:t.deviceAdr+":3",dpt:a});}),(r=a.SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&r.forEach(function(a){e.push({channel:t.deviceAdr+":4",dpt:a}),e.push({channel:t.deviceAdr+":5",dpt:a}),e.push({channel:t.deviceAdr+":6",dpt:a});}),(r=a.ENERGIE_METER_TRANSMITTER.getReadableDpts())&&r.forEach(function(a){e.push({channel:t.deviceAdr+":7",dpt:a});}),e;},IPEnergyActor.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t+":"+this.channel,dataPoint:null},r=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case"timeout":a.channel=t+":0",a.dataPoint=r.MAINTENANCE.getDptFromState(e);break;case"switchState":a.channel=t+":3",a.dataPoint=r.SWITCH_TRANSMITTER.getDptFromState("switchTState");break;case"ch4State":a.channel=t+":4",a.dataPoint=r.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case"ch5State":a.channel=t+":5",a.dataPoint=r.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case"ch6State":a.channel=t+":6",a.dataPoint=r.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case"meterVoltage":case"meterEnergyCounter":case"meterFrequency":case"meterPower":case"meterCurrent":a.channel=t+":7",a.dataPoint=r.ENERGIE_METER_TRANSMITTER.getDptFromState(e);break;default:return null;}return a;},IPEnergyActor.prototype.executeCommand=function(e,t,a){var r=null,n=x.hub.m.hm._Channel["HmIP-RF"];switch(t){case"on":case"ch4on":case"ch5on":case"ch6on":switch(t){case"on":case"ch4on":r=this.deviceAdr+":4";break;case"ch5on":r=this.deviceAdr+":5";break;case"ch6on":r=this.deviceAdr+":6";}n.SWITCH_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,r,"on",a);break;case"off":case"ch4off":case"ch5off":case"ch6off":switch(t){case"off":case"ch4off":r=this.deviceAdr+":4";break;case"ch5off":r=this.deviceAdr+":5";break;case"ch6off":r=this.deviceAdr+":6";}n.SWITCH_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,r,"off",a);break;case"toggle":case"ch4toggle":case"ch5toggle":case"ch6toggle":switch(t){case"toggle":case"ch4toggle":r=this.deviceAdr+":4";break;case"ch5toggle":r=this.deviceAdr+":5";break;case"ch6toggle":r=this.deviceAdr+":6";}n.SWITCH_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,r,"toggle",a);break;default:a&&a(new Error("no such command"));}},IPEnergyActor.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o,c=x.hub.m.hm._Channel["HmIP-RF"],l=null;if(0==i)return"UNREACH"==t?c.MAINTENANCE.parseDptState(t,a):((l={})["0_"+t.toLowerCase()]=a,l);if(3==i)return(o=c.SWITCH_TRANSMITTER.parseDptState(t,a))&&((l={}).switchState=o.switchTState),l;if(4==i||5==i||6==i){if(o=c.SWITCH_VIRTUAL_RECEIVER.parseDptState(t,a))switch(l={},parseInt(i)){case 4:l.ch4State=o.switchState;break;case 5:l.ch5State=o.switchState;break;case 6:l.ch6State=o.switchState;}return l;}return 7==i?c.ENERGIE_METER_TRANSMITTER.parseDptState(t,a):null;},IPEnergyActor.prototype.isButton=function(){return this._chKeyTransceivers.length>0;},IPEnergyActor.prototype.claimEvent=function(e,t){var a=0,r=this,cb=function cb(){++a<r._chKeyTransceivers.length?r._claimButtonEvent(r._chKeyTransceivers[a],e,cb):t&&t();};this._claimButtonEvent(this._chKeyTransceivers[a],e,cb);},IPEnergyActor.prototype._claimButtonEvent=function(e,t,a){var r=this;t.reportValueUsage(this.deviceIF,this.deviceAdr+":"+e,"PRESS_SHORT",function(n,i){n&&console.error("button:"+e+" claim PRESS_SHORT event error:"+n.stack),t.reportValueUsage(r.deviceIF,r.deviceAdr+":"+e,"PRESS_LONG",function(t,r){t&&console.error("button:"+e+" claim PRESS_LONG event error:"+t.stack),a&&a();});});};var IPEnergyActor2=function IPEnergyActor2(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="ip_energyactor2";};util.inherits(IPEnergyActor2,Device),IPEnergyActor2.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["HmIP-RF"],r=a.MAINTENANCE.getReadableDpts();return r&&r.forEach(function(a){"UNREACH"==a&&e.push({channel:t.deviceAdr+":0",dpt:a});}),(r=a.SWITCH_TRANSMITTER.getReadableDpts())&&r.forEach(function(a){e.push({channel:t.deviceAdr+":1",dpt:a});}),(r=a.SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&r.forEach(function(a){e.push({channel:t.deviceAdr+":2",dpt:a}),e.push({channel:t.deviceAdr+":3",dpt:a}),e.push({channel:t.deviceAdr+":4",dpt:a});}),(r=a.ENERGIE_METER_TRANSMITTER.getReadableDpts())&&r.forEach(function(a){e.push({channel:t.deviceAdr+":5",dpt:a});}),e;},IPEnergyActor2.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t+":"+this.channel,dataPoint:null},r=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case"timeout":a.channel=t+":0",a.dataPoint=r.MAINTENANCE.getDptFromState(e);break;case"switchState":a.channel=t+":1",a.dataPoint=r.SWITCH_TRANSMITTER.getDptFromState("switchTState");break;case"ch2State":a.channel=t+":2",a.dataPoint=r.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case"ch3State":a.channel=t+":3",a.dataPoint=r.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case"ch4State":a.channel=t+":4",a.dataPoint=r.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case"meterVoltage":case"meterEnergyCounter":case"meterFrequency":case"meterPower":case"meterCurrent":a.channel=t+":5",a.dataPoint=r.ENERGIE_METER_TRANSMITTER.getDptFromState(e);break;default:return null;}return a;},IPEnergyActor2.prototype.executeCommand=function(e,t,a){var r=null,n=x.hub.m.hm._Channel["HmIP-RF"];switch(t){case"on":case"ch2on":case"ch3on":case"ch4on":switch(t){case"on":case"ch2on":r=this.deviceAdr+":2";break;case"ch3on":r=this.deviceAdr+":3";break;case"ch4on":r=this.deviceAdr+":4";}n.SWITCH_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,r,"on",a);break;case"off":case"ch2off":case"ch3off":case"ch4off":switch(t){case"off":case"ch2off":r=this.deviceAdr+":2";break;case"ch3off":r=this.deviceAdr+":3";break;case"ch4off":r=this.deviceAdr+":4";}n.SWITCH_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,r,"off",a);break;case"toggle":case"ch2toggle":case"ch3toggle":case"ch4toggle":switch(t){case"toggle":case"ch2toggle":r=this.deviceAdr+":2";break;case"ch3toggle":r=this.deviceAdr+":3";break;case"ch4toggle":r=this.deviceAdr+":4";}n.SWITCH_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,r,"toggle",a);break;default:a&&a(new Error("no such command"));}},IPEnergyActor2.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o,c=x.hub.m.hm._Channel["HmIP-RF"],l=null;if(0==i)return"UNREACH"==t?c.MAINTENANCE.parseDptState(t,a):((l={})["0_"+t.toLowerCase()]=a,l);if(1==i)return(o=c.SWITCH_TRANSMITTER.parseDptState(t,a))&&((l={}).switchState=o.switchTState),l;if(2==i||3==i||4==i){if(o=c.SWITCH_VIRTUAL_RECEIVER.parseDptState(t,a))switch(l={},parseInt(i)){case 2:l.ch2State=o.switchState;break;case 3:l.ch3State=o.switchState;break;case 4:l.ch4State=o.switchState;}return l;}return 5==i?c.ENERGIE_METER_TRANSMITTER.parseDptState(t,a):null;};var IPDimmer=function IPDimmer(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="ip_dimmer";};util.inherits(IPDimmer,Device),IPDimmer.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["HmIP-RF"],r=a.MAINTENANCE.getReadableDpts();return r&&r.forEach(function(a){"UNREACH"==a&&e.push({channel:t.deviceAdr+":0",dpt:a});}),(r=a.DIMMER_TRANSMITTER.getReadableDpts())&&r.forEach(function(a){e.push({channel:t.deviceAdr+":3",dpt:a});}),(r=a.DIMMER_VIRTUAL_RECEIVER.getReadableDpts())&&r.forEach(function(a){e.push({channel:t.deviceAdr+":4",dpt:a}),e.push({channel:t.deviceAdr+":5",dpt:a}),e.push({channel:t.deviceAdr+":6",dpt:a});}),e;},IPDimmer.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t+":"+this.channel,dataPoint:null},r=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case"timeout":a.channel=t+":0",a.dataPoint=r.MAINTENANCE.getDptFromState(e);break;case"dimmerLevel":a.channel=t+":3",a.dataPoint=r.DIMMER_TRANSMITTER.getDptFromState("dimmerTLevel");break;case"ch4Level":a.channel=t+":4",a.dataPoint=r.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case"ch5Level":a.channel=t+":5",a.dataPoint=r.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case"ch6Level":a.channel=t+":6",a.dataPoint=r.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;default:return null;}return a;},IPDimmer.prototype.executeCommand=function(e,t,a){var r,n,i=null,s=x.hub.m.hm._Channel["HmIP-RF"],o=t;-1!=t.indexOf("dimUp")?(n=t.indexOf("dimUp"),o=t.substr(0,n+5),r=t.substr(n+5)):-1!=t.indexOf("dimDown")?(n=t.indexOf("dimDown"),o=t.substr(0,n+7),r=t.substr(n+7)):-1!=t.indexOf("dimTo")?(n=t.indexOf("dimTo"),o=t.substr(0,n+5),r=t.substr(n+5)):-1!=t.indexOf("toggleTo")&&(n=t.indexOf("toggleTo"),o=t.substr(0,n+8),r=t.substr(n+8));var c=this;switch(o){case"dimOff":s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,this.deviceAdr+":4","dimOff",function(t,r){t?a&&a(t,r):s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":5","dimOff",function(t,r){t?a&&a(t,r):s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":6","dimOff",a);});});break;case"dimUp":r=r?parseInt(r)/100:.1,e.getState({"interface":this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(t,n){t?a&&a(t):void 0!==n&&null!=n?((r=n.value+r)>1&&(r=1),r=Math.round(100*r),s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":4","dimTo"+r,function(t,n){t?a&&a(t,n):s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":5","dimTo"+r,function(t,n){t?a&&a(t,n):s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":6","dimTo"+r,a);});})):a&&a(new Error("get dimmer current value return invalid"));});break;case"dimDown":r=r?parseInt(r)/100:.1,e.getState({"interface":this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(t,n){t?a&&a(t):void 0!==n&&null!=n?((r=n.value-r)<0&&(r=0),r=Math.round(100*r),s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":4","dimTo"+r,function(t,n){t?a&&a(t,n):s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":5","dimTo"+r,function(t,n){t?a&&a(t,n):s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":6","dimTo"+r,a);});})):a&&a(new Error("get dimmer current value return invalid"));});break;case"dimTo":if(!r)return void(a&&a(new Error("dimTo has no value")));s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,this.deviceAdr+":4","dimTo"+r,function(t,n){t?a&&a(t,n):s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":5","dimTo"+r,function(t,n){t?a&&a(t,n):s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":6","dimTo"+r,function(t,n){if(t)a&&a(t,n);else{var i=r/100;i>1&&(i=1),i<0&&(i=0),e.updateStatusBuffer(c.deviceIF,c.deviceAdr+":3","LEVEL",i,new Date().getTime()+1e3),a&&a(t);}});});});break;case"toggleTo":if(!r)return void(a&&a(new Error("toggle has no value")));e.getState({"interface":this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(t,n){t?a&&a(t):void 0!==n&&null!=n?(n.value&&(r=0),s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":4","dimTo"+r,function(t,n){t?a&&a(t,n):s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":5","dimTo"+r,function(t,n){t?a&&a(t,n):s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":6","dimTo"+r,a);});})):a&&a(new Error("get dimmer current value return invalid"));});break;case"ch4dimOff":case"ch5dimOff":case"ch6dimOff":switch(o){case"ch4dimOff":i=this.deviceAdr+":4";break;case"ch5dimOff":i=this.deviceAdr+":5";break;case"ch6dimOff":i=this.deviceAdr+":6";}s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,i,"dimOff",a);break;case"ch4dimUp":case"ch5dimUp":case"ch6dimUp":switch(o){case"ch4dimUp":i=this.deviceAdr+":4";break;case"ch5dimUp":i=this.deviceAdr+":5";break;case"ch6dimUp":i=this.deviceAdr+":6";}s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,i,"dimUp"+r,a);break;case"ch4dimDown":case"ch5dimDown":case"ch6dimDown":switch(o){case"ch4dimDown":i=this.deviceAdr+":4";break;case"ch5dimDown":i=this.deviceAdr+":5";break;case"ch6dimDown":i=this.deviceAdr+":6";}s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,i,"dimDown"+r,a);break;case"ch4dimTo":case"ch5dimTo":case"ch6dimTo":switch(o){case"ch4dimTo":i=this.deviceAdr+":4";break;case"ch5dimTo":i=this.deviceAdr+":5";break;case"ch6dimTo":i=this.deviceAdr+":6";}s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,i,"dimTo"+r,a);break;case"ch4toggleTo":case"ch5toggleTo":case"ch6toggleTo":switch(o){case"ch4toggleTo":i=this.deviceAdr+":4";break;case"ch5toggleTo":i=this.deviceAdr+":5";break;case"ch6toggleTo":i=this.deviceAdr+":6";}s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,i,"toggleTo"+r,a);break;default:a&&a(new Error("no such command"));}},IPDimmer.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o,c=x.hub.m.hm._Channel["HmIP-RF"],l=null;if(0==i)return"UNREACH"==t?c.MAINTENANCE.parseDptState(t,a):((l={})["0_"+t.toLowerCase()]=a,l);if(3==i)return(o=c.DIMMER_TRANSMITTER.parseDptState(t,a))&&((l={}).dimmerLevel=o.dimmerTLevel),l;if(4==i||5==i||6==i){if(o=c.DIMMER_VIRTUAL_RECEIVER.parseDptState(t,a))switch(l={},parseInt(i)){case 4:l.ch4Level=o.dimmerLevel;break;case 5:l.ch5Level=o.dimmerLevel;break;case 6:l.ch6Level=o.dimmerLevel;}return l;}return null;};var IPDimmer2=function IPDimmer2(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="ip_dimmer2";};util.inherits(IPDimmer2,Device),IPDimmer2.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["HmIP-RF"],r=a.MAINTENANCE.getReadableDpts();return r&&r.forEach(function(a){"UNREACH"==a&&e.push({channel:t.deviceAdr+":0",dpt:a});}),(r=a.DIMMER_TRANSMITTER.getReadableDpts())&&r.forEach(function(a){e.push({channel:t.deviceAdr+":2",dpt:a});}),(r=a.DIMMER_VIRTUAL_RECEIVER.getReadableDpts())&&r.forEach(function(a){e.push({channel:t.deviceAdr+":3",dpt:a}),e.push({channel:t.deviceAdr+":4",dpt:a}),e.push({channel:t.deviceAdr+":5",dpt:a});}),e;},IPDimmer2.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t+":"+this.channel,dataPoint:null},r=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case"timeout":a.channel=t+":0",a.dataPoint=r.MAINTENANCE.getDptFromState(e);break;case"dimmerLevel":a.channel=t+":2",a.dataPoint=r.DIMMER_TRANSMITTER.getDptFromState("dimmerTLevel");break;case"ch4Level":a.channel=t+":3",a.dataPoint=r.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case"ch5Level":a.channel=t+":4",a.dataPoint=r.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case"ch6Level":a.channel=t+":5",a.dataPoint=r.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;default:return null;}return a;},IPDimmer2.prototype.executeCommand=function(e,t,a){var r,n,i=null,s=x.hub.m.hm._Channel["HmIP-RF"],o=t;-1!=t.indexOf("dimUp")?(n=t.indexOf("dimUp"),o=t.substr(0,n+5),r=t.substr(n+5)):-1!=t.indexOf("dimDown")?(n=t.indexOf("dimDown"),o=t.substr(0,n+7),r=t.substr(n+7)):-1!=t.indexOf("dimTo")?(n=t.indexOf("dimTo"),o=t.substr(0,n+5),r=t.substr(n+5)):-1!=t.indexOf("toggleTo")&&(n=t.indexOf("toggleTo"),o=t.substr(0,n+8),r=t.substr(n+8));var c=this;switch(o){case"dimOff":s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,this.deviceAdr+":3","dimOff",function(t,r){t?a&&a(t,r):s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":4","dimOff",function(t,r){t?a&&a(t,r):s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":5","dimOff",a);});});break;case"dimUp":r=r?parseInt(r)/100:.1,e.getState({"interface":this.deviceIF,channel:this.deviceAdr+":2",datapoint:"LEVEL"},function(t,n){t?a&&a(t):void 0!==n&&null!=n?((r=n.value+r)>1&&(r=1),r=Math.round(100*r),s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":3","dimTo"+r,function(t,n){t?a&&a(t,n):s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":4","dimTo"+r,function(t,n){t?a&&a(t,n):s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":5","dimTo"+r,a);});})):a&&a(new Error("get dimmer current value return invalid"));});break;case"dimDown":r=r?parseInt(r)/100:.1,e.getState({"interface":this.deviceIF,channel:this.deviceAdr+":2",datapoint:"LEVEL"},function(t,n){t?a&&a(t):void 0!==n&&null!=n?((r=n.value-r)<0&&(r=0),r=Math.round(100*r),s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":3","dimTo"+r,function(t,n){t?a&&a(t,n):s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":4","dimTo"+r,function(t,n){t?a&&a(t,n):s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":5","dimTo"+r,a);});})):a&&a(new Error("get dimmer current value return invalid"));});break;case"dimTo":if(!r)return void(a&&a(new Error("dimTo has no value")));s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,this.deviceAdr+":3","dimTo"+r,function(t,n){t?a&&a(t,n):s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":4","dimTo"+r,function(t,n){t?a&&a(t,n):s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":5","dimTo"+r,function(t,n){if(t)a&&a(t,n);else{var i=r/100;i>1&&(i=1),i<0&&(i=0),e.updateStatusBuffer(c.deviceIF,c.deviceAdr+":2","LEVEL",i,new Date().getTime()+1e3),a&&a(t);}});});});break;case"toggleTo":if(!r)return void(a&&a(new Error("toggle has no value")));e.getState({"interface":this.deviceIF,channel:this.deviceAdr+":2",datapoint:"LEVEL"},function(t,n){t?a&&a(t):void 0!==n&&null!=n?(n.value&&(r=0),s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":3","dimTo"+r,function(t,n){t?a&&a(t,n):s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":4","dimTo"+r,function(t,n){t?a&&a(t,n):s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":5","dimTo"+r,a);});})):a&&a(new Error("get dimmer current value return invalid"));});break;case"ch3dimOff":case"ch4dimOff":case"ch5dimOff":switch(o){case"ch3dimOff":i=this.deviceAdr+":3";break;case"ch4dimOff":i=this.deviceAdr+":4";break;case"ch5dimOff":i=this.deviceAdr+":5";}s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,i,"dimOff",a);break;case"ch3dimUp":case"ch4dimUp":case"ch5dimUp":switch(o){case"ch3dimUp":i=this.deviceAdr+":3";break;case"ch4dimUp":i=this.deviceAdr+":4";break;case"ch5dimUp":i=this.deviceAdr+":5";}s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,i,"dimUp"+r,a);break;case"ch3dimDown":case"ch4dimDown":case"ch5dimDown":switch(o){case"ch3dimDown":i=this.deviceAdr+":3";break;case"ch4dimDown":i=this.deviceAdr+":4";break;case"ch5dimDown":i=this.deviceAdr+":5";}s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,i,"dimDown"+r,a);break;case"ch3dimTo":case"ch4dimTo":case"ch5dimTo":switch(o){case"ch3dimTo":i=this.deviceAdr+":3";break;case"ch4dimTo":i=this.deviceAdr+":4";break;case"ch5dimTo":i=this.deviceAdr+":5";}s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,i,"dimTo"+r,a);break;case"ch3toggleTo":case"ch4toggleTo":case"ch5toggleTo":switch(o){case"ch3toggleTo":i=this.deviceAdr+":3";break;case"ch4toggleTo":i=this.deviceAdr+":4";break;case"ch5toggleTo":i=this.deviceAdr+":5";}s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,i,"toggleTo"+r,a);break;default:a&&a(new Error("no such command"));}},IPDimmer2.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o,c=x.hub.m.hm._Channel["HmIP-RF"],l=null;if(0==i)return"UNREACH"==t?c.MAINTENANCE.parseDptState(t,a):((l={})["0_"+t.toLowerCase()]=a,l);if(2==i)return(o=c.DIMMER_TRANSMITTER.parseDptState(t,a))&&((l={}).dimmerLevel=o.dimmerTLevel),l;if(3==i||4==i||5==i){if(o=c.DIMMER_VIRTUAL_RECEIVER.parseDptState(t,a))switch(l={},parseInt(i)){case 3:l.ch3Level=o.dimmerLevel;break;case 4:l.ch4Level=o.dimmerLevel;break;case 5:l.ch5Level=o.dimmerLevel;}return l;}return null;};var IPDimmer3=function IPDimmer3(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="ip_dimmer3";};util.inherits(IPDimmer3,Device),IPDimmer3.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["HmIP-RF"],r=a.MAINTENANCE.getReadableDpts();return r&&r.forEach(function(a){"UNREACH"==a&&e.push({channel:t.deviceAdr+":0",dpt:a});}),(r=a.DIMMER_TRANSMITTER.getReadableDpts())&&r.forEach(function(a){e.push({channel:t.deviceAdr+":1",dpt:a});}),(r=a.DIMMER_VIRTUAL_RECEIVER.getReadableDpts())&&r.forEach(function(a){e.push({channel:t.deviceAdr+":2",dpt:a}),e.push({channel:t.deviceAdr+":3",dpt:a}),e.push({channel:t.deviceAdr+":4",dpt:a});}),e;},IPDimmer3.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t+":"+this.channel,dataPoint:null},r=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case"timeout":a.channel=t+":0",a.dataPoint=r.MAINTENANCE.getDptFromState(e);break;case"dimmerLevel":a.channel=t+":1",a.dataPoint=r.DIMMER_TRANSMITTER.getDptFromState("dimmerTLevel");break;case"ch2Level":a.channel=t+":2",a.dataPoint=r.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case"ch3Level":a.channel=t+":3",a.dataPoint=r.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;case"ch4Level":a.channel=t+":4",a.dataPoint=r.DIMMER_VIRTUAL_RECEIVER.getDptFromState("dimmerLevel");break;default:return null;}return a;},IPDimmer3.prototype.executeCommand=function(e,t,a){var r,n,i=null,s=x.hub.m.hm._Channel["HmIP-RF"],o=t;-1!=t.indexOf("dimUp")?(n=t.indexOf("dimUp"),o=t.substr(0,n+5),r=t.substr(n+5)):-1!=t.indexOf("dimDown")?(n=t.indexOf("dimDown"),o=t.substr(0,n+7),r=t.substr(n+7)):-1!=t.indexOf("dimTo")?(n=t.indexOf("dimTo"),o=t.substr(0,n+5),r=t.substr(n+5)):-1!=t.indexOf("toggleTo")&&(n=t.indexOf("toggleTo"),o=t.substr(0,n+8),r=t.substr(n+8));var c=this;switch(o){case"dimOff":s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,this.deviceAdr+":2","dimOff",function(t,r){t?a&&a(t,r):s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":3","dimOff",function(t,r){t?a&&a(t,r):s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":4","dimOff",a);});});break;case"dimUp":r=r?parseInt(r)/100:.1,e.getState({"interface":this.deviceIF,channel:this.deviceAdr+":1",datapoint:"LEVEL"},function(t,n){t?a&&a(t):void 0!==n&&null!=n?((r=n.value+r)>1&&(r=1),r=Math.round(100*r),s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":2","dimTo"+r,function(t,n){t?a&&a(t,n):s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":3","dimTo"+r,function(t,n){t?a&&a(t,n):s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":4","dimTo"+r,a);});})):a&&a(new Error("get dimmer current value return invalid"));});break;case"dimDown":r=r?parseInt(r)/100:.1,e.getState({"interface":this.deviceIF,channel:this.deviceAdr+":1",datapoint:"LEVEL"},function(t,n){t?a&&a(t):void 0!==n&&null!=n?((r=n.value-r)<0&&(r=0),r=Math.round(100*r),s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":2","dimTo"+r,function(t,n){t?a&&a(t,n):s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":3","dimTo"+r,function(t,n){t?a&&a(t,n):s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":4","dimTo"+r,a);});})):a&&a(new Error("get dimmer current value return invalid"));});break;case"dimTo":if(!r)return void(a&&a(new Error("dimTo has no value")));s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,this.deviceAdr+":2","dimTo"+r,function(t,n){t?a&&a(t,n):s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":3","dimTo"+r,function(t,n){t?a&&a(t,n):s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":4","dimTo"+r,function(t,n){if(t)a&&a(t,n);else{var i=r/100;i>1&&(i=1),i<0&&(i=0),e.updateStatusBuffer(c.deviceIF,c.deviceAdr+":1","LEVEL",i,new Date().getTime()+1e3),a&&a(t);}});});});break;case"toggleTo":if(!r)return void(a&&a(new Error("toggle has no value")));e.getState({"interface":this.deviceIF,channel:this.deviceAdr+":1",datapoint:"LEVEL"},function(t,n){t?a&&a(t):void 0!==n&&null!=n?(n.value&&(r=0),s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":2","dimTo"+r,function(t,n){t?a&&a(t,n):s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":3","dimTo"+r,function(t,n){t?a&&a(t,n):s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":4","dimTo"+r,a);});})):a&&a(new Error("get dimmer current value return invalid"));});break;case"ch2dimOff":case"ch3dimOff":case"ch4dimOff":switch(o){case"ch2dimOff":i=this.deviceAdr+":2";break;case"ch3dimOff":i=this.deviceAdr+":3";break;case"ch4dimOff":i=this.deviceAdr+":4";}s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,i,"dimOff",a);break;case"ch2dimUp":case"ch3dimUp":case"ch4dimUp":switch(o){case"ch2dimUp":i=this.deviceAdr+":2";break;case"ch3dimUp":i=this.deviceAdr+":3";break;case"ch4dimUp":i=this.deviceAdr+":4";}s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,i,"dimUp"+r,a);break;case"ch2dimDown":case"ch3dimDown":case"ch4dimDown":switch(o){case"ch2dimDown":i=this.deviceAdr+":2";break;case"ch3dimDown":i=this.deviceAdr+":3";break;case"ch4dimDown":i=this.deviceAdr+":4";}s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,i,"dimDown"+r,a);break;case"ch2dimTo":case"ch3dimTo":case"ch4dimTo":switch(o){case"ch2dimTo":i=this.deviceAdr+":2";break;case"ch3dimTo":i=this.deviceAdr+":3";break;case"ch4dimTo":i=this.deviceAdr+":4";}s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,i,"dimTo"+r,a);break;case"ch2toggleTo":case"ch3toggleTo":case"ch4toggleTo":switch(o){case"ch2toggleTo":i=this.deviceAdr+":2";break;case"ch3toggleTo":i=this.deviceAdr+":3";break;case"ch4toggleTo":i=this.deviceAdr+":4";}s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,i,"toggleTo"+r,a);break;default:a&&a(new Error("no such command"));}},IPDimmer3.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o,c=x.hub.m.hm._Channel["HmIP-RF"],l=null;if(0==i)return"UNREACH"==t?c.MAINTENANCE.parseDptState(t,a):((l={})["0_"+t.toLowerCase()]=a,l);if(1==i)return(o=c.DIMMER_TRANSMITTER.parseDptState(t,a))&&((l={}).dimmerLevel=o.dimmerTLevel),l;if(2==i||3==i||4==i){if(o=c.DIMMER_VIRTUAL_RECEIVER.parseDptState(t,a))switch(l={},parseInt(i)){case 2:l.ch2Level=o.dimmerLevel;break;case 3:l.ch3Level=o.dimmerLevel;break;case 4:l.ch4Level=o.dimmerLevel;}return l;}return null;};var IPMotion=function IPMotion(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="ip_motion";};util.inherits(IPMotion,Device),IPMotion.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["HmIP-RF"],r=a.MAINTENANCE_BAT_EL.getReadableDpts();return r&&r.forEach(function(a){e.push({channel:t.deviceAdr+":0",dpt:a});}),(r=a.MOTIONDETECTOR_TRANSCEIVER.getReadableDpts())&&r.forEach(function(a){e.push({channel:t.deviceAdr+":1",dpt:a});}),e;},IPMotion.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t+":"+this.channel,dataPoint:null},r=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case"timeout":case"lowbat":case"sabotage":a.channel=t+":0",a.dataPoint=r.MAINTENANCE_BAT_EL.getDptFromState(e);break;case"state":case"illumination":case"active":a.channel=t+":1",a.dataPoint=r.MOTIONDETECTOR_TRANSCEIVER.getDptFromState(e);break;default:return null;}return a;},IPMotion.prototype.executeCommand=function(e,t,a){var r=x.hub.m.hm._Channel["HmIP-RF"];switch(t){case"reset":case"activate":case"deactivate":case"toggleActivate":r.MOTIONDETECTOR_TRANSCEIVER.executeCommand(e,this.deviceIF,this.deviceAdr+":1",t,a);break;default:a&&a(new Error("no such command"));}},IPMotion.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o=x.hub.m.hm._Channel["HmIP-RF"],c=null;return 0==i?"UNREACH"==t||"LOW_BAT"==t||"SABOTAGE"==t?o.MAINTENANCE_BAT_EL.parseDptState(t,a):((c={})["0_"+t.toLowerCase()]=a,c):1==i?o.MOTIONDETECTOR_TRANSCEIVER.parseDptState(t,a):null;};var IPMotion2=function IPMotion2(e,t,a){Device.call(this,e,t,a),this.channel=3,this.legacyType="ip_motion2";};util.inherits(IPMotion2,Device),IPMotion2.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["HmIP-RF"],r=a.MAINTENANCE_BAT_EL.getReadableDpts();return r&&r.forEach(function(a){"SABOTAGE"!=a&&e.push({channel:t.deviceAdr+":0",dpt:a});}),(r=a.MOTIONDETECTOR_TRANSCEIVER.getReadableDpts())&&r.forEach(function(a){e.push({channel:t.deviceAdr+":3",dpt:a});}),e;},IPMotion2.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t+":"+this.channel,dataPoint:null},r=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case"timeout":case"lowbat":a.channel=t+":0",a.dataPoint=r.MAINTENANCE_BAT_EL.getDptFromState(e);break;case"state":case"illumination":case"active":a.channel=t+":3",a.dataPoint=r.MOTIONDETECTOR_TRANSCEIVER.getDptFromState(e);break;default:return null;}return a;},IPMotion2.prototype.executeCommand=function(e,t,a){x.hub.m.hm._Channel["HmIP-RF"];switch(t){case"reset":case"activate":case"deactivate":case"toggleActivate":break;default:a&&a(new Error("no such command"));}},IPMotion2.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o,c=x.hub.m.hm._Channel["HmIP-RF"],l=null;return 0==i?"UNREACH"==t||"LOW_BAT"==t?c.MAINTENANCE_BAT_EL.parseDptState(t,a):((l={})["0_"+t.toLowerCase()]=a,l):(1==i&&(o=c.KEY_TRANRECEIVER.parseDptState(t,a))&&(o.pressShort&&(l={btn1pressShort:!0}),o.pressLong&&(l={btn1pressLong:!0})),2==i&&(o=c.KEY_TRANRECEIVER.parseDptState(t,a))&&(o.pressShort&&(l={btn2pressShort:!0}),o.pressLong&&(l={btn2pressLong:!0})),3==i?c.MOTIONDETECTOR_TRANSCEIVER.parseDptState(t,a):l);},IPMotion2.prototype.isButton=function(){return!0;},IPMotion2.prototype.claimEvent=function(e,t){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);var r=this;e.reportValueUsage(this.deviceIF,this.deviceAdr+":1","PRESS_SHORT",function(a,n){a&&console.error("button:1 claim PRESS_SHORT event error:"+a.stack),e.reportValueUsage(r.deviceIF,r.deviceAdr+":1","PRESS_LONG",function(a,n){a&&console.error("button:1 claim PRESS_LONG event error:"+a.stack),e.reportValueUsage(r.deviceIF,r.deviceAdr+":2","PRESS_SHORT",function(a,n){a&&console.error("button:2 claim PRESS_SHORT event error:"+a.stack),e.reportValueUsage(r.deviceIF,r.deviceAdr+":2","PRESS_LONG",function(e,a){e&&console.error("button:2 claim PRESS_LONG event error:"+e.stack),t&&t();});});});});};var IPButton=function IPButton(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="ip_button";};util.inherits(IPButton,Device),IPButton.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();return a&&a.forEach(function(a){"SABOTAGE"!=a&&e.push({channel:t.deviceAdr+":0",dpt:a});}),e;},IPButton.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t+":"+this.channel,dataPoint:null},r=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case"timeout":case"lowbat":a.channel=t+":0",a.dataPoint=r.MAINTENANCE_BAT_EL.getDptFromState(e);break;default:return null;}return a;},IPButton.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o,c=x.hub.m.hm._Channel["HmIP-RF"],l=null;return 0==i?"UNREACH"==t||"LOW_BAT"==t?c.MAINTENANCE_BAT_EL.parseDptState(t,a):((l={})["0_"+t.toLowerCase()]=a,l):(i==this.channel&&(o=c.KEY_TRANRECEIVER.parseDptState(t,a))&&(o.pressShort&&(l={pressShort:!0}),o.pressLong&&(l={pressLong:!0})),l);},IPButton.prototype.isButton=function(){return!0;},IPButton.prototype.claimEvent=function(e,t){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);var r=this;e.reportValueUsage(this.deviceIF,this.deviceAdr+":1","PRESS_SHORT",function(a,n){a&&console.error("button:1 claim PRESS_SHORT event error:"+a.stack),e.reportValueUsage(r.deviceIF,r.deviceAdr+":1","PRESS_LONG",function(e,a){e&&console.error("button:1 claim PRESS_LONG event error:"+e.stack),t&&t();});});};var IPButton2=function IPButton2(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="ip_button2";};util.inherits(IPButton2,Device),IPButton2.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();return a&&a.forEach(function(a){"SABOTAGE"!=a&&e.push({channel:t.deviceAdr+":0",dpt:a});}),e;},IPButton2.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t+":"+this.channel,dataPoint:null},r=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case"timeout":case"lowbat":a.channel=t+":0",a.dataPoint=r.MAINTENANCE_BAT_EL.getDptFromState(e);break;default:return null;}return a;},IPButton2.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o,c=x.hub.m.hm._Channel["HmIP-RF"],l=null;return 0==i?"UNREACH"==t||"LOW_BAT"==t?c.MAINTENANCE_BAT_EL.parseDptState(t,a):((l={})["0_"+t.toLowerCase()]=a,l):(1==i&&(o=c.KEY_TRANRECEIVER.parseDptState(t,a))&&(o.pressShort&&(l={btn1pressShort:!0}),o.pressLong&&(l={btn1pressLong:!0})),2==i&&(o=c.KEY_TRANRECEIVER.parseDptState(t,a))&&(o.pressShort&&(l={btn2pressShort:!0}),o.pressLong&&(l={btn2pressLong:!0})),l);},IPButton2.prototype.isButton=function(){return!0;},IPButton2.prototype.claimEvent=function(e,t){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);var r=this;e.reportValueUsage(this.deviceIF,this.deviceAdr+":1","PRESS_SHORT",function(a,n){a&&console.error("button:1 claim PRESS_SHORT event error:"+a.stack),e.reportValueUsage(r.deviceIF,r.deviceAdr+":1","PRESS_LONG",function(a,n){a&&console.error("button:1 claim PRESS_LONG event error:"+a.stack),e.reportValueUsage(r.deviceIF,r.deviceAdr+":2","PRESS_SHORT",function(a,n){a&&console.error("button:2 claim PRESS_SHORT event error:"+a.stack),e.reportValueUsage(r.deviceIF,r.deviceAdr+":2","PRESS_LONG",function(e,a){e&&console.error("button:2 claim PRESS_LONG event error:"+e.stack),t&&t();});});});});};var IPButton4=function IPButton4(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="ip_button4";};util.inherits(IPButton4,Device),IPButton4.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();return a&&a.forEach(function(a){"SABOTAGE"!=a&&e.push({channel:t.deviceAdr+":0",dpt:a});}),e;},IPButton4.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t+":"+this.channel,dataPoint:null},r=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case"timeout":case"lowbat":a.channel=t+":0",a.dataPoint=r.MAINTENANCE_BAT_EL.getDptFromState(e);break;default:return null;}return a;},IPButton4.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o,c=x.hub.m.hm._Channel["HmIP-RF"],l=null;return 0==i?"UNREACH"==t||"LOW_BAT"==t?c.MAINTENANCE_BAT_EL.parseDptState(t,a):((l={})["0_"+t.toLowerCase()]=a,l):(1!=i&&2!=i&&3!=i&&4!=i||(o=c.KEY_TRANRECEIVER.parseDptState(t,a))&&(l||(l={}),o.pressShort&&(l["btn"+i+"pressShort"]=!0),o.pressLong&&(l["btn"+i+"pressLong"]=!0)),l);},IPButton4.prototype.isButton=function(){return!0;},IPButton4.prototype.claimEvent=function(e,t){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);var r=this;this._claimButtonEvent(1,e,function(){r._claimButtonEvent(2,e,function(){r._claimButtonEvent(3,e,function(){r._claimButtonEvent(4,e,function(){t&&t();});});});});},IPButton4.prototype._claimButtonEvent=function(e,t,a){var r=this;t.reportValueUsage(this.deviceIF,this.deviceAdr+":"+e,"PRESS_SHORT",function(n,i){n&&console.error("button:"+e+" claim PRESS_SHORT event error:"+n.stack),t.reportValueUsage(r.deviceIF,r.deviceAdr+":"+e,"PRESS_LONG",function(t,r){t&&console.error("button:"+e+" claim PRESS_LONG event error:"+t.stack),a&&a();});});};var IPButton6=function IPButton6(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="ip_button6";};util.inherits(IPButton6,Device),IPButton6.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();return a&&a.forEach(function(a){"SABOTAGE"!=a&&e.push({channel:t.deviceAdr+":0",dpt:a});}),e;},IPButton6.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t+":"+this.channel,dataPoint:null},r=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case"timeout":case"lowbat":a.channel=t+":0",a.dataPoint=r.MAINTENANCE_BAT_EL.getDptFromState(e);break;default:return null;}return a;},IPButton6.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o,c=x.hub.m.hm._Channel["HmIP-RF"],l=null;return 0==i?"UNREACH"==t||"LOW_BAT"==t?c.MAINTENANCE_BAT_EL.parseDptState(t,a):((l={})["0_"+t.toLowerCase()]=a,l):(1!=i&&2!=i&&3!=i&&4!=i&&5!=i&&6!=i||(o=c.KEY_TRANRECEIVER.parseDptState(t,a))&&(l||(l={}),o.pressShort&&(l["btn"+i+"pressShort"]=!0),o.pressLong&&(l["btn"+i+"pressLong"]=!0)),l);},IPButton6.prototype.isButton=function(){return!0;},IPButton6.prototype.claimEvent=function(e,t){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);var r=this;this._claimButtonEvent(1,e,function(){r._claimButtonEvent(2,e,function(){r._claimButtonEvent(3,e,function(){r._claimButtonEvent(4,e,function(){r._claimButtonEvent(5,e,function(){r._claimButtonEvent(6,e,function(){t&&t();});});});});});});},IPButton6.prototype._claimButtonEvent=function(e,t,a){var r=this;t.reportValueUsage(this.deviceIF,this.deviceAdr+":"+e,"PRESS_SHORT",function(n,i){n&&console.error("button:"+e+" claim PRESS_SHORT event error:"+n.stack),t.reportValueUsage(r.deviceIF,r.deviceAdr+":"+e,"PRESS_LONG",function(t,r){t&&console.error("button:"+e+" claim PRESS_LONG event error:"+t.stack),a&&a();});});};var IPSiren=function IPSiren(e,t,a){Device.call(this,e,t,a),this.channel=3,this.legacyType="ip_siren";};util.inherits(IPSiren,Device),IPSiren.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["HmIP-RF"],r=a.MAINTENANCE_BAT_EL.getReadableDpts();return r&&r.forEach(function(a){e.push({channel:t.deviceAdr+":0",dpt:a});}),(r=a.ALARM_SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&r.forEach(function(a){e.push({channel:t.deviceAdr+":3",dpt:a});}),e;},IPSiren.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t+":"+this.channel,dataPoint:null},r=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case"timeout":case"lowbat":case"sabotage":a.channel=t+":0",a.dataPoint=r.MAINTENANCE_BAT_EL.getDptFromState(e);break;case"state":a.channel=t+":3",a.dataPoint=r.ALARM_SWITCH_VIRTUAL_RECEIVER.getDptFromState(e);break;default:return null;}return a;},IPSiren.prototype.executeCommand=function(e,t,a){x.hub.m.hm._Channel["HmIP-RF"].ALARM_SWITCH_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,this.deviceAdr+":3",t,a);},IPSiren.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o=x.hub.m.hm._Channel["HmIP-RF"],c=null;return 0==i?"UNREACH"==t||"LOW_BAT"==t||"SABOTAGE"==t?o.MAINTENANCE_BAT_EL.parseDptState(t,a):((c={})["0_"+t.toLowerCase()]=a,c):3==i?o.ALARM_SWITCH_VIRTUAL_RECEIVER.parseDptState(t,a):null;};var IPWallthermo=function IPWallthermo(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="ip_wallthermo";};util.inherits(IPWallthermo,Device),IPWallthermo.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["HmIP-RF"],r=a.MAINTENANCE_BAT_EL.getReadableDpts();return r&&r.forEach(function(a){"SABOTAGE"!=a&&e.push({channel:t.deviceAdr+":0",dpt:a});}),(r=a.HEATING_CLIMATECONTROL_TRANSCEIVER.getReadableDpts())&&r.forEach(function(a){"LEVEL"!=a&&e.push({channel:t.deviceAdr+":1",dpt:a});}),e;},IPWallthermo.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t+":"+this.channel,dataPoint:null},r=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case"timeout":case"lowbat":a.channel=t+":0",a.dataPoint=r.MAINTENANCE_BAT_EL.getDptFromState(e);break;case"profile":case"temp":case"boost":case"frost":case"hum":case"mode":case"state":case"window":a.channel=t+":1",a.dataPoint=r.HEATING_CLIMATECONTROL_TRANSCEIVER.getDptFromState(e);break;default:return null;}return a;},IPWallthermo.prototype.executeCommand=function(e,t,a){var r=this.deviceAdr+":"+this.channel;x.hub.m.hm._Channel["HmIP-RF"].HEATING_CLIMATECONTROL_TRANSCEIVER.executeCommand(e,this.deviceIF,r,t,a);},IPWallthermo.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o=x.hub.m.hm._Channel["HmIP-RF"],c=null;return 0==i?"UNREACH"==t||"LOW_BAT"==t?o.MAINTENANCE_BAT_EL.parseDptState(t,a):((c={})["0_"+t.toLowerCase()]=a,c):1==i?o.HEATING_CLIMATECONTROL_TRANSCEIVER.parseDptState(t,a):c;};var IPWallthermo2=function IPWallthermo2(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="ip_wallthermo2";};util.inherits(IPWallthermo2,IPWallthermo),IPWallthermo2.prototype._getReadableDpts=function(){var e=IPWallthermo.prototype._getReadableDpts.call(this);e||(e=[]);var t=this,a=x.hub.m.hm._Channel["HmIP-RF"],r=a.CLIMATECONTROL_FLOOR_DIRECT_TRANSMITTER.getReadableDpts();return r&&r.forEach(function(a){e.push({channel:t.deviceAdr+":8",dpt:a});}),(r=a.SWITCH_VIRTUAL_RECEIVER.getReadableDpts())&&r.forEach(function(a){e.push({channel:t.deviceAdr+":10",dpt:a});}),e;},IPWallthermo2.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t+":"+this.channel,dataPoint:null},r=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case"valveState":a.channel=t+":10",a.dataPoint=r.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case"cl_fd_emergencyOP":case"cl_fd_frostProtection":case"cl_fd_state":case"cl_fd_humidityAlarm":a.channel=t+":8",a.dataPoint=r.CLIMATECONTROL_FLOOR_DIRECT_TRANSMITTER.getDptFromState(e);break;default:return IPWallthermo.prototype._getDptFromRef.call(this,e);}return a;},IPWallthermo2.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o,c=x.hub.m.hm._Channel["HmIP-RF"],l=null;return 0==i?"UNREACH"==t||"LOW_BAT"==t?c.MAINTENANCE_BAT_EL.parseDptState(t,a):((l={})["0_"+t.toLowerCase()]=a,l):1==i?c.HEATING_CLIMATECONTROL_TRANSCEIVER.parseDptState(t,a):8==i?c.CLIMATECONTROL_FLOOR_DIRECT_TRANSMITTER.parseDptState(t,a):(10==i&&(l={},o=c.SWITCH_VIRTUAL_RECEIVER.parseDptState(t,a),l.valveState=o?o.switchState:"?"),l);};var IPSmoke=function IPSmoke(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="ip_smoke";};util.inherits(IPSmoke,Device),IPSmoke.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["HmIP-RF"],r=a.MAINTENANCE.getReadableDpts();return r&&r.forEach(function(a){"SABOTAGE"!=a&&e.push({channel:t.deviceAdr+":0",dpt:a});}),(r=a.SMOKE_DETECTOR.getReadableDpts())&&r.forEach(function(a){e.push({channel:t.deviceAdr+":1",dpt:a});}),e;},IPSmoke.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t+":"+this.channel,dataPoint:null},r=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case"timeout":case"lowbat":a.channel=t+":0",a.dataPoint=r.MAINTENANCE.getDptFromState(e);break;case"profile":case"temp":case"boost":case"frost":case"hum":case"mode":case"state":case"window":a.channel=t+":1",a.dataPoint=r.SMOKE_DETECTOR.getDptFromState(e);break;default:return null;}return a;},IPSmoke.prototype.executeCommand=function(e,t,a){var r=this.deviceAdr+":"+this.channel;x.hub.m.hm._Channel["HmIP-RF"].SMOKE_DETECTOR.executeCommand(e,this.deviceIF,r,t,a);},IPSmoke.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o=x.hub.m.hm._Channel["HmIP-RF"],c=null;return 0==i?"UNREACH"==t||"LOW_BAT"==t?o.MAINTENANCE.parseDptState(t,a):((c={})["0_"+t.toLowerCase()]=a,c):1==i?o.SMOKE_DETECTOR.parseDptState(t,a):c;};var IPWindow=function IPWindow(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="ip_window";};util.inherits(IPWindow,Device),IPWindow.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["HmIP-RF"],r=a.MAINTENANCE_BAT_EL.getReadableDpts();return r&&r.forEach(function(a){e.push({channel:t.deviceAdr+":0",dpt:a});}),(r=a.ROTARY_HANDLE_TRANSCEIVER.getReadableDpts())&&r.forEach(function(a){e.push({channel:t.deviceAdr+":1",dpt:a});}),e;},IPWindow.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t+":"+this.channel,dataPoint:null},r=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case"timeout":case"lowbat":case"sabotage":a.channel=t+":0",a.dataPoint=r.MAINTENANCE_BAT_EL.getDptFromState(e);break;case"state":a.channel=t+":1",a.dataPoint=r.ROTARY_HANDLE_TRANSCEIVER.getDptFromState(e);break;default:return null;}return a;},IPWindow.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o=x.hub.m.hm._Channel["HmIP-RF"],c=null;return 0==i?"UNREACH"==t||"LOW_BAT"==t||"SABOTAGE"==t?o.MAINTENANCE_BAT_EL.parseDptState(t,a):((c={})["0_"+t.toLowerCase()]=a,c):1==i?o.ROTARY_HANDLE_TRANSCEIVER.parseDptState(t,a):c;};var IPBlind=function IPBlind(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="ip_blind";};util.inherits(IPBlind,Device),IPBlind.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["HmIP-RF"],r=a.MAINTENANCE.getReadableDpts();return r&&r.forEach(function(a){"UNREACH"==a&&e.push({channel:t.deviceAdr+":0",dpt:a});}),(r=a.SHUTTER_TRANSMITTER.getReadableDpts())&&r.forEach(function(a){e.push({channel:t.deviceAdr+":3",dpt:a});}),(r=a.SHUTTER_VIRTUAL_RECEIVER.getReadableDpts())&&r.forEach(function(a){e.push({channel:t.deviceAdr+":4",dpt:a}),e.push({channel:t.deviceAdr+":5",dpt:a}),e.push({channel:t.deviceAdr+":6",dpt:a});}),e;},IPBlind.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t+":"+this.channel,dataPoint:null},r=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case"timeout":a.channel=t+":0",a.dataPoint=r.MAINTENANCE.getDptFromState(e);break;case"blindLevel":a.channel=t+":3",a.dataPoint=r.SHUTTER_TRANSMITTER.getDptFromState("blindTLevel");break;case"ch4Level":a.channel=t+":4",a.dataPoint=r.SHUTTER_VIRTUAL_RECEIVER.getDptFromState("blindLevel");break;case"ch5Level":a.channel=t+":5",a.dataPoint=r.SHUTTER_VIRTUAL_RECEIVER.getDptFromState("blindLevel");break;case"ch6Level":a.channel=t+":6",a.dataPoint=r.SHUTTER_VIRTUAL_RECEIVER.getDptFromState("blindLevel");break;default:return null;}return a;},IPBlind.prototype.executeCommand=function(e,t,a){var r,n,i=null,s=x.hub.m.hm._Channel["HmIP-RF"],o=t;-1!=t.indexOf("stepUp")?(n=t.indexOf("stepUp"),o=t.substr(0,n+6),r=t.substr(n+6)):-1!=t.indexOf("stepDown")?(n=t.indexOf("stepDown"),o=t.substr(0,n+8),r=t.substr(n+8)):-1!=t.indexOf("moveTo")?(n=t.indexOf("moveTo"),o=t.substr(0,n+6),r=t.substr(n+6)):-1!=t.indexOf("stop")&&(n=t.indexOf("stop"),o=t.substr(0,n+4),r=t.substr(n+4));var c=this;switch(o){case"stop":s.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,this.deviceAdr+":4","stop",function(t,r){t?a&&a(t,r):s.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":5","stop",function(t,r){t?a&&a(t,r):s.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":6","stop",a);});});break;case"moveUp":s.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,this.deviceAdr+":4","moveUp",function(t,r){t?a&&a(t,r):s.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":5","moveTo0",function(t,r){t?a&&a(t,r):s.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":6","moveTo0",a);});});break;case"moveDown":s.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,this.deviceAdr+":4","moveDown",function(t,r){t?a&&a(t,r):s.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":5","moveTo0",function(t,r){t?a&&a(t,r):s.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":6","moveTo0",a);});});break;case"stepUp":r=r?parseInt(r)/100:.05,e.getState({"interface":this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(t,n){t?a&&a(t):void 0!==n&&null!=n?((r=n.value+r)>1&&(r=1),r=Math.round(100*r),s.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":4","moveTo"+r,function(t,n){t?a&&a(t,n):s.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":5","moveTo0",function(t,n){t?a&&a(t,n):s.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":6","moveTo0",function(t,n){if(t)a&&a(t,n);else{var i=r/100;i>1&&(i=1),i<0&&(i=0),e.updateStatusBuffer(c.deviceIF,c.deviceAdr+":3","LEVEL",i,new Date().getTime()+1e3),a&&a(t);}});});})):a&&a(new Error("get blind current value return invalid"));});break;case"stepDown":r=r?parseInt(r)/100:.05,e.getState({"interface":this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(t,n){t?a&&a(t):void 0!==n&&null!=n?((r=n.value-r)<0&&(r=0),r=Math.round(100*r),s.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":4","moveTo"+r,function(t,n){t?a&&a(t,n):s.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":5","moveTo0",function(t,n){t?a&&a(t,n):s.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":6","moveTo0",function(t,n){if(t)a&&a(t,n);else{var i=r/100;i>1&&(i=1),i<0&&(i=0),e.updateStatusBuffer(c.deviceIF,c.deviceAdr+":3","LEVEL",i,new Date().getTime()+1e3),a&&a(t);}});});})):a&&a(new Error("get blind current value return invalid"));});break;case"moveTo":if(!r)return void(a&&a(new Error("moveTo has no value")));s.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,this.deviceAdr+":4","moveTo"+r,function(t,n){t?a&&a(t,n):s.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":5","moveTo0",function(t,n){t?a&&a(t,n):s.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":6","moveTo0",function(t,n){if(t)a&&a(t,n);else{var i=r/100;i>1&&(i=1),i<0&&(i=0),e.updateStatusBuffer(c.deviceIF,c.deviceAdr+":3","LEVEL",i,new Date().getTime()+1e3),a&&a(t);}});});});break;case"ch4stop":case"ch5stop":case"ch6stop":switch(o){case"ch4stop":i=this.deviceAdr+":4";break;case"ch5stop":i=this.deviceAdr+":5";break;case"ch6stop":i=this.deviceAdr+":6";}s.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,i,"stop",a);break;case"ch4moveUp":case"ch5moveUp":case"ch6moveUp":switch(o){case"ch4moveUp":i=this.deviceAdr+":4";break;case"ch5moveUp":i=this.deviceAdr+":5";break;case"ch6moveUp":i=this.deviceAdr+":6";}s.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,i,"moveUp",a);break;case"ch4moveDown":case"ch5moveDown":case"ch6moveDown":switch(o){case"ch4moveDown":i=this.deviceAdr+":4";break;case"ch5moveDown":i=this.deviceAdr+":5";break;case"ch6moveDown":i=this.deviceAdr+":6";}s.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,i,"moveDown",a);break;case"ch4stepUp":case"ch5stepUp":case"ch6stepUp":switch(o){case"ch4stepUp":i=this.deviceAdr+":4";break;case"ch5stepUp":i=this.deviceAdr+":5";break;case"ch6stepUp":i=this.deviceAdr+":6";}s.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,i,"stepUp"+r,a);break;case"ch4stepDown":case"ch5stepDown":case"ch6stepDown":switch(o){case"ch4stepDown":i=this.deviceAdr+":4";break;case"ch5stepDown":i=this.deviceAdr+":5";break;case"ch6stepDown":i=this.deviceAdr+":6";}s.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,i,"stepDown"+r,a);break;case"ch4moveTo":case"ch5moveTo":case"ch6moveTo":switch(o){case"ch4moveTo":i=this.deviceAdr+":4";break;case"ch5moveTo":i=this.deviceAdr+":5";break;case"ch6moveTo":i=this.deviceAdr+":6";}s.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,i,"moveTo"+r,a);break;default:a&&a(new Error("no such command"));}},IPBlind.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o,c=x.hub.m.hm._Channel["HmIP-RF"],l=null;if(0==i)return"UNREACH"==t?c.MAINTENANCE.parseDptState(t,a):((l={})["0_"+t.toLowerCase()]=a,l);if(3==i)return(o=c.SHUTTER_TRANSMITTER.parseDptState(t,a))&&((l={}).blindLevel=o.blindTLevel),l;if(4==i||5==i||6==i){if(o=c.SHUTTER_VIRTUAL_RECEIVER.parseDptState(t,a))switch(l={},parseInt(i)){case 4:l.ch4Level=o.blindLevel;break;case 5:l.ch5Level=o.blindLevel;break;case 6:l.ch6Level=o.blindLevel;}return l;}return null;},IPBlind.prototype.getConfig=function(e,t){var a=this.deviceAdr+":3";e.getParamset(this.deviceIF,a,"MASTER",function(e,r){if(e)t&&t(e);else{var n={},i=null;r&&(i={CHANGE_OVER_DELAY:r.CHANGE_OVER_DELAY,REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT:r.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT,REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE:r.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE,REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT:r.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT,REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE:r.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE,REFERENCE_RUN_COUNTER:r.REFERENCE_RUN_COUNTER}),n[a]=i,t&&t(e,n);}});},IPBlind.prototype.setConfig=function(e,t,a){if(t){var r=this.deviceAdr+":3",n=t[r];if(n){var i={};i.CHANGE_OVER_DELAY={__rpcValueType:"double",__rpcValue:n.CHANGE_OVER_DELAY},i.REFERENCE_RUN_COUNTER=n.REFERENCE_RUN_COUNTER,i.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT={__rpcValueType:"double",__rpcValue:n.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT},i.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE={__rpcValueType:"double",__rpcValue:n.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE},i.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT={__rpcValueType:"double",__rpcValue:n.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT},i.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE={__rpcValueType:"double",__rpcValue:n.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE},e.setParamset(this.deviceIF,r,"MASTER",i,function(e){a&&a(e);});}else a&&a(new Error("config data not complete"));}else a&&a(new Error("config data invalid"));},IPBlind.prototype.isButton=function(){return!0;},IPBlind.prototype.claimEvent=function(e,t){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);var r=this;this._claimButtonEvent(1,e,function(){r._claimButtonEvent(2,e,function(){t&&t();});});},IPBlind.prototype._claimButtonEvent=function(e,t,a){var r=this;t.reportValueUsage(this.deviceIF,this.deviceAdr+":"+e,"PRESS_SHORT",function(n,i){n&&console.error("button:"+e+" claim PRESS_SHORT event error:"+n.stack),t.reportValueUsage(r.deviceIF,r.deviceAdr+":"+e,"PRESS_LONG",function(t,r){t&&console.error("button:"+e+" claim PRESS_LONG event error:"+t.stack),a&&a();});});};var IPJalousie=function IPJalousie(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="ip_jalousie";};util.inherits(IPJalousie,Device),IPJalousie.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["HmIP-RF"],r=a.MAINTENANCE.getReadableDpts();return r&&r.forEach(function(a){"UNREACH"==a&&e.push({channel:t.deviceAdr+":0",dpt:a});}),(r=a.BLIND_TRANSMITTER.getReadableDpts())&&r.forEach(function(a){e.push({channel:t.deviceAdr+":3",dpt:a});}),(r=a.BLIND_VIRTUAL_RECEIVER.getReadableDpts())&&r.forEach(function(a){e.push({channel:t.deviceAdr+":4",dpt:a}),e.push({channel:t.deviceAdr+":5",dpt:a}),e.push({channel:t.deviceAdr+":6",dpt:a});}),e;},IPJalousie.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t+":"+this.channel,dataPoint:null},r=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case"timeout":a.channel=t+":0",a.dataPoint=r.MAINTENANCE.getDptFromState(e);break;case"blindLevel":a.channel=t+":3",a.dataPoint=r.BLIND_TRANSMITTER.getDptFromState("blindTPos");break;case"lamellaLevel":a.channel=t+":3",a.dataPoint=r.BLIND_TRANSMITTER.getDptFromState("lamellaTPos");break;case"ch4blindLevel":a.channel=t+":4",a.dataPoint=r.BLIND_VIRTUAL_RECEIVER.getDptFromState("blindPos");break;case"ch4lamellaLevel":a.channel=t+":4",a.dataPoint=r.BLIND_VIRTUAL_RECEIVER.getDptFromState("lamellaPos");break;case"ch5blindLevel":a.channel=t+":5",a.dataPoint=r.BLIND_VIRTUAL_RECEIVER.getDptFromState("blindPos");break;case"ch5lamellaLevel":a.channel=t+":5",a.dataPoint=r.BLIND_VIRTUAL_RECEIVER.getDptFromState("lamellaPos");break;case"ch6blindLevel":a.channel=t+":6",a.dataPoint=r.BLIND_VIRTUAL_RECEIVER.getDptFromState("blindPos");break;case"ch6lamellaLevel":a.channel=t+":6",a.dataPoint=r.BLIND_VIRTUAL_RECEIVER.getDptFromState("lamellaPos");break;default:return null;}return a;},IPJalousie.prototype.executeCommand=function(e,t,a){var r,n,i=null,s=x.hub.m.hm._Channel["HmIP-RF"],o=t;-1!=t.indexOf("stepUp")?(n=t.indexOf("stepUp"),o=t.substr(0,n+6),r=t.substr(n+6)):-1!=t.indexOf("stepDown")?(n=t.indexOf("stepDown"),o=t.substr(0,n+8),r=t.substr(n+8)):-1!=t.indexOf("moveTo")?(n=t.indexOf("moveTo"),o=t.substr(0,n+6),r=t.substr(n+6)):-1!=t.indexOf("stop")?(n=t.indexOf("stop"),o=t.substr(0,n+4),r=t.substr(n+4)):-1!=t.indexOf("lamellaStepUp")?(n=t.indexOf("lamellaStepUp"),o=t.substr(0,n+13),r=t.substr(n+13)):-1!=t.indexOf("lamellaStepDown")?(n=t.indexOf("lamellaStepDown"),o=t.substr(0,n+15),r=t.substr(n+15)):-1!=t.indexOf("lamellaTo")&&(n=t.indexOf("lamellaTo"),o=t.substr(0,n+9),r=t.substr(n+9));var c=this;switch(o){case"stop":case"moveUp":case"moveDown":s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,this.deviceAdr+":4",o,function(t,r){t?a&&a(t,r):s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":5",o,function(t,r){t?a&&a(t,r):s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":6",o,a);});});break;case"lamellaUp":case"lamellaDown":e.getState({"interface":this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(t,n){t?a&&a(t):void 0!==n&&null!=n?(r=n.value,r=Math.round(100*r),s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":4",o,function(t,n){t?a&&a(t,n):s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":4","moveTo"+r,function(t,n){t?a&&a(t,n):s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":5",o,function(t,n){t?a&&a(t,n):s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":5","moveTo"+r,function(t,n){t?a&&a(t,n):s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":6",o,function(t,n){t?a&&a(t,n):s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":6","moveTo"+r,function(e,t){a&&a(e,t);});});});});});})):a&&a(new Error("get blind current value return invalid"));});break;case"stepUp":r=r?parseInt(r)/100:.05,e.getState({"interface":this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(t,n){t?a&&a(t):void 0!==n&&null!=n?((r=n.value+r)>1&&(r=1),r=Math.round(100*r),s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":4","moveTo"+r,function(t,n){t?a&&a(t,n):s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":5","moveTo"+r,function(t,n){t?a&&a(t,n):s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":6","moveTo"+r,function(t,n){if(t)a&&a(t,n);else{var i=r/100;i>1&&(i=1),i<0&&(i=0),e.updateStatusBuffer(c.deviceIF,c.deviceAdr+":3","LEVEL",i,new Date().getTime()+1e3),a&&a(t);}});});})):a&&a(new Error("get blind current value return invalid"));});break;case"stepDown":r=r?parseInt(r)/100:.05,e.getState({"interface":this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(t,n){t?a&&a(t):void 0!==n&&null!=n?((r=n.value-r)<0&&(r=0),r=Math.round(100*r),s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":4","moveTo"+r,function(t,n){t?a&&a(t,n):s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":5","moveTo"+r,function(t,n){t?a&&a(t,n):s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":6","moveTo"+r,function(t,n){if(t)a&&a(t,n);else{var i=r/100;i>1&&(i=1),i<0&&(i=0),e.updateStatusBuffer(c.deviceIF,c.deviceAdr+":3","LEVEL",i,new Date().getTime()+1e3),a&&a(t);}});});})):a&&a(new Error("get blind current value return invalid"));});break;case"moveTo":if(!r)return void(a&&a(new Error("moveTo has no value")));s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,this.deviceAdr+":4","moveTo"+r,function(t,n){t?a&&a(t,n):s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":5","moveTo"+r,function(t,n){t?a&&a(t,n):s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":6","moveTo"+r,function(t,n){if(t)a&&a(t,n);else{var i=r/100;i>1&&(i=1),i<0&&(i=0),e.updateStatusBuffer(c.deviceIF,c.deviceAdr+":3","LEVEL",i,new Date().getTime()+1e3),a&&a(t);}});});});break;case"lamellaStepUp":r=r?parseInt(r)/100:.05,e.getState({"interface":this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(t,n){if(t)a&&a(t);else if(void 0!==n&&null!=n){var i=n.value;i=Math.round(100*i),e.getState({"interface":c.deviceIF,channel:c.deviceAdr+":3",datapoint:"LEVEL_2"},function(t,n){t?a&&a(t):void 0!==n&&null!=n?((r=n.value+r)>1&&(r=1),r=Math.round(100*r),s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":4","lamellaTo"+r,function(t,n){t?a&&a(t,n):s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":4","moveTo"+i,function(t,n){t?a&&a(t,n):s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":5","lamellaTo"+r,function(t,n){t?a&&a(t,n):s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":5","moveTo"+i,function(t,n){t?a&&a(t,n):s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":6","lamellaTo"+r,function(t,n){t?a&&a(t,n):s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":6","moveTo"+i,function(t,n){if(t)a&&a(t,n);else{var i=r/100;i>1&&(i=1),i<0&&(i=0),e.updateStatusBuffer(c.deviceIF,c.deviceAdr+":3","LEVEL_2",i,new Date().getTime()+1e3),a&&a(t);}});});});});});})):a&&a(new Error("get lamella current value return invalid"));});}else a&&a(new Error("get blind current value return invalid"));});break;case"lamellaStepDown":r=r?parseInt(r)/100:.05,e.getState({"interface":this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(t,n){if(t)a&&a(t);else if(void 0!==n&&null!=n){var i=n.value;i=Math.round(100*i),e.getState({"interface":c.deviceIF,channel:c.deviceAdr+":3",datapoint:"LEVEL_2"},function(t,n){t?a&&a(t):void 0!==n&&null!=n?((r=n.value-r)<0&&(r=0),r=Math.round(100*r),s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":4","lamellaTo"+r,function(t,n){t?a&&a(t,n):s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":4","moveTo"+i,function(t,n){t?a&&a(t,n):s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":5","lamellaTo"+r,function(t,n){t?a&&a(t,n):s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":5","moveTo"+i,function(t,n){t?a&&a(t,n):s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":6","lamellaTo"+r,function(t,n){t?a&&a(t,n):s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":6","moveTo"+i,function(t,n){if(t)a&&a(t,n);else{var i=r/100;i>1&&(i=1),i<0&&(i=0),e.updateStatusBuffer(c.deviceIF,c.deviceAdr+":3","LEVEL_2",i,new Date().getTime()+1e3),a&&a(t);}});});});});});})):a&&a(new Error("get lamella current value return invalid"));});}else a&&a(new Error("get blind current value return invalid"));});break;case"lamellaTo":if(!r)return void(a&&a(new Error("lamellaTo has no value")));e.getState({"interface":this.deviceIF,channel:this.deviceAdr+":3",datapoint:"LEVEL"},function(t,n){if(t)a&&a(t);else if(void 0!==n&&null!=n){var i=n.value;i=Math.round(100*i),s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":4","lamellaTo"+r,function(t,n){t?a&&a(t,n):s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":4","moveTo"+i,function(t,n){t?a&&a(t,n):s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":5","lamellaTo"+r,function(t,n){t?a&&a(t,n):s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":5","moveTo"+i,function(t,n){t?a&&a(t,n):s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":6","lamellaTo"+r,function(t,n){t?a&&a(t,n):s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,c.deviceAdr+":6","moveTo"+i,function(t,n){if(t)a&&a(t,n);else{var i=r/100;i>1&&(i=1),i<0&&(i=0),e.updateStatusBuffer(c.deviceIF,c.deviceAdr+":3","LEVEL_2",i,new Date().getTime()+1e3),a&&a(t);}});});});});});});}else a&&a(new Error("get blind current value return invalid"));});break;case"ch4stop":case"ch5stop":case"ch6stop":switch(o){case"ch4stop":i=this.deviceAdr+":4";break;case"ch5stop":i=this.deviceAdr+":5";break;case"ch6stop":i=this.deviceAdr+":6";}s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,i,"stop",a);break;case"ch4moveUp":case"ch5moveUp":case"ch6moveUp":switch(o){case"ch4moveUp":i=this.deviceAdr+":4";break;case"ch5moveUp":i=this.deviceAdr+":5";break;case"ch6moveUp":i=this.deviceAdr+":6";}s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,i,"moveUp",a);break;case"ch4moveDown":case"ch5moveDown":case"ch6moveDown":switch(o){case"ch4moveDown":i=this.deviceAdr+":4";break;case"ch5moveDown":i=this.deviceAdr+":5";break;case"ch6moveDown":i=this.deviceAdr+":6";}s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,i,"moveDown",a);break;case"ch4lamellaUp":case"ch5lamellaUp":case"ch6lamellaUp":switch(o){case"ch4lamellaUp":i=this.deviceAdr+":4";break;case"ch5lamellaUp":i=this.deviceAdr+":5";break;case"ch6lamellaUp":i=this.deviceAdr+":6";}e.getState({"interface":this.deviceIF,channel:i,datapoint:"LEVEL"},function(t,r){if(t)a&&a(t);else if(void 0!==r&&null!=r){var n=r.value;n=Math.round(100*n),s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,i,"lamellaUp",function(t,r){t?a&&a(t):s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,i,"moveTo"+n,function(e,t){a&&a(e,t);});});}else a&&a(new Error("get blind current value return invalid"));});break;case"ch4lamellaDown":case"ch5lamellaDown":case"ch6lamellaDown":switch(o){case"ch4lamellaDown":i=this.deviceAdr+":4";break;case"ch5lamellaDown":i=this.deviceAdr+":5";break;case"ch6lamellaDown":i=this.deviceAdr+":6";}e.getState({"interface":this.deviceIF,channel:i,datapoint:"LEVEL"},function(t,r){if(t)a&&a(t);else if(void 0!==r&&null!=r){var n=r.value;n=Math.round(100*n),s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,i,"lamellaDown",function(t,r){t?a&&a(t):s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,i,"moveTo"+n,function(e,t){a&&a(e,t);});});}else a&&a(new Error("get blind current value return invalid"));});break;case"ch4stepUp":case"ch5stepUp":case"ch6stepUp":switch(o){case"ch4stepUp":i=this.deviceAdr+":4";break;case"ch5stepUp":i=this.deviceAdr+":5";break;case"ch6stepUp":i=this.deviceAdr+":6";}s.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,i,"stepUp"+r,a);break;case"ch4stepDown":case"ch5stepDown":case"ch6stepDown":switch(o){case"ch4stepDown":i=this.deviceAdr+":4";break;case"ch5stepDown":i=this.deviceAdr+":5";break;case"ch6stepDown":i=this.deviceAdr+":6";}s.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,i,"stepDown"+r,a);break;case"ch4lamellaStepUp":case"ch5lamellaStepUp":case"ch6lamellaStepUp":switch(o){case"ch4lamellaStepUp":i=this.deviceAdr+":4";break;case"ch5lamellaStepUp":i=this.deviceAdr+":5";break;case"ch6lamellaStepUp":i=this.deviceAdr+":6";}e.getState({"interface":this.deviceIF,channel:i,datapoint:"LEVEL"},function(t,n){if(t)a&&a(t);else if(void 0!==n&&null!=n){var o=n.value;o=Math.round(100*o),s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,i,"lamellaStepUp"+r,function(t,r){t?a&&a(t):s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,i,"moveTo"+o,function(e,t){a&&a(e,t);});});}else a&&a(new Error("get blind current value return invalid"));});break;case"ch4lamellaStepDown":case"ch5lamellaStepDown":case"ch6lamellaStepDown":switch(o){case"ch4lamellaStepDown":i=this.deviceAdr+":4";break;case"ch5lamellaStepDown":i=this.deviceAdr+":5";break;case"ch6lamellaStepDown":i=this.deviceAdr+":6";}e.getState({"interface":this.deviceIF,channel:i,datapoint:"LEVEL"},function(t,n){if(t)a&&a(t);else if(void 0!==n&&null!=n){var o=n.value;o=Math.round(100*o),s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,i,"lamellaStepDown"+r,function(t,r){t?a&&a(t):s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,i,"moveTo"+o,function(e,t){a&&a(e,t);});});}else a&&a(new Error("get blind current value return invalid"));});break;case"ch4moveTo":case"ch5moveTo":case"ch6moveTo":switch(o){case"ch4moveTo":i=this.deviceAdr+":4";break;case"ch5moveTo":i=this.deviceAdr+":5";break;case"ch6moveTo":i=this.deviceAdr+":6";}s.SHUTTER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,i,"moveTo"+r,a);break;case"ch4lamellaTo":case"ch5lamellaTo":case"ch6lamellaTo":switch(o){case"ch4lamellaTo":i=this.deviceAdr+":4";break;case"ch5lamellaTo":i=this.deviceAdr+":5";break;case"ch6lamellaTo":i=this.deviceAdr+":6";}e.getState({"interface":this.deviceIF,channel:i,datapoint:"LEVEL"},function(t,n){if(t)a&&a(t);else if(void 0!==n&&null!=n){var o=n.value;o=Math.round(100*o),s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,i,"lamellaTo"+r,function(t,r){t?a&&a(t):s.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,i,"moveTo"+o,function(e,t){a&&a(e,t);});});}else a&&a(new Error("get blind current value return invalid"));});break;default:a&&a(new Error("no such command"));}},IPJalousie.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o,c=x.hub.m.hm._Channel["HmIP-RF"],l=null;if(0==i)return"UNREACH"==t?c.MAINTENANCE.parseDptState(t,a):((l={})["0_"+t.toLowerCase()]=a,l);if(3==i)return(o=c.BLIND_TRANSMITTER.parseDptState(t,a))&&(l={},"LEVEL"==t?l.blindLevel=o.blindTPos:"LEVEL_2"==t&&(l.lamellaLevel=o.lamellaTPos)),l;if(4==i||5==i||6==i){if(o=c.BLIND_VIRTUAL_RECEIVER.parseDptState(t,a))switch(l={},parseInt(i)){case 4:"LEVEL"==t?l.ch4blindLevel=o.blindPos:"LEVEL_2"==t&&(l.ch4lamellaLevel=o.lamellaPos);break;case 5:"LEVEL"==t?l.ch5blindLevel=o.blindPos:"LEVEL_2"==t&&(l.ch5lamellaLevel=o.lamellaPos);break;case 6:"LEVEL"==t?l.ch6blindLevel=o.blindPos:"LEVEL_2"==t&&(l.ch6lamellaLevel=o.lamellaPos);}return l;}return null;},IPJalousie.prototype.getConfig=function(e,t){var a=this.deviceAdr+":3";e.getParamset(this.deviceIF,a,"MASTER",function(e,r){if(e)t&&t(e);else{var n={},i=null;r&&(i={CHANGE_OVER_DELAY:r.CHANGE_OVER_DELAY,REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT:r.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT,REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE:r.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE,REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT:r.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT,REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE:r.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE,REFERENCE_RUNNING_TIME_SLATS_UNIT:r.REFERENCE_RUNNING_TIME_SLATS_UNIT,REFERENCE_RUNNING_TIME_SLATS_VALUE:r.REFERENCE_RUNNING_TIME_SLATS_VALUE,REFERENCE_RUN_COUNTER:r.REFERENCE_RUN_COUNTER}),n[a]=i,t&&t(e,n);}});},IPJalousie.prototype.setConfig=function(e,t,a){if(t){var r=this.deviceAdr+":3",n=t[r];if(n){var i={};i.CHANGE_OVER_DELAY={__rpcValueType:"double",__rpcValue:n.CHANGE_OVER_DELAY},i.REFERENCE_RUN_COUNTER=n.REFERENCE_RUN_COUNTER,i.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT={__rpcValueType:"double",__rpcValue:n.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT},i.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE={__rpcValueType:"double",__rpcValue:n.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE},i.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT={__rpcValueType:"double",__rpcValue:n.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT},i.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE={__rpcValueType:"double",__rpcValue:n.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE},i.REFERENCE_RUNNING_TIME_SLATS_UNIT={__rpcValueType:"double",__rpcValue:n.REFERENCE_RUNNING_TIME_SLATS_UNIT},i.REFERENCE_RUNNING_TIME_SLATS_VALUE={__rpcValueType:"double",__rpcValue:n.REFERENCE_RUNNING_TIME_SLATS_VALUE},e.setParamset(this.deviceIF,r,"MASTER",i,function(e){a&&a(e);});}else a&&a(new Error("config data not complete"));}else a&&a(new Error("config data invalid"));},IPJalousie.prototype.isButton=function(){return!0;},IPJalousie.prototype.claimEvent=function(e,t){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);var r=this;this._claimButtonEvent(1,e,function(){r._claimButtonEvent(2,e,function(){t&&t();});});},IPJalousie.prototype._claimButtonEvent=function(e,t,a){var r=this;t.reportValueUsage(this.deviceIF,this.deviceAdr+":"+e,"PRESS_SHORT",function(n,i){n&&console.error("button:"+e+" claim PRESS_SHORT event error:"+n.stack),t.reportValueUsage(r.deviceIF,r.deviceAdr+":"+e,"PRESS_LONG",function(t,r){t&&console.error("button:"+e+" claim PRESS_LONG event error:"+t.stack),a&&a();});});};var IPPresence=function IPPresence(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="ip_presence";};util.inherits(IPPresence,Device),IPPresence.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["HmIP-RF"],r=a.MAINTENANCE_BAT_EL.getReadableDpts();return r&&r.forEach(function(a){e.push({channel:t.deviceAdr+":0",dpt:a});}),(r=a.PRESENCEDETECTOR_TRANSCEIVER.getReadableDpts())&&r.forEach(function(a){e.push({channel:t.deviceAdr+":1",dpt:a});}),e;},IPPresence.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t+":"+this.channel,dataPoint:null},r=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case"timeout":case"lowbat":case"sabotage":a.channel=t+":0",a.dataPoint=r.MAINTENANCE_BAT_EL.getDptFromState(e);break;case"state":case"illumination":case"current_illumination":case"active":a.channel=t+":1",a.dataPoint=r.PRESENCEDETECTOR_TRANSCEIVER.getDptFromState(e);break;default:return null;}return a;},IPPresence.prototype.executeCommand=function(e,t,a){var r=x.hub.m.hm._Channel["HmIP-RF"];switch(t){case"reset":case"activate":case"deactivate":case"toggleActivate":r.PRESENCEDETECTOR_TRANSCEIVER.executeCommand(e,this.deviceIF,this.deviceAdr+":1",t,a);break;default:a&&a(new Error("no such command"));}},IPPresence.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o=x.hub.m.hm._Channel["HmIP-RF"],c=null;return 0==i?"UNREACH"==t||"LOW_BAT"==t||"SABOTAGE"==t?o.MAINTENANCE_BAT_EL.parseDptState(t,a):((c={})["0_"+t.toLowerCase()]=a,c):1==i?o.PRESENCEDETECTOR_TRANSCEIVER.parseDptState(t,a):null;};var IPFloorHeater=function IPFloorHeater(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="ip_floor_heater";};util.inherits(IPFloorHeater,Device),IPFloorHeater.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["HmIP-RF"].CLIMATECONTROL_FLOOR_TRANSCEIVER.getReadableDpts();return a&&a.forEach(function(a){e.push({channel:t.deviceAdr+":"+t.channel,dpt:a});}),e;},IPFloorHeater.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t+":"+this.channel,dataPoint:null},r=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case"cl_f_humidityLimiter":case"cl_f_emergencyOP":case"cl_f_frostProtection":case"cl_f_state":case"cl_f_dewPointAlarm":case"cl_f_externalClock":a.channel=t+":"+this.channel,a.dataPoint=r.CLIMATECONTROL_FLOOR_TRANSCEIVER.getDptFromState(e);break;default:return null;}return a;},IPFloorHeater.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o=x.hub.m.hm._Channel["HmIP-RF"];return i==this.channel?o.CLIMATECONTROL_FLOOR_TRANSCEIVER.parseDptState(t,a):null;};var IPFloorPumpHeater=function IPFloorPumpHeater(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="ip_floor_pump_heater";};util.inherits(IPFloorPumpHeater,Device),IPFloorPumpHeater.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["HmIP-RF"].CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER.getReadableDpts();return a&&a.forEach(function(a){e.push({channel:t.deviceAdr+":"+t.channel,dpt:a});}),e;},IPFloorPumpHeater.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t+":"+this.channel,dataPoint:null},r=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case"cl_fp_humidityLimiter":case"cl_fp_emergencyOP":case"cl_fp_frostProtection":case"cl_fp_state":case"cl_fp_dewPointAlarm":case"cl_fp_externalClock":a.channel=t+":"+this.channel,a.dataPoint=r.CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER.getDptFromState(e);break;default:return null;}return a;},IPFloorPumpHeater.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o=x.hub.m.hm._Channel["HmIP-RF"];return i==this.channel?o.CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER.parseDptState(t,a):null;};var IPWeather=function IPWeather(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="ip_weather";};util.inherits(IPWeather,Device),IPWeather.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["HmIP-RF"],r=a.MAINTENANCE_BAT_CL.getReadableDpts();return r&&r.forEach(function(a){e.push({channel:t.deviceAdr+":0",dpt:a});}),(r=a.WEATHER_TRANSMIT.getReadableDpts())&&r.forEach(function(a){-1==a.indexOf("RAIN")&&-1==a.indexOf("WIND_DIR")&&e.push({channel:t.deviceAdr+":1",dpt:a});}),e;},IPWeather.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t+":"+this.channel,dataPoint:null},r=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case"timeout":case"lowbat":a.channel=t+":0",a.dataPoint=r.MAINTENANCE_BAT_CL.getDptFromState(e);break;default:a.channel=t+":1";var n=r.WEATHER_TRANSMIT.getDptFromState(e);if(!n)return null;a.dataPoint=n;}return a;},IPWeather.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o=x.hub.m.hm._Channel["HmIP-RF"],c=null;return 0==i?"UNREACH"==t||"LOW_BAT"==t?o.MAINTENANCE_BAT_CL.parseDptState(t,a):((c={})["0_"+t.toLowerCase()]=a,c):1==i?o.WEATHER_TRANSMIT.parseDptState(t,a):null;};var IPWeather2=function IPWeather2(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="ip_weather2";};util.inherits(IPWeather2,Device),IPWeather2.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["HmIP-RF"],r=a.MAINTENANCE_BAT_CL.getReadableDpts();return r&&r.forEach(function(a){e.push({channel:t.deviceAdr+":0",dpt:a});}),(r=a.WEATHER_TRANSMIT.getReadableDpts())&&r.forEach(function(a){-1==a.indexOf("WIND_DIR")&&e.push({channel:t.deviceAdr+":1",dpt:a});}),e;},IPWeather2.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t+":"+this.channel,dataPoint:null},r=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case"timeout":case"lowbat":a.channel=t+":0",a.dataPoint=r.MAINTENANCE_BAT_CL.getDptFromState(e);break;default:a.channel=t+":1";var n=r.WEATHER_TRANSMIT.getDptFromState(e);if(!n)return null;a.dataPoint=n;}return a;},IPWeather2.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o=x.hub.m.hm._Channel["HmIP-RF"],c=null;return 0==i?"UNREACH"==t||"LOW_BAT"==t?o.MAINTENANCE_BAT_CL.parseDptState(t,a):((c={})["0_"+t.toLowerCase()]=a,c):1==i?o.WEATHER_TRANSMIT.parseDptState(t,a):null;};var IPWeather3=function IPWeather3(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="ip_weather3";};util.inherits(IPWeather3,Device),IPWeather3.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["HmIP-RF"],r=a.MAINTENANCE_BAT_CL.getReadableDpts();return r&&r.forEach(function(a){e.push({channel:t.deviceAdr+":0",dpt:a});}),(r=a.CLIMATE_TRANSCEIVER.getReadableDpts())&&r.forEach(function(a){e.push({channel:t.deviceAdr+":1",dpt:a});}),e;},IPWeather3.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t+":"+this.channel,dataPoint:null},r=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case"timeout":case"lowbat":a.channel=t+":0",a.dataPoint=r.MAINTENANCE_BAT_CL.getDptFromState(e);break;default:a.channel=t+":1";var n=r.CLIMATE_TRANSCEIVER.getDptFromState(e);if(!n)return null;a.dataPoint=n;}return a;},IPWeather3.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o=x.hub.m.hm._Channel["HmIP-RF"],c=null;return 0==i?"UNREACH"==t||"LOW_BAT"==t?o.MAINTENANCE_BAT_CL.parseDptState(t,a):((c={})["0_"+t.toLowerCase()]=a,c):1==i?o.CLIMATE_TRANSCEIVER.parseDptState(t,a):null;};var IPWeather4=function IPWeather4(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="ip_weather4";};util.inherits(IPWeather4,Device),IPWeather4.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["HmIP-RF"],r=a.MAINTENANCE_BAT_CL.getReadableDpts();return r&&r.forEach(function(a){e.push({channel:t.deviceAdr+":0",dpt:a});}),(r=a.WEATHER_TRANSMIT.getReadableDpts())&&r.forEach(function(a){-1==a.indexOf("WIND_DIR")&&e.push({channel:t.deviceAdr+":1",dpt:a});}),e;},IPWeather4.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t+":"+this.channel,dataPoint:null},r=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case"timeout":case"lowbat":a.channel=t+":0",a.dataPoint=r.MAINTENANCE_BAT_CL.getDptFromState(e);break;default:a.channel=t+":1";var n=r.WEATHER_TRANSMIT.getDptFromState(e);if(!n)return null;a.dataPoint=n;}return a;},IPWeather4.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o=x.hub.m.hm._Channel["HmIP-RF"],c=null;return 0==i?"UNREACH"==t||"LOW_BAT"==t?o.MAINTENANCE_BAT_CL.parseDptState(t,a):((c={})["0_"+t.toLowerCase()]=a,c):1==i?o.WEATHER_TRANSMIT.parseDptState(t,a):null;};var IPDirection=function IPDirection(e,t,a){Device.call(this,e,t,a),this.channel=2,this.legacyType="ip_direction";};util.inherits(IPDirection,Device),IPDirection.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["HmIP-RF"],r=a.MAINTENANCE_BAT_EL.getReadableDpts();return r&&r.forEach(function(a){e.push({channel:t.deviceAdr+":0",dpt:a});}),(r=a.PASSAGE_DETECTOR_DIRECTION_TRANSMITTER.getReadableDpts())&&r.forEach(function(a){e.push({channel:t.deviceAdr+":2",dpt:a}),e.push({channel:t.deviceAdr+":3",dpt:a});}),e;},IPDirection.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t+":"+this.channel,dataPoint:null},r=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case"timeout":case"lowbat":a.channel=t+":0",a.dataPoint=r.MAINTENANCE_BAT_EL.getDptFromState(e);break;case"ch2State":a.channel=t+":2",a.dataPoint=r.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case"ch3State":a.channel=t+":3",a.dataPoint=r.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;case"ch4State":a.channel=t+":4",a.dataPoint=r.SWITCH_VIRTUAL_RECEIVER.getDptFromState("switchState");break;default:a.channel=t+":2";var n=r.PASSAGE_DETECTOR_DIRECTION_TRANSMITTER.getDptFromState(e);if(!n)return null;a.dataPoint=n;}return a;},IPDirection.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o,c=x.hub.m.hm._Channel["HmIP-RF"],l=null;return 0==i?"UNREACH"==t||"LOW_BAT"==t?c.MAINTENANCE_BAT_EL.parseDptState(t,a):((l={})["0_"+t.toLowerCase()]=a,l):2==i?((o=c.PASSAGE_DETECTOR_DIRECTION_TRANSMITTER.parseDptState(t,a))&&(l={},void 0!==o.current_direction&&(l.current_passage_r2l=o.current_direction),void 0!==o.last_direction&&(l.last_passage_r2l=o.last_direction),void 0!==o.passage_counter&&(l.r2l_passage_counter=o.passage_counter),void 0!==o.passage_counter_overflow&&(l.r2l_passage_counter_overflow=o.passage_counter_overflow)),l):3==i?((o=c.PASSAGE_DETECTOR_DIRECTION_TRANSMITTER.parseDptState(t,a))&&(l={},void 0!==o.current_direction&&(l.current_passage_l2r=o.current_direction),void 0!==o.last_direction&&(l.last_passage_l2r=o.last_direction),void 0!==o.passage_counter&&(l.l2r_passage_counter=o.passage_counter),void 0!==o.passage_counter_overflow&&(l.l2r_passage_counter_overflow=o.passage_counter_overflow)),l):null;},IPDirection.prototype.parseStates=function(e){var t={};for(var a in e){var r=this.parseChnState(a,e[a]);r&&(t=x.hub.m.hm._Util.mergeObj(t,r));}return t.current_passage_r2l&&t.current_passage_l2r&&(t.current_passage_r2l.value?t.current_direction={value:"right_to_left",time:t.current_passage_r2l.time}:t.current_direction={value:"left_to_right",time:t.current_passage_l2r.time}),t.last_passage_r2l&&t.last_passage_l2r&&(t.last_passage_r2l.value?t.last_direction={value:"right_to_left",time:t.last_passage_r2l.time}:t.last_direction={value:"left_to_right",time:t.last_passage_l2r.time}),delete t.current_passage_r2l,delete t.current_passage_l2r,delete t.last_passage_r2l,delete t.last_passage_l2r,t;};var IPButton8=function IPButton8(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="ip_button8";};util.inherits(IPButton8,Device),IPButton8.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();return a&&a.forEach(function(a){"SABOTAGE"!=a&&e.push({channel:t.deviceAdr+":0",dpt:a});}),e;},IPButton8.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t+":"+this.channel,dataPoint:null},r=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case"timeout":case"lowbat":a.channel=t+":0",a.dataPoint=r.MAINTENANCE_BAT_EL.getDptFromState(e);break;default:return null;}return a;},IPButton8.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o,c=x.hub.m.hm._Channel["HmIP-RF"],l=null;return 0==i?"UNREACH"==t||"LOW_BAT"==t?c.MAINTENANCE_BAT_EL.parseDptState(t,a):((l={})["0_"+t.toLowerCase()]=a,l):(1!=i&&2!=i&&3!=i&&4!=i&&5!=i&&6!=i&&7!=i&&8!=i||(o=c.KEY_TRANRECEIVER.parseDptState(t,a))&&(l||(l={}),o.pressShort&&(l["btn"+i+"pressShort"]=!0),o.pressLong&&(l["btn"+i+"pressLong"]=!0)),l);},IPButton8.prototype.isButton=function(){return!0;},IPButton8.prototype.claimEvent=function(e,t){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);var r=this;this._claimButtonEvent(1,e,function(){r._claimButtonEvent(2,e,function(){r._claimButtonEvent(3,e,function(){r._claimButtonEvent(4,e,function(){r._claimButtonEvent(5,e,function(){r._claimButtonEvent(6,e,function(){r._claimButtonEvent(7,e,function(){r._claimButtonEvent(8,e,function(){t&&t();});});});});});});});});},IPButton8.prototype._claimButtonEvent=function(e,t,a){var r=this;t.reportValueUsage(this.deviceIF,this.deviceAdr+":"+e,"PRESS_SHORT",function(n,i){n&&console.error("button:"+e+" claim PRESS_SHORT event error:"+n.stack),t.reportValueUsage(r.deviceIF,r.deviceAdr+":"+e,"PRESS_LONG",function(t,r){t&&console.error("button:"+e+" claim PRESS_LONG event error:"+t.stack),a&&a();});});};var IPGenericInput=function IPGenericInput(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="ip_generic_input";};util.inherits(IPGenericInput,Device),IPGenericInput.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["HmIP-RF"].GENERIC_INPUT_TRANSMITER.getReadableDpts();return a&&a.forEach(function(a){e.push({channel:t.deviceAdr+":"+t.channel,dpt:a});}),e;},IPGenericInput.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t+":"+this.channel,dataPoint:null},r=x.hub.m.hm._Channel["HmIP-RF"];a.channel=t+":"+this.channel;var n=r.GENERIC_INPUT_TRANSMITER.getDptFromState(e);return n?(a.dataPoint=n,a):null;},IPGenericInput.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o=x.hub.m.hm._Channel["HmIP-RF"];return i==this.channel?o.GENERIC_INPUT_TRANSMITER.parseDptState(t,a):null;};var IPAnalogOutput=function IPAnalogOutput(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="ip_analog_output";};util.inherits(IPAnalogOutput,Device),IPAnalogOutput.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["HmIP-RF"].ANALOG_OUTPUT_TRANSCEIVER.getReadableDpts();return a&&a.forEach(function(a){e.push({channel:t.deviceAdr+":"+t.channel,dpt:a});}),e;},IPAnalogOutput.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t+":"+this.channel,dataPoint:null},r=x.hub.m.hm._Channel["HmIP-RF"];return"outputLevel"!==e?null:(a.channel=t+":"+this.channel,a.dataPoint=r.ANALOG_OUTPUT_TRANSCEIVER.getDptFromState("outputLevel"),a);},IPAnalogOutput.prototype.executeCommand=function(e,t,a){x.hub.m.hm._Channel["HmIP-RF"].ANALOG_OUTPUT_TRANSCEIVER.executeCommand(e,this.deviceIF,this.deviceAdr+":"+this.channel,t,function(e,t){a&&a(e,t);});},IPAnalogOutput.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o=x.hub.m.hm._Channel["HmIP-RF"],c=null;return i==this.channel&&(c=o.ANALOG_OUTPUT_TRANSCEIVER.parseDptState(t,a)),c;};var IPWater=function IPWater(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="ip_water";};util.inherits(IPWater,Device),IPWater.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["HmIP-RF"],r=a.MAINTENANCE_BAT_CL.getReadableDpts();return r&&r.forEach(function(a){e.push({channel:t.deviceAdr+":0",dpt:a});}),(r=a.WATER_DETECTION_TRANSMITTER.getReadableDpts())&&r.forEach(function(a){e.push({channel:t.deviceAdr+":1",dpt:a});}),e;},IPWater.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t+":"+this.channel,dataPoint:null},r=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case"timeout":case"lowbat":a.channel=t+":0",a.dataPoint=r.MAINTENANCE_BAT_CL.getDptFromState(e);break;case"alarm":case"moisture":case"water":a.channel=t+":1",a.dataPoint=r.WATER_DETECTION_TRANSMITTER.getDptFromState(e);break;default:return null;}return a;},IPWater.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o=x.hub.m.hm._Channel["HmIP-RF"],c=null;return 0==i?"UNREACH"==t||"LOW_BAT"==t||"ERROR_NON_FLAT_POSITIONING"==t?o.MAINTENANCE_BAT_CL.parseDptState(t,a):((c={})["0_"+t.toLowerCase()]=a,c):1==i?o.WATER_DETECTION_TRANSMITTER.parseDptState(t,a):null;};var IPAcce=function IPAcce(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="ip_acce";};util.inherits(IPAcce,Device),IPAcce.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["HmIP-RF"],r=a.MAINTENANCE_BAT_EL.getReadableDpts();return r&&r.forEach(function(a){"SABOTAGE"!=a&&e.push({channel:t.deviceAdr+":0",dpt:a});}),(r=a.ACCELERATION_TRANSCEIVER.getReadableDpts())&&r.forEach(function(a){e.push({channel:t.deviceAdr+":1",dpt:a});}),e;},IPAcce.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t+":"+this.channel,dataPoint:null},r=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case"timeout":case"lowbat":case"volatage":case"errorCode":case"sensorError":a.channel=t+":0",a.dataPoint=r.MAINTENANCE_BAT_EL.getDptFromState(e);break;case"motion":a.channel=t+":1",a.dataPoint=r.ACCELERATION_TRANSCEIVER.getDptFromState(e);break;default:return null;}return a;},IPAcce.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o=x.hub.m.hm._Channel["HmIP-RF"],c=null;return 0==i?"UNREACH"==t||"LOW_BAT"==t||"OPERATING_VOLTAGE"==t||"ERROR_CODE"==t||"SENSOR_ERROR"==t?o.MAINTENANCE_BAT_EL.parseDptState(t,a):((c={})["0_"+t.toLowerCase()]=a,c):1==i?o.ACCELERATION_TRANSCEIVER.parseDptState(t,a):null;};var IPWGC=function IPWGC(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="ip_garagedoor";};util.inherits(IPWGC,Device),IPWGC.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();return a&&a.forEach(function(a){"SABOTAGE"!=a&&e.push({channel:t.deviceAdr+":0",dpt:a});}),e;},IPWGC.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t+":"+this.channel,dataPoint:null},r=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case"timeout":case"lowbat":case"voltage":case"errorCode":a.channel=t+":0",a.dataPoint=r.MAINTENANCE_BAT_EL.getDptFromState(e);break;default:return null;}return a;},IPWGC.prototype.executeCommand=function(e,t,a){var r=null,n=x.hub.m.hm._Channel["HmIP-RF"];if("on"===t)r=this.deviceAdr+":3",n.SWITCH_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,r,"onFor0.5",a);else{if("onFor"==t.substr(0,5))return r=this.deviceAdr+":3",void n.SWITCH_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,r,t,a);a&&a(new Error("no such command"));}},IPWGC.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o,c=x.hub.m.hm._Channel["HmIP-RF"],l=null;return 0==i?"UNREACH"==t||"LOW_BAT"==t||"OPERATING_VOLTAGE"==t||"ERROR_CODE"==t?c.MAINTENANCE_BAT_EL.parseDptState(t,a):((l={})["0_"+t.toLowerCase()]=a,l):1==i?((o=c.KEY_TRANRECEIVER.parseDptState(t,a))&&(l||(l={}),o.pressShort&&(l.btnPressShort=!0),o.pressLong&&(l.btnPressLong=!0)),l):null;},IPWGC.prototype.isButton=function(){return!0;},IPWGC.prototype.claimEvent=function(e,t){this._claimButtonEvent(1,e,function(){t&&t();});},IPWGC.prototype._claimButtonEvent=function(e,t,a){var r=this;t.reportValueUsage(this.deviceIF,this.deviceAdr+":"+e,"PRESS_SHORT",function(n,i){n&&console.error("button:"+e+" claim PRESS_SHORT event error:"+n.stack),t.reportValueUsage(r.deviceIF,r.deviceAdr+":"+e,"PRESS_LONG",function(t,r){t&&console.error("button:"+e+" claim PRESS_LONG event error:"+t.stack),a&&a();});});};var e,t,a,r,n=(e=function e(_e,t,a){Device.call(this,_e,t,a),this._chMaintenance=0,this._chKeyTransceiver1=1,this._chKeyTransceiver2=2,this._chSwitchTransmitter3=3,this._chSwitchVirtualReceiver4=4,this._chDimmerTransmitter7=7,this._chDimmerVirtualReceiver8=8,this._chDimmerTransmitter11=11,this._chDimmerVirtualReceiver12=12,this._chDimmerWeekProfile=15,this.legacyType="ip_bsl";},util.inherits(e,Device),e.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":"+this._chMaintenance,dpt:"UNREACH"},{channel:this.deviceAdr+":"+this._chSwitchTransmitter3,dpt:"STATE"},{channel:this.deviceAdr+":"+this._chDimmerTransmitter7,dpt:"LEVEL"},{channel:this.deviceAdr+":"+this._chDimmerTransmitter7,dpt:"COLOR"},{channel:this.deviceAdr+":"+this._chDimmerTransmitter11,dpt:"LEVEL"},{channel:this.deviceAdr+":"+this._chDimmerTransmitter11,dpt:"COLOR"}];},e.prototype._getDptFromRef=function(e){var t={channel:this.getSerial()+":",dataPoint:null};switch(e){case"timeout":t.channel+=this._chMaintenance,t.dataPoint="UNREACH";break;case"state":t.channel+=this._chSwitchTransmitter3,t.dataPoint="STATE";break;case"led1Level":t.channel+=this._chDimmerTransmitter7,t.dataPoint="LEVEL";break;case"led1Color":t.channel+=this._chDimmerTransmitter7,t.dataPoint="COLOR";break;case"led2Level":t.channel+=this._chDimmerTransmitter11,t.dataPoint="LEVEL";break;case"led2Color":t.channel+=this._chDimmerTransmitter11,t.dataPoint="COLOR";break;default:return null;}return t;},e.prototype.executeCommand=function(e,t,a){var r,n,i,s=x.hub.m.hm._Channel["HmIP-RF"],o=this.getSerial(),c=t;switch(-1!=t.indexOf("dimUp")?(n=t.indexOf("dimUp"),c=t.substr(0,n+5),i=t.substr(n)):-1!=t.indexOf("dimDown")?(n=t.indexOf("dimDown"),c=t.substr(0,n+7),i=t.substr(n)):-1!=t.indexOf("dimTo")?(n=t.indexOf("dimTo"),c=t.substr(0,n+5),i=t.substr(n)):-1!=t.indexOf("toggleTo")?(n=t.indexOf("toggleTo"),c=t.substr(0,n+8),i=t.substr(n)):-1!=t.indexOf("colorTo")&&(n=t.indexOf("colorTo"),c=t.substr(0,n+7),i=t.substr(n)),c){case"on":case"off":case"toggle":r=o+":"+this._chSwitchVirtualReceiver4,s.SWITCH_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,r,c,a);break;case"led1on":case"led1off":case"led1dimUp":case"led1dimDown":case"led1dimTo":case"led1toggleTo":case"led1colorTo":case"led2on":case"led2off":case"led2dimUp":case"led2dimDown":case"led2dimTo":case"led2toggleTo":case"led2colorTo":r="led1"==c.substr(0,4)?o+":"+this._chDimmerVirtualReceiver12:o+":"+this._chDimmerVirtualReceiver8,"led1on"==c?i="dimTo100":"led1off"==c?i="dimOff":"led2on"==c?i="dimTo100":"led2off"==c&&(i="dimOff"),s.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,r,i,a);break;default:if("onFor"==c.substr(0,5))return r=o+":"+this._chSwitchVirtualReceiver4,void s.SWITCH_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,r,c,a);a&&a(new Error("no such command"));}},e.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1);if(n!=this.getSerial())return null;var s,o=x.hub.m.hm._Channel["HmIP-RF"];switch(parseInt(i)){case this._chMaintenance:return"UNREACH"===t?o.MAINTENANCE.parseDptState(t,a):((c={})["0_"+t.toLowerCase()]=a,c);case this._chKeyTransceiver1:case this._chKeyTransceiver2:return(s=o.KEY_TRANRECEIVER.parseDptState(t,a))&&(c||(c={}),s.pressShort&&(c["btn"+i+"pressShort"]=!0),s.pressLong&&(c["btn"+i+"pressLong"]=!0)),c;case this._chSwitchTransmitter3:var c;return"STATE"===t?((s=o.SWITCH_TRANSMITTER.parseDptState(t,a))&&((c={}).state=s.switchTState),c):null;case this._chDimmerTransmitter7:return(s=o.DIMMER_TRANSMITTER.parseDptState(t,a))&&(c={},"LEVEL"==t?c.led2Level=s.dimmerTLevel:"COLOR"==t&&(c.led2Color=s.dimmerTColor)),c;case this._chDimmerTransmitter11:return(s=o.DIMMER_TRANSMITTER.parseDptState(t,a))&&(c={},"LEVEL"==t?c.led1Level=s.dimmerTLevel:"COLOR"==t&&(c.led1Color=s.dimmerTColor)),c;default:return null;}},e.prototype.isButton=function(){return!0;},e.prototype.claimEvent=function(e,t){var a=this.getSerial(),r=this;e.reportValueUsage(this.deviceIF,a+":"+this._chKeyTransceiver1,"PRESS_SHORT",function(n,i){n&&console.error("button:1 claim PRESS_SHORT event error:"+n.stack),e.reportValueUsage(r.deviceIF,a+":"+r._chKeyTransceiver1,"PRESS_LONG",function(n,i){n&&console.error("button:1 claim PRESS_LONG event error:"+n.stack),e.reportValueUsage(r.deviceIF,a+":"+r._chKeyTransceiver2,"PRESS_SHORT",function(n,i){n&&console.error("button:2 claim PRESS_SHORT event error:"+n.stack),e.reportValueUsage(r.deviceIF,a+":"+r._chKeyTransceiver2,"PRESS_LONG",function(e,a){e&&console.error("button:2 claim PRESS_LONG event error:"+e.stack),t&&t();});});});});},e),i=(t=function t(e,_t,a){Device.call(this,e,_t,a),this._chMaintenance=0,this._chDoorReceiver=1,this._chSimpleSwitchReceiver=2,this.legacyType="ip_tormatic";},util.inherits(t,Device),t.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":"+this._chMaintenance,dpt:"UNREACH"},{channel:this.deviceAdr+":"+this._chDoorReceiver,dpt:"DOOR_STATE"},{channel:this.deviceAdr+":"+this._chSimpleSwitchReceiver,dpt:"STATE"}];},t.prototype._getDptFromRef=function(e){var t={channel:this.getSerial()+":",dataPoint:null};switch(e){case"timeout":t.channel+=this._chMaintenance,t.dataPoint="UNREACH";break;case"doorState":t.channel+=this._chDoorReceiver,t.dataPoint="DOOR_STATE";break;case"lightState":t.channel+=this._chSimpleSwitchReceiver,t.dataPoint="STATE";break;default:return null;}return t;},t.prototype.executeCommand=function(e,t,a){var r,n,i=x.hub.m.hm._Channel["HmIP-RF"],s=this.getSerial();switch(t){case"open":case"close":case"partialOpen":case"stop":r=s+":"+this._chDoorReceiver,i.DOOR_RECEIVER.executeCommand(e,this.deviceIF,r,t,a);break;case"lightOn":case"lightOff":case"lightToggle":n=t.substr(5).toLowerCase(),r=s+":"+this._chSimpleSwitchReceiver,i.SIMPLE_SWITCH_RECEIVER.executeCommand(e,this.deviceIF,r,n,a);break;default:a&&a(new Error("no such command"));}},t.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1);if(n!=this.getSerial())return null;var s,o,c=x.hub.m.hm._Channel["HmIP-RF"];switch(parseInt(i)){case this._chMaintenance:return"UNREACH"===t?c.MAINTENANCE.parseDptState(t,a):((s={})["0_"+t.toLowerCase()]=a,s);case this._chDoorReceiver:return(o=c.DOOR_RECEIVER.parseDptState(t,a))&&(s=o),s;case this._chSimpleSwitchReceiver:return(o=c.SIMPLE_SWITCH_RECEIVER.parseDptState(t,a))&&((s={}).lightState=o.state),s;default:return null;}},t),s=(a=function a(e,t,_a){Device.call(this,e,t,_a),this._chMaintenance=0,this._chBrightness=1,this.legacyType="ip_lux";},util.inherits(a,Device),a.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["HmIP-RF"],r=a.MAINTENANCE_BAT_EL.getReadableDpts();return r&&r.forEach(function(a){"SABOTAGE"!=a&&"ERROR_CODE"!=a&&"SENSOR_ERROR"!=a&&e.push({channel:t.deviceAdr+":0",dpt:a});}),(r=a.BRIGHTNESS_TRANSMITTER.getReadableDpts())&&r.forEach(function(a){e.push({channel:t.deviceAdr+":1",dpt:a});}),e;},a.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t+":"+this.channel,dataPoint:null},r=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case"timeout":case"lowbat":case"volatage":a.channel=t+":0",a.dataPoint=r.MAINTENANCE_BAT_EL.getDptFromState(e);break;case"illu":case"avgIllu":case"maxIllu":case"minIllu":a.channel=t+":1",a.dataPoint=r.BRIGHTNESS_TRANSMITTER.getDptFromState(e);break;default:return null;}return a;},a.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o=x.hub.m.hm._Channel["HmIP-RF"],c=null;return 0==i?"UNREACH"==t||"LOW_BAT"==t||"OPERATING_VOLTAGE"==t?o.MAINTENANCE_BAT_EL.parseDptState(t,a):((c={})["0_"+t.toLowerCase()]=a,c):1==i?o.BRIGHTNESS_TRANSMITTER.parseDptState(t,a):null;},a),o=(r=function r(e,t,a){Device.call(this,e,t,a),this._chMaintenance=0,this._chPowerMainsTransmitter=1,this.legacyType="ip_pmfs";},util.inherits(r,Device),r.prototype._getReadableDpts=function(){var e=this.getSerial(),t=[],a=this,r=x.hub.m.hm._Channel["HmIP-RF"],n=r.MAINTENANCE.getReadableDpts();return n&&n.forEach(function(r){"UNREACH"==r&&t.push({channel:e+":"+a._chMaintenance,dpt:r});}),(n=r.POWER_MAINS_TRANSMITTER.getReadableDpts())&&n.forEach(function(r){t.push({channel:e+":"+a._chPowerMainsTransmitter,dpt:r});}),t;},r.prototype._getDptFromRef=function(e){var t=this.getSerial(),a={channel:null,dataPoint:null},r=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case"timeout":a.channel=t+":"+this._chMaintenance,a.dataPoint=r.MAINTENANCE.getDptFromState(e);break;case"powerMainsFailure":a.channel=t+":"+this._chPowerMainsTransmitter,a.dataPoint=r.POWER_MAINS_TRANSMITTER.getDptFromState(e);break;default:return null;}return a;},r.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o=x.hub.m.hm._Channel["HmIP-RF"],c=null;return i==this._chMaintenance?"UNREACH"==t?o.MAINTENANCE.parseDptState(t,a):((c={})["0_"+t.toLowerCase()]=a,c):i==this._chPowerMainsTransmitter?o.POWER_MAINS_TRANSMITTER.parseDptState(t,a):null;},r),c=function(){var IP_Rotary=function IP_Rotary(e,t,a){Device.call(this,e,t,a),this.channel=1,this.legacyType="ip_rotary";};return util.inherits(IP_Rotary,Device),IP_Rotary.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts();return a&&a.forEach(function(a){"SABOTAGE"!=a&&"ERROR_CODE"!=a&&"SENSOR_ERROR"!=a&&e.push({channel:t.deviceAdr+":0",dpt:a});}),e;},IP_Rotary.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t+":"+this.channel,dataPoint:null},r=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case"timeout":case"lowbat":case"voltage":a.channel=t+":0",a.dataPoint=r.MAINTENANCE_BAT_EL.getDptFromState(e);break;default:return null;}return a;},IP_Rotary.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o,c=x.hub.m.hm._Channel["HmIP-RF"],l=null;return 0==i?"UNREACH"==t||"LOW_BAT"==t||"OPERATING_VOLTAGE"==t?c.MAINTENANCE_BAT_EL.parseDptState(t,a):((l={})["0_"+t.toLowerCase()]=a,l):(1!=i&&2!=i&&3!=i||(o=c.KEY_TRANRECEIVER.parseDptState(t,a))&&(l||(l={}),o.pressShort&&(l["btn"+i+"pressShort"]=!0),o.pressLong&&(l["btn"+i+"pressLong"]=!0)),l);},IP_Rotary.prototype.isButton=function(){return!0;},IP_Rotary.prototype.claimEvent=function(e,t){var a=this.deviceAdr;-1==a.indexOf(":")&&this.channel&&(a+=":"+this.channel);var r=this;this._claimButtonEvent(1,e,function(){r._claimButtonEvent(2,e,function(){r._claimButtonEvent(3,e,function(){t&&t();});});});},IP_Rotary.prototype._claimButtonEvent=function(e,t,a){var r=this;t.reportValueUsage(this.deviceIF,this.deviceAdr+":"+e,"PRESS_SHORT",function(n,i){n&&console.error("button:"+e+" claim PRESS_SHORT event error:"+n.stack),t.reportValueUsage(r.deviceIF,r.deviceAdr+":"+e,"PRESS_LONG",function(t,r){t&&console.error("button:"+e+" claim PRESS_LONG event error:"+t.stack),a&&a();});});},IP_Rotary;}(),l=function(){var T_Button=function T_Button(e,t,a){Device.call(this,e,t,a),this._chKeyTransceivers=[1],this._chMaintenance=0,this._chMaintenanceDpts=["UNREACH","LOW_BAT"],1==this._chKeyTransceivers.length?this.legacyType="ip_button":this.legacyType="ip_button"+this._chKeyTransceivers;};return util.inherits(T_Button,Device),T_Button.prototype._getReadableDpts=function(){var e=[],t=this,a=this.getSerial(),r=x.hub.m.hm._Channel["HmIP-RF"].T_MAINTENANCE.getReadableDpts();return r&&r.forEach(function(r){-1!=t._chMaintenanceDpts.indexOf(r)&&e.push({channel:a+":"+t._chMaintenance,dpt:r});}),e;},T_Button.prototype._getDptFromRef=function(e){var t=x.hub.m.hm._Channel["HmIP-RF"].T_MAINTENANCE.getDptFromState(e);return t?{channel:this.getSerial()+":"+this._chMaintenance,dataPoint:t}:null;},T_Button.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=x.hub.m.hm._Channel["HmIP-RF"],i=e.substr(0,r),s=e.substr(r+1);if(i!=this.getSerial())return null;if(parseInt(s)==this._chMaintenance)return-1!=this._chMaintenanceDpts.indexOf(t)?n.T_MAINTENANCE.parseDptState(t,a):((o={})["0_"+t.toLowerCase()]=a,o);if(-1!=this._chKeyTransceivers.indexOf(parseInt(s))){if(tmp=n.KEY_TRANRECEIVER.parseDptState(t,a),tmp){var o={};1==this._chKeyTransceivers.length?o=tmp:(tmp.pressShort&&(o["btn"+s+"pressShort"]=!0),tmp.pressLong&&(o["btn"+s+"pressLong"]=!0));}return o;}},T_Button.prototype.isButton=function(){return!0;},T_Button.prototype.claimEvent=function(e,t){var a=0,r=this,cb=function cb(){++a<r._chKeyTransceivers.length?r._claimButtonEvent(r._chKeyTransceivers[a],e,cb):t&&t();};this._claimButtonEvent(this._chKeyTransceivers[a],e,cb);},T_Button.prototype._claimButtonEvent=function(e,t,a){var r=this;t.reportValueUsage(this.deviceIF,this.deviceAdr+":"+e,"PRESS_SHORT",function(n,i){n&&console.error("button:"+e+" claim PRESS_SHORT event error:"+n.stack),t.reportValueUsage(r.deviceIF,r.deviceAdr+":"+e,"PRESS_LONG",function(t,r){t&&console.error("button:"+e+" claim PRESS_LONG event error:"+t.stack),a&&a();});});},T_Button.parse=function(e){var t=null,a=e.address,r=e.address.indexOf(":");-1!=r&&(t=e.address.substr(r+1),a=e.address.substr(0,r));var n=null;if("HmIP-MOD-OC8"===e.type)(n=new T_Button(e.type,e["interface"],a))._chMaintenance=0,n._chMaintenanceDpts=["UNREACH","OPERATING_VOLTAGE"],n._chKeyTransceivers=[parseInt(t)];return n;},T_Button.resolve=function(e,t){return"HmIP-MOD-OC8"==e?this._resolveIPMultiButton(e,t,1,8,["UNREACH","OPERATING_VOLTAGE"]):"HmIP-RCV-50"==e.substr(0,11)?this._resolveIPMultiButton(e,t,1,50,null):null;},T_Button._resolveIPMultiButton=function(e,t,a,r,n){var i,s,o=[];for(i=0;i<r;i++){(s=new T_Button(e,t["interface"],t.address+":"+(i+a)))._chMaintenance=0,n&&(s._chMaintenanceDpts=n),s._chKeyTransceivers=[i+a],o.push(s);}return o;},T_Button;}(),u=function(){var T_Switch=function T_Switch(e,t,a){Device.call(this,e,t,a),this.channel=1,this._switchIdx=0,this._chMaintenance=0,this._chSwitchVirtualReceiver1=2,this._chSwitchVirtualReceiver2=3,this._chSwitchVirtualReceiver3=4,this._chSwitchWeekProfile=5,this.legacyType="ip_switch";};return util.inherits(T_Switch,Device),T_Switch.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":"+this._chMaintenance,dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"}];},T_Switch.prototype._getDptFromRef=function(e){var t={channel:this.getSerial()+":",dataPoint:null};switch(e){case"timeout":t.channel+=this._chMaintenance,t.dataPoint="UNREACH";break;case"state":t.channel+=this.channel,t.dataPoint="STATE";break;default:return null;}return t;},T_Switch.prototype.executeCommand=function(e,t,a){var r,n,i,s=this.getSerial(),o=this;switch(t){case"on":n="STATE",r=s+":"+this._chSwitchVirtualReceiver1,e.writeValue(this.deviceIF,r,n,!0,a);break;case"off":n="STATE",r=s+":"+this._chSwitchVirtualReceiver1,e.writeValue(this.deviceIF,r,n,!1,a);break;case"toggle":n="STATE",r=s+":"+this.channel,e.getState({"interface":this.deviceIF,channel:r,datapoint:n},function(t,i){if(t)a&&a(t);else if(i){var c=!0;i.value&&(c=!1),n="STATE",r=s+":"+o._chSwitchVirtualReceiver1,e.writeValue(o.deviceIF,r,n,c,a);}else a&&a(new Error("get switch current value return invalid"));});break;default:if("onFor"==t.substr(0,5))return i=parseFloat(t.substr(5)),isNaN(i)?void(a&&a(new Error("onFor command invalid"))):(n="ON_TIME",r=s+":"+o._chSwitchVirtualReceiver1,void e.writeValue(this.deviceIF,r,n,{type:"double",value:i},function(t){t?a&&a(t):(n="STATE",r=s+":"+o._chSwitchVirtualReceiver1,e.writeValue(o.deviceIF,r,n,!0,a));}));a&&a(new Error("no such command"));}},T_Switch.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1);if(n!=this.getSerial())return null;switch(parseInt(i)){case this._chMaintenance:if("UNREACH"===t)return{timeout:a};var s={};return s["0_"+t.toLowerCase()]=a,s;case this.channel:return"STATE"===t?{state:1==a?"on":"off"}:null;default:return null;}},T_Switch.parse=function(e){var t=null,a=e.address.indexOf(":");-1!=a&&(t=e.address.substr(a+1));var r=null;if("HmIP-MOD-OC8"===e.type)r=this._parseTSwitch(e,t,41);return r;},T_Switch._parseTSwitch=function(e,t,a){var r=new T_Switch(e.type,e["interface"],e.address);return r._chMaintenance=0,r.channel=parseInt(t),r._chSwitchVirtualReceiver1=r.channel+1,r._chSwitchVirtualReceiver2=r.channel+2,r._chSwitchVirtualReceiver3=r.channel+3,r._chSwitchWeekProfile=a,r;},T_Switch.resolve=function(e,t,a,r){var n=[];if("HmIP-MOD-OC8"==e)for(l=0;l<8;l++){d=new T_Switch(e,t["interface"],t.address+":"+(4*l+9)),d._chMaintenance=0,d.channel=4*l+9,d._chSwitchVirtualReceiver1=d.channel+1,d._chSwitchVirtualReceiver2=d.channel+2,d._chSwitchVirtualReceiver3=d.channel+3,d._chSwitchWeekProfile=41,n.push(d);}else if(!a||!a.length){if(a=[],t.channels)for(var i in t.channels){var s=t.channels[i];if(s&&"SWITCH_TRANSMITTER"==s.type&&s.address){if(-1!=(c=s.address.indexOf(":"))){var o=parseInt(s.address.substr(c+1));isNaN(o)||a.push(o);}}else if(s&&"SWITCH_WEEK_PROFILE"==s.type&&s.addres){var c;if(-1!=(c=s.address.indexOf(":"))){o=parseInt(s.address.substr(c+1));isNaN(o)||(r=o);}}}if(a&&a.length)for(var l=0;l<a.length;l++){d=new T_Switch(e,t["interface"],t.address+":"+a[l]),d._chMaintenance=0,d.channel=a[l],d._switchIdx=l,d._chSwitchVirtualReceiver1=d.channel+1,d._chSwitchVirtualReceiver2=d.channel+2,d._chSwitchVirtualReceiver3=d.channel+3,d._chSwitchWeekProfile=r,n.push(d);}}return n;},T_Switch;}(),h=function(){var T_Dimmer=function T_Dimmer(e,t,a){Device.call(this,e,t,a),this.channel=1,this._chMaintenance=0,this._chDimmerVirtualReceiver1=2,this._chDimmerVirtualReceiver2=3,this._chDimmerVirtualReceiver3=4,this._chDimmerWeekProfile=13,this.legacyType="ip_dimmer";};return util.inherits(T_Dimmer,Device),T_Dimmer.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["HmIP-RF"],r=a.MAINTENANCE.getReadableDpts();return r&&r.forEach(function(a){"UNREACH"==a&&e.push({channel:t.deviceAdr+":"+t._chMaintenance,dpt:a});}),(r=a.DIMMER_TRANSMITTER.getReadableDpts())&&r.forEach(function(a){e.push({channel:t.deviceAdr+":"+t.channel,dpt:a});}),(r=a.DIMMER_VIRTUAL_RECEIVER.getReadableDpts())&&r.forEach(function(a){e.push({channel:t.deviceAdr+":"+t._chDimmerVirtualReceiver1,dpt:a}),e.push({channel:t.deviceAdr+":"+t._chDimmerVirtualReceiver2,dpt:a}),e.push({channel:t.deviceAdr+":"+t._chDimmerVirtualReceiver3,dpt:a});}),e;},T_Dimmer.prototype._getDptFromRef=function(e){var t=this.getSerail(),a={channel:null,dataPoint:null},r=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case"timeout":a.channel=t+":"+this._chMaintenance,a.dataPoint=r.MAINTENANCE.getDptFromState(e);break;case"dimmerLevel":a.channel=t+":"+this.channel,a.dataPoint=r.DIMMER_TRANSMITTER.getDptFromState("dimmerTLevel");break;default:return null;}return a;},T_Dimmer.prototype.executeCommand=function(e,t,a){var r,n,i=x.hub.m.hm._Channel["HmIP-RF"],s=t;-1!=t.indexOf("dimUp")?(n=t.indexOf("dimUp"),s=t.substr(0,n+5),r=t.substr(n+5)):-1!=t.indexOf("dimDown")?(n=t.indexOf("dimDown"),s=t.substr(0,n+7),r=t.substr(n+7)):-1!=t.indexOf("dimTo")?(n=t.indexOf("dimTo"),s=t.substr(0,n+5),r=t.substr(n+5)):-1!=t.indexOf("toggleTo")&&(n=t.indexOf("toggleTo"),s=t.substr(0,n+8),r=t.substr(n+8));var o=this.getSerial(),c=this;switch(s){case"dimOff":i.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,o+":"+this._chDimmerVirtualReceiver1,"dimOff",a);break;case"dimUp":r=r?parseInt(r)/100:.1,e.getState({"interface":this.deviceIF,channel:o+":"+this.channel,datapoint:"LEVEL"},function(t,n){t?a&&a(t):void 0!==n&&null!=n?((r=n.value+r)>1&&(r=1),r=Math.round(100*r),i.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,o+":"+c._chDimmerVirtualReceiver1,"dimTo"+r,a)):a&&a(new Error("get dimmer current value return invalid"));});break;case"dimDown":r=r?parseInt(r)/100:.1,e.getState({"interface":this.deviceIF,channel:o+":"+this.channel,datapoint:"LEVEL"},function(t,n){t?a&&a(t):void 0!==n&&null!=n?((r=n.value-r)<0&&(r=0),r=Math.round(100*r),i.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,o+":"+c._chDimmerVirtualReceiver1,"dimTo"+r,a)):a&&a(new Error("get dimmer current value return invalid"));});break;case"dimTo":if(!r)return void(a&&a(new Error("dimTo has no value")));i.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,o+":"+c._chDimmerVirtualReceiver1,"dimTo"+r,channel);break;case"toggleTo":if(!r)return void(a&&a(new Error("toggle has no value")));e.getState({"interface":this.deviceIF,channel:o+":"+this.channel,datapoint:"LEVEL"},function(t,n){t?a&&a(t):void 0!==n&&null!=n?(n.value&&(r=0),i.DIMMER_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,o+":"+c._chDimmerVirtualReceiver1,"dimTo"+r,a)):a&&a(new Error("get dimmer current value return invalid"));});break;default:a&&a(new Error("no such command"));}},T_Dimmer.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1);if(n!=this.getSerial())return null;var s,o=x.hub.m.hm._Channel["HmIP-RF"],c=null;switch(parseInt(i)){case this._chMaintenance:return"UNREACH"===t?o.MAINTENANCE.parseDptState(t,a):((c={})["0_"+t.toLowerCase()]=a,c);case this.channel:return(s=o.DIMMER_TRANSMITTER.parseDptState(t,a))&&((c={}).dimmerLevel=s.dimmerTLevel),c;}return null;},T_Dimmer;}(),p=function(){var T_Blind=function T_Blind(e,t,a){Device.call(this,e,t,a),this.channel=1,this._chMaintenance=0,this._chBlindVirtualReceiver1=2,this._chBlindVirtualReceiver2=3,this._chBlindVirtualReceiver3=4,this._chBlindWeekProfile=5,this.legacyType="ip_jalousie";};return util.inherits(T_Blind,Device),T_Blind.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["HmIP-RF"],r=a.MAINTENANCE.getReadableDpts();return r&&r.forEach(function(a){"UNREACH"==a&&e.push({channel:t.deviceAdr+":"+t._chMaintenance,dpt:a});}),(r=a.BLIND_TRANSMITTER.getReadableDpts())&&r.forEach(function(a){e.push({channel:t.deviceAdr+":"+t.channel,dpt:a});}),(r=a.BLIND_VIRTUAL_RECEIVER.getReadableDpts())&&r.forEach(function(a){e.push({channel:t.deviceAdr+":"+t._chBlindVirtualReceiver1,dpt:a}),e.push({channel:t.deviceAdr+":"+t._chBlindVirtualReceiver2,dpt:a}),e.push({channel:t.deviceAdr+":"+t._chBlindVirtualReceiver3,dpt:a});}),e;},T_Blind.prototype._getDptFromRef=function(e){var t=this.getSerial(),a={channel:null,dataPoint:null},r=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case"timeout":a.channel=t+":"+this._chMaintenance,a.dataPoint=r.MAINTENANCE.getDptFromState(e);break;case"blindLevel":a.channel=t+":"+this.channel,a.dataPoint=r.BLIND_TRANSMITTER.getDptFromState("blindTPos");break;case"lamellaLevel":a.channel=t+":"+this.channel,a.dataPoint=r.BLIND_TRANSMITTER.getDptFromState("lamellaTPos");break;default:return null;}return a;},T_Blind.prototype.executeCommand=function(e,t,a){var r,n,i=x.hub.m.hm._Channel["HmIP-RF"],s=t;-1!=t.indexOf("stepUp")?(n=t.indexOf("stepUp"),s=t.substr(0,n+6),r=t.substr(n+6)):-1!=t.indexOf("stepDown")?(n=t.indexOf("stepDown"),s=t.substr(0,n+8),r=t.substr(n+8)):-1!=t.indexOf("moveTo")?(n=t.indexOf("moveTo"),s=t.substr(0,n+6),r=t.substr(n+6)):-1!=t.indexOf("stop")?(n=t.indexOf("stop"),s=t.substr(0,n+4),r=t.substr(n+4)):-1!=t.indexOf("lamellaStepUp")?(n=t.indexOf("lamellaStepUp"),s=t.substr(0,n+13),r=t.substr(n+13)):-1!=t.indexOf("lamellaStepDown")?(n=t.indexOf("lamellaStepDown"),s=t.substr(0,n+15),r=t.substr(n+15)):-1!=t.indexOf("lamellaTo")&&(n=t.indexOf("lamellaTo"),s=t.substr(0,n+9),r=t.substr(n+9));var o=this.getSerial(),c=this;switch(s){case"stop":case"moveUp":case"moveDown":i.BLIND_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,o+":"+this._chBlindVirtualReceiver1,s,a);break;case"lamellaUp":case"lamellaDown":e.getState({"interface":this.deviceIF,channel:o+":"+this.channel,datapoint:"LEVEL"},function(t,r){t?a&&a(t):void 0!==r&&null!=r?i.BLIND_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,o+":"+this._chBlindVirtualReceiver1,"lamellaTo"+(s=100),function(t){t?a&&a(t):i.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,o+":"+c._chBlindVirtualReceiver1,"moveTo"+Math.round(100*r.value),a);}):a&&a(new Error("get blind current value return invalid"));});break;case"stepUp":case"stepDown":r=r?parseInt(r)/100:.05,e.getState({"interface":this.deviceIF,channel:o+":"+this.channel,datapoint:"LEVEL"},function(t,n){t?a&&a(t):void 0!==n&&null!=n?((r="stepUp"==s?n.value+r:n.value-r)>1&&(r=1),r<0&&(r=0),r=Math.round(100*r),i.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,o+":"+c._chBlindVirtualReceiver1,"moveTo"+r,a)):a&&a(new Error("get blind current value return invalid"));});break;case"moveTo":if(!r)return void(a&&a(new Error("moveTo has no value")));i.BLIND_VIRTUAL_RECEIVER.executeCommand(e,this.deviceIF,o+":"+this._chBlindVirtualReceiver1,"moveTo"+r,a);break;case"lamellaStepUp":case"lamellaStepDown":r=r?parseInt(r)/100:.05,e.getState({"interface":this.deviceIF,channel:o+":"+this.channel,datapoint:"LEVEL"},function(t,n){if(t)a&&a(t);else if(void 0!==n&&null!=n){var l=n.value;l=Math.round(100*l),e.getState({"interface":c.deviceIF,channel:o+":"+c.channel,datapoint:"LEVEL_2"},function(t,n){t?a&&a(t):void 0!==n&&null!=n?((r="lamellaStepUp"==s?n.value+r:n.value-r)>1&&(r=1),r<0&&(r=0),r=Math.round(100*r),i.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,o+":"+c._chBlindVirtualReceiver1,"lamellaTo"+r,function(t,r){t?a&&a(t,r):i.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,o+":"+c._chBlindVirtualReceiver1,"moveTo"+l,a);})):a&&a(new Error("get lamella current value return invalid"));});}else a&&a(new Error("get blind current value return invalid"));});break;case"lamellaTo":if(!r)return void(a&&a(new Error("lamellaTo has no value")));e.getState({"interface":this.deviceIF,channel:o+":"+this.channel,datapoint:"LEVEL"},function(t,n){if(t)a&&a(t);else if(void 0!==n&&null!=n){var s=n.value;s=Math.round(100*s),i.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,o+":"+c._chBlindVirtualReceiver1,"lamellaTo"+r,function(t){t?a&&a(t):i.BLIND_VIRTUAL_RECEIVER.executeCommand(e,c.deviceIF,o+":"+c._chBlindVirtualReceiver1,"moveTo"+s,a);});}else a&&a(new Error("get blind current value return invalid"));});break;default:a&&a(new Error("no such command"));}},T_Blind.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1);if(n!=this.getSerial())return null;var s,o=x.hub.m.hm._Channel["HmIP-RF"],c=null;switch(parseInt(i)){case this._chMaintenance:return"UNREACH"===t?o.MAINTENANCE.parseDptState(t,a):((c={})["0_"+t.toLowerCase()]=a,c);case this.channel:return(s=o.BLIND_TRANSMITTER.parseDptState(t,a))&&(c={},"LEVEL"==t?c.blindLevel=s.blindTPos:"LEVEL_2"==t&&(c.lamellaLevel=s.lamellaTPos)),c;}return null;},T_Blind.prototype.getConfig=function(e,t){var a=this.getSerial()+":"+this.channel;e.getParamset(this.deviceIF,a,"MASTER",function(e,r){if(e)t&&t(e);else{var n={},i=null;r&&(i={CHANGE_OVER_DELAY:r.CHANGE_OVER_DELAY,REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT:r.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT,REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE:r.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE,REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT:r.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT,REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE:r.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE,REFERENCE_RUNNING_TIME_SLATS_UNIT:r.REFERENCE_RUNNING_TIME_SLATS_UNIT,REFERENCE_RUNNING_TIME_SLATS_VALUE:r.REFERENCE_RUNNING_TIME_SLATS_VALUE,REFERENCE_RUN_COUNTER:r.REFERENCE_RUN_COUNTER}),n[a]=i,t&&t(e,n);}});},T_Blind.prototype.setConfig=function(e,t,a){if(t){var r=this.getSerial()+":"+this.channel,n=t[r];if(n){var i={};i.CHANGE_OVER_DELAY={__rpcValueType:"double",__rpcValue:n.CHANGE_OVER_DELAY},i.REFERENCE_RUN_COUNTER=n.REFERENCE_RUN_COUNTER,i.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT={__rpcValueType:"double",__rpcValue:n.REFERENCE_RUNNING_TIME_BOTTOM_TOP_UNIT},i.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE={__rpcValueType:"double",__rpcValue:n.REFERENCE_RUNNING_TIME_BOTTOM_TOP_VALUE},i.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT={__rpcValueType:"double",__rpcValue:n.REFERENCE_RUNNING_TIME_TOP_BOTTOM_UNIT},i.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE={__rpcValueType:"double",__rpcValue:n.REFERENCE_RUNNING_TIME_TOP_BOTTOM_VALUE},i.REFERENCE_RUNNING_TIME_SLATS_UNIT={__rpcValueType:"double",__rpcValue:n.REFERENCE_RUNNING_TIME_SLATS_UNIT},i.REFERENCE_RUNNING_TIME_SLATS_VALUE={__rpcValueType:"double",__rpcValue:n.REFERENCE_RUNNING_TIME_SLATS_VALUE},e.setParamset(this.deviceIF,r,"MASTER",i,function(e){a&&a(e);});}else a&&a(new Error("config data not complete"));}else a&&a(new Error("config data invalid"));},T_Blind;}(),v=function(){var T_INPUT=function T_INPUT(e,t,a){Device.call(this,e,t,a),this.channel=1,this._chMaintenance=0,this.legacyType="ip_multi_input";};util.inherits(T_INPUT,Device),T_INPUT.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":"+this._chMaintenance,dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"STATE"}];},T_INPUT.prototype._getDptFromRef=function(e){var t={channel:this.getSerial()+":",dataPoint:null};switch(e){case"timeout":t.channel+=this._chMaintenance,t.dataPoint="UNREACH";break;case"state":t.channel+=this.channel,t.dataPoint="STATE";break;default:return null;}return t;},T_INPUT.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1);if(n!=this.getSerial())return null;var s=x.hub.m.hm._Channel["HmIP-RF"];switch(parseInt(i)){case this._chMaintenance:if("UNREACH"===t)return{timeout:a};var o={};return o["0_"+t.toLowerCase()]=a,o;case this.channel:switch(t){case"STATE":return{state:1==a?"on":"off"};case"PRESS_SHORT":case"PRESS_LONG":return s.KEY_TRANRECEIVER.parseDptState(t,a);default:return null;}default:return null;}},T_INPUT.prototype.isButton=function(){return!0;},T_INPUT.prototype.claimEvent=function(e,t){this._claimButtonEvent(this.channel,e,function(){t&&t();});},T_INPUT.prototype._claimButtonEvent=function(e,t,a){var r=this.getSerial()+":"+e,n=this;t.reportValueUsage(this.deviceIF,r,"PRESS_SHORT",function(i,s){i&&console.error("button:"+e+" claim PRESS_SHORT event error:"+i.stack),t.reportValueUsage(n.deviceIF,r,"PRESS_LONG",function(t,r){t&&console.error("button:"+e+" claim PRESS_LONG event error:"+t.stack),a&&a();});});};var T_INPUT_BAT=function T_INPUT_BAT(e,t,a){T_INPUT.call(this,e,t,a),this.legacyType="ip_multi_input_bat";};return util.inherits(T_INPUT_BAT,T_INPUT),T_INPUT_BAT.prototype._getReadableDpts=function(){for(var e=x.hub.m.hm._Channel["HmIP-RF"].MAINTENANCE_BAT_EL.getReadableDpts,t=x.hub.m.hm._Channel["HmIP-RF"].MULTI_MODE_INPUT_TRANSMITTER.getReadableDpts,a=[],r=0;r<e.length;r++){a.push({channel:this.deviceAdr+":"+this._chMaintenance,dpt:e[r]});}for(r=0;r<t.length;r++){a.push({channel:this.deviceAdr+":"+this.channel,dpt:t[r]});}return a;},T_INPUT_BAT.prototype._getDptFromRef=function(e){var t={channel:this.getSerial()+":",dataPoint:null},a=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case"timeout":case"lowbat":case"voltage":case"errorCode":t.channel+=this._chMaintenance,t.dataPoint=a.MAINTENANCE_BAT_EL.getDptFromState(e);break;case"state":t.channel+=this.channel,t.dataPoint=a.MULTI_MODE_INPUT_TRANSMITTER.getDptFromState(e);break;default:return null;}return t;},T_INPUT_BAT.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1);if(n!=this.getSerial())return null;var s=x.hub.m.hm._Channel["HmIP-RF"];switch(parseInt(i)){case this._chMaintenance:switch(t){case"UNREACH":case"LOW_BAT":case"OPERATING_VOLTAGE":case"ERROR_CODE":return s.MAINTENANCE_BAT_EL.parseDptState(t,a);default:var o={};return o["0_"+t.toLowerCase()]=a,o;}case this.channel:switch(t){case"STATE":case"PRESS_SHORT":case"PRESS_LONG":return s.MULTI_MODE_INPUT_TRANSMITTER.parseDptState(t,a);default:return null;}default:return null;}},T_INPUT.resolve=function(e,t,a){var r,n;if("HmIP-FCI"==e.substr(0,8))r=parseInt(e.substr(8)),n=T_INPUT_BAT;else if("HmIP-MOD-RC"==e.substr(0,11))r=parseInt(e.substr(11)),n=T_INPUT_BAT;else{if("HmIPW-DRI"!=e.substr(0,9)){if((!a||!a.length)&&(a=[],t.channels))for(var i in t.channels){var s=t.channels[i];if(s&&"MULTI_MODE_INPUT_TRANSMITTER"==s.type&&s.address){var o=s.address.indexOf(":");if(-1!=o){var c=parseInt(s.address.substr(o+1));isNaN(c)||a.push(c);}}}if(!a||!a.length)return[];var l,u,h=[];for(l=0;l<a.length;l++){(u=new T_INPUT(e,t["interface"],t.address+":"+a[l]))._chMaintenance=0,u.channel=a[l],h.push(u);}return h;}r=parseInt(e.substr(9)),n=T_INPUT;}return this._resolveIPMultiInput(e,t,r,n);},T_INPUT._resolveIPMultiInput=function(e,t,a,r){var n,i,s=[];for(n=0;n<a;n++){(i=new r(e,t["interface"],t.address+":"+(n+1)))._chMaintenance=0,i.channel=n+1,s.push(i);}return s;},T_INPUT.parse=function(e){var t=null,a=e.address,r=e.address.indexOf(":");-1!=r&&(t=e.address.substr(r+1),a=e.address.substr(0,r));var n=v;"HmIP-FCI1"!=e.type&&"HmIP-FCI6"!=e.type&&"HmIP-MOD-RC8"!=e.type||(n=T_INPUT_BAT);var i=new n(e.type,e["interface"],a);return i._chMaintenance=0,i.channel=parseInt(t),i;},T_INPUT;}(),E=function(){var T_Motion=function T_Motion(e,t,a){Device.call(this,e,t,a),this.channel=3,this._chKeyTransceivers=[],this._chMaintenance=0,this._chMaintenanceDpts=["UNREACH"],this._chMotionDetectorTransceiver=3,this.legacyType="ip_motion2";};return util.inherits(T_Motion,Device),T_Motion.prototype._getReadableDpts=function(){var e=[],t=this,a=x.hub.m.hm._Channel["HmIP-RF"],r=a.MAINTENANCE_BAT_EL.getReadableDpts();return r&&r.forEach(function(a){-1!=t._chMaintenanceDpts.indexOf(a)&&e.push({channel:serialNum+":"+t._chMaintenance,dpt:a});}),(r=a.MOTIONDETECTOR_TRANSCEIVER.getReadableDpts())&&r.forEach(function(a){e.push({channel:t.deviceAdr+":"+t._chMotionDetectorTransceiver,dpt:a});}),e;},T_Motion.prototype._getDptFromRef=function(e){var t=this.deviceAdr,a={channel:t+":"+this.channel,dataPoint:null},r=x.hub.m.hm._Channel["HmIP-RF"];switch(e){case"timeout":case"lowbat":a.channel=t+":0",a.dataPoint=r.MAINTENANCE_BAT_EL.getDptFromState(e);break;case"state":case"illumination":case"active":a.channel=t+":"+this._chMotionDetectorTransceiver,a.dataPoint=r.MOTIONDETECTOR_TRANSCEIVER.getDptFromState(e);break;default:return null;}return a;},T_Motion.prototype.executeCommand=function(e,t,a){var r=x.hub.m.hm._Channel["HmIP-RF"];switch(t){case"reset":case"activate":case"deactivate":case"toggleActivate":r.MOTIONDETECTOR_TRANSCEIVER.executeCommand(e,this.deviceIF,this.deviceAdr+":"+this._chMotionDetectorTransceiver,t,a);break;default:a&&a(new Error("no such command"));}},T_Motion.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1),s=this.deviceAdr;if(-1!=(r=this.deviceAdr.indexOf(":"))&&(s=this.deviceAdr.substr(0,r)),n!=s)return null;var o,c=x.hub.m.hm._Channel["HmIP-RF"],l=null;return 0==i?"UNREACH"==t||"LOW_BAT"==t?c.MAINTENANCE_BAT_EL.parseDptState(t,a):((l={})["0_"+t.toLowerCase()]=a,l):(1==i&&(o=c.KEY_TRANRECEIVER.parseDptState(t,a))&&(o.pressShort&&(l={btn1pressShort:!0}),o.pressLong&&(l={btn1pressLong:!0})),2==i&&(o=c.KEY_TRANRECEIVER.parseDptState(t,a))&&(o.pressShort&&(l={btn2pressShort:!0}),o.pressLong&&(l={btn2pressLong:!0})),3==i?c.MOTIONDETECTOR_TRANSCEIVER.parseDptState(t,a):l);},T_Motion.prototype.isButton=function(){return this._chKeyTransceivers.length>0;},T_Motion.prototype.claimEvent=function(e,t){if(this._chKeyTransceivers&&this._chKeyTransceivers.length){var _claimButtonChannel=function _claimButtonChannel(t,a,r,n){e.reportValueUsage(t,a+":"+r,"PRESS_SHORT",function(i,s){i&&console.error("button:1 claim PRESS_SHORT event error:"+i.stack),e.reportValueUsage(t,a+":"+r,"PRESS_LONG",function(e,t){e&&console.error("button:1 claim PRESS_LONG event error:"+e.stack),n();});});},a=this,r=0,cb=function cb(){++r<a._chKeyTransceivers.length?_claimButtonChannel(a.deviceIF,a.deviceAdr,a._chKeyTransceivers[r],cb):t&&t();},n=this.deviceAdr;-1==n.indexOf(":")&&this.channel&&(n+=":"+this.channel),_claimButtonChannel(this.deviceIF,this.deviceAdr,this._chKeyTransceivers[r],cb);}else t&&t();},T_Motion.resolve=function(e,t){var a=new T_Motion(e,t["interface"],t.address);return"HmIPW-SMI55"==e&&(a._chKeyTransceivers=[1,2],a._chMotionDetectorTransceiver=3),a;},T_Motion;}(),m=function(){var T_Analog_Input=function T_Analog_Input(e,t,a){Device.call(this,e,t,a),this.channel=1,this._chMaintenance=0,this.legacyType="ip_analog_input";};return util.inherits(T_Analog_Input,Device),T_Analog_Input.prototype._getReadableDpts=function(){return[{channel:this.deviceAdr+":"+this._chMaintenance,dpt:"UNREACH"},{channel:this.deviceAdr+":"+this.channel,dpt:"VOLTAGE"}];},T_Analog_Input.prototype._getDptFromRef=function(e){var t={channel:this.getSerial()+":",dataPoint:null};switch(e){case"timeout":t.channel+=this._chMaintenance,t.dataPoint="UNREACH";break;case"state":t.channel+=this.channel,t.dataPoint="VOLTAGE";break;default:return null;}return t;},T_Analog_Input.prototype.parseDptState=function(e,t,a){var r=e.indexOf(":");if(-1==r)return null;var n=e.substr(0,r),i=e.substr(r+1);if(n!=this.getSerial())return null;x.hub.m.hm._Channel["HmIP-RF"];switch(parseInt(i)){case this._chMaintenance:if("UNREACH"===t)return{timeout:a};var s={};return s["0_"+t.toLowerCase()]=a,s;case this.channel:return"VOLTAGE"===t?{voltage:parseFloat(a)}:null;default:return null;}},T_Analog_Input.parse=function(e){var t=null,a=e.address,r=e.address.indexOf(":");-1!=r&&(t=e.address.substr(r+1),a=e.address.substr(0,r));var n=new T_Analog_Input(e.type,e["interface"],a);return n._chMaintenance=0,n.channel=parseInt(t),n;},T_Analog_Input;}(),_={};return _.CLASS_MAP={maintenance:Maintenance,button:Button,vbutton:VirtaulButton,"switch":Switch,dimmer:Dimmer,blind:Blind,powerswitch:PowerSwitch,weather:Weather,heater:Heater,heater2:Heater2,heater3:Heater3,wallthermo:WallThermo,wallthermo2:WallThermo2,contact:Contact,weatherstation:WeatherStation,rain:Rain,gong2:Gong,gong:Gong2,window:Window,temp:Temperature,co2:CO2,motion:Motion,smoke:Smoke,siren:Siren,capacity:Capacity,switch_interface:SwitchInterface,tilt:Tilt,temp2:Temperature2,water:Water,weather2:Weather2,energymeter:EnergyMeter,rgb:RGB,lux:LUX,siren2:Siren2,jalousie:Jalousie,mod_em_8bit:MOD_EM_8bit,mod_em_8:MOD_EM_8,keymatic:KeyMatic,ou_led16:OU_LED16,hm_dis_ep_wm55:HM_Dis_EP_WM55,dualwhite:HM_LC_DW_WM},_.CLASS_MAP_IP={ip_switch:IPSwitch,ip_contact:IPContact,ip_heater:IPHeater,ip_powerswitch:IPPowerSwitch,ip_energyactor:IPEnergyActor,ip_dimmer:IPDimmer,ip_motion:IPMotion,ip_motion2:IPMotion2,ip_button2:IPButton2,ip_siren:IPSiren,ip_wallthermo:IPWallthermo,ip_smoke:IPSmoke,ip_window:IPWindow,ip_button4:IPButton4,ip_dimmer2:IPDimmer2,ip_energyactor2:IPEnergyActor2,ip_blind:IPBlind,ip_jalousie:IPJalousie,ip_presence:IPPresence,ip_dimmer3:IPDimmer3,ip_wallthermo2:IPWallthermo2,ip_floor_heater:IPFloorHeater,ip_floor_pump_heater:IPFloorPumpHeater,ip_button6:IPButton6,ip_weather:IPWeather,ip_weather2:IPWeather2,ip_weather3:IPWeather3,ip_weather4:IPWeather4,ip_direction:IPDirection,ip_button8:IPButton8,ip_generic_input:IPGenericInput,ip_analog_output:IPAnalogOutput,ip_water:IPWater,ip_acce:IPAcce,ip_garagedoor:IPWGC,ip_bsl:n,ip_tormatic:i,ip_button:IPButton,ip_lux:s,ip_pmfs:o,ip_rotary:c},_.parseJson=function(e){if(!(e&&e.type&&e["interface"]&&e.address))return null;var t;switch(e["interface"]){case"BidCos-RF":t=this._parseRFDeviceJson(e);break;case"HmIP-RF":t=this._parseIPDeviceJson(e);break;default:return null;}return t;},_._parseRFDeviceJson=function(e){var t=x.hub.m.hm.RFDeviceTypes[e.type];if(void 0===t||null==t)return null;var a=x.hub.m.hm.RFDeviceCatagory[t];if(!a||!a.type)return null;var r=this.CLASS_MAP[a.type];if(!r)return null;var n=null,i=e.address.indexOf(":");-1!=i&&(n=e.address.substr(i+1)),"HM-Dis-EP-WM55"==e.type&&3==n&&(r=this.CLASS_MAP.hm_dis_ep_wm55);var s=new r(e.type,e["interface"],e.address);return n&&(s.channel=parseInt(n)),s;},_._parseIPDeviceJson=function(e){if(e.type.startsWith("ELV-SH-")&&(e.type=e.type.replace("ELV-SH-","HmIP-")),"HmIPW"==e.type.substr(0,5))return this._parseIPW(e);if("HmIP-MIOB"==e.type)return _._parse_HMIP_MIOB(e);if("HmIP-FCI1"==e.type||"HmIP-FCI6"==e.type||"HmIP-MOD-RC8"==e.type)return v.parse(e);var t=null;switch(-1!=(i=e.address.indexOf(":"))&&(t=e.address.substr(i+1)),e.type){case"HmIP-WHS2":return this._parseTSwitch(e,t,9);case"HmIP-MOD-OC8":return parseInt(t)<=8?l.parse(e):u.parse(e);case"HmIP-MIO16-PCB":return parseInt(t)<13?m.parse(e):parseInt(t)<17?v.parse(e):u.parse(e);}var a=_._getIPMetaIndex(e.type);if(void 0===a||null==a)return null;var r=x.hub.m.hm.IPDeviceCatagory[a];if(!r||!r.type)return null;var n=this.CLASS_MAP_IP[r.type];if(!n)return null;var i;t=null;-1!=(i=e.address.indexOf(":"))&&(t=e.address.substr(i+1));var s=new n(e.type,e["interface"],e.address);return t&&(s.channel=parseInt(t)),s;},_._parseIPW=function(e){var t,a,r=null,n=e.address.indexOf(":");return-1!=n&&(r=e.address.substr(n+1)),"HmIPW-DRS"==e.type.substr(0,9)?(t=parseInt(e.type.substr(9)),(a=new u(e.type,e["interface"],e.address))._chMaintenance=0,a.channel=parseInt(r),a._chSwitchVirtualReceiver1=a.channel+1,a._chSwitchVirtualReceiver2=a.channel+2,a._chSwitchVirtualReceiver3=a.channel+3,a._chSwitchWeekProfile=4*t+1,a):"HmIPW-DRD"==e.type.substr(0,9)?(t=parseInt(e.type.substr(9)),(a=new h(e.type,e["interface"],e.address))._chMaintenance=0,a.channel=parseInt(r),a._chDimmerVirtualReceiver1=a.channel+1,a._chDimmerVirtualReceiver2=a.channel+2,a._chDimmerVirtualReceiver3=a.channel+3,a._chDimmerWeekProfile=4*t+1,a):"HmIPW-DRBL"==e.type.substr(0,10)?(t=parseInt(e.type.substr(10)),(a=new p(e.type,e["interface"],e.address))._chMaintenance=0,a.channel=parseInt(r),a._chBlindVirtualReceiver1=a.channel+1,a._chBlindVirtualReceiver2=a.channel+2,a._chBlindVirtualReceiver3=a.channel+3,a._chBlindWeekProfile=4*t+1,a):"HmIPW-DRI"==e.type.substr(0,9)?(t=parseInt(e.type.substr(9)),(a=new v(e.type,e["interface"],e.address))._chMaintenance=0,a.channel=parseInt(r),a):"HmIPW-FIO"==e.type.substr(0,9)?(t=parseInt(e.type.substr(9)),(r=parseInt(r))<=t?((a=new v(e.type,e["interface"],e.address))._chMaintenance=0,a.channel=parseInt(r)):((a=new u(e.type,e["interface"],e.address))._chMaintenance=0,a.channel=parseInt(r),a._chSwitchVirtualReceiver1=a.channel+1,a._chSwitchVirtualReceiver2=a.channel+2,a._chSwitchVirtualReceiver3=a.channel+3,a._chSwitchWeekProfile=t+4*t+1),a):null;},_._parse_HMIP_MIOB=function(e){var t=e.address,a=null,r=e.address.indexOf(":");-1!=r&&(t=e.address.substr(0,r),a=e.address.substr(r+1));var n=null;if(0==a?n=this.CLASS_MAP.maintenance:3==a||7==a?n=this.CLASS_MAP_IP.ip_switch:9==a||10==a?n=this.CLASS_MAP_IP.ip_generic_input:11==a&&(n=this.CLASS_MAP_IP.ip_analog_output),n){var i=new n(e.type,e["interface"],t);return i.channel=a,i;}return null;},_._parseTSwitch=function(e,t,a){var r=new u(e.type,e["interface"],e.address);return r._chMaintenance=0,r.channel=parseInt(t),r._chSwitchVirtualReceiver1=r.channel+1,r._chSwitchVirtualReceiver2=r.channel+2,r._chSwitchVirtualReceiver3=r.channel+3,r._chSwitchWeekProfile=a,r;},_.resolve=function(e){if(!e||!e.type||!e["interface"])return null;var t;switch(e["interface"]){case"BidCos-RF":t=this._resolveRFFromType(e.type,e);break;case"HmIP-RF":t=this._resolveIPFromType(e.type,e);break;default:return null;}return t?Array.isArray(t)?t:[t]:null;},_._resolveRFFromType=function(e,t){if("HM-MOD-EM-8"==e)return this._resolve_HM_MOD_EM_8(e,t);if("HM-OU-LED16"==e)return this._resolve_HM_OU_LED16(e,t);if("HM-Dis-EP-WM55"==e)return this._resolve_HM_Dis_EP_WM55(e,t);var a=x.hub.m.hm.RFDeviceTypes[e];if(void 0===a||null==a)return null;var r=x.hub.m.hm.RFDeviceCatagory[a];if(!r||!r.type)return this._resolveRFFromTypeGeneral(e,t);var n=[];if(t.channels)for(var i in t.channels){var s=t.channels[i];s.type==r.channel&&n.push(s);}var o=this.CLASS_MAP[r.type];if(!o)return null;if("*"==r.channelNum){var c=[];return n.forEach(function(a){var r=new o(e,t["interface"],t.address),i=a.address.indexOf(":");n.length>1&&(r.deviceAdr=a.address),r.channel=a.address.substr(i+1),c.push(r);}),c;}var l=new o(e,t["interface"],t.address);return void 0!==r.channelNum&&null!=r.channelNum&&(l.channel=r.channelNum),l;},_._resolveIPFromType=function(e,t){if(e.startsWith("ELV-SH-")&&(e=e.replace("ELV-SH-","HmIP-")),"HmIPW"==e.substr(0,5))return this._resolveIPW(e,t);if("HmIP-MOD-OC8"==e){var a=l.resolve(e,t),r=u.resolve(e,t);return a.concat(r);}if(0==e.indexOf("HmIP-FAL"))return _._resolve_HMIP_FAL_X(e,t);if(0==e.indexOf("HmIP-MIOB"))return _._resolve_HMIP_MIOB(e,t);if("HmIP-DRSI"==e.substr(0,9)){for(var n=parseInt(e.substr(9)),i=[],s=1;s<=n;s++){i.push(s);}return v.resolve(e,t,i);}if("HmIP-DRDI"==e.substr(0,9)){for(n=parseInt(e.substr(9)),i=[],s=1;s<=n;s++){i.push(s);}return v.resolve(e,t,i);}if("HmIP-DRBLI"==e.substr(0,10)){for(n=parseInt(e.substr(10)),i=[],s=1;s<=2*n;s++){i.push(s);}return v.resolve(e,t,i);}switch(e){case"HmIP-PCBS2":return l._resolveIPMultiButton(e,t,1,2,["UNREACH","OPERATING_VOLTAGE"]);case"HmIP-WHS2":return this._resolveIPMultiSwitch(e,t,2);case"HmIP-FCI1":case"HmIP-FCI6":case"HmIP-MOD-RC8":return v.resolve(e,t);case"HmIP-MIO16-PCB":return _._resolve_HMIP_MIO16_PCB(e,t);}var o=this._getIPMetaIndex(e);if(void 0===o||null==o)return null;var c=x.hub.m.hm.IPDeviceCatagory[o];if(!c||!c.type)return null;var h=[];if(t.channels)for(var d in t.channels){var p=t.channels[d];p.type==c.channel&&h.push(p);}var E=this.CLASS_MAP_IP[c.type];if(!E)return null;if("*"==c.channelNum){var m=[];return h.forEach(function(a){var r=new E(e,t["interface"],t.address),n=a.address.indexOf(":");h.length>1&&(r.deviceAdr=a.address),r.channel=a.address.substr(n+1),m.push(r);}),m;}var f=new E(e,t["interface"],t.address);return void 0!==c.channelNum&&null!=c.channelNum&&(f.channel=c.channelNum),f;},_._resolveIPW=function(e,t){var a,r,n=[];if("HmIPW-DRS"==e.substr(0,9))a=parseInt(e.substr(9)),n=this._resolveIPMultiSwitch(e,t,a);else if("HmIPW-DRD"==e.substr(0,9))for(a=parseInt(e.substr(9)),r=0;r<a;r++){(s=new h(e,t["interface"],t.address+":"+(4*r+1)))._chMaintenance=0,s.channel=4*r+1,s._chDimmerVirtualReceiver1=s.channel+1,s._chDimmerVirtualReceiver2=s.channel+2,s._chDimmerVirtualReceiver3=s.channel+3,s._chDimmerWeekProfile=4*a+1,n.push(s);}else if("HmIPW-DRBL"==e.substr(0,10))for(a=parseInt(e.substr(10)),r=0;r<a;r++){(s=new p(e,t["interface"],t.address+":"+(4*r+1)))._chMaintenance=0,s.channel=4*r+1,s._chBlindVirtualReceiver1=s.channel+1,s._chBlindVirtualReceiver2=s.channel+2,s._chBlindVirtualReceiver3=s.channel+3,s._chBlindWeekProfile=4*a+1,n.push(s);}else if("HmIPW-DRI"==e.substr(0,9))for(a=parseInt(e.substr(9)),r=0;r<a;r++){(s=new v(e,t["interface"],t.address+":"+(r+1)))._chMaintenance=0,s.channel=r+1,n.push(s);}else if("HmIPW-FIO"==e.substr(0,9))for(a=parseInt(e.substr(9)),r=0;r<a;r++){var i=new v(e,t["interface"],t.address+":"+(r+1));i._chMaintenance=0,i.channel=r+1,n.push(i),(s=new u(e,t["interface"],t.address+":"+(4*r+a+1)))._chMaintenance=0,s.channel=4*r+a+1,s._chSwitchVirtualReceiver1=s.channel+1,s._chSwitchVirtualReceiver2=s.channel+2,s._chSwitchVirtualReceiver3=s.channel+3,s._chSwitchWeekProfile=a+4*a+1,n.push(s);}else if("HmIPW-SMI55"==e){var s=E.resolve(e,t);n.push(s);}return n;},_._resolveIPMultiSwitch=function(e,t,a){var r,n,i=[];for(r=0;r<a;r++){(n=new u(e,t["interface"],t.address+":"+(4*r+1)))._chMaintenance=0,n.channel=4*r+1,n._chSwitchVirtualReceiver1=n.channel+1,n._chSwitchVirtualReceiver2=n.channel+2,n._chSwitchVirtualReceiver3=n.channel+3,n._chSwitchWeekProfile=4*a+1,i.push(n);}return i;},_._resolveRFFromTypeGeneral=function(e,t){var a=[];if(!t||!t.channels)return null;var r=t.channels;for(var n in r){var i=r[n];if(i&&i.type&&x.hub.m.hm._Channel["BidCos-RF"][i.type]){var s=x.hub.m.hm._Channel["BidCos-RF"][i.type].device;if(s){var o=this.CLASS_MAP[s];if(o){var c=new o(e,t["interface"],n),l=n.indexOf(":");c.channel=n.substr(l+1),a.push(c);}}}}return a;},_._resolve_HM_MOD_EM_8=function(e,t){var a=[];if(!t||!t.channels)return null;var r=t.channels;for(var n in r){r[n];var i=n.indexOf(":"),s=n.substr(i+1),o=new(0==s?this.CLASS_MAP.maintenance:this.CLASS_MAP.mod_em_8)(e,t["interface"],n);o.channel=s,a.push(o);}return a;},_._resolve_HM_OU_LED16=function(e,t){var a=[];if(!t||!t.channels)return null;var r=t.channels;for(var n in r){r[n];var i=n.indexOf(":"),s=n.substr(i+1),o=new(0==s?this.CLASS_MAP.maintenance:this.CLASS_MAP.ou_led16)(e,t["interface"],n);o.channel=s,a.push(o);}return a;},_._resolve_HM_Dis_EP_WM55=function(e,t){var a=[];if(!t||!t.channels)return null;var r=t.channels;for(var n in r){r[n];var i=n.indexOf(":"),s=n.substr(i+1),o=null;if(0==s?o=this.CLASS_MAP.maintenance:1==s||2==s?o=this.CLASS_MAP.button:3==s&&(o=this.CLASS_MAP.hm_dis_ep_wm55),o){var c=new o(e,t["interface"],n);c.channel=s,a.push(c);}}return a;},_._resolve_HMIP_FAL_X=function(e,t){var a=[];if(!t||!t.channels)return null;var r=t.channels;for(var n in r){var i,s=r[n],o=n.indexOf(":"),c=n.substr(o+1);if(0==c?i=this.CLASS_MAP.maintenance:"CLIMATECONTROL_FLOOR_PUMP_TRANSCEIVER"==s.type?i=this.CLASS_MAP_IP.ip_floor_pump_heater:"CLIMATECONTROL_FLOOR_TRANSCEIVER"==s.type&&(i=this.CLASS_MAP_IP.ip_floor_heater),i){var l=new i(e,t["interface"],n);l.channel=c,a.push(l);}}return a;},_._resolve_HMIP_MIOB=function(e,t){var a=[];if(!t||!t.channels)return null;var r=t.channels;for(var n in r){r[n];var i=n.indexOf(":"),s=n.substr(i+1),o=null;if(0==s?o=this.CLASS_MAP.maintenance:3==s||7==s?o=this.CLASS_MAP_IP.ip_switch:9==s||10==s?o=this.CLASS_MAP_IP.ip_generic_input:11==s&&(o=this.CLASS_MAP_IP.ip_analog_output),o){var c=new o(e,t["interface"],n);c.channel=s,a.push(c);}}return a;},_._resolve_HMIP_MIO16_PCB=function(e,t){var a=[];if(!t||!t.channels)return null;var r=t.channels;for(var n in r){r[n];var i=n.indexOf(":"),s=n.substr(i+1),o=null;if(o=0==s?this.CLASS_MAP.maintenance:s>=1&&s<=12?m:s>=13&&s<=16?v:u){var c=new o(e,t["interface"],n);c.channel=s,a.push(c);}}return a;},_._getIPMetaIndex=function(e){for(var t in x.hub.m.hm.IPDeviceTypes){if(x.hub.m.hm.IPDeviceTypes.hasOwnProperty(t)&&t.toUpperCase()==e.toUpperCase())return x.hub.m.hm.IPDeviceTypes[t];}return null;},_;}(),x.hub.m.hm.Manager=function(){var M=function M(e){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Manager"),this._gateway=e,this._devices={},this._meta={};};return M.prototype.init=function(e){x.hub.m.hm._Util.isIP(this._gateway.ip)?(this._logger.log("info","start connect monitor to "+this._gateway.ip),this._startMonitor(e)):e&&e();},M.prototype.onDeviceEvent=function(e){this._logger.log("trace","receive device event:"+JSON.stringify({device:e.device?e.device.type:null,address:e.device?e.device.address:null,channel:e.channel,datapoint:e.datapoint,value:e.value?e.value.value:null,ip:e.ip}));if(!e)return null;if(!e.device)return null;var t=x.hub.m.hm.HM_MODULE.resolveGateway(this._gateway);if(!t)return null;var a=e.device;if(a.hsstype=a.type,a.channels)for(var r in a.channels){if(a.channels.hasOwnProperty(r)){var n=a.channels[r];n.hsstype=n.type;}}var i,s=t._parseDevice(a);if(!s||0==s.length)return null;if(1==s.length?i=s[0]:s.forEach(function(t){if(t.address==e.channel)i=t;else if(0==e.channel.indexOf(t.address)){var a=e.channel.split(":")[1];if(t.channels)for(var r in t.channels){if(t.channels[r].address==a)return void(i=t);}}}),!i)return null;var o=x.hub.m.hm._Util.getDeviceHashCode(i),c=t.resolveState(i,e,e.oldValue.value),l=t.resolveState(i,e,e.value.value);if(!l)return null;this._logger.log("trace","event to device state"),this._logger.log("trace","device:"+JSON.stringify(i)),this._logger.log("trace","state:"+JSON.stringify(l));var u=[];if(Array.isArray(l))l.forEach(function(e){var t=function(e,t){var a=null;return t&&0!=t.length?(t.forEach(function(t){t&&t.key==e&&(a=t);}),a):null;}(e.key,c),a={key:e.key,value:e.value,changed:!t||e.value!=t.value,oldValue:t?t.value:void 0};u.push({device:i,gateway:this._gateway,data:a});}.bind(this));else{var h={key:l.key,value:l.value,changed:l.value!=c.value,oldValue:c.value};u.push({device:i,gateway:this._gateway,data:h});}this._generateEvent(o,u);},M.prototype._generateEvent=function(e,t){var a=require("x.hub.eventbus.js"),r=this._meta[e];if(r&&r.length>0)for(var n=0;n<r.length;n++){var i=r[n];if(i)for(var s=0;s<t.length;s++){var o=t[s];o&&o.data&&(o.data.key==i.statusKey||"*"==o.data.key)&&a.emit("status",{module:"hm",device:o.device,gateway:o.gateway,data:o.data},i);}}},M.prototype.addStateDevice=function(e,t,a){if(e){e=JSON.parse(JSON.stringify(e));var r=x.hub.m.hm._Util.getDeviceHashCode(e);if(this._devices[r]||(delete e.gateway,this._devices[r]=e),this._meta[r]||(this._meta[r]=[]),a&&this._meta[r].push(a),"HmIP-RCV-50"==e.type&&"HmIP-RCV"!=e.address.substr(0,8)){var n=0,i=(e=JSON.parse(JSON.stringify(e))).address.split(":");if(i.length>=2&&(n=i[1]),n){e.address="HmIP-RCV-1:"+n;r=x.hub.m.hm._Util.getDeviceHashCode(e);this._devices[r]||(delete e.gateway,this._devices[r]=e),this._meta[r]||(this._meta[r]=[]),a&&this._meta[r].push(a);}}t&&t();}else t&&t(new Error("device json invalid"));},M.prototype.removeStateDevice=function(e,t,a){if(e){if(a){e=JSON.parse(JSON.stringify(e));var r=x.hub.m.hm._Util.getDeviceHashCode(e),n=this._meta[r];if(n){for(var i=-1,s=0;s<n.length;s++){var o=n[s];if(o&&"taskman"==o.src&&"taskman"==a.src&&o.taskID==a.taskID&&o.statusKey==a.statusKey){i=s;break;}}i>=0&&n.splice(i,1),0==n.length&&(delete this._devices[r],delete this._meta[r]);}t&&t();}}else t&&t(new Error("device json invalid"));},M.prototype.getAllStates=function(){var e=[];for(var t in this._devices){if(this._devices.hasOwnProperty(t)){var a=this._devices[t];if(a&&a.device){var r=this.getStates(a.device);r&&e.push(r);}}}return e;},M.prototype.getStates=function(e){if(!e)return null;e=JSON.parse(JSON.stringify(e));var t=x.hub.m.hm._Util.getDeviceHashCode(e),a=this._devices[t];a||this.addStateDevice(e);var r=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!r)return null;var n={};for(var i in(a=this._devices[t]).states){var s=a.states[i],o=r.getBufferedState(s);n[i]=this._resolveRawState(e,i,o);}return{device:e,gateway:this._gateway,states:n};},M.prototype.updateStates=function(e,t){if(e){e=JSON.parse(JSON.stringify(e));var a=x.hub.m.hm._Util.getDeviceHashCode(e),r=this._devices[a];r||this.addStateDevice(e),r=this._devices[a],this._updateStates(e,r.states,t);}else t&&t(new Error("device json is null"));},M.prototype.getState=function(e,t,a){if(!e||!t)return a&&a(new Error("argument invalid")),null;if("SysVar"!=e.type&&"CUxD"!=e["interface"]){e=JSON.parse(JSON.stringify(e));var r=x.hub.m.hm._Util.getDeviceHashCode(e);this._devices[r]||this.addStateDevice(e);var n=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!n)return a&&a(new Error("no monitor for gateway")),null;var i=x.hub.m.hm.HM_MODULE.resolveGateway(this._gateway);if(!i)return a&&a(new Error("gateway json invalid")),null;var s=i.resolveDatapointInfo(e,t);if(!s)return a&&a(new Error("device json or state ref invalid")),null;n.getState(s,function(r,n){if(r)a&&a(r);else if(n){var o,c=i.resolveState(e,s,n.value);c?Array.isArray(c)?c.forEach(function(e){e&&e.key==t&&(o={value:e.value,time:n.time});}):o={value:c.value,time:n.time}:o={value:c,time:n.time},a&&a(null,o);}else a&&a(null,null);});}else x.hub.m.hm.HM_MODULE.doStatus("var",this._gateway,e,{value:t},function(e,t){if(e)a&&a(e);else if(t){var r={value:t.status,time:new Date().getTime()};a&&a(null,r);}else a&&a(new Error("get sys var status return null"));});},M.prototype.executeCommand=function(e,t,a){var r=x.hub.m.hm.HM_MODULE.resolveGateway(this._gateway);if(!r)return a&&a(new Error("gateway json invalid")),null;r.executeCommandCreator(e,t,a);},M.prototype.updateState=function(e,t,a){if(!e||!t)return a&&a(new Error("argument invalid")),null;e=JSON.parse(JSON.stringify(e));var r=x.hub.m.hm._Util.getDeviceHashCode(e);this._devices[r]||this.addStateDevice(e);var n=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!n)return a&&a(new Error("no monitor for gateway")),null;var i=x.hub.m.hm.HM_MODULE.resolveGateway(this._gateway);if(!i)return a&&a(new Error("gateway json invalid")),null;var s=i.resolveDatapointInfo(e,t);if(!s)return a&&a(new Error("device json or state ref invalid")),null;n.updateState(s,function(r,n){if(r)a&&a(r);else{var o,c=i.resolveState(e,s,n);c?Array.isArray(c)?c.forEach(function(e){e&&e.key==t&&(o={value:e.value});}):o={value:c.value}:o={value:c},a&&a(null,o);}});},M.prototype._startMonitor=function(e){var t=require("x.hub.m.hm.js")._monitorManager,a=this;t.startMonitor(this._gateway,{persistant:!0},function(r){var n=t.getMonitor(a._gateway.ip,a._gateway.uuid);n&&n.on("new_devices",a._onNewDevices.bind(a)),e&&e(r);});},M.prototype._onNewDevices=function(e){var t=[];for(var a in e){if(e.hasOwnProperty(a)){var r=x.hub.m.hm._Device.resolve(e[a]);if(r&&r.length>0){var n=r.filter(function(e){return e&&e.isButton();});t=t.concat(n);}}}var i=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(i&&t.length>0){var s=0,cb=function cb(){++s<t.length&&t[s].claimEvent(i,cb);};t[s].claimEvent(i,cb);}},M.prototype._updateStates=function(e,t,a){var r=require("x.hub.m.hm.js")._monitorManager,n=this;r.startMonitor(this._gateway,{persistant:!0},function(r){r?a&&a(r):n._getStateByScript(e,t,a);});},M.prototype._resolveDetailDpt=function(e){var t=require("xnm.aio.hm.js").devicemanager,a=t.applyUIFilter(e,{catagory:"status",elems:"*"}),r=a?a.status:null,n=(a=t.applyUIFilter(e,{catagory:"command",elems:"*"}))?a.command:null,i={states:{},commands:{}};if(r&&r.length>=0)for(var s=0;s<r.length;s++){var o=r[s];(c=this._resolveDatapointRef(e,o.ref.value,!1))&&(i.states[o.ref.value]=c);}if(n&&n.length>=0)for(s=0;s<n.length;s++){var c,l=n[s];(c=this._resolveDatapointRef(e,l.ref.value,!0))&&(i.commands[l.ref.value]=c);}return i;},M.prototype.learnRFDevice=function(e){var t=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);t?t.learnRF(function(t,a){if(t)e&&e(t);else{var r=[],n=new x.hub.m.hm.HM_MODULE.CCU();for(var i in a){var s=a[i];if(s.hsstype=s.type,s.channels)for(i in s.channels){s.channels[i].hsstype=s.channels[i].type;}var o=n._parseDevice(s);o&&(r=r.concat(o));}e&&e(null,r);}}):e&&e(new Error("monitor not started"));},M.prototype.learnIPDevice=function(e,t,a){var r=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);r?r.learnIP(e,t,function(e,t){if(e)a&&a(e);else{var r=[],n=new x.hub.m.hm.HM_MODULE.CCU();for(var i in t){var s=t[i];if(s.hsstype=s.type,s.channels)for(i in s.channels){s.channels[i].hsstype=s.channels[i].type;}var o=n._parseDevice(s);o&&(r=r.concat(o));}a&&a(null,r);}}):a&&a(new Error("monitor not started"));},M.prototype.learnIPDeviceQR=function(e,t){var a=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);a?a.learnIPQR(e,function(e,a){if(e)t&&t(e);else{var r=[],n=new x.hub.m.hm.HM_MODULE.CCU();for(var i in a){var s=a[i];if(s.hsstype=s.type,s.channels)for(i in s.channels){s.channels[i].hsstype=s.channels[i].type;}var o=n._parseDevice(s);o&&(r=r.concat(o));}t&&t(null,r);}}):t&&t(new Error("monitor not started"));},M.prototype.deleteDevice=function(e,t,a){var r=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);r?r.deleteDevice(e,t,a):a&&a(new Error("monitor not started"));},M.prototype.getRFInterfaces=function(e){var t=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);t?t.getRFInterfaces(e):e&&e(new Error("monitor not started"));},M;}(),x.hub.m.hm.ChipManager=function(e){x.hub.m.hm.Manager.call(this,e),this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Manager.ChipManager");},util.inherits(x.hub.m.hm.ChipManager,x.hub.m.hm.Manager),x.hub.m.hm.ChipManager.prototype.init=function(e){if(x.hub.m.hm._Util.isIP(this._gateway.ip)){this._logger.log("info","start connect monitor to "+this._gateway.ip);var t=this,a=require("x.hub.m.hm.js")._monitorManager;a.startMonitor(this._gateway,{localChip:"chip",persistant:!0},function(r){var n=a.getMonitor(t._gateway.ip,t._gateway.uuid);n&&n.on("new_devices",t._onNewDevices.bind(t)),e&&e(r);},!0,!0);}else e&&e();},x.hub.m.hm.ChipManager.prototype.reset=function(e){var t=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!t)return e&&e(new Error("no chip monitor")),null;t.reset(e);},x.hub.m.hm.ChipManager.prototype.executeCommand=function(e,t,a){if(e&&e.address&&t){var r=e.address.split(".");if(r.length<3)a&&a({error:new Error("address invalid")});else{var n={type:r[0],"interface":r[1],address:r[2]},i=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!i)return a&&a(new Error("no chip monitor")),null;var s=x.hub.m.hm._Device.parseJson(n);s?s.executeCommand(i,t.value,a):a&&a(new Error("unknow device"));}}else a&&a(new Error("argument invalid"));},x.hub.m.hm.ChipManager.prototype.getState=function(e,t,a){if(!e||!e.address||!t)return a&&a(new Error("argument invalid")),null;var r=e.address.split(".");if(r.length<3)a&&a(new Error("address invalid"));else{var n={type:r[0],"interface":r[1],address:r[2]},i=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!i)return a&&a(new Error("no chip monitor")),null;var s=x.hub.m.hm._Device.parseJson(n);s?s.getState(i,t.value,a):a&&a(new Error("unknow device"));}},x.hub.m.hm.ChipManager.prototype.getBufferedStateLegacy=function(e,t){if(!e)return null;var a,r,n=x.hub.m.hm._Device.resolve(e);if(!n||0==n.length)return null;if(1==n.length?a=n[0]:n.forEach(function(e){e.deviceAdr==t&&(a=e);}),!a)return null;var i=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(i){var s=i.getAllBufferedStates(),o=a.deviceAdr,c=o.indexOf(":");-1!=c&&(o=o.substr(0,c)),s[o]&&s[o].states&&(r=a.parseStates(s[o].states));}if(!r)return null;var l={type:"HM",adr:a.toLegacyAdr(),state:{}};for(var u in r){l.state[u]=r[u].value;}return l;},x.hub.m.hm.ChipManager.prototype.checkButtonEvent=function(e){if(!e)return null;if(!e.device)return null;if(!e.datapoint||0!=e.datapoint.indexOf("PRESS"))return null;var t,a,r=x.hub.m.hm._Device.resolve(e.device);if(!r||0==r.length)return null;if(1==r.length?t=r[0]:r.forEach(function(a){a.deviceAdr==e.channel&&(t=a);}),!t)return null;if(!(a=t.parseDptState(e.channel,e.datapoint,e.value.value)))return null;var n={type:"HM",adr:t.deviceType+"."+t.deviceIF+"."+t.deviceAdr,state:{},_ver:"v5+"},i=Object.keys(a);n.state[i[0]]=a[i[0]],require("x.hub.eventbus.js").emit("gatewayevent",n,{address:"HM"},"BTN");},x.hub.m.hm.ChipManager.prototype.onDeviceEvent=function(e){if(!e)return null;if(!e.device)return null;var t,a,r,n=x.hub.m.hm._Device.resolve(e.device);if(!n||0==n.length)return null;if(1==n.length?t=n[0]:n.forEach(function(a){a.deviceAdr==e.channel&&(t=a);}),!t)return null;if(a=t.parseDptState(e.channel,e.datapoint,e.oldValue.value),!(r=t.parseDptState(e.channel,e.datapoint,e.value.value)))return null;var i={sys:"aio",type:"HM",address:t.deviceType+"."+t.deviceIF+"."+t.deviceAdr},s=this._gateway,o={key:null,value:null,changed:e.changed,oldValue:null},c=Object.keys(r);return o.key=c[0],o.value=r[c[0]],o.oldValue=a?a[c[0]]:void 0,this._logger.log("debug","EVENT:\t"+i.address+"\t"+o.key+"\t"+o.value),{device:i,gateway:s,data:o};},x.hub.m.hm.ChipManager.prototype.learnRFDevice=function(e){var t=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);t?t.learnRF(function(t,a){if(t)e&&e(t);else{var r=[];for(var n in a){var i=a[n],s=x.hub.m.hm._Device.resolve(i);s&&(r=r.concat(s));}e&&e(t,r);}}):e&&e(new Error("monitor not started"));},x.hub.m.hm.ChipManager.prototype.learnRFDeviceSN=function(e,t){var a=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);a?a.learnRFSN(e,function(e,a){if(e)t&&t(e);else{var r=[];for(var n in a){var i=a[n],s=x.hub.m.hm._Device.resolve(i);s&&(r=r.concat(s));}t&&t(e,r);}}):t&&t(new Error("monitor not started"));},x.hub.m.hm.ChipManager.prototype.learnIPDevice=function(e,t,a){var r=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);r?r.learnIP(e,t,function(e,t){if(e)a&&a(e);else{var r=[];for(var n in t){var i=t[n],s=x.hub.m.hm._Device.resolve(i);s&&(r=r.concat(s));}a&&a(e,r);}}):a&&a(new Error("monitor not started"));},x.hub.m.hm.ChipManager.prototype.learnIPDeviceQR=function(e,t){var a=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);a?a.learnIPQR(e,function(e,a){if(e)t&&t(e);else{var r=[];for(var n in a){var i=a[n],s=x.hub.m.hm._Device.resolve(i);s&&(r=r.concat(s));}t&&t(e,r);}}):t&&t(new Error("monitor not started"));},x.hub.m.hm.ChipManager.prototype.getAllBufferedStates=function(){var e=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);return e?function(e){var t=[];for(var a in e){var r=e[a],n=x.hub.m.hm._Device.resolve(r.device);if(n)for(var i=0,s=n.length;i<s;i++){var o=n[i],c=o.parseStates(r.states);t.push({device:o,states:c});}}return t;}(e.getAllBufferedStates()):[];},x.hub.m.hm.ChipManager.prototype.getConfig=function(e,t){if(e&&e.address){var a=e.address.split(".");if(a.length<3)t&&t({error:new Error("address invalid")});else{var r={type:a[0],"interface":a[1],address:a[2]},n=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!n)return t&&t(new Error("no chip monitor")),null;var i=x.hub.m.hm._Device.parseJson(r);i?i.getConfig(n,t):t&&t(new Error("unknow device"));}}else t&&t(new Error("device json invalid"));},x.hub.m.hm.ChipManager.prototype.setConfig=function(e,t,a){if(e&&e.address){var r=e.address.split(".");if(r.length<3)a&&a({error:new Error("address invalid")});else{var n={type:r[0],"interface":r[1],address:r[2]},i=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(!i)return a&&a(new Error("no chip monitor")),null;var s=x.hub.m.hm._Device.parseJson(n);s?s.setConfig(i,t,a):a&&a(new Error("unknow device"));}}else a&&a(new Error("device json invalid"));},x.hub.m.hm.ChipManager.prototype._onNewDevices=function(e){var t=[];for(var a in e){if(e.hasOwnProperty(a)){var r=x.hub.m.hm._Device.resolve(e[a]);if(r&&r.length>0){var n=r.filter(function(e){return e&&e.isButton();});t=t.concat(n);}}}var i=require("x.hub.m.hm.js")._monitorManager.getMonitor(this._gateway.ip,this._gateway.uuid);if(i&&t.length>0){var s=0,cb=function cb(){++s<t.length&&t[s].claimEvent(i,cb);};t[s].claimEvent(i,cb);}},x.hub.m.hm.CCU2Discovery=function(){var Discovery=function Discovery(e){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.CCU2Discovery"),this._autoDiscoverTO=null;var t=this;this._hmHandlerCB=function(e,a){if(t._logger.log("debug","find ccu:"+e.uuid+"@"+e.ip+" from netif:"+a),t._searchCB&&t._searchCB(e,a),e.ip){var r=!1;t._searchTmpHMs.forEach(function(t){t.ip==e.ip&&(r=!0);}),r||t._searchTmpHMs.push(e);}},this._searchCB=e,this._searchRunning=!1,this._searchTmpHMs=[],this._searchTmpCBs=[];};return Discovery.prototype.discover=function(e){if(e&&-1==this._searchTmpCBs.indexOf(e)&&this._searchTmpCBs.push(e),!this._searchRunning){this._searchRunning=!0,this._searchTmpHMs=[],this._autoDiscoverTO&&(clearTimeout(this._autoDiscoverTO),this._autoDiscoverTO=null),require("xnm.aio.hm.js").discoverCCUs(this._hmHandlerCB);var t=this;setTimeout(function(){t._searchRunning=!1,t._autoDiscoverTO=setTimeout(function(){t.discover();},3e4),t._searchTmpCBs.forEach(function(e){e&&e(t._searchTmpHMs);}),t._searchTmpCBs=[];},3e3);}},Discovery;}(),x.hub.m.hm._Util={isDeviceJsonValid:function isDeviceJsonValid(e){return e&&e.type&&e.address&&e["interface"];},isGatewayJsonValid:function isGatewayJsonValid(e){return e&&e.ip;},getDeviceHashCode:function getDeviceHashCode(e){if(!e)return-1;var t=0;return t=((t=((t=(t<<5)-t+this._getStringHashCode(e.type))<<5)-t+this._getStringHashCode(e.address))<<5)-t+this._getStringHashCode(e["interface"]);},getGatewayHashCode:function getGatewayHashCode(e){if(!e)return-1;var t=80;e.port&&((t=parseInt(e.port))||(t=80));var a=0;return a=((a=((a=((a=((a=(a<<5)-a+this._getStringHashCode(e.ip))<<5)-a+t)<<5)-a+this._getStringHashCode(e.uuid))<<5)-a+this._getStringHashCode(e.username))<<5)-a+this._getStringHashCode(e.password);},getLocalIP:function getLocalIP(e,t){var _ip2number=function _ip2number(e){if(!e)return-1;var t=e.match(/^(\d+)\.(\d+)\.(\d+)\.(\d+)$/);return t?(+t[1]<<24)+(+t[2]<<16)+(+t[3]<<8)+ +t[4]:-1;};if("127.0.0.1"==t||"localhost"==t)return"127.0.0.1";var a=require("os").networkInterfaces();for(var r in a){if(a.hasOwnProperty(r))for(var n=a[r],i=0;i<n.length;i++){var s=n[i];if(s&&"IPv4"==s.family&&s.address){if(e==r)return s.address;if(!e&&!t)return s.address;if(!e&&s.netmask&&t){var o=_ip2number(s.netmask);if((_ip2number(s.address)&o)==(_ip2number(t)&o))return s.address;}}}}return null;},getLocalMac:function getLocalMac(e){var t=require("os").networkInterfaces();for(var a in t){if(t.hasOwnProperty(a))for(var r=t[a],n=0;n<r.length;n++){var i=r[n];if(i&&"IPv4"==i.family&&i.address&&i.mac&&e==i.address)return i.mac;}}return"00:00:00:00:00:00";},isIP:function isIP(e){return /^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(e);},mergeObj:function mergeObj(e,t){var a,r={};for(a in e){e.hasOwnProperty(a)&&(r[a]=e[a]);}for(a in t){t.hasOwnProperty(a)&&(r[a]=t[a]);}return r;},_getStringHashCode:function _getStringHashCode(e){var t,a,r=0;if(void 0===e||null==e)return-1;if(0===e.length)return r;for(t=0,a=e.length;t<a;t++){r=(r<<5)-r+e.charCodeAt(t);}return r;}},x.hub.m.hm.UdpEventProducer=function(){var Producer=function Producer(e){this._handler=e,this._pool={};};return Producer.prototype.EVENT_TO=300,Producer.prototype.onEvent=function(e){if(e&&e.channel){var t=0,a=e.channel,r=a.indexOf(":");-1!=r&&(a=e.channel.substr(0,r),t=e.channel.substr(r+1));var n=this._pool[a];n&&n.timeout&&clearTimeout(n.timeout);var i=this,s=setTimeout(function(){var e=i._pool[a];for(var t in i._pool[a]=null,e){var r=e[t],n=i._handler._chipManager.getBufferedStateLegacy(r.device,r.channel);if(n){n._ver="v5+";var s=require("x.hub.eventbus.js");s.emit("gatewayevent",n,{address:"HM"},"STA"),s.emit("udpevent",n,"STA");}}},this.EVENT_TO);this._pool[a]||(this._pool[a]={}),this._pool[a].timeout=s,this._pool[a][t]||(this._pool[a][t]=e);}},Producer.prototype.addSTAEvent=function(e){if(e&&e.adr){var t=new Date().getTime(),a=e.adr,r=this._pool[a];r&&r.timeout&&clearTimeout(r.timeout);var n=this,i=setTimeout(function(){var e=n._pool[a];if(e&&e.states){var t=require("x.hub.eventbus.js");t.emit("gatewayevent",e.states,{address:"HM"},"STA"),t.emit("udpevent",e.states,"STA");}},this.EVENT_TO);this._pool[a]={states:e,timestamp:t,timeout:i};}},Producer;}(),x.hub.m.hm.Handler=function(){var Handler=function Handler(){this._logger=require("x.logger.js").getLogger("x.hub.m.hm.Handler");var e=this;this._udpEvtProducer=new x.hub.m.hm.UdpEventProducer(this),this._discoveryCB=function(t,a){e._onFindHM(t,a);},this._discovery=null,this._monitorManager=null,this._managers={},this._xmlrpcServer=null,this._chipManager=null;};return util.inherits(Handler,EventEmitter),Handler.prototype.CCU=x.hub.m.hm.CCU,Handler.prototype.XMLRPCClient=x.hub.m.hm.Client,Handler.prototype.init=function(e){var t=this;if(localStorage){var a=!0;"false"==localStorage.getItem("x.hub.m.hm.CCU_INIT_STATE")&&(a=!1),x.hub.m.hm.CCU_INIT_STATE=a;}require("x.hub.eventbus.js").on("x.hub.m.hm.CCU_INIT_STATE",function(e){var t=!0;"false"==e&&(t=!1),x.hub.m.hm.CCU_INIT_STATE=t;}),this._discovery=new x.hub.m.hm.CCU2Discovery(this._discoveryCB),this._monitorManager=new x.hub.m.hm.MonitorManager(),this._xmlrpcServer=new x.hub.m.hm.Server(global.HM_LOCAL_PORT),this._xmlrpcServer.start(function(a){if(a)return t._logger.log("warn","start homematic local server error with port:"+t._xmlrpcServer.getPort()),t._logger.log("warn",a.stack),void(e&&e({error:a}));t._monitorManager.init(t._xmlrpcServer,function(a){a?e&&e({error:a}):global&&global.HM_CHIP?t._initChipManager(function(t){e&&e({error:t});}):e&&e({});});});},Handler.prototype.getSystems=function(){return["hm"];},Handler.prototype.addStateDevice=function(e,t,a){if(e){if(e.gateway&&"mediola"!=e.gateway.uuid){if(e.gateway.ip&&x.hub.m.hm._Util.isIP(e.gateway.ip)){if(!x.hub.m.hm._Util.isIP(e.gateway.ip))return this._logger.log("warn","ccu has ip:"+e.gateway.ip," , may not receive event from it."),void(t&&t({error:new Error("gateway ip is url")}));var r=this._getManager(e.gateway);r||(r=this._addManager(e.gateway)).init(function(e){}),r.addStateDevice(e,function(e){t&&t({error:e});},a);}else t&&t({error:new Error("gateway ip format invalid")});}else t&&t();}else t&&t({error:new Error("device json format invalid")});},Handler.prototype.removeStateDevice=function(e,t,a){if(e){if(e.gateway&&"mediola"!=e.gateway.uuid){if(e.gateway.ip&&x.hub.m.hm._Util.isIP(e.gateway.ip)){if(!x.hub.m.hm._Util.isIP(e.gateway.ip))return this._logger.log("warn","ccu has ip:"+e.gateway.ip," , may not receive event from it."),void(t&&t({error:new Error("gateway ip is url")}));var r=this._getManager(e.gateway);r?r.removeStateDevice(e,function(e){t&&t({error:e});},a):t&&t({});}else t&&t({error:new Error("gateway ip format invalid")});}else t&&t();}else t&&t({error:new Error("device json format invalid")});},Handler.prototype.getAllStates=function(){return this._chipManager?this._chipManager.getAllBufferedStates():[];},Handler.prototype.getStates=function(e){if(!(e&&x.hub.m.hm._Util.isDeviceJsonValid(e)&&e.gateway&&x.hub.m.hm._Util.isGatewayJsonValid(e.gateway)))return null;var t=this._getManager(e.gateway);return t?t.getStates(e):((t=this._addManager(e.gateway)).init(),null);},Handler.prototype.getState=function(e,t,a){return e?e.gateway&&"mediola"!=e.gateway.uuid?x.hub.m.hm._Util.isDeviceJsonValid(e)&&e.gateway&&x.hub.m.hm._Util.isGatewayJsonValid(e.gateway)?void x.hub.m.hm.HM_MODULE.doStatus("xhub",e.gateway,e,{value:t},function(e,t){e?a&&a({error:e}):t?a&&a({data:{value:t.status}}):a&&a({error:new Error("do status failed")});}):(a&&a({error:new Error("device json invalid")}),null):this._chipManager?this._chipManager.getState(e,{value:t},function(e,t){a&&a({error:e,data:t});}):void(a&&a({error:new Error("chip manager not inited")})):(a&&a({error:new Error("device is null")}),null);},Handler.prototype.executeCommand=function(e,t,a){if(e){if(t)return e.gateway&&"mediola"!=e.gateway.uuid?void(e.gateway?x.hub.m.hm.HM_MODULE.doCommand(e.gateway,e,t,function(e){e?a&&a({error:e}):a&&a({});}):a&&a({error:new Error("gateway is null")})):this._chipManager?void this._chipManager.executeCommand(e,t,function(e){a&&a({error:e});}):void(a&&a({error:new Error("chip manager not inited")}));a&&a({error:new Error("command invalid")});}else a&&a({error:new Error("device is null")});},Handler.prototype.updateStates=function(e,t){if(e&&x.hub.m.hm._Util.isDeviceJsonValid(e)&&e.gateway&&x.hub.m.hm._Util.isGatewayJsonValid(e.gateway)){var a=this._getManager(e.gateway);a?a.updateStates(e,function(e,a){t&&t({error:e,data:a});}):(a=this._addManager(e.gateway)).init(function(r){r?t&&t({error:r}):a.updateStates(e,function(e,a){t&&t({error:e,data:a});});});}else t&&t({error:new Error("device json format invalid")});},Handler.prototype.checkDeviceMatch=function(e,t){if(!(t&&t.device&&e&&e.device))return!1;if(t.gateway&&"mediola"!=t.gateway.uuid){var a=x.hub.m.hm._Util.getDeviceHashCode(t.device),r=x.hub.m.hm._Util.getDeviceHashCode(e.device);if(a==r)return!0;if("HmIP-RCV-50"==e.device.type&&"HmIP-RCV"!=e.device.address.substr(0,8)){var n=JSON.parse(JSON.stringify(e.device)),i=0,s=n.address.split(":");if(s.length>=2&&(i=s[1]),i)return n.address="HmIP-RCV-1:"+i,a==(r=x.hub.m.hm._Util.getDeviceHashCode(n));}return!1;}var o=e.device.address;return e.device["interface"]&&e.device.type&&(o=e.device.type+"."+e.device["interface"]+"."+e.device.address),o==t.device.address;},Handler.prototype._initChipManager=function(e){var t="127.0.0.1";global&&global.HM_CHIP&&(t=global.HM_CHIP),this._chipManager=new x.hub.m.hm.ChipManager({ip:t,username:global.HM_CHIP_USERNAME,password:global.HM_CHIP_PASSWORD,uuid:"mediola"}),this._chipManager.init(e);},Handler.prototype._initCCU3Manager=function(e){global&&global.HM_CCU3&&global.HM_CCU3;this._addManager({ip:"127.0.0.1",type:3}).init(function(t){e&&e(t);});},Handler.prototype._discover=function(e){this._discovery.discover(e);},Handler.prototype._onFindHM=function(e,t){this._logger.log("debug","find ccu:"+e.uuid+"@"+e.ip+" from netif:"+t),this._monitorManager.onFindHomeMatic(e.ip,t,e.uuid);},Handler.prototype._getManager=function(e){var t=x.hub.m.hm._Util.getGatewayHashCode(e);return this._managers[t];},Handler.prototype._addManager=function(e){var t=x.hub.m.hm._Util.getGatewayHashCode(e),a=new x.hub.m.hm.Manager(e);return this._managers[t]=a,a;},Handler.prototype.onDeviceEvent=function(e,t){this._logger.log("trace","receive device event:"+JSON.stringify(e));require("x.hub.eventbus.js");if(t)this._chipManager&&(this._chipManager.checkButtonEvent(e),this._udpEvtProducer.onEvent(e));else for(var a in this._managers){var r=this._managers[a];if(r)try{r.onDeviceEvent(e);}catch(e){console.error(e.stack);}}},Handler.prototype.resetChip=function(e){this._chipManager?this._chipManager.reset(function(){e&&e({});}):e&&e(new Error("chip manager not inited"));},Handler.prototype.initManager=function(e,t){if(e){var a=this._getManager(e);a||(a=this._addManager(e)),a.init(function(e){t&&t({error:e});});}else t&&t({error:new Error("gateway invalid")});},Handler.prototype.learnRFDevice=function(e,t){if(e){var a=this._getManager(e);a?a.learnRFDevice(function(e,a){t&&t({error:e,data:a});}):(a=this._addManager(e)).init(function(e){e?t&&t({error:e}):setTimeout(function(){a.learnRFDevice(function(e,a){t&&t({error:e,data:a});});},3e3);});}else this._chipManager?this._chipManager.learnRFDevice(function(e,a){if(e)t&&t({error:e});else{var r=[];a.forEach(function(e){if(e){var t={address:e.toLegacyAdr(),type:e.toLegacyType()};r.push(t);}}),t&&t({data:r});}}):t&&t(new Error("chip manager not inited"));},Handler.prototype.learnRFDeviceSN=function(e,t,a){if(e){var r=this._getManager(e);r?r.learnRFDevice(function(e,t){a&&a({error:e,data:t});}):(r=this._addManager(e)).init(function(e){e?a&&a({error:e}):setTimeout(function(){r.learnRFDevice(function(e,t){a&&a({error:e,data:t});});},3e3);});}else this._chipManager?this._chipManager.learnRFDeviceSN(t,function(e,t){if(e)a&&a({error:e});else{var r=[];t.forEach(function(e){if(e){var t={address:e.toLegacyAdr(),type:e.toLegacyType()};r.push(t);}}),a&&a({data:r});}}):a&&a(new Error("chip manager not inited"));},Handler.prototype.learnIPDevice=function(e,t,a,r){if(e){var n=this._getManager(e);n?n.learnIPDevice(t,a,function(e,t){r&&r({error:e,data:t});}):(n=this._addManager(e)).init(function(e){e?r&&r({error:e}):setTimeout(function(){n.learnIPDevice(t,a,function(e,t){r&&r({error:e,data:t});});},3e3);});}else t?a?this._chipManager?this._chipManager.learnIPDevice(t,a,function(e,t){if(e)r&&r({error:e});else{var a=[];t.forEach(function(e){if(e){var t={address:e.toLegacyAdr(),type:e.toLegacyType()};a.push(t);}}),r&&r({data:a});}}):r&&r(new Error("chip manager not inited")):r&&r({error:new Error("key is null")}):r&&r({error:new Error("sgtin is null")});},Handler.prototype.learnIPDeviceQR=function(e,t,a){if(t){if(e){var r=this._getManager(e);r?r.learnIPDeviceQR(t,function(e,t){a&&a({error:e,data:t});}):(r=this._addManager(e)).init(function(e){e?a&&a({error:e}):setTimeout(function(){r.learnIPDeviceQR(t,function(e,t){a&&a({error:e,data:t});});},3e3);});}else this._chipManager?this._chipManager.learnIPDeviceQR(t,function(e,t){if(e)a&&a({error:e});else{var r=[];t.forEach(function(e){if(e){var t={address:e.toLegacyAdr(),type:e.toLegacyType()};r.push(t);}}),a&&a({data:r});}}):a&&a(new Error("chip manager not inited"));}else a&&a({error:new Error("qrKey is null")});},Handler.prototype.deleteDevice=function(e,t,a){if(t){var r=t.split(".");if(r.length<3)a&&a({error:new Error("address invalid")});else{var n=r[1],i=r[2];e?a&&a({error:new Error("not supported yet")}):this._chipManager?this._chipManager.deleteDevice(n,i,function(e){a&&a({error:e});}):a&&a(new Error("chip manager not inited"));}}else a&&a({error:new Error("address invalid")});},Handler.prototype.getRFInterfaces=function(e,t){if(e){var a=this._getManager(e);a?a.getRFInterfaces(function(e,a){t&&t({error:e,data:a});}):(a=this._addManager(e)).init(function(e){e?t&&t({error:e}):setTimeout(function(){a.getRFInterfaces(function(e,a){t&&t({error:e,data:a});});},3e3);});}else this._chipManager?this._chipManager.getRFInterfaces(function(e,a){t&&t({error:e,data:a});}):t&&t(new Error("chip manager not inited"));},Handler.prototype.executeCommandLegacy=function(e,t,a,r){e?r&&r({error:new Error("not supported yet")}):this._chipManager?t?this.executeCommand({address:t},{value:a},function(e){r&&r({error:e?e.error:null});}):r&&r({error:new Error("address invalid")}):r&&r({error:new Error("chip manager not inited")});},Handler.prototype.getAllStatesLegacy=function(e){var t=[];try{this.getAllStates().forEach(function(e){if(e&&e.device&&e.states){var a={type:"HM",adr:e.device.toLegacyAdr(),state:{}};for(var r in e.states){a.state[r]=e.states[r].value;}t.push(a);}});}catch(e){console.error(e.stack);}e&&e({data:t});},Handler.prototype.getConfig=function(e,t){e?e.gateway&&"mediola"!=e.gateway.uuid?t&&t({error:new Error("not supported yet")}):this._chipManager?this._chipManager.getConfig(e,function(e,a){t&&t({error:e,data:a});}):t&&t({error:new Error("chip manager not inited")}):t&&t({error:new Error("device is null")});},Handler.prototype.setConfig=function(e,t,a){e?e.gateway&&"mediola"!=e.gateway.uuid?a&&a({error:new Error("not supported yet")}):this._chipManager?this._chipManager.setConfig(e,t,function(e){a&&a({error:e});}):a&&a({error:new Error("chip manager not inited")}):a&&a({error:new Error("device is null")});},Handler.prototype.getMonitorStates=function(e){this._monitorManager.getMonitorStates(function(t,a){e&&e({error:t,data:a});});},Handler.prototype.getAllDevices=function(e){var t=[];try{this.getAllStates().forEach(function(e){if(e&&e.device&&e.states){var a={type:"HM",address:e.device.toLegacyAdr(),data:e.device.toLegacyType(),snr:e.device.getSerial(),_ver:"v5+"};t.push(a);}});}catch(e){console.error(e.stack);}e&&e({data:t});},Handler.prototype.isWindowOpen=function(){try{for(var e=this.getAllStates(),t=0;t<e.length;t++){var a=e[t];if(a&&a.device&&a.states){var r=a.device.toLegacyType();if("window"==r){if(a.states.state&&"closed"!=a.states.state.value)return!0;}else if("contact"==r){if(a.states.state&&"closed"!=a.states.state.value)return!0;}else if("ip_contact"==r){if(a.states.state&&"closed"!=a.states.state.value)return!0;}else if("ip_window"==r&&a.states.state&&"closed"!=a.states.state.value)return!0;}}}catch(e){return!1;}},Handler;}(),"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new x.hub.m.hm.Handler());