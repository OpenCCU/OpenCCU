var util=require("util"),EventEmitter=require("events"),x=x||{};x.hub=x.hub||{},x.hub.m=x.hub.m||{},x.hub.m.heos=x.hub.m.heos||{},x.hub.m.heos.MODULE=require("xnm.aio.heos.js"),x.hub.m.heos.Handler=function(){var Handler=function Handler(){this._commandBuffer=[];};return util.inherits(Handler,EventEmitter),Handler.prototype.init=function(e){e&&e();},Handler.prototype.getSystems=function(){return["heos"];},Handler.prototype.executeCommand=function(e,o,t){var n=e.gateway,m=x.hub.m.heos.MODULE.getController(),u=m.isIdle(),a=this;u&&(m.open(n),m.on("open",function(){a._doNextCommand();}));var d=this._commandBuffer.length;this._commandBuffer.push({gateway:e.gateway,device:e,command:o,callback:t}),0!=d||u||this._doNextCommand();},Handler.prototype._doNextCommand=function(){if(this._commandBuffer.length>0){var e=this,o=this._commandBuffer[0];o.command&&"playUrl"==o.command.value?x.hub.m.heos.MODULE.doCommand(o.gateway,o.device,{value:"clearQueue"},function(t){x.hub.m.heos.MODULE.doCommand(o.gateway,o.device,o.command,function(){e._commandBuffer.splice(0,1),e._doNextCommand();});}):x.hub.m.heos.MODULE.doCommand(o.gateway,o.device,o.command,function(){e._commandBuffer.splice(0,1),e._doNextCommand();});}},Handler;}(),"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new x.hub.m.heos.Handler());