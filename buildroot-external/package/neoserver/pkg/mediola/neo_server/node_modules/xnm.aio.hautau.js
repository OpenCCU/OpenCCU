function _typeof(obj){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj;}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;},_typeof(obj);}var xnm=xnm||{};xnm.aio=xnm.aio||{},xnm.aio.hautau=xnm.aio.hautau||{},xnm.aio.hautau.Gateway=function(){var Gateway=function Gateway(e,t){"undefined"==typeof require||null==require?this._logger={log:function log(){}}:this._logger=require("x.logger.js").getLogger("xnm.aio.hautau.Gateway"),this.ip=e,this.port=t,this.port||(this.port=80),this.timeout=1e3,this._statesBuffer={},this._fifo=[];};return Gateway.DEVICETYPE_MAP={0:"general",1:"multisensor",2:"outputbox203v",4:"general",5:"ventra",6:"general",7:"general",8:"general",9:"drive",10:"general",11:"general",100:"general",101:"ska20cd",102:"drive",103:"hscd","103_int":"hscdi",104:"general",105:"ventra2",106:"drive",107:"general",108:"general",255:"general"},Gateway.prototype.executeCommandCreator=function(e,t,a){if(t&&t.value){if(e){if(void 0!==e.address&&null!=e.address)switch(t.value){case"open":this._open(e.address,a);break;case"close":this._close(e.address,a);break;case"stop":this._stop(e.address,a);break;case"levelUp":this._setVentraLevel(e.address,"up",a);break;case"levelDown":this._setVentraLevel(e.address,"down",a);break;case"levelTo":this._setVentraLevel(e.address,t.ext,a);break;case"keyboardOn":this._setVentraKeyboard(e.address,"on",a);break;case"keyboardOff":this._setVentraKeyboard(e.address,"off",a);break;case"lockOn":this._setHscdLock(e.address,"on",a);break;case"lockOff":this._setHscdLock(e.address,"off",a);break;default:a&&a(new Error("command not exist"));}else a&&a(new Error("device json format invali"));}else a&&a(new Error("device json is null"));}else a&&a(new Error("command json format invalid"));},Gateway.prototype.getStatesCreator=function(e,t,a){for(var n={},s=0;s<t.length;s++){var o=t[s];o&&o.device&&void 0!==o.device.address&&null!=o.device.address&&o.device.type&&(n[o.device.address]=o.device.type);}var r=[],i=this,u=Object.keys(n);s=0;var cb=function cb(e,o){if(!e&&o){var l=function(e,t,a){if(!t)return[];for(var n=[],s=0;s<a.length;s++){var o=a[s];if(o&&o.id&&o.device&&o.device.address&&o.device.address==e&&o.status&&o.status.value){var r=t[o.status.value];void 0!==r&&null!=r&&n.push({id:o.id,status:r});}}return n;}(u[s],o,t);l&&(r=r.concat(l));}++s<u.length?i._getDeviceStates(u[s],n[u[s]],cb):a&&a(null,r);};this._getDeviceStates(u[s],n[u[s]],cb);},Gateway.prototype.listDevices=function(e,t){var a=this,n=!1,s=0,o=30;if("object"==_typeof(e)&&null!==e){var r=Number(e.start),i=Number(e.end),u=e.custom||null;u&&u.length>0&&(n=!0),n?s=u[0]:(!isNaN(r)&&r>=0&&r<=255&&(s=r),!isNaN(i)&&i>=0&&i<=255&&(o=i),o<s&&(o=s));}var l=s,p=0,c=[],cb=function cb(e,r){if(e&&-3!=e.code)return s==l&&p<5?(p++,void a._ping(s,cb)):void(t&&t(e,c));!e&&r&&(r.sys="hautau",r.type=r.DeviceType,r.address=s,c.push(r)),n?(u.shift(),s=u[0],0==u.length?t&&t(null,c):a._ping(s,cb)):++s>o?t&&t(null,c):a._ping(s,cb);};this._ping(s,cb);},Gateway.prototype._getDeviceStates=function(e,t,a){var n=new Date().getTime(),s=!1,o=this._statesBuffer[e];o?o.timestamp&&n-o.timestamp>3e3&&(s=!0,o.timestamp=n):(s=!0,this._statesBuffer[e]={states:null,timestamp:n},o=this._statesBuffer[e]);var r=Gateway.DEVICETYPE_MAP[t];if(void 0!==r&&null!=r){if(s){var i=this;this.getDeviceStates(e,r,function(t,n){!t&&n&&(i._statesBuffer[e]={states:n,timestamp:new Date().getTime()}),a&&a(t,n);});}else a&&a(null,o.states);}else a&&a(new Error("unknown device type"));},Gateway.prototype.getDeviceStates=function(e,t,a){switch(t){case"drive":this._getDriveStates(e,function(e,t){a&&a(e,t);});break;case"multisensor":this._getMultiSensorStates(e,function(e,t){a&&a(e,t);});break;case"ska20cd":this._getSka20cdStates(e,function(e,t){a&&a(e,t);});break;case"ventra":case"ventra2":this._getVentraStates(e,function(e,t){a&&a(e,t);});break;case"hscd":case"hscdi":this._getHscdStates(e,function(e,t){a&&a(e,t);});break;default:a&&a(null,null);}},Gateway.prototype._open=function(e,t){this._executeRequest("/hautau/open",{adr:e},null,function(e,a){t&&t(e,a);});},Gateway.prototype._close=function(e,t){this._executeRequest("/hautau/close",{adr:e},null,function(e,a){t&&t(e,a);});},Gateway.prototype._stop=function(e,t){this._executeRequest("/hautau/stop",{adr:e},null,function(e,a){t&&t(e,a);});},Gateway.prototype._getDriveStates=function(e,t){this._executeRequest("/hautau/drive",{adr:e,state:"show"},null,function(e,a){if(e)t&&t(e,a);else{var n={Closed:"yes"==a.Closed,Opened:"yes"==a.Opened,PowerCutoff:"yes"==a.PowerCutoff,State:"yes"==a.Closed?"closed":"open"};t&&t(null,n);}});},Gateway.prototype._getMultiSensorStates=function(e,t){this._executeRequest("/hautau/multisensor",{adr:e,state:"show"},null,function(e,a){e?t&&t(e,a):(a.Temperature=a.Temperature.toFixed(1),t&&t(null,a));});},Gateway.prototype._getSka20cdStates=function(e,t){this._executeRequest("/hautau/ska20cd",{adr:e,state:"show"},null,function(e,a){if(e)t&&t(e,a);else{var n={Closed:"yes"==a.Closed,Opened:"yes"==a.Opened,PowerCutoff:"yes"==a.PowerCutoff,State:"yes"==a.Closed?"closed":"open"};t&&t(null,n);}});},Gateway.prototype._getVentraStates=function(e,t){this._executeRequest("/hautau/ventra",{adr:e,state:"show"},null,function(e,a){e?t&&t(e,a):(a.FilterChange="yes"==a.FilterChange,t&&t(null,a));});},Gateway.prototype._setVentraLevel=function(e,t,a){var n=this;t||(t=0),this._executeRequest("/hautau/ventra",{adr:e,level:t},null,function(t,s){if(t)a&&a(t,s);else{if(void 0!==s.Level&&null!=s.Level){var o=new Date().getTime(),r=n._statesBuffer[e];r||(n._statesBuffer[e]={states:{},timestamp:o},r=n._statesBuffer[e]),r.states.Level=s.Level;}a&&a(null,s);}});},Gateway.prototype._setVentraKeyboard=function(e,t,a){var n=this;this._executeRequest("/hautau/ventra",{adr:e,keyboard:t},null,function(t,s){if(t)a&&a(t,s);else{if(void 0!==s.Keyboard&&null!=s.Keyboard){var o=new Date().getTime(),r=n._statesBuffer[e];r||(n._statesBuffer[e]={states:{},timestamp:o},r=n._statesBuffer[e]),r.states.Keyboard=s.Keyboard;}a&&a(null,s);}});},Gateway.prototype._getHscdStates=function(e,t){this._executeRequest("/hautau/hscd",{adr:e,state:"show"},null,function(e,a){e?t&&t(e,a):(a.WindowDown="yes"==a.WindowDown,a.WindowClosed="yes"==a.WindowClosed,a.State=a.WindowClosed?"closed":"open",t&&t(null,a));});},Gateway.prototype._setHscdLock=function(e,t,a){var n=this;this._executeRequest("/hautau/hscd",{adr:e,lock:t},null,function(t,s){if(t)a&&a(t,s);else if(void 0!==s.Lock&&null!=s.Lock){var o=new Date().getTime(),r=n._statesBuffer[e];r||(n._statesBuffer[e]={states:{},timestamp:o},r=n._statesBuffer[e]),r.states.Lock=s.Lock,a&&a(null,s);}});},Gateway.prototype._ping=function(e,t){this._executeRequest("/hautau/ping",{adr:e},2e3,t);},Gateway.prototype._executeRequest=function(e,t,a,n){var s=this._fifo.length,o={path:e,params:t,timeout:a,callback:n};this._fifo.push(o),0==s&&this._doNextRequest();},Gateway.prototype._doNextRequest=function(){if(0!=this._fifo.length){var e=this._fifo[0],t=this;this._doJsonRequest(e.path,e.params,e.timeout,function(a,n){try{e.callback&&e.callback(a,n);}catch(e){}t._fifo.splice(0,1),t._doNextRequest();});}},Gateway.prototype._doJsonRequest=function(e,t,a,n){this._doRequest("GET",e,t,a,function(e,t){if(e)n&&n(e);else{if(!t)return(e=new Error("request empty")).code=-2,void(n&&n(e));try{var a=JSON.parse(t);"ok"!=a.Result?((e=new Error(a.Result?a.Result:"result param is empty")).code=-3,n&&n(e)):n&&n(null,a);}catch(e){e.code=-2,n&&n(e);}}});},Gateway.prototype._doRequest2=function(e,t,a,n,s){n||(n=this.timeout);var o=this,r="http://"+this.ip+":"+this.port+t;if(a){var i=[];for(var u in a){var l=a[u];void 0!==l&&null!=l||(l=""),i.push(u+"="+encodeURIComponent(l));}r+="?"+i.join("&");}this._logger.log("trace","send "+e+" to url:"+r);var p=s;$.ajax({url:r,type:e,timeout:n,dataType:"text",cache:!0,success:function success(e){o._logger.log("trace","http request success:"+e),p&&(p(null,e),p=null);},error:function error(e,t){var a="http request error:"+(e?e.status:"0")+"-"+t;if(o._logger.log("trace",a),p){var n=new Error(a);n.code=-1,p(n),p=null;}}});},Gateway.prototype._doRequest=function(e,t,a,n,s){n||(n=this.timeout);var o=this;if(a){var r=[];for(var i in a){var u=a[i];void 0!==u&&null!=u||(u=""),r.push(i+"="+encodeURIComponent(u));}t+="?"+r.join("&");}this._logger.log("trace","send "+e+" to url: http://"+this.ip+":"+this.port+t);var l={host:this.ip,port:this.port,path:t,method:e,headers:{"Content-Type":'application/json; charset="UTF-8"',"User-Agent":"mediola",Connection:"close"},timeout:n},p=s,c=require("http").request(l,function(e){e.setEncoding("utf-8");var t="";e.on("data",function(e){t+=e;}),e.on("end",function(){if(o._logger.log("trace","http response "+e.statusCode+": "+t),200==e.statusCode)p&&p(null,t);else{var a=new Error("http response "+e.statusCode);a.code=-1,p&&p(a);}p=null;});});c.on("timeout",function(){if(o._logger.log("trace","http request timeout"),p){var e=new Error("http request timeout");e.code=-1,p(e),p=null;}c.abort();}),c.on("error",function(e){o._logger.log("trace","http request error:"+e.message),p&&(p(e),p=null);}),c.end();},Gateway.prototype.toJSON=function(){return{sys:"hautau",ip:this.ip,port:this.port};},Gateway.prototype.equalsTo=function(e){return!!e&&e instanceof Gateway&&this.ip==e.ip&&this.port==e.port;},Gateway.parseJSON=function(e){return e.ip?new Gateway(e.ip,e.port):null;},Gateway;}(),xnm.aio.hautau.DM=function(){var DMError=function DMError(e,t){this.code=e,this.message=t,this.stack=new Error().stack;};(DMError.prototype=new Error()).name="HautauDMError",DMError.prototype.code=0,DMError.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOW:4,NOT_FOUND:5,IP_EXISTS:6};var e={general:{command:[{type:"enum",name:"open",ref:{value:"open"}},{type:"enum",name:"close",ref:{value:"close"}},{type:"enum",name:"stop",ref:{value:"stop"}}]},outputbox203v:{command:[{type:"enum",name:"open",ref:{value:"open"}},{type:"enum",name:"close",ref:{value:"close"}},{type:"enum",name:"stop",ref:{value:"stop"}}]},multisensor:{status:[{type:"int",name:"co2",ref:{value:"CO2"}},{type:"float",name:"temperature",ref:{value:"Temperature"}},{type:"int",name:"humidity",ref:{value:"Humidity"}}]},drive:{command:[{type:"enum",name:"open",ref:{value:"open"}},{type:"enum",name:"close",ref:{value:"close"}},{type:"enum",name:"stop",ref:{value:"stop"}}],status:[{type:"enum",name:"power cutoff",ref:{value:"PowerCutoff",options:["true","false"]}},{type:"enum",name:"opened",ref:{value:"Opened",options:["true","false"]}},{type:"enum",name:"closed",ref:{value:"Closed",options:["true","false"]}},{type:"enum",name:"state",ref:{value:"State",options:["open","closed"]}}]},ska20cd:{command:[{type:"enum",name:"open",ref:{value:"open"}},{type:"enum",name:"close",ref:{value:"close"}},{type:"enum",name:"stop",ref:{value:"stop"}}],status:[{type:"enum",name:"power cutoff",ref:{value:"PowerCutoff",options:["true","false"]}},{type:"enum",name:"opened",ref:{value:"Opened",options:["true","false"]}},{type:"enum",name:"closed",ref:{value:"Closed",options:["true","false"]}},{type:"enum",name:"state",ref:{value:"State",options:["open","closed"]}}]},ventra:{command:[{type:"int",name:"set level",ref:{value:"levelTo",ext:"%d",extMeta:"0-3"}},{type:"enum",name:"level up",ref:{value:"levelUp"}},{type:"enum",name:"level down",ref:{value:"levelDown"}}],status:[{type:"enum",name:"error",ref:{value:"Errors",options:["no","temperature","fan1","fan2","keyboard","opened"]}},{type:"enum",name:"change filter",ref:{value:"FilterChange",options:["true","false"]}},{type:"int",name:"filter percent",ref:{value:"FilterPercent",extMeta:"0-100"}},{type:"int",name:"level0 runtime",ref:{value:"RuntimeLevel0"}},{type:"int",name:"level1 runtime",ref:{value:"RuntimeLevel1"}},{type:"int",name:"level2 runtime",ref:{value:"RuntimeLevel2"}},{type:"int",name:"level3 runtime",ref:{value:"RuntimeLevel3"}},{type:"int",name:"level",ref:{value:"Level",extMeta:"0-4"}},{type:"enum",name:"keyboard",ref:{value:"Keyboard",options:["on","off"]}}]},ventra2:{command:[{type:"int",name:"set level",ref:{value:"levelTo",ext:"%d",extMeta:"0-5"}},{type:"enum",name:"level up",ref:{value:"levelUp"}},{type:"enum",name:"level down",ref:{value:"levelDown"}}],status:[{type:"enum",name:"error",ref:{value:"Errors",options:["no","temperature","fan1","fan2","keyboard","opened","humidity"]}},{type:"enum",name:"change filter",ref:{value:"FilterChange",options:["true","false"]}},{type:"int",name:"filter percent",ref:{value:"FilterPercent",extMeta:"0-100"}},{type:"int",name:"level0 runtime",ref:{value:"RuntimeLevel0"}},{type:"int",name:"level1 runtime",ref:{value:"RuntimeLevel1"}},{type:"int",name:"level2 runtime",ref:{value:"RuntimeLevel2"}},{type:"int",name:"level3 runtime",ref:{value:"RuntimeLevel3"}},{type:"int",name:"level",ref:{value:"Level",extMeta:"0-5"}},{type:"enum",name:"keyboard",ref:{value:"Keyboard",options:["on","off"]}},{type:"float",name:"temperature",ref:{value:"Temperature"}},{type:"int",name:"humidity",ref:{value:"Humidity"}}]},hscd:{command:[{type:"enum",name:"open",ref:{value:"open"}},{type:"enum",name:"close",ref:{value:"close"}},{type:"enum",name:"stop",ref:{value:"stop"}}],status:[{type:"enum",name:"error",ref:{value:"Errors",options:["no","safety","current","keyboard","sw","cpu","checksum","ram","watchdog","stop","safetystop","pos","speed","vars","phase"]}},{type:"enum",name:"window down",ref:{value:"WindowDown",options:["true","false"]}},{type:"enum",name:"window closed",ref:{value:"WindowClosed",options:["true","false"]}},{type:"enum",name:"window state",ref:{value:"State",options:["open","closed"]}}]},hscdi:{command:[{type:"enum",name:"open",ref:{value:"open"}},{type:"enum",name:"close",ref:{value:"close"}},{type:"enum",name:"stop",ref:{value:"stop"}},{type:"enum",name:"hscd_lockOn",ref:{value:"lockOn"}},{type:"enum",name:"hscd_lockOff",ref:{value:"lockOff"}}],status:[{type:"enum",name:"error",ref:{value:"Errors",options:["no","safety","current","keyboard","sw","cpu","checksum","ram","watchdog","stop","safetystop","pos","speed","vars","phase"]}},{type:"enum",name:"lock",ref:{value:"Lock",options:["on","off"]}},{type:"enum",name:"window down",ref:{value:"WindowDown",options:["true","false"]}},{type:"enum",name:"window closed",ref:{value:"WindowClosed",options:["true","false"]}},{type:"enum",name:"window state",ref:{value:"State",options:["open","closed"]}},{type:"enum",name:"position percent (internorm)",ref:{value:"Position",extMeta:"0-100"}},{type:"enum",name:"number of driving cycles (internorm)",ref:{value:"Cycles",extMeta:"0-10000"}}]}};return{SYS:"hautau",getGatewayType:function getGatewayType(){return[{sys:this.SYS,name:"HAUTAU WLAN-Box",port:80}];},getGatewayDeviceType:function getGatewayDeviceType(){return[{sys:this.SYS,type:0,name:"Rauchmeldezentrale (RAZK)"},{sys:this.SYS,type:1,name:"Multisensor MS"},{sys:this.SYS,type:2,name:"Output Box 230V"},{sys:this.SYS,type:4,name:"LSF"},{sys:this.SYS,type:5,name:"Fensterlüfter Ventra 301"},{sys:this.SYS,type:6,name:"Primat kompakt"},{sys:this.SYS,type:7,name:"Small Master"},{sys:this.SYS,type:8,name:"Fensterlüfter Monitor"},{sys:this.SYS,type:9,name:"Primat kompakt 195"},{sys:this.SYS,type:10,name:"RWA Taster"},{sys:this.SYS,type:11,name:"Rauchmelder"},{sys:this.SYS,type:100,name:"Wlan Box"},{sys:this.SYS,type:101,name:"SKA 20 comfort drive"},{sys:this.SYS,type:102,name:"SM2/EM2 comfort drive"},{sys:this.SYS,type:103,name:"Atrium HS comfort drive"},{sys:this.SYS,type:"103_int",name:"Internorm HS comfort drive"},{sys:this.SYS,type:104,name:"Lamelle"},{sys:this.SYS,type:105,name:"Fensterlüfter Ventra 302"},{sys:this.SYS,type:106,name:"Neu Primat kompakt 195"},{sys:this.SYS,type:107,name:"SBS comfort drive"},{sys:this.SYS,type:108,name:"Primat kompakt SOBINCO"}];},createGateway:function createGateway(e,t,a){var n=DMError,s=DMError.ERROR_CODE;e?e.ip?a(null,e):a(new n(s.INVALID,"ip is invalid")):a(new n(s.INVALID,"info is invalid"));},updateGateway:function updateGateway(e,t,a,n){var s=DMError,o=DMError.ERROR_CODE;t?t.ip?n(null,t):n(new s(o.INVALID,"ip is invalid")):n(new s(o.INVALID,"update is invalid"));},deleteGateway:function deleteGateway(e,t,a){a();},createDevice:function createDevice(e,t,a){var n=DMError,s=DMError.ERROR_CODE;if(e){if(e.gateway){if(null!=e.address&&void 0!==e.address){if(null!=e.type&&void 0!==e.type){var o,r,i=t.data.gateways;for(o=0;o<i.length;o++){if(i[o].index===e.gateway){r=i[o];break;}}r?a(null,e):a(new n(s.NOT_FOUND,"gateway with index "+e.gateway+" not exists"));}else a(new n(s.INVALID,"type is invalid"));}else a(new n(s.INVALID,"address is invalid"));}else a(new n(s.INVALID,"gateway is invalid"));}else a(new n(s.INVALID,"info is invalid"));},updateDevice:function updateDevice(e,t,a){var n=DMError,s=DMError.ERROR_CODE;if(e){if(e.gateway){if(null!=e.address&&void 0!==e.address){if(null!=e.type&&void 0!==e.type){var o,r,i=t.data.gateways;for(o=0;o<i.length;o++){if(i[o].index===e.gateway){r=i[o];break;}}r?a(null,e):a(new n(s.NOT_FOUND,"gateway with index "+e.gateway+" not exists"));}else a(new n(s.INVALID,"type is invalid"));}else a(new n(s.INVALID,"address is invalid"));}else a(new n(s.INVALID,"gateway is invalid"));}else a(new n(s.INVALID,"info is invalid"));},deleteDevice:function deleteDevice(e,t,a){a();},applyUIFilter:function applyUIFilter(e,t){var a=this,_doFilterArr=function _doFilterArr(e,t,a){var n=[];return e.forEach(function(e){if("root"==e.type){var s=JSON.parse(JSON.stringify(e)),o=_doFilterArr(s.children,t,a);o&&o.length>0&&(s.children=o,n.push(s));}else if(function(e,t){if("*"==e)return!0;for(var a=!1,n=0;n<e.length;n++){if(e[n]==t){a=!0;break;}}return a;}(a.elems,e.type)){var r=JSON.parse(JSON.stringify(e));n.push(r);}}),n;},_filter=function _filter(e,t){var n=[],s=null,o=a.getCommandStatusMap(e);return o&&(s=function(e,t,a){var n=[];switch(a.catagory){case"command":e.command&&(n=_doFilterArr(e.command,t,a));break;case"status":e.status&&(n=_doFilterArr(e.status,t,a));}return n;}(o,e,t),n=n.concat(s)),n;};if(!e.sys)return null;var n=JSON.parse(JSON.stringify(e)),s=null;switch(t.catagory){case"command":s=_filter(e,t),n.command=s;break;case"status":s=_filter(e,t),n.status=s;break;default:return null;}return s&&0!=s.length?n:null;},getCommandStatusMap:function getCommandStatusMap(t){if(!t||void 0===t.type||null==t.type)return null;if(e[t.type])return e[t.type];var a=xnm.aio.hautau.Gateway.DEVICETYPE_MAP[t.type];return a?e[a]:null;}};}(),xnm.aio.hautau.RulesManager=function(){},xnm.aio.hautau.RulesManager.prototype.getDeviceChannels=function(e,t,a){var n=[];return"drive"!=t&&"ska20cd"!=t&&"hscd"!=t&&"hscdi"!=t||"action"==a&&(n=["state"]),n;},xnm.aio.hautau.RulesManager.prototype.getCommands=function(e,t,a,n){var s=[];if(("drive"==t||"ska20cd"==t||"hscd"==t||"hscdi"==t)&&"action"==a)for(var o=xnm.aio.hautau.DM.getCommandStatusMap({type:t}).command,r=0;r<o.length;r++){s.push({action:"",id:window.XC_Text[o[r].name],subtype:"command",sys:"hautau",type:"action",value:o[r].ref.value});}return s;},xnm.aio.hautau.Handler=function(){var Handler=function Handler(){};return Handler.prototype.Gateway=xnm.aio.hautau.Gateway,Handler.prototype.devicemanager=xnm.aio.hautau.DM,Handler.prototype.RulesManager=xnm.aio.hautau.RulesManager,Handler.prototype.registModule=function(e){e.register(this.devicemanager.SYS,"hautau");},Handler.prototype.resolveGateway=function(e){return e?this.Gateway.parseJSON(e):null;},Handler.prototype.getDeviceCommands=function(e,t){var a=this.devicemanager.applyUIFilter(e,{catagory:"command",elems:"*"}),n=a?a.command:[];t&&t(null,n);},Handler.prototype.getDeviceStatus=function(e,t){var a=this.devicemanager.applyUIFilter(e,{catagory:"status",elems:"*"}),n=a?a.status:[];t&&t(null,n);},Handler.prototype.doCommand=function(e,t,a,n){var s=this.resolveGateway(e);s?s.executeCommandCreator(t,a,function(e){n&&n(e);}):n&&n(new Error("gateway json format invalid"));},Handler.prototype.doStatus=function(e,t,a,n,s){var o=this.resolveGateway(t);if(o){var r=[{id:e,device:a,status:n}];o.getStatesCreator(null,r,function(e,t){e?s&&s(e):s&&s(null,t[0]);});}else s&&s(new Error("device json format invalid"));},Handler.prototype.getDeviceList=function(e,t,a){var n=this.resolveGateway(e);n?n.listDevices(t,function(e,t){a&&a(e,t);}):a&&a(new Error("gateway json format invalid"));},Handler.prototype.getDeviceCommandList=function(e){},Handler.prototype.discoverWithTimeout=function(e,t){var a=require("x.upnp.js"),n={};a.discoverDevicesWithTimeout(e,function(e){if(e.deviceType&&-1!=e.deviceType.indexOf("urn:hautau-de:device:WLAN-Box")){var t=new xnm.aio.hautau.Gateway(e.ip);n[e.ip]||(n[e.ip]=t);}}),setTimeout(function(){var e=[];for(var a in n){e.push(n[a]);}t&&t(null,e);},e);},Handler;}(),"undefined"!=typeof module&&null!=module&&(module.exports=new xnm.aio.hautau.Handler());