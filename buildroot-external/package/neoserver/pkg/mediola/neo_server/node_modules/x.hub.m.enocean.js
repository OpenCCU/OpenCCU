var util=require("util"),EventEmitter=require("events"),crypto=require("crypto"),fs_extra=require("fs-extra"),fileman=require("x.hub.fileman.js"),x=x||{};x.hub=x.hub||{},x.hub.m=x.hub.m||{},x.hub.m.enocean=x.hub.m.enocean||{},x.hub.m.enocean.SENDER_ID=null,x.hub.m.enocean.MANUFACTURE_ID=2047,x.hub.m.enocean._CRC8Table=[0,7,14,9,28,27,18,21,56,63,54,49,36,35,42,45,112,119,126,121,108,107,98,101,72,79,70,65,84,83,90,93,224,231,238,233,252,251,242,245,216,223,214,209,196,195,202,205,144,151,158,153,140,139,130,133,168,175,166,161,180,179,186,189,199,192,201,206,219,220,213,210,255,248,241,246,227,228,237,234,183,176,185,190,171,172,165,162,143,136,129,134,147,148,157,154,39,32,41,46,59,60,53,50,31,24,17,22,3,4,13,10,87,80,89,94,75,76,69,66,111,104,97,102,115,116,125,122,137,142,135,128,149,146,155,156,177,182,191,184,173,170,163,164,249,254,247,240,229,226,235,236,193,198,207,200,221,218,211,212,105,110,103,96,117,114,123,124,81,86,95,88,77,74,67,68,25,30,23,16,5,2,11,12,33,38,47,40,61,58,51,52,78,73,64,71,82,85,92,91,118,113,120,127,106,109,100,99,62,57,48,55,34,37,44,43,6,1,8,15,26,29,20,19,174,169,160,167,178,181,188,187,150,145,152,159,138,141,132,131,222,217,208,215,194,197,204,203,230,225,232,239,250,253,244,243],x.hub.m.enocean.CRC8=function(e){for(var t=0,a=0;a<e.length;a++){t=x.hub.m.enocean._CRC8Table[t^e[a]];}return t;},x.hub.m.enocean.Serial=function(){var Serial=function Serial(e,t){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.Serial.("+e+")"),this._port=e,this._serialPort=null,this._baudrate=t,this._baudrate||(this._baudrate=57600);};return Serial.prototype.getPort=function(){return this._port;},Serial.prototype.setListener=function(e){this._listener=e;},Serial.prototype.open=function(e){if(this._serialPort)return this._logger.log("warn","port:"+this._port+" already opened"),void(e&&e());var t=e;try{this._logger.log("trace","try to listen to port:"+this._port);var a,r=require("serialport");if(!r)return this._logger.log("warn","no seiralport module"),void(e&&e(new Error("no seiralport modul")));a=r.SerialPort?new r.SerialPort(this._port,{baudrate:this._baudrate}):new r(this._port,{baudRate:this._baudrate});var n=this;a.on("open",function(){n._logger.log("trace","port:"+n._port+" opened"),n._serialPort=a,a.flush(function(){t&&t(),t=null;});}),a.on("error",function(e){n._logger.log("warn","enocean error:"+e.message),n._serialPort=null,t?(t&&t(e),t=null):n._listener&&n._listener.onSerialError&&n._listener.onSerialError(e);}),a.on("data",function(e){n._logger.log("trace","receive data "+e.toString("hex")),n._listener&&n._listener.onSerialData&&n._listener.onSerialData(e);}),a.on("close",function(){n._logger.log("trace","port closed");});}catch(e){this._logger.log("warn","init enocean via "+this._port+" error:"+e.message),t&&t(e),t=null;}},Serial.prototype.close=function(){this._listener=null;try{this._serialPort&&this._serialPort.close();}catch(e){this._logger.log("warn","close enocean via "+this._port+" error:"+e.message);}this._serialPort=null;},Serial.prototype.sendPacket=function(e,t){this._serialPort?this._serialPort.write(e,t):t&&t(new Error("port not opened"));},Serial;}(),x.hub.m.enocean.ReComm=function(){var ReComm=function ReComm(e){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.ReComm"),this._esp3=e;};return ReComm.prototype.sendRawSysEx=function(e,t,a,r){var n=this,s=new x.hub.m.enocean.ESP3.Telegram.ADT(197,e,t,a);this._esp3.sendTelegram(s,!0,function(e,t){setTimeout(function(){return e?(n._logger.log("warn","ReComm command failed with err:"+e.message),void(r&&r(e))):t&&0!=t.retCode?(n._logger.log("warn","ReComm command failed with retCode:"+t.retCode),(e=new Error("ReComm command failed:"+t.retCode)).code=t.retCode,void(r&&r(e,t))):void(r&&r(null,t));},50);});},ReComm;}(),x.hub.m.enocean.SecurityHandler=function(){var e=new Buffer("3410de8f1aba3eff9f5a117172eacabd","hex"),Handler=function Handler(){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.SecurityHandler"),this._secInfo={},this._unsync={};};return Handler.prototype.SECURITY_FILE="enocean_sec.json",Handler.prototype.init=function(e){this._logger.log("trace","init");var t=this;this._loadSec(function(a,r){a&&t._logger.log("warn","init error:"+a.message),r&&(t._secInfo=r),e&&e();});},Handler.prototype.getUnsyncDevice=function(){return this._unsync;},Handler.prototype.isSecureDevice=function(e){return this._secInfo[e];},Handler.prototype.secureTeachIn=function(e,t,a){this._logger.log("trace","secure teach-in:"+e),e&&(t.key&&delete t.key,this._secInfo[e]=t),this._saveSec(this._secInfo,a);},Handler.prototype.resolve=function(e){if(!e)return null;switch(e.rorg){case 53:return this._resolveSecureTeachIn(e);case 49:return this._resolveSecureMessage(e);default:return null;}},Handler.prototype._resolveSecureTeachIn=function(e){var t={},a=e.userData,r=a.readUInt8(0);if(t.teachInInfo={},t.teachInInfo.idx=r>>6&3,t.teachInInfo.cnt=r>>4&3,t.teachInInfo.psk=r>>3&1,t.teachInInfo.type=r>>2&1,t.teachInInfo.info=3&r,0==t.teachInInfo.idx){var n=a.readUInt8(1);t.slf={},t.slf.rlc_algo=n>>6&3,t.slf.rlc_tx=n>>5&1,t.slf.mac_alro=n>>3&3,t.slf.data_enc=7&n;var s=0;1==t.slf.rlc_algo?s=2:2==t.slf.rlc_algo&&(s=3),s&&(t.rlc=a.slice(2,2+s)),t.key=a.slice(2+s),t.completeKey=null;}else t.key=a.slice(1);return t;},Handler.prototype._resolveSecureMessage=function(t){var a=t.senderID,r=this._secInfo[a];if(!r)return null;if(!r.completeKey)return null;var n=0,s=0;1==r.slf.mac_alro?n=3:2==r.slf.mac_alro&&(n=4),1==r.slf.rlc_tx&&(1==r.slf.rlc_algo?s=2:2==r.slf.rlc_algo&&(s=3));var o,i=t.userData.length-n-s,l=t.userData.slice(0,i),u=null,c=null;s&&(c=t.userData.slice(i,i+s)),n&&(u=t.userData.slice(i+s)),o=c||r.rlc;var h=!1,_=!0;if(u){var p=this.checkCmac(t.rorg,l,o,r.completeKey,u);p.rlc&&o.toString("hex")!=p.rlc.toString("hex")&&(o=p.rlc,r.rlc=p.rlc,h=!0),p&&p.ok?(this._logger.log("trace","receive from "+a+" with cmac rlc:"+o.toString("hex")),delete this._unsync[a]):(_=!1,this._logger.log("warn","receive from "+a+" with cmac out of snyc, last rlc:"+o.toString("hex")),this._unsync[a]=o.toString("hex"));}var d=null;if(_&&3==r.slf.data_enc){var v=this.decryptVAES(o,e,r.completeKey,l);d=t.convertToPacket(v).toRadioTelegram();}return r.rlc=this._incRLC(o),h=!0,this._logger.log("trace","senderID next rlc:"+r.rlc.toString("hex")),h&&this._saveSec(this._secInfo),d;},Handler.prototype.decryptVAES=function(e,t,a,r){for(var n=r.length,s=Math.ceil(n/16),o=[],i=null,l=0;l<s;l++){var u=16*l,c=u+16;c>n&&(c=n);var h=r.slice(u,c),_=this._doVAESblock(e,t,a,i,h);o.push(_.data),i=_.enc;}return Buffer.concat(o);},Handler.prototype._doVAESblock=function(e,t,a,r,n){var s=this._xor(e,t);r&&(s=this._xor(s,r));var o=this._doAES128(a,null,s),i=this._xor(o,n);return{data:i=i.slice(0,n.length),enc:o};},Handler.prototype.checkCmac=function(e,t,a,r,n){if(a){for(var s=this._bufToInt(a),o=0;o<128;o++){if(0!=o){s+=1;var i=65535;3==a.length&&(i=16777215),s>i&&(s=0);}var l=this._intToBuf(s,a.length);if(this.calcCmac(e,t,l,r,n.length).toString("hex")==n.toString("hex"))return{ok:!0,rlc:this._intToBuf(s,a.length)};}return{ok:!1,rlc:this._intToBuf(s,a.length)};}return this.calcCmac(e,t,null,r,n.length).toString("hex")==n.toString("hex")?{ok:!0}:{ok:!1};},Handler.prototype.calcCmac=function(e,t,a,r,n){var s=this._getCmacSubkey(r),o=new Buffer(1);o.writeUInt8(e),o=Buffer.concat([o,t]),a&&(o=Buffer.concat([o,a]));for(var i,l=o.length,u=Math.ceil(l/16),c=null,h=0;h<u;h++){var _=16*h,p=_+16;p>l&&(p=l);var d=o.slice(_,p);c=i=this._doCmacBlock(r,s.k1,s.k2,d,c);}return i.slice(0,n);},Handler.prototype._doCmacBlock=function(e,t,a,r,n){for(var s=new Buffer(16),o=0;o<16;o++){o<r.length?s.writeUInt8(r.readUInt8(o),o):o==r.length?s.writeUInt8(128,o):s.writeUInt8(0,o);}return n&&(s=this._xor(s,n)),s=r.length<16?this._xor(s,a):this._xor(s,t),this._doAES128(e,null,s);},Handler.prototype._getCmacSubkey=function(e){var t,a,r=new Buffer("00000000000000000000000000000000","hex"),n=new Buffer("00000000000000000000000000000087","hex"),s=this._doAES128(e,null,r);return t=new Buffer(s.toString("hex"),"hex"),this._bufShiftLeft(t,1),128&s.readUInt8(0)&&(t=this._xor(t,n)),a=new Buffer(t.toString("hex"),"hex"),this._bufShiftLeft(a,1),128&t.readUInt8(0)&&(a=this._xor(a,n)),{k1:t,k2:a};},Handler.prototype._doAES128=function(e,t,a){t||(t=new Buffer("00000000000000000000000000000000","hex"));var r=crypto.createCipheriv("aes128",e,t);r.setAutoPadding(!1);var n=r.update(a),s=r["final"]();return Buffer.concat([n,s]);},Handler.prototype._xor=function(e,t){for(var a=Math.max(e.length,t.length),r=new Buffer(a),n=0;n<a;n++){var s,o=0,i=0;n<e.length&&(o=e.readUInt8(n)),n<t.length&&(i=t.readUInt8(n)),s=o^i,r.writeUInt8(s,n);}return r;},Handler.prototype._bufShiftLeft=function(e,t){if(t!==(0|t))throw new Error("shiftBits must be a 32 bit int");for(var a=2*((t>>4)+(0!=(15&t))),r=8*a-t,n=0,s=0;s-a<e.length;s+=2){if(n<<=16,s<e.length-1?n|=e.readUInt16BE(s):s<e.length&&(n|=e[s]<<8),s-a>=0){if(s-a<e.length-1)e.writeUInt16BE(n>>>r&65535,s-a);else{if(s-a!=e.length-1)throw new Error();e[s-a]=n>>>r+8;}}else s-a==-1&&(e[0]=n>>>r);}},Handler.prototype._bufToInt=function(e){var t=e.toString("hex");return parseInt(t,16);},Handler.prototype._intToBuf=function(e,t){for(var a=e.toString(16);a.length<2*t;){a="0"+a;}return new Buffer(a,"hex");},Handler.prototype._incRLC=function(e){var t=this._bufToInt(e);t+=1;var a=65535;return 3==e.length&&(a=16777215),t>a&&(t=0),this._intToBuf(t,e.length);},Handler.prototype._getFile=function(){var e=require("x.hub.fileman.js").fileManager,t=require("path"),a=(require("fs"),e.getUserRootDataPath());return t.resolve(a,this.SECURITY_FILE);},Handler.prototype._loadSec=function(e){var t=this._getFile();fs_extra.ensureFile(t,function(a){a?e&&e(a):fs_extra.readFile(t,"utf8",function(t,a){if(t)e&&e(t);else{var r;try{for(var n in r=JSON.parse(a)){if(r.hasOwnProperty(n)){var s=r[n];s.rlc&&(s.rlc=new Buffer(s.rlc,"hex")),s.completeKey&&(s.completeKey=new Buffer(s.completeKey,"hex"));}}}catch(e){}e&&e(null,r);}});});},Handler.prototype._saveSec=function(e,t){var a=this._getFile(),r={};for(var n in e){r[n]={},r[n].teachInInfo=e[n].teachInInfo,r[n].slf=e[n].slf,r[n].rlc=e[n].rlc.toString("hex"),r[n].completeKey=e[n].completeKey.toString("hex");}fs_extra.writeFile(a,JSON.stringify(r,null,2),function(e){t&&t(e);});},Handler;}(),x.hub.m.enocean.LearnHandler=function(){var e,t=((e=function e(_e){this._handler=_e;}).prototype.onTelegram=function(e){var t=this;if(176===e.rorg){if(!this._isProfileMatch(e.getManufacturerId(),e.getProductId()))return;var a={address:e.senderID,data:this._getLearnProfile(),vendor:this._getLearnVendor(),senderID:x.hub.m.enocean.SENDER_ID,gpInfo:e.toJSON()};0==e.purpose?this._handler._controller._deviceHandler.onLearnDevice(null,a,function(a,r){a?t._sendTeachInResponse(0,null,x.hub.m.enocean.SENDER_ID,e.senderID,function(){t._handler._learnFinish(a,-1,r);}):t._sendTeachInResponse(1,null,x.hub.m.enocean.SENDER_ID,e.senderID,function(){t._handler._learnFinish(a,0,r);});}):1==e.purpose?this._handler._controller._deviceHandler.deleteDevice(a,function(a,r){a?t._sendTeachInResponse(0,null,x.hub.m.enocean.SENDER_ID,e.senderID,function(){t._handler._learnFinish(a,-1,r);}):t._sendTeachInResponse(2,null,x.hub.m.enocean.SENDER_ID,e.senderID,function(){t._handler._learnFinish(a,1,r);});}):2==e.purpose&&this._handler._controller._deviceHandler.onLearnAddDeleteDevice(a,function(a,r,n){a?t._sendTeachInResponse(0,null,x.hub.m.enocean.SENDER_ID,e.senderID,function(){t._handler._learnFinish(a,r,n);}):t._sendTeachInResponse(0==r?1:2,null,x.hub.m.enocean.SENDER_ID,e.senderID,function(){t._handler._learnFinish(a,r,n);});});}},e.prototype._sendTeachInResponse=function(e,t,a,r,n){a||(a=x.hub.m.enocean.SENDER_ID);var s=new x.hub.m.enocean.ESP3.Telegram.GP_TR(2047,e,t,a,0);s.setDstId(r),this._handler._controller._esp3.sendTelegram(s,!0,function(e){n&&n(e);});},e.prototype._isProfileMatch=function(e,t){var a=this._handler._learnProfile;if(!a)return!0;if("gp"==a)return!0;var r=x.hub.m.enocean.profiles[a];if(!r)return!1;var n=new r();return n._data==a&&(!n.isGPMatch||n.isGPMatch(e,t));},e.prototype._getLearnProfile=function(){return this._handler._learnProfile?this._handler._learnProfile:"gp";},e.prototype._getLearnVendor=function(){return this._handler._learnVendor;},e),Handler=function Handler(e){this._controller=e,this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.LearnHandler"),this._learning=!1,this._learnCallback=null,this._learnProfile=null,this._learnAddress=null,this._learnSenderID=null,this._learnVendor=null,this._saParams=null,this._secTeachInFrames={},this._teaching=!1,this._teachCallback=null,this._teachProfile=null,this._teachID=null,this._teachSenderID=null,this._teachVendor=null,this._teachingTO=null;var a=this;this._teachinTelegramCB={_onEOTelegram:function _onEOTelegram(e){a.onTeachInResponseTelegram(e);}},this._gpLearn=new t(this);};return Handler.prototype.learn=function(e,t,a,r,n,s,o){if(this._learning)s&&s(new Error("learning process running"));else if(this._teaching)s&&s(new Error("teach-in process running"));else{if((!n||n<=0)&&(n=3e4),this._learning=!0,this._learnCallback=s,this._learnProfile=e?e.toLowerCase():null,this._learnAddress=t?t.toLowerCase():null,this._learnVendor=r||"general",this._learnSenderID=a?a.toLowerCase():null,this._secTeachInFrames={},this._saParams=null,e&&("bb-aa-cc"==e.toLowerCase()||"d2-06-10"==e.toLowerCase()||"d2-06-ff"==e.toLowerCase()||"smartguard2"==e.toLowerCase())&&(this._saParams={extended:1},o&&void 0!==o.saLearnMode&&null!=o.saLearnMode)){var i=parseInt(o.saLearnMode);isNaN(i)&&(i=1),i<0&&(i=1),i>2&&(i=1),this._saParams.extended=i;}var l=this;this._controller._esp3.startLearn(this,n,this._saParams,function(e){if(e){var t=l._learnCallback;l._learning=!1,l._learnProfile=null,l._learnCallback=null,l._secTeachInFrames={},t&&t(e);}});}},Handler.prototype.onLearnTimeout=function(){this._learnFinish(new Error("learn timeout"));},Handler.prototype.onTelegram=function(e){if(e){var t;if(this._learnProfile){var a=x.hub.m.enocean.profiles[this._learnProfile];if(a){var r=new a();if(r.handleLearnTelegram)return void r.handleLearnTelegram(this,e);}}switch(e.rorg){case 212:if(0==e.cmd)return void this._learnUTE(e);break;case 213:0==e.getLearnBit()&&this._learn1BS(e);break;case 165:0==e.getLearnBit()&&this._learn4BS(e);break;case 176:case 177:this._gpLearn.onTelegram(e);break;case 246:this._learnRPS(e);break;case 53:var n=this._controller._secHandler.resolve(e);t=e.senderID;var s=this._secTeachInFrames[t];if(this._logger.log("trace","ts"),this._logger.log("trace",n),n&&(n.teachInInfo&&0==n.teachInInfo.idx?(s||(this._secTeachInFrames[t]=[],s=this._secTeachInFrames[t]),s.push(n)):n.teachInInfo&&0!=n.teachInInfo.idx&&s&&s.push(n)),s&&s[0]){var o=s[0];if(o&&o.teachInInfo){var i=o.teachInInfo.cnt;if(i&&s.length==i){if(i>1){for(var l=[],u=0;u<s.length;u++){var c=s[u];l.push(c.key);}o.completeKey=Buffer.concat(l);}else o.completeKey=o.key;this._controller._secHandler.secureTeachIn(t,o);}}}}!1;}},Handler.prototype.onEvent=function(e){if(e&&e instanceof x.hub.m.enocean.ESP3.Event.SA_CONFIRM_LEARN){var t=e.getEEP();if(this._learnProfile&&!this._isLearningProfileEquals(t))return;var a=this._learnProfile?this._learnProfile:t;"d2-06-ff"==t&&"smartguard2"==this._learnProfile&&(a="d2-06-ff");var r,n=this,s=x.hub.m.enocean.profiles[a];s||(r=new x.hub.m.enocean.ESP3.Response.Response_OK_SA_CONFIRM_LEARN(500,17),this._controller._esp3.sendResponse(r,function(e){n._learnFinish(new Error("eep not supported"));})),s=new s();var o=e.getPMCandidateId();o||(o=s.UNIQUE_GATEWAY_SENDERID?this._controller._deviceHandler.getNextFreeSenderId():x.hub.m.enocean.SENDER_ID);var i={address:e.getSAClientId(),data:a,vendor:this._learnVendor,senderID:o,hopCount:e.getHopCount(),saLearnMode:this._saParams?this._saParams.extended:null,originalEEP:t};this._controller._deviceHandler.onLearnAddDeleteDevice(i,function(t,a,s){if(t)return r=new x.hub.m.enocean.ESP3.Response.Response_OK_SA_CONFIRM_LEARN(500,19),void n._controller._esp3.sendResponse(r,function(e){n._learnFinish(e);});var o=0;1==a&&(o=32);var i=128*(e.getHopCount()+1);r=new x.hub.m.enocean.ESP3.Response.Response_OK_SA_CONFIRM_LEARN(i,o),n._controller._esp3.sendResponse(r,function(e){n._learnFinish(e,a,s);});});}},Handler.prototype.onTeachInResponseTelegram=function(e){if(e&&this._teaching){var t=this;if(this._teachProfile){var a=x.hub.m.enocean.profiles[this._teachProfile];if(a){var r=new a();if(r.handleTeachinTelegram)return void r.handleTeachinTelegram(this,e);}}if(165===e.rorg)if(0==e.getLearnBit()&&1==e.getLearnStatus()){var n=e.getFunc(),s=e.getType();this._toProfileStr(165,n,s);if(1==e.getLearnResult())this._controller._deviceHandler.onLearnDevice({address:this._teachID,senderID:this._teachSenderID,data:this._teachProfile,vendor:this._teachVendor},{address:e.senderID,senderID:this._teachSenderID,data:this._teachProfile,vendor:this._teachVendor},function(e,a){t._teachFinish(e,a);});else if(0==e.getLearnResult()){var o=this._controller._deviceHandler.getDevice(this._teachID);t._teachFinish(null,o,1);}}}},Handler.prototype._learnRPS=function(e){var t=this._getRealProfile(this._learnProfile),a=this;t&&"f6"!=t.substr(0,2)||((t=this._learnProfile)||(t="f6-??-??"),this._controller._deviceHandler.onLearnDevice({address:this._learnAddress,senderID:this._learnSenderID,data:this._learnProfile,vendor:this._learnVendor},{address:e.senderID,senderID:this._learnSenderID,data:t,vendor:this._learnVendor},function(e,t){a._learnFinish(e,0,t);}));},Handler.prototype._learn1BS=function(e){var t=this,a=this._getRealProfile(this._learnProfile);a&&"d5"!=a.substr(0,2)||((a=this._learnProfile)||(a="d5-??-??"),this._controller._deviceHandler.onLearnDevice({address:this._learnAddress,senderID:this._learnSenderID,data:this._learnProfile,vendor:this._learnVendor},{address:e.senderID,senderID:this._learnSenderID,data:a,vendor:this._learnVendor},function(e,a){t._learnFinish(e,0,a);}));},Handler.prototype._learn4BS=function(e){if(0==e.getLearnType())this._learn4BSV1(e);else{var t=e.getFunc(),a=e.getType(),r=this._toProfileStr(165,t,a),n=x.hub.m.enocean.profiles[r];if(n)3==new n().TEACH_IN_VARIATION?this._learn4BSV3(e):this._learn4BSV2(e);}},Handler.prototype._learn4BSV1=function(e){var t=this._getRealProfile(this._learnProfile);if(t){if("a5"!=t.substr(0,2))return;var a=x.hub.m.enocean.profiles[this._learnProfile];if(!a)return;if(1!=new a().TEACH_IN_VARIATION)return;}var r=this;(t=this._learnProfile)||(t="a5-??-??"),this._controller._deviceHandler.onLearnDevice({address:this._learnAddress,senderID:this._learnSenderID,data:this._learnProfile,vendor:this._learnVendor},{address:e.senderID,senderID:this._learnSenderID,data:t,vendor:this._learnVendor},function(e,t){r._learnFinish(e,0,t);});},Handler.prototype._learn4BSV2=function(e){var t=e.getFunc(),a=e.getType(),r=this._toProfileStr(165,t,a);if(!this._learnProfile||this._isLearningProfileEquals(r)){r=this._learnProfile?this._learnProfile:r;var n=x.hub.m.enocean.profiles[r];if(n)if(3!=new n().TEACH_IN_VARIATION){var s=this,o=r;this._controller._deviceHandler.onLearnDevice({address:this._learnAddress,senderID:this._learnSenderID,data:this._learnProfile,vendor:this._learnVendor},{address:e.senderID,senderID:this._learnSenderID,data:o,vendor:this._learnVendor},function(e,t){s._learnFinish(e,0,t);});}else this._learn4BSV3(e);}},Handler.prototype._learn4BSV3=function(e){var t=e.getFunc(),a=e.getType(),r=this._toProfileStr(165,t,a);if(!this._learnProfile||this._isLearningProfileEquals(r)){r=this._learnProfile?this._learnProfile:r;var n=x.hub.m.enocean.profiles[r],s=this;if(n){n=new n();var o=s._learnSenderID;!o&&n.UNIQUE_GATEWAY_SENDERID&&(o=require("x.hub.m.enocean.js")._deviceHandler.getNextFreeSenderId()),this._controller._deviceHandler.onLearnDevice({address:this._learnAddress,senderID:o,data:this._learnProfile,vendor:this._learnVendor},{address:e.senderID,senderID:o,data:r,vendor:this._learnVendor},function(t,a){t?s._send4BSResponse(null,1,0,e,function(){s._learnFinish(t,0,a);}):s._send4BSResponse(o,1,1,e,function(){s._learnFinish(null,0,a);});});}else this._send4BSResponse(null,0,0,e,function(){s._learnFinish(new Error("eep not supported"));});}},Handler.prototype._send4BSResponse=function(e,t,a,r,n){e||(e=x.hub.m.enocean.SENDER_ID);var s=r.getFunc(),o=r.getType(),i=(r.getManufacturerId(),(63&s)<<2|o>>5&3),l=(31&o)<<3|x.hub.m.enocean.MANUFACTURE_ID>>8&7,u=255&x.hub.m.enocean.MANUFACTURE_ID,c=16|(128|t<<6|a<<5),h=new x.hub.m.enocean.ESP3.Telegram.BS4(new Buffer([i,l,u,c]),e,0);h.setDstId(r.senderID),this._controller._esp3.sendTelegram(h,!0,function(e){n&&n(e);});},Handler.prototype._learnUTE=function(e){var t,a=this._toProfileStr(e.eepRorg,e.eepFunc,e.eepType),r=this;if(!this._learnProfile||this._isLearningProfileEquals(a)){a=this._learnProfile?this._learnProfile:a;var n=x.hub.m.enocean.profiles[a];if(n){n=new n(),(t=this._learnSenderID)||(t=n.UNIQUE_GATEWAY_SENDERID?require("x.hub.m.enocean.js")._deviceHandler.getNextFreeSenderId():x.hub.m.enocean.SENDER_ID);var s={address:e.senderID,data:a,vendor:this._learnVendor,senderID:t};switch(e.subtype){case 0:this._controller._deviceHandler.onLearnDevice({address:this._learnAddress,senderID:this._learnSenderID,data:this._learnProfile,vendor:this._learnVendor},s,function(a,n){if(0==e.rspExpected){var s=0;a&&404==a.errorCode?s=3:a||(s=1),r._sendUTEResponse(t,s,e,function(){r._learnFinish(a,0,n);});}else r._learnFinish(a,0,n);});break;case 1:this._controller._deviceHandler.deleteDevice(s,function(a,n){if(0==e.rspExpected){var s=0;a&&404==a.errorCode?s=3:a||(s=2),r._sendUTEResponse(t,s,e,function(){r._learnFinish(a,1,n);});}else r._learnFinish(a,1,n);});break;case 2:this._controller._deviceHandler.onLearnAddDeleteDevice(s,function(a,n,s){if(0==e.rspExpected){var o=0;a&&404==a.errorCode?o=3:a||(0==n?o=1:1==n&&(o=2)),r._sendUTEResponse(t,o,e,function(){r._learnFinish(a,n,s);});}else r._learnFinish(a,n,s);});}}}},Handler.prototype._sendUTEResponse=function(e,t,a,r){e||(e=x.hub.m.enocean.SENDER_ID);var n=new x.hub.m.enocean.ESP3.Telegram.UTE(1,a.ute,0,t,a.numChannel,a.manufactureID,a.eepType,a.eepFunc,a.eepRorg,e,0);n.setDstId(a.senderID),this._controller._esp3.sendTelegram(n,!0,function(e){r&&r(e);});},Handler.prototype._learnFinish=function(e,t,a){var r=this._learnCallback;this._learning=!1,this._learnCallback=null,this._learnProfile=null,this._learnAddress=null,this._learnSenderID=null,this._learnVendor=null,this._secTeachInFrames={};var n=this._saParams;this._saParams=null,this._controller._esp3.stopLearn(this,n,function(){}),r&&r(e,t,a),!e&&0==t&&a&&a.init&&setTimeout(function(){a.init();},1e3);},Handler.prototype._toProfileStr=function(e,t,a){for(var r=e.toString(16);r.length<2;){r="0"+r;}for(var n=t.toString(16);n.length<2;){n="0"+n;}for(var s=a.toString(16);s.length<2;){s="0"+s;}return(r+"-"+n+"-"+s).toLowerCase();},Handler.prototype._fromProfileStr=function(e){var t=e.split("-");return{rorg:parseInt(t[0],16),func:parseInt(t[1],16),type:parseInt(t[2],16)};},Handler.prototype._getRealProfile=function(e){if(!e)return null;var t=x.hub.m.enocean.profiles[e];if(!t)return e;var a=new t();return a._eepAlias?a._eepAlias:e;},Handler.prototype._isLearningProfileEquals=function(e){if(!this._learnProfile)return!1;if(this._learnProfile==e)return!0;if("bb-aa-cc"==this._learnProfile&&"d2-06-10"==e)return!0;if("d2-06-10"==this._learnProfile&&"bb-aa-cc"==e)return!0;if("smartguard2"==this._learnProfile&&"d2-06-11"==e)return!0;if("smartguard2"==this._learnProfile&&"d2-06-ff"==e)return!0;var t=x.hub.m.enocean.profiles[this._learnProfile];return!!t&&new t()._eepAlias==e;},Handler.prototype.teachin=function(e,t,a,r,n){if(this._teaching)n&&n(new Error("teach-in process running"));else if(this._learning)n&&n(new Error("learning process running"));else if(e){e=e.toLowerCase(),t||(t=this._controller._deviceHandler.getNextFreeAddress());var s=this;this._teachCallback=n,this._teachProfile=e,this._teachID=t,this._teachSenderID=a,this._teachVendor=r||"general",this._teaching=!0,this._teachingTO=setTimeout(function(){s._teachFinish(new Error("teach-in timeout"));},3e4);var o,i=e,l=x.hub.m.enocean.profiles[i];if(l&&((l=new l()).getTeachinType&&(o=l.getTeachinType()),l.isTeachinBidirectional&&l.isTeachinBidirectional()),o||(i=this._getRealProfile(i),(l=x.hub.m.enocean.profiles[i])&&((l=new l()).getTeachinType&&(o=l.getTeachinType()),l.isTeachinBidirectional&&l.isTeachinBidirectional())),!o)switch(i.substr(0,2)){case"f6":o="RPS";break;case"d5":o="1BS";break;case"a5":o="4BS";}switch(o){case"RPS":this._teachinRPS(e,t,a);break;case"1BS":this._teachin1BS(e,t,a);break;case"4BS":this._teachin4BS(e,t,a);break;case"UTE":this._teachinUTE(e,t,a);break;default:this._teachFinish(new Error("profile not supported"));}}else n&&n(new Error("profile is null"));},Handler.prototype._teachinRPS=function(e,t,a){this._teachFinish(new Error("RPS teach-in should be done by execute command directly"));},Handler.prototype._teachin1BS=function(e,t,a){},Handler.prototype._teachin4BS=function(e,t,a){var r=2,n=e,s=x.hub.m.enocean.profiles[n];switch(s?r=new s().TEACH_IN_VARIATION:(n=this._getRealProfile(n),(s=x.hub.m.enocean.profiles[e])&&(r=new s().TEACH_IN_VARIATION)),r){case 1:this._teachin4BSV1(e,t,a);break;case 2:this._teachin4BSV2(e,t,a);break;case 3:this._teachin4BSV3(e,t,a);break;default:this._teachFinish(new Error("no supported"));}},Handler.prototype._teachin4BSV1=function(e,t,a){},Handler.prototype._teachin4BSV2=function(e,t,a){var r=a;if(a||(r=require("x.hub.m.enocean.js")._deviceHandler.getNextFreeSenderId())){var n,s=e,o=x.hub.m.enocean.profiles[s];if(o||(s=this._getRealProfile(s),o=x.hub.m.enocean.profiles[e]),o&&(o=new o())._eepAlias&&(e=o._eepAlias),o&&o.getTeachinTelegram)n=o.getTeachinTelegram(t,r,x.hub.m.enocean.MANUFACTURE_ID);else{var i=this._fromProfileStr(e),l=(63&i.func)<<2|i.type>>6&2,u=(31&i.type)<<3|x.hub.m.enocean.MANUFACTURE_ID>>8&7,c=255&x.hub.m.enocean.MANUFACTURE_ID,h=new Buffer([l,u,c,128]);n=new x.hub.m.enocean.ESP3.Telegram.BS4(h,r,0);}var _=this;this._controller._esp3.sendTelegram(n,!0,function(e){e?_._teachFinish(e):(t||(t=r),_._controller._deviceHandler.addDevice({address:t,data:_._teachProfile,senderID:r,vendor:_._teachVendor},function(e,t){_._teachFinish(e,t);}));});}else this._teachFinish(new Error("no more sender ID available"));},Handler.prototype._teachin4BSV3=function(e,t,a){var r=a;if(!a){if(!(r=require("x.hub.m.enocean.js")._deviceHandler.getNextFreeSenderId()))return void this._teachFinish(new Error("no more sender ID available"));this._teachSenderID=r;}var n,s=e,o=x.hub.m.enocean.profiles[s];if(o||(s=this._getRealProfile(s),o=x.hub.m.enocean.profiles[e]),o&&(o=new o())._eepAlias&&(e=o._eepAlias),o&&o.getTeachinTelegram)n=o.getTeachinTelegram(t,r,x.hub.m.enocean.MANUFACTURE_ID);else{var i=this._fromProfileStr(e),l=(63&i.func)<<2|i.type>>6&2,u=(31&i.type)<<3|x.hub.m.enocean.MANUFACTURE_ID>>8&7,c=255&x.hub.m.enocean.MANUFACTURE_ID,h=new Buffer([l,u,c,128]);n=new x.hub.m.enocean.ESP3.Telegram.BS4(h,r,0);}var _=this;this._controller._esp3.addListener(this._teachinTelegramCB),this._controller._esp3.sendTelegram(n,!0,function(e){e&&_._teachFinish(e);});},Handler.prototype._teachinUTE=function(e,t,a){var r=a;if(!a){if(!(r=require("x.hub.m.enocean.js")._deviceHandler.getNextFreeSenderId()))return void this._teachFinish(new Error("no more sender ID available"));this._teachSenderID=r;}var n=e,s=x.hub.m.enocean.profiles[n];s||(n=this._getRealProfile(n),s=x.hub.m.enocean.profiles[e]),s&&(s=new s())._eepAlias&&(e=s._eepAlias);var o=e.split("-"),i=new x.hub.m.enocean.ESP3.Telegram.UTE(0,1,0,2,255,x.hub.m.enocean.MANUFACTURE_ID,parseInt(o[2],16),parseInt(o[1],16),parseInt(o[0],16),r,0);i.setDstId(reqTelegram.senderID),this._controller._esp3.sendTelegram(i,!0,function(e){e&&self._teachFinish(e);});},Handler.prototype._teachFinish=function(e,t,a){this._controller._esp3.removeListener(this._teachinTelegramCB);var r=this._teachCallback;this._teachingTO&&clearTimeout(this._teachingTO),this._teachingTO=null,this._teaching=!1,this._teachCallback=null,this._teachProfile=null,this._teachID=null,this._teachSenderID=null,this._teachVendor=null,this._saParams=null,r&&r(e,t,a);},Handler;}(),x.hub.m.enocean.DeviceHandler=function(){var D=function D(e){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.DeviceHandler"),this._controller=e,this._devices={};};return util.inherits(D,EventEmitter),D.prototype.SENSOR_FILE="enocean.json",D.prototype.UNKNOWN_PROFILE_ERR=404,D.prototype.ALREADY_EXISTS_ERR=400,D.prototype.init=function(e){this._logger.log("trace","init");var t=this;this._loadDevices(function(a,r){a&&t._logger.log("warn","init error:"+a.message),r&&(t._devices=r),t._initDevices(),e&&e();});},D.prototype._initDevices=function(){var e=Object.keys(this._devices),t=0,a=this,cb=function cb(){++t<e.length&&(a._devices[e[t]]&&a._devices[e[t]].init?a._devices[e[t]].init(cb):cb());};this._devices[e[t]]&&this._devices[e[t]].init?this._devices[e[t]].init(cb):cb();},D.prototype.getDevice=function(e){if(!e)return null;var t=this._devices[e];if(t)return t;var a=parseInt(e,16);for(a=(a-=1).toString(16);a.length<8;){a="0"+a;}return(t=this._devices[a])&&t instanceof x.hub.m.enocean.profiles.eltako_f6t?t:null;},D.prototype.getAllDevices=function(){return this._devices;},D.prototype.findDevice=function(e){return e&&e.address?this._devices[e.address]:null;},D.prototype.findDeviceWithData=function(e){if(!e)return null;var t=[];for(var a in this._devices){var r=this._devices[a];r&&r.getData()==e&&t.push(r);}return t;},D.prototype.addDevice=function(e,t){var a;if(!e||!e.data)return a=new Error("device json invalid"),void(t&&t(a));e.address||(e.address=this.getNextFreeAddress()),e.address=e.address.toLowerCase(),e.senderID&&(e.senderID=e.senderID.toLowerCase());var r=x.hub.m.enocean.profiles.parseJson(e);if(!r)return(a=new Error("unknow profile")).errorCode=this.UNKNOWN_PROFILE_ERR,void(t&&t(a));var n=r._address,s=this._devices[n];s&&s._data==r._data&&(r._states=s._states),this._devices[n]=r,this._saveDevices(this._devices,function(e){t&&t(e,r);});},D.prototype.updateDevice=function(e,t,a){var r;if(!e)return r=new Error("address invalid"),void(a&&a(r));if(!t||!t.data)return r=new Error("device json invalid"),void(a&&a(r));var n=this._devices[e];t.address||(t.address=e),t.address=t.address.toLowerCase(),t.senderID&&(t.senderID=t.senderID.toLowerCase());var s=x.hub.m.enocean.profiles.parseJson(t);if(!s)return(r=new Error("unknow profile")).errorCode=this.UNKNOWN_PROFILE_ERR,void(a&&a(r));n&&n._data==s._data&&(s._params=n._params,s._states=n._states),this._devices[t.address]=s,t.address!=e&&delete this._devices[e],this._saveDevices(this._devices,function(e){a&&a(e,s);});},D.prototype.deleteDevice=function(e,t){if(e&&e.address&&this._devices[e.address]){var a=this._devices[e.address];a&&a.finalize&&a.finalize();var r=this._devices[e.address];delete this._devices[e.address],this.emit("deleteDevice",r),this._saveDevices(this._devices,function(e){t&&t(e,a);});}else t&&t();},D.prototype.onLearnAddDeleteDevice=function(e,t){e&&e.address?this._devices[e.address]?this.deleteDevice(e,function(e,a){t&&t(e,1,a);}):this.onLearnDevice(null,e,function(e,a){t&&t(e,0,a);}):t&&t();},D.prototype.onLearnDevice=function(e,t,a){var r;if(!t||!t.address||!t.data)return r=new Error("device json invalid"),void(a&&a(r));var n=x.hub.m.enocean.profiles.parseJson(t);if(!n)return(r=new Error("unknow profile")).errorCode=this.UNKNOWN_PROFILE_ERR,void(a&&a(r));var s=t.address;if(this._devices[s]){var o=this._devices[s],i=o.toJSON();return i.data!=t.data||i.vendor!=t.vendor?((r=new Error("address "+t.address+" already exists, please delete it first")).errorCode=this.ALREADY_EXISTS_ERR,void(a&&a(r))):i.senderID!=t.senderID?(o._senderID=t.senderID,"bb-aa-cc"==o._data||"d2-06-10"==o._data||"d2-06-ff"==o._data||"smartguard2"==n._data?(o.executeCommand(null,{value:"alertOn"}),o.executeCommand(null,{value:"preAlarmOn"})):"afriso_water_eco"==n._data&&n.onLearn(),void this._saveDevices(this._devices,function(e){a&&a(e,o);})):void(a&&a(null,o));}if(e){var l=e.address;l&&l!=s&&this._devices[l]&&delete this._devices[l];}this._devices[s]=n,"bb-aa-cc"==n._data||"d2-06-10"==n._data||"d2-06-ff"==n._data||"smartguard2"==n._data?(n.executeCommand(null,{value:"alertOn"}),n.executeCommand(null,{value:"preAlarmOn"})):"afriso_water_eco"==n._data&&n.onLearn(),this._saveDevices(this._devices,function(e){a&&a(e,n);});},D.prototype.deviceParamsUpdated=function(e,t){this._saveDevices(this._devices,function(e){t&&t(e);});},D.prototype.isVirtual=function(e){var t=x.hub.m.enocean.SENDER_ID;if(!t)return!1;var a=parseInt(t,16)+1,r=parseInt(t,16)+128,n=parseInt(e,16);return n>=a&&n<=r;},D.prototype.getVirtualSenderID=function(){var e=x.hub.m.enocean.SENDER_ID;if(!e)return[];var t=parseInt(e,16)+1,a=parseInt(e,16)+128,r=[],n=this._devices;for(var s in n){var o=n[s];if(o&&o._senderID){var i=parseInt(o._senderID,16);i>=t&&i<=a&&r.push(i);}}return r;},D.prototype.getVirtualAddress=function(){var e=[],t=this._devices;for(var a in t){if("x"==a.charAt(0)){var r=parseInt(a.substr(1),16);r>=0&&r<=268435455&&e.push(a);}}return e;},D.prototype.getFreeSenderIdCount=function(){return 128-this.getVirtualSenderID().length;},D.prototype.getNextFreeSenderId=function(){var e=x.hub.m.enocean.SENDER_ID;if(!e)return null;for(var t=parseInt(e,16)+1,a=parseInt(e,16)+128,r=this.getVirtualSenderID(),n=null,s=t;s<=a;s++){if(-1==r.indexOf(s)){n=s;break;}}if(n)for(n=n.toString(16).toLowerCase();n.length<8;){n="0"+n;}return n;},D.prototype.getNextFreeAddress=function(){for(var e=this.getVirtualAddress(),t=null,a=0;a<=268435455;a++){for(var r=a.toString(16);r.length<7;){r="0"+r;}if(r="x"+r,-1==e.indexOf(r)){t=r;break;}}return t;},D.prototype.generateVirtual=function(e,t){if(e&&e.data){var a=e.senderID;if(a||(a=this.getNextFreeSenderId())){e.senderID=a,e.address=a,e.virtual=!0;var r=this.findDevice(e);if(r){var n=r.toJSON();return e.data!=n.data?void(t&&t(new Error("device of another type with the same address exists"))):e.vendor&&e.vendor!=n.vendor?void(t&&t(new Error("device of another vendor with the same address exists"))):void(t&&t(null,r));}var s=x.hub.m.enocean.profiles.parseJson(e);s?this.addDevice(s.toJSON(),function(e,a){t&&t(e,a);}):t&&t(new Error("unknow profile"));}else t&&t(new Error("no sender id available"));}else t&&t(new Error("query is null"));},D.prototype._getFile=function(){var e=fileman.fileManager,t=require("path"),a=e.getUserRootDataPath();return t.resolve(a,this.SENSOR_FILE);},D.prototype._loadDevices=function(e){var t=require("fs-extra"),a=this._getFile();t.ensureFile(a,function(r){r?e&&e(r):t.readFile(a,"utf8",function(t,a){if(t)e&&e(t);else if(a)try{var r={},n=JSON.parse(a);for(var s in n){var o=n[s],i=x.hub.m.enocean.profiles.parseDBJson(o);i&&(r[s]=i);}e&&e(null,r);}catch(t){e&&e(t);}else e&&e(null,{});});});},D.prototype._saveDevices=function(e,t){var a=this._getFile(),r={};for(var n in e){var s=e[n];r[n]=s.toDBJSON();}fs_extra.writeFile(a,JSON.stringify(r,null,2),function(e){t&&t(e);});},D;}(),x.hub.m.enocean.ESP3=function(){var ESP3_Frame=function ESP3_Frame(e,t,a){this.type=e,this.data=t,this.optData=a;};ESP3_Frame.TYPE={1:"RADIO_ERP1",2:"RESPONSE",3:"RADIO_SUB_TEL",4:"EVENT",5:"COMMAND_COMMAND",6:"SMART_ACK_COMMAND",7:"REMOTE_MAN_COMMAND",9:"RADIO_MESSAGE",10:"RADIO_ERP2",16:"RADIO_802_15_4",17:"COMMAND_2_4"},ESP3_Frame.prototype.toBuffer=function(){var e=new Buffer(6);e.writeUInt8(85,0),e.writeUInt16BE(this.data.length,1),e.writeUInt8(this.optData?this.optData.length:0,3),e.writeUInt8(this.type,4),e.writeUInt8(0,5);var t=x.hub.m.enocean.CRC8(e.slice(1,5));e.writeUInt8(t,5);var a=this.optData?Buffer.concat([this.data,this.optData],this.data.length+this.optData.length):this.data,r=x.hub.m.enocean.CRC8(a),n=Buffer.concat([e,a],6+a.length+1);return n.writeUInt8(r,n.length-1),n;},ESP3_Frame.prototype.toJSON=function(){return{dataLen:this.data.length,optLen:this.optData?this.optData.length:0,type:this.type,typeName:ESP3_Frame.TYPE[this.type],data:this.data.toString("hex"),optData:this.optData?this.optData.toString("hex"):null};},ESP3_Frame.prototype.toPacket=function(){return Packet.resolve(this);};var Packet=function Packet(){};Packet.resolve=function(e){switch(e.type){case 1:return RADIO_ERP1_Packet.resolve(e);case 2:return Response_Packet.resolve(e);case 4:return EVENT_Packet.resolve(e);case 5:return COMMAND_COMMAND_Packet.resolve(e);case 6:return SMART_ACK_COMMAND_Packet.resolve(e);default:return null;}};var Response_Packet=function Response_Packet(e,t,a){this.retCode=e,this.resData=t,this.optData=a;};Response_Packet.CODE={0:"RET_OK",1:"RET_ERROR",2:"RET_NOT_SUPPORTED",3:"RET_WRONG_PARAM",4:"RET_OPERATION_DENIED",5:"RET_LOCK_SET",6:"RET_BUFFER_TO_SMALL",7:"RET_NO_FREE_BUFFER"},Response_Packet.prototype.toJSON=function(){return{retCodeName:Response_Packet.CODE[this.retCode],retCode:this.retCode.toString(16),resData:this.resData?this.resData.toString("hex"):null,optData:this.optData?this.optData.toString("hex"):null};},Response_Packet.prototype.toFrame=function(){var e=new Buffer(1);return e.writeUInt8(this.retCode,0),this.resData&&(e=Buffer.concat([e,this.resData])),new ESP3_Frame(2,e,this.optData);},Response_Packet.prototype.toResponse=function(){return Response.resolve(this);},Response_Packet.resolve=function(e){var t,a,r;return t=e.data.readUInt8(0),e.data.length>1&&(a=e.data.slice(1)),r=e.optData,new Response_Packet(t,a,r);};var RADIO_ERP1_Packet=function RADIO_ERP1_Packet(e,t,a,r,n,s){this.data=e,this.hasOpt=t,t&&(this.subTelNum=a,this.dstId=r,this.dBm=n,this.securityLvl=s);};RADIO_ERP1_Packet.prototype.toJSON=function(){var e={data:this.data.toString("hex")};return this.hasOpt&&(e.subTelNum=this.subTelNum.toString(16),e.dstId=this.dstId,e.dBm=this.dBm.toString(16),e.securityLvl=this.securityLvl),e;},RADIO_ERP1_Packet.prototype.toFrame=function(){var e=this.data,t=null;return this.hasOpt&&(t=new Buffer([this.subTelNum]),t=Buffer.concat([t,new Buffer(this.dstId,"hex")]),t=Buffer.concat([t,new Buffer([this.dBm,this.securityLvl])])),new ESP3_Frame(1,e,t);},RADIO_ERP1_Packet.prototype.toRadioTelegram=function(){return Telegram.resolve(this);},RADIO_ERP1_Packet.resolve=function(e){var t,a,r,n,s=!1;return e.optData&&(s=!0,t=e.optData.readUInt8(0),a=e.optData.slice(1,5).toString("hex"),r=e.optData.readUInt8(5),n=e.optData.readUInt8(6)),new RADIO_ERP1_Packet(e.data,s,t,a,r,n);};var SMART_ACK_COMMAND_Packet=function SMART_ACK_COMMAND_Packet(e){this.data=e;};SMART_ACK_COMMAND_Packet.prototype.toJSON=function(){return{data:this.data.toString("hex")};},SMART_ACK_COMMAND_Packet.prototype.toFrame=function(){var e=this.data;return new ESP3_Frame(6,e,null);},SMART_ACK_COMMAND_Packet.prototype.toSACommand=function(){return SA_COMMAND.resolve(this);},SMART_ACK_COMMAND_Packet.resolve=function(e){return new SMART_ACK_COMMAND_Packet(e.data);};var COMMAND_COMMAND_Packet=function COMMAND_COMMAND_Packet(e){this.data=e;};COMMAND_COMMAND_Packet.prototype.toJSON=function(){return{data:this.data.toString("hex")};},COMMAND_COMMAND_Packet.prototype.toFrame=function(){var e=this.data;return new ESP3_Frame(5,e,null);},COMMAND_COMMAND_Packet.prototype.toCommandCommand=function(){return COMMAND_COMMAND.resolve(this);},COMMAND_COMMAND_Packet.resolve=function(e){return new COMMAND_COMMAND_Packet(e.data);};var EVENT_Packet=function EVENT_Packet(e){this.data=e;};EVENT_Packet.prototype.toJSON=function(){return{data:this.data.toString("hex")};},EVENT_Packet.prototype.toFrame=function(){var e=this.data;return new ESP3_Frame(4,e,null);},EVENT_Packet.prototype.toEvent=function(){return Event.resolve(this);},EVENT_Packet.resolve=function(e){return new EVENT_Packet(e.data);};var Telegram=function Telegram(e,t){this.rorg=e,this.optData=t,this.optData||(this.optData={subTelNum:1,dstId:"FFFFFFFF",dBm:255,securityLvl:0});};Telegram.prototype.setDstId=function(e){this.optData.dstId=e||"FFFFFFFF";},Telegram.resolve=function(e){if(!e.data)return null;switch(e.data.readUInt8(0)){case 208:return SIG.resolve(e);case 246:return RPS.resolve(e);case 213:return BS1.resolve(e);case 165:return BS4.resolve(e);case 210:return VLD.resolve(e);case 212:return UTE.resolve(e);case 53:return TS.resolve(e);case 49:return SM.resolve(e);case 64:return CDM.resolve(e);case 176:return a.resolve(e);case 178:return n.resolve(e);default:return null;}};var e,t,a=function(){var _getByte=function _getByte(e,t,a){a>=8&&(a=8),a<=0&&(a=1);var r=Math.floor(t/8),n=t%8,s=Math.pow(2,a)-1,o=0;return n+a>8?(o=16-n-a,e.readUInt16BE(r)>>o&s):(o=8-n-a,e.readUInt8(r)>>o&s);},ChnDef=function ChnDef(e){this.type=e;};ChnDef.prototype.getType=function(){return this.type;},ChnDef.resolve=function(e,t){if(t+2>8*e.length)return null;var a=_getByte(e,t,2),r=null;switch(a){case 0:r=TeachInChnDef.resovle(e,t);break;case 1:r={type:a,sigType:e.readUInt16BE(0)>>6&255,valueType:e.readUInt16BE(0)>>2&3,resolution:15&e.readUInt16BE(0),engMin:e.readUInt8(2),scalingMin:e.readUInt16BE(3)>>12&15,engMax:e.readUInt16BE(3)>>4&255,scalingMax:15&e.readUInt16BE(3)};break;case 2:r=FlagChnDef.resovle(e,t);break;case 3:r=EnumChnDef.resovle(e,t);}return r;};var TeachInChnDef=function TeachInChnDef(e,t,a){ChnDef.call(this,0),this.sigType=e,this.dataLen=t,this.data=a;};TeachInChnDef.prototype=new ChnDef(),TeachInChnDef.prototype.constructor=TeachInChnDef,TeachInChnDef.prototype.getBitLength=function(){return 2==this.sigType?50:(this.sigType,18);},TeachInChnDef.prototype.getProductID=function(){return 2==this.sigType&&this.data?this.data.readUInt32BE(0):null;},TeachInChnDef.resovle=function(e,t){if(t+18>8*e.legnth)return null;var a=_getByte(e,t+2,8),r=_getByte(e,t+10,8),n=null;if(2==a){if(t+50>8*e.legnth)return null;var s=new Buffer(4);s.writeUInt8(_getByte(e,t+18,8),0),s.writeUInt8(_getByte(e,t+26,8),1),s.writeUInt8(_getByte(e,t+34,8),2),s.writeUInt8(_getByte(e,t+42,8),3),n=s;}else 1==a&&(n=null);return new TeachInChnDef(a,r,n);};var DataChnDef=function DataChnDef(e,t,a,r,n,s,o){ChnDef.call(this,1),this.sigType=e,this.valueType=t,this.resolution=a,this.engMin=r,this.scalMin=n,this.engMax=s,this.scalMax=o;};(DataChnDef.prototype=new ChnDef()).constructor=DataChnDef,DataChnDef.prototype.getBitLength=function(){return 40;},DataChnDef.prototype.toJSON=function(){return{sigType:this.sigType,valueType:this.valueType,resolution:this.resolution,engMin:this.engMin,scalMin:this.scalMin,engMax:this.engMax,scalMax:this.scalMax};},DataChnDef.resovle=function(e,t){if(t+40>8*e.length)return null;var a=_getByte(e,t+2,8),r=_getByte(e,t+10,2),n=_getByte(e,t+12,4),s=_getByte(e,t+16,8),o=_getByte(e,t+24,4),i=_getByte(e,t+28,8),l=_getByte(e,t+36,4);return new DataChnDef(a,r,n,s,o,i,l);};var FlagChnDef=function FlagChnDef(e,t){ChnDef.call(this,2),this.sigType=e,this.valueType=t;};FlagChnDef.prototype=new ChnDef(),FlagChnDef.prototype.constructor=FlagChnDef,FlagChnDef.prototype.getBitLength=function(){return 12;},FlagChnDef.resovle=function(e,t){if(t+12>8*e.length)return null;var a=_getByte(e,t+2,8),r=_getByte(e,t+10,2);return new FlagChnDef(a,r);},FlagChnDef.prototype.toJSON=function(){return{sigType:this.sigType,valueType:this.valueType};};var EnumChnDef=function EnumChnDef(e,t,a){ChnDef.call(this,3),this.sigType=e,this.valueType=t,this.resolution=a;};EnumChnDef.prototype=new ChnDef(),EnumChnDef.prototype.constructor=EnumChnDef,EnumChnDef.prototype.getBitLength=function(){return 16;},EnumChnDef.prototype.toJSON=function(){return{sigType:this.sigType,valueType:this.valueType,resolution:this.resolution};},EnumChnDef.resovle=function(e,t){if(t+16>8*e.length)return null;var a=_getByte(e,t+2,8),r=_getByte(e,t+10,2),n=_getByte(e,t+12,4);return new EnumChnDef(a,r,n);};var TI=function TI(e,t,a){Telegram.call(this,176),this.manufacturerID=e,this.dataDirection=t,this.purpose=a,this.productID=null,this.outboudChannels={},this.inboundChannels={},this.senderID=null,this.status=null;};return(TI.prototype=new Telegram()).constructor=TI,TI.prototype.getManufacturerId=function(){return this.manufacturerID;},TI.prototype.getProductId=function(){return this.productID;},TI.prototype.toJSON=function(){var e={manufacturerID:this.manufacturerID,dataDirection:this.dataDirection,purpose:this.purpose,productID:this.productID,outboudChannels:{},inboundChannels:{}};for(var t in this.outboudChannels){e.outboudChannels[t]=this.outboudChannels[t].toJSON();}for(var t in this.inboundChannels){e.inboundChannels[t]=this.inboundChannels[t].toJSON();}return e;},TI.resolve=function(e){var t=e.data,a=t.readUInt16BE(1)>>5&2047,r=t.readUInt16BE(1)>>4&1,n=t.readUInt16BE(1)>>2&3,s=new TI(a,r,n),o=t.slice(3,t.length-5),i=t.slice(t.length-5,t.length-1),l=t.readUInt8(t.length-1);s.senderID=i.toString("hex"),s.status=l;for(var u=0,c=0,h=0;;){var _=ChnDef.resolve(o,c);if(!_)break;0==u?0==_.getType()?s.productID=_.getProductID():(s.outboudChannels[h]=_,h++,u=1):1==u?0==_.getType()?u=2:(s.outboudChannels[h]=_,h++,u=1):2==u&&(s.inboundChannels[h]=_,h++),c+=_.getBitLength();}return s;},TI;}(),r=(((e=function e(_e2,t,a,r,n){Telegram.call(this,177),this.manufacturerID=_e2,this.result=t,this.chnAcknoledgement=a,this.senderID=r,this.status=n;}).prototype=new Telegram()).constructor=e,e.prototype.toPacket=function(){var e=new Buffer(3);if(e.writeUInt8(this.rorg,0),e.writeUInt16BE(this.manufacturerID<<5|this.result<<3,1),3==this.result){var t=[];if(this.chnAcknoledgement){for(var a=Math.ceil(this.chnAcknoledgement.length/8),r=0;r<a.length;r++){t.push(0);}for(var n=0;n<this.chnAcknoledgement.length;n++){var s=Math.floor(n/8),o=8-n%8-1;t[s]=chnAcknoledgement[n]<<o|t[s];}}e=Buffer.concat([e,new Buffer(t)]);}e=Buffer.concat([e,new Buffer(this.senderID,"hex")]),e=Buffer.concat([e,new Buffer([this.status])]);var i=1,l="FFFFFFFF",u=255,c=0;return this.optData&&(i=this.optData.subTelNum,l=this.optData.dstId,u=this.optData.dBm,c=this.optData.securityLvl),new RADIO_ERP1_Packet(e,!0,i,l,u,c);},e.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),manufacturerID:this.manufacturerID.toString(16),result:this.result,chnAcknoledgement:this.chnAcknoledgement,senderID:this.senderID,receiverID:this.receiverID};},e),n=(((t=function t(e,_t,a){Telegram.call(this,178),this.data=e,this.senderID=_t,this.status=a;}).prototype=new Telegram()).constructor=t,t.prototype.toPacket=function(){var e=new Buffer(1);e.writeUInt8(this.rorg,0),this.data&&(e=Buffer.concat([e,this.data])),e=Buffer.concat([e,new Buffer(this.senderID,"hex")]),e=Buffer.concat([e,new Buffer([this.status])]);var t=1,a="FFFFFFFF",r=255,n=0;return this.optData&&(t=this.optData.subTelNum,a=this.optData.dstId,r=this.optData.dBm,n=this.optData.securityLvl),new RADIO_ERP1_Packet(e,!0,t,a,r,n);},t.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),data:this.data?this.data.toString("hex"):null,senderID:this.senderID,status:this.status};},t.resolve=function(e){var a=e.data,r=a.slice(1,a.length-5),n=a.slice(a.length-5,a.length-1),s=a.readUInt8(a.length-1);return new t(r,n.toString("hex"),s);},t),CDM=function CDM(e,t,a,r,n,s,o,i){Telegram.call(this,64,i),this.seq=e,this.idx=t,this.len=a,this.crorg=r,this.data=n,this.senderID=s,this.status=o;};CDM.prototype=new Telegram(),CDM.prototype.constructor=CDM,CDM.prototype.getSenderID=function(){return this.senderID;},CDM.prototype.getSeq=function(){return this.seq;},CDM.prototype.getIdx=function(){return this.idx;},CDM.prototype.getLen=function(){return this.len;},CDM.prototype.getCRORG=function(){return this.crorg;},CDM.prototype.getData=function(){return this.data;},CDM.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),seq:this.seq,idx:this.idx,len:this.len,crorg:this.crorg?this.crorg.toString(16):null,data:this.data.toString("hex"),senderID:this.senderID,status:this.status};},CDM.resolve=function(e){var t,a,r,n,s,o,i=e.data,l=i.readUInt8(1)>>6&3,u=63&i.readUInt8(1);return 0==u?(t=i.readUInt16BE(2),a=i.readUInt8(4),r=i.slice(5,i.length-5),n=i.slice(i.length-5,i.length-1).toString("hex"),s=i.readUInt8(i.length-1)):(t=null,a=null,r=i.slice(2,i.length-5),n=i.slice(i.length-5,i.length-1).toString("hex"),s=i.readUInt8(i.length-1)),e.hasOpt&&(o={subTelNum:e.subTelNum,dstId:e.dstId,dBm:e.dBm,securityLvl:e.securityLvl}),new CDM(l,u,t,a,r,n,s,o);};var SIG=function SIG(e,t,a,r){Telegram.call(this,208,r),this.messageIndex=e,this.userData=t,this.senderID=a;};SIG.prototype=new Telegram(),SIG.prototype.constructor=SIG,SIG.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),messageIndex:this.messageIndex,userData:this.userData?this.userData.toString("hex"):null,senderID:this.senderID};},SIG.prototype.toPacket=function(){var e=new Buffer(2);e.writeUInt8(this.rorg,0),e.writeUInt8(this.messageIndex,1),this.userData&&(e=Buffer.concat([e,this.userData])),e=Buffer.concat([e,new Buffer(this.senderID,"hex")]);var t=1,a="FFFFFFFF",r=255,n=0;return this.optData&&(t=this.optData.subTelNum,a=this.optData.dstId,r=this.optData.dBm,n=this.optData.securityLvl),new RADIO_ERP1_Packet(e,!0,t,a,r,n);},SIG.resolve=function(e){var t,a=e.data,r=a.readUInt8(1),n=null,s=null;switch(r){case 1:n=0,s=a.slice(2,6).toString("hex");break;case 4:case 6:n=a.slice(2,3),s=a.slice(3,7).toString("hex");}return e.hasOpt&&(t={subTelNum:e.subTelNum,dstId:e.dstId,dBm:e.dBm,securityLvl:e.securityLvl}),new SIG(r,n,s,t);};var RPS=function RPS(e,t,a,r,n,s){Telegram.call(this,246,s),this.userData=e||0,this.senderID=t,this.t21=a||0,this.nu=r||0,this.rc=n||0;};RPS.prototype=new Telegram(),RPS.prototype.constructor=RPS,RPS.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),userData:this.userData.toString(16),senderID:this.senderID,t21:this.t21,nu:this.nu,rc:this.rc};},RPS.prototype.toPacket=function(){var e=new Buffer(2);e.writeUInt8(this.rorg,0),e.writeUInt8(this.userData,1),e=Buffer.concat([e,new Buffer(this.senderID,"hex")]);var t=this.t21<<5|this.nu<<4||this.rc;e=Buffer.concat([e,new Buffer([t])]);var a=1,r="FFFFFFFF",n=255,s=0;return this.optData&&(a=this.optData.subTelNum,r=this.optData.dstId,n=this.optData.dBm,s=this.optData.securityLvl),new RADIO_ERP1_Packet(e,!0,a,r,n,s);},RPS.resolve=function(e){var t,a=e.data,r=a.readUInt8(1),n=a.slice(2,6).toString("hex"),s=a.readUInt8(6)>>5&1,o=a.readUInt8(6)>>4&1,i=15&a;return e.hasOpt&&(t={subTelNum:e.subTelNum,dstId:e.dstId,dBm:e.dBm,securityLvl:e.securityLvl}),new RPS(r,n,s,o,i,t);};var BS1=function BS1(e,t,a,r){Telegram.call(this,213,r),this.userData=e,this.senderID=t,this.rc=a||0;};BS1.prototype=new Telegram(),BS1.prototype.constructor=BS1,BS1.prototype.getLearnBit=function(){return this.userData>>3&1;},BS1.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),userData:this.userData.toString(16),learn:this.getLearnBit(),senderID:this.senderID,rc:this.rc};},BS1.prototype.toPacket=function(){var e=new Buffer(2);e.writeUInt8(this.rorg,0),e.writeUInt8(this.userData,1),e=Buffer.concat([e,new Buffer(this.senderID,"hex")]);var t=this.rc;e=Buffer.concat([e,new Buffer([t])]);var a=1,r="FFFFFFFF",n=255,s=0;return this.optData&&(a=this.optData.subTelNum,r=this.optData.dstId,n=this.optData.dBm,s=this.optData.securityLvl),new RADIO_ERP1_Packet(e,!0,a,r,n,s);},BS1.resolve=function(e){var t,a=e.data,r=a.readUInt8(1),n=a.slice(2,6).toString("hex"),s=15&a.readUInt8(6);return e.hasOpt&&(t={subTelNum:e.subTelNum,dstId:e.dstId,dBm:e.dBm,securityLvl:e.securityLvl}),new BS1(r,n,s,t);};var BS4=function BS4(e,t,a,r){Telegram.call(this,165,r),this.userData=e,this.senderID=t,this.rc=a||0;};BS4.prototype=new Telegram(),BS4.prototype.constructor=BS4,BS4.prototype.getLearnType=function(){return this.userData.readUInt8(3)>>7&1;},BS4.prototype.getLearnBit=function(){return this.userData.readUInt8(3)>>3&1;},BS4.prototype.getLearnStatus=function(){return this.userData.readUInt8(3)>>4&1;},BS4.prototype.getLearnResult=function(){return this.userData.readUInt8(3)>>5&1;},BS4.prototype.getEEPResult=function(){return this.userData.readUInt8(3)>>6&1;},BS4.prototype.getFunc=function(){return this.userData.readUInt8(0)>>2&63;},BS4.prototype.getType=function(){return(3&this.userData.readUInt8(0))<<5|this.userData.readUInt8(1)>>3&31;},BS4.prototype.getManufacturerId=function(){return(7&this.userData.readUInt8(1))<<8|this.userData.readUInt8(2);},BS4.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),userData:this.userData.toString("hex"),learnType:this.getLearnType(),learn:this.getLearnBit(),learnStatus:this.getLearnStatus(),learnResult:this.getLearnResult(),eepResult:this.getEEPResult(),func:this.getFunc(),type:this.getType(),manufacturerId:this.getManufacturerId(),senderID:this.senderID,rc:this.rc};},BS4.prototype.toPacket=function(){var e=new Buffer(1);e.writeUInt8(this.rorg,0),e=Buffer.concat([e,this.userData]),e=Buffer.concat([e,new Buffer(this.senderID,"hex")]);var t,a=15&this.rc;if(e=Buffer.concat([e,new Buffer([a])]),this.optData){var r=this.optData.subTelNum,n=this.optData.dstId,s=this.optData.dBm,o=this.optData.securityLvl;t=new RADIO_ERP1_Packet(e,!0,r,n,s,o);}else t=new RADIO_ERP1_Packet(e,!1);return t;},BS4.resolve=function(e){var t,a=e.data,r=a.slice(1,5),n=a.slice(5,9).toString("hex"),s=15&a.readUInt8(9);return e.hasOpt&&(t={subTelNum:e.subTelNum,dstId:e.dstId,dBm:e.dBm,securityLvl:e.securityLvl}),new BS4(r,n,s,t);};var VLD=function VLD(e,t,a,r){Telegram.call(this,210,r),this.userData=e,this.senderID=t,this.status=a;};VLD.prototype=new Telegram(),VLD.prototype.constructor=VLD,VLD.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),userData:this.userData.toString("hex"),senderID:this.senderID,status:this.status,optData:this.optData};},VLD.prototype.toPacket=function(){var e,t=new Buffer(1);if(t.writeUInt8(this.rorg,0),t=Buffer.concat([t,this.userData]),t=Buffer.concat([t,new Buffer(this.senderID,"hex")]),t=Buffer.concat([t,new Buffer([this.status])]),this.optData){var a=this.optData.subTelNum,r=this.optData.dstId,n=this.optData.dBm,s=this.optData.securityLvl;e=new RADIO_ERP1_Packet(t,!0,a,r,n,s);}else e=new RADIO_ERP1_Packet(t,!1);return e;},VLD.resolve=function(e){var t,a=e.data,r=a.slice(1,a.length-5),n=a.slice(a.length-5,a.length-1).toString("hex"),s=a.readUInt8(a.length-1);return e.hasOpt&&(t={subTelNum:e.subTelNum,dstId:e.dstId,dBm:e.dBm,securityLvl:e.securityLvl}),new VLD(r,n,s,t);};var ADT=function ADT(e,t,a,r,n){Telegram.call(this,166),this.rorg_en=e,this.data=t,this.dstID=a,this.senderID=r,this.status=n;};(ADT.prototype=new Telegram()).constructor=ADT,ADT.prototype.toPacket=function(){var e=new Buffer(2);return e.writeUInt8(this.rorg,0),e.writeUInt8(this.rorg_en,1),e=Buffer.concat([e,this.data]),e=Buffer.concat([e,new Buffer(this.dstID,"hex")]),e=Buffer.concat([e,new Buffer(this.senderID,"hex")]),e=Buffer.concat([e,new Buffer([this.status])]),new RADIO_ERP1_Packet(e,!1);};var UTE=function UTE(e,t,a,r,n,s,o,i,l,u,c){Telegram.call(this,212),this.cmd=e,this.ute=t,this.rspExpected=a,this.subtype=r,this.numChannel=n,this.manufactureID=s,this.eepType=o,this.eepFunc=i,this.eepRorg=l,this.senderID=u,this.status=c;};UTE.prototype=new Telegram(),UTE.prototype.constructor=UTE,UTE.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),ute:this.ute,rspExpected:this.rspExpected,subtype:this.subtype,cmd:this.cmd,numChannel:this.numChannel,manufactureID:this.manufactureID,eepType:this.eepType.toString(16),eepFunc:this.eepFunc.toString(16),eepRorg:this.eepRorg.toString(16),senderID:this.senderID,status:this.status};},UTE.prototype.toPacket=function(){var e=new Buffer(8);e.writeUInt8(this.rorg,0);var t,a=this.ute<<7|this.rspExpected<<6|this.subtype<<4|this.cmd;if(e.writeUInt8(a,1),e.writeUInt8(this.numChannel,2),e.writeUInt16BE(parseInt(this.manufactureID,16),3),e.writeUInt8(this.eepType,5),e.writeUInt8(this.eepFunc,6),e.writeUInt8(this.eepRorg,7),e=Buffer.concat([e,new Buffer(this.senderID,"hex")]),e=Buffer.concat([e,new Buffer([this.status])]),this.optData){var r=this.optData.subTelNum,n=this.optData.dstId,s=this.optData.dBm,o=this.optData.securityLvl;t=new RADIO_ERP1_Packet(e,!0,r,n,s,o);}else t=new RADIO_ERP1_Packet(e,!1);return t;},UTE.resolve=function(e){var t=e.data.slice(1,8),a=e.data.slice(8,12).toString("hex"),r=e.data.readUInt8(12),n=t.readUInt8(0)>>7&1,s=15&t.readUInt8(0),o=t.readUInt8(1),i=t.slice(2,4).toString("hex"),l=t.readUInt8(4),u=t.readUInt8(5),c=t.readUInt8(6),h=t.readUInt8(0)>>6&1,_=t.readUInt8(0)>>4&3,p=new UTE(s,n,h,_,o,i,l,u,c,a,r);if(e.hasOpt){var d={subTelNum:e.subTelNum,dstId:e.dstId,dBm:e.dBm,securityLvl:e.securityLvl};p.optData=d;}return p;};var TS=function TS(e,t,a,r){Telegram.call(this,53,r),this.userData=e,this.senderID=t,this.status=a;};TS.prototype=new Telegram(),TS.prototype.constructor=TS,TS.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),userData:this.userData.toString("hex"),senderID:this.senderID,status:this.status,optData:this.optData};},TS.resolve=function(e){var t,a=e.data,r=a.slice(1,a.length-5),n=a.slice(a.length-5,a.length-1).toString("hex"),s=a.readUInt8(a.length-1);return e.hasOpt&&(t={subTelNum:e.subTelNum,dstId:e.dstId,dBm:e.dBm,securityLvl:e.securityLvl}),new TS(r,n,s,t);};var SM=function SM(e,t,a,r){Telegram.call(this,49,r),this.userData=e,this.senderID=t,this.status=a;};SM.prototype=new Telegram(),SM.prototype.constructor=SM,SM.prototype.toJSON=function(){return{rorg:this.rorg.toString(16),userData:this.userData.toString("hex"),senderID:this.senderID,status:this.status,optData:this.optData};},SM.prototype.convertToPacket=function(e){var t,a=Buffer.concat([e,new Buffer(this.senderID,"hex"),new Buffer([this.status])]);if(this.optData){var r=this.optData.subTelNum,n=this.optData.dstId,s=this.optData.dBm,o=this.optData.securityLvl;t=new RADIO_ERP1_Packet(a,!0,r,n,s,o);}else t=new RADIO_ERP1_Packet(a,!1);return t;},SM.resolve=function(e){var t,a=e.data,r=a.slice(1,a.length-5),n=a.slice(a.length-5,a.length-1).toString("hex"),s=a.readUInt8(a.length-1);return e.hasOpt&&(t={subTelNum:e.subTelNum,dstId:e.dstId,dBm:e.dBm,securityLvl:e.securityLvl}),new SM(r,n,s,t);},Telegram.SIG=SIG,Telegram.RPS=RPS,Telegram.BS1=BS1,Telegram.BS4=BS4,Telegram.VLD=VLD,Telegram.ADT=ADT,Telegram.UTE=UTE,Telegram.TS=TS,Telegram.SM=SM,Telegram.GP_TI=a,Telegram.GP_TR=r,Telegram.GP_CD=n;var Response=function Response(e,t){this._code=e,this._rspData=t;};Response.CODE={0:"RET_OK",1:"RET_ERROR",2:"RET_NOT_SUPPORTED",3:"RET_WRONG_PARAM",4:"RET_OPERATION_DENIED",5:"RET_LOCK_SET",6:"RET_BUFFER_TO_SMALL",7:"RET_NO_FREE_BUFFER"},Response.prototype.toJSON=function(){return{code:this._code,rspData:this._rspData?this._rspData.toString("hex"):null};},Response.prototype.toPacket=function(){return new Response_Packet(this._code,this._rspData);},Response.resolve=function(e){return new Response(e.retCode,e.resData);};var Response_OK_SA_CONFIRM_LEARN=function Response_OK_SA_CONFIRM_LEARN(e,t){Response.call(this,0),this._responseTime=e,this._confirmCode=t;};Response_OK_SA_CONFIRM_LEARN.prototype.toPacket=function(){var e=new Buffer(3);return e.writeUInt16BE(this._responseTime,0),e.writeUInt8(this._confirmCode,2),new Response_Packet(this._code,e);},Response_OK_SA_CONFIRM_LEARN.prototype.toJSON=function(){return{code:this._code,responseTime:this._responseTime,confirmCode:this._confirmCode};},Response.Response_OK_SA_CONFIRM_LEARN=Response_OK_SA_CONFIRM_LEARN;var Event=function Event(e){this._code=e;};Event.resolve=function(e){if(!e.data)return null;switch(e.data.readUInt8(0)){case 1:return SA_RECLAIM_NOT_SUCCESSFUL.resolve(e);case 2:return SA_CONFIRM_LEARN.resolve(e);default:return null;}};var SA_RECLAIM_NOT_SUCCESSFUL=function SA_RECLAIM_NOT_SUCCESSFUL(){Event.call(this,1);};SA_RECLAIM_NOT_SUCCESSFUL.prototype=new Event(),SA_RECLAIM_NOT_SUCCESSFUL.prototype.constructor=SA_RECLAIM_NOT_SUCCESSFUL,SA_RECLAIM_NOT_SUCCESSFUL.prototype.toJSON=function(){return{code:this._code};},SA_RECLAIM_NOT_SUCCESSFUL.prototype.toPacket=function(){var e=new Buffer(1);return e.writeUInt8(this._code,0),new EVENT_Packet(e);},SA_RECLAIM_NOT_SUCCESSFUL.resolve=function(e){return new SA_RECLAIM_NOT_SUCCESSFUL();};var SA_CONFIRM_LEARN=function SA_CONFIRM_LEARN(e,t,a,r,n,s,o){Event.call(this,2),this._priority=e,this._manufacturerId=t,this._eep=a,this._rssi=r,this._pm_candidateId=n,this._sa_clientId=s,this._hop_count=o;};SA_CONFIRM_LEARN.prototype=new Event(),SA_CONFIRM_LEARN.prototype.constructor=SA_CONFIRM_LEARN,SA_CONFIRM_LEARN.prototype.getEEP=function(){return this._eep?this._eep.substr(0,2)+"-"+this._eep.substr(2,2)+"-"+this._eep.substr(4,2):null;},SA_CONFIRM_LEARN.prototype.getPMCandidateId=function(){return this._pm_candidateId;},SA_CONFIRM_LEARN.prototype.getSAClientId=function(){return this._sa_clientId;},SA_CONFIRM_LEARN.prototype.getHopCount=function(){return this._hop_count;},SA_CONFIRM_LEARN.prototype.toJSON=function(){return{code:this._code,priority:this._priority,manufacturerId:this._manufacturerId,eep:this.getEEP(),rssi:this._rssi,pm_candidateId:this._pm_candidateId,sa_clientId:this._sa_clientId,hop_count:this._hop_count};},SA_CONFIRM_LEARN.prototype.toPacket=function(){var e=new Buffer(4);return e.writeUInt8(this._code,0),e.writeUInt8(this._priority,1),e.writeUInt16BE(1023&this._manufacturerId,2),e=Buffer.concat([e,new Buffer(this._eep,"hex")]),e=Buffer.concat([e,new Buffer([this._rssi])]),e=Buffer.concat([e,new Buffer(this._pm_candidateId,"hex")]),e=Buffer.concat([e,new Buffer(this._sa_clientId,"hex")]),e=Buffer.concat([e,new Buffer([this._hop_count])]),new EVENT_Packet(e);},SA_CONFIRM_LEARN.resolve=function(e){var t=e.data,a=t.readUInt8(1),r=1023&t.readUInt16BE(2),n=t.slice(4,7).toString("hex"),s=t.readUInt8(7),o=t.slice(8,12).toString("hex"),i=t.slice(12,16).toString("hex"),l=t.readUInt8(16);return new SA_CONFIRM_LEARN(a,r,n,s,o,i,l);},Event.SA_RECLAIM_NOT_SUCCESSFUL=SA_RECLAIM_NOT_SUCCESSFUL,Event.SA_CONFIRM_LEARN=SA_CONFIRM_LEARN;var COMMAND_COMMAND=function COMMAND_COMMAND(e){this._code=e;};COMMAND_COMMAND.resolve=function(e){return e.data&&9===e.data.readUInt8(0)?CO_WR_REPEATER.resolve(e):null;},CO_WR_REPEATER=function CO_WR_REPEATER(e,t){COMMAND_COMMAND.call(this,9),this._enable=e,this._level=t;},CO_WR_REPEATER.prototype=new COMMAND_COMMAND(),CO_WR_REPEATER.prototype.constructor=CO_WR_REPEATER,CO_WR_REPEATER.prototype.toJSON=function(){return{code:this._code,enable:this._enable,level:this._level};},CO_WR_REPEATER.prototype.toPacket=function(){var e=new Buffer(3);return e.writeUInt8(this._code,0),e.writeUInt8(this._enable,1),e.writeUInt8(this._level,2),new COMMAND_COMMAND_Packet(e);},CO_WR_REPEATER.resolve=function(e){var t=e.data.readUInt8(1),a=CO_WR_REPEATER.readUInt8(2);return new CO_WR_REPEATER(t,a);},COMMAND_COMMAND.CO_WR_REPEATER=CO_WR_REPEATER;var SA_COMMAND=function SA_COMMAND(e){this._code=e;};SA_COMMAND.resolve=function(e){if(!e.data)return null;switch(e.data.readUInt8(0)){case 1:return SA_WR_LEARNMODE.resolve(e);case 6:return SA_RD_LEARNEDCLIENTS.resolve(e);case 8:return SA_WR_POSTMASTER.resolve(e);default:return null;}};var SA_WR_LEARNMODE=function SA_WR_LEARNMODE(e,t,a){SA_COMMAND.call(this,1),this._enable=e,this._extended=t,this._timeout=a;};SA_WR_LEARNMODE.prototype=new SA_COMMAND(),SA_WR_LEARNMODE.prototype.constructor=SA_WR_LEARNMODE,SA_WR_LEARNMODE.prototype.toJSON=function(){return{code:this._code,enable:this._enable,extended:this._extended,timeout:this._timeout};},SA_WR_LEARNMODE.prototype.toPacket=function(){var e=new Buffer(7);return e.writeUInt8(this._code,0),e.writeUInt8(this._enable,1),e.writeUInt8(this._extended,2),e.writeUInt32BE(this._timeout,3),new SMART_ACK_COMMAND_Packet(e);},SA_WR_LEARNMODE.resolve=function(e){var t=e.data,a=t.readUInt8(1),r=t.readUInt8(2),n=t.readUInt32BE(3);return new SA_WR_LEARNMODE(a,r,n);};var SA_WR_RESET=function SA_WR_RESET(e){SA_COMMAND.call(this,5),this._saClientId=e;};(SA_WR_RESET.prototype=new SA_COMMAND()).constructor=SA_WR_RESET,SA_WR_RESET.prototype.toJSON=function(){return{code:this._code,clientId:this._saClientId};},SA_WR_RESET.prototype.toPacket=function(){var e=new Buffer(1);return e.writeUInt8(this._code,0),e=Buffer.concat([e,new Buffer(this._saClientId,"hex")]),new SMART_ACK_COMMAND_Packet(e);},SA_WR_RESET.resolve=function(e){var t=e.data.slice(1,5).toString("hex");return new SA_WR_RESET(t);};var SA_RD_LEARNEDCLIENTS=function SA_RD_LEARNEDCLIENTS(){SA_COMMAND.call(this,6);};SA_RD_LEARNEDCLIENTS.prototype=new SA_COMMAND(),SA_RD_LEARNEDCLIENTS.prototype.constructor=SA_RD_LEARNEDCLIENTS,SA_RD_LEARNEDCLIENTS.prototype.toJSON=function(){return{code:this._code};},SA_RD_LEARNEDCLIENTS.prototype.toPacket=function(){var e=new Buffer(1);return e.writeUInt8(this._code,0),new SMART_ACK_COMMAND_Packet(e);},SA_RD_LEARNEDCLIENTS.resolve=function(e){e.data;return new SA_RD_LEARNEDCLIENTS();};var SA_WR_POSTMASTER=function SA_WR_POSTMASTER(e){SA_COMMAND.call(this,8),this._mailBoxCount=e;};SA_WR_POSTMASTER.prototype=new SA_COMMAND(),SA_WR_POSTMASTER.prototype.constructor=SA_WR_POSTMASTER,SA_WR_POSTMASTER.prototype.toJSON=function(){return{code:this._code,mailBoxCount:this._mailBoxCount};},SA_WR_POSTMASTER.prototype.toPacket=function(){var e=new Buffer(2);return e.writeUInt8(this._code,0),e.writeUInt8(this._mailBoxCount,1),new SMART_ACK_COMMAND_Packet(e);},SA_WR_POSTMASTER.resolve=function(e){var t=e.data.readUInt8(1);return new SA_WR_POSTMASTER(t);},SA_COMMAND.SA_WR_LEARNMODE=SA_WR_LEARNMODE,SA_COMMAND.SA_WR_RESET=SA_WR_RESET,SA_COMMAND.SA_RD_LEARNEDCLIENTS=SA_RD_LEARNEDCLIENTS,SA_COMMAND.SA_WR_POSTMASTER=SA_WR_POSTMASTER;var s,o=((s=function s(e){this._esp3=e,this._buffer={};}).prototype.receiveChainedTelegram=function(e){var t=e.getSenderID(),a=e.getSeq(),r=e.getIdx();this._buffer[t]||(this._buffer[t]={});var n=this._buffer[t];n[a]||(n[a]=[]);for(var s=n[a],o=0;o<=r;o++){o!=r?s.length<r&&(s[o]=null):s[o]=e;}this._checkChain(t,a);},s.prototype._checkChain=function(e,t){var a=this._buffer[e][t];if(a[0]){var r=a[0],n=r.getLen(),s=r.getCRORG(),o=0,i=new Buffer(1);i.writeUInt8(s);for(var l=0;l<a.length;l++){var u=a[l];if(!u)return;var c=u.getData();o+=c.length,i=Buffer.concat([i,c]);}if(o>=n){delete this._buffer[e][t],i=Buffer.concat([i,new Buffer(e,"hex")]),i=Buffer.concat([i,new Buffer("00","hex")]);var h=new RADIO_ERP1_Packet(i,!1);this._esp3._onEORadio_ERP1(h);}}},s),ESP3=function ESP3(e){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.ESP3"),this._controller=e,this._listeners=[],e&&this._listeners.push(e),this._recomm=new x.hub.m.enocean.ReComm(this),this._serial=null,this._baseID=null,this._rdata=new Buffer([]),this._frameBuffer=[],this._learnHandler=null,this._learning=!1,this._learnTO=null,this._cdmHandler=new o(this);};return ESP3.RESPONSE_TO=1500,ESP3.prototype.attachSerial=function(e,t){var a=this;this._serial=new x.hub.m.enocean.Serial(e),this._serial.setListener(this),this._serial.open(function(e){if(e)return a._serial.setListener(null),a._serial=null,void(t&&t(e));a.readBaseID(function(e,r){e?(a._serial.setListener(null),a._serial.close(),a._serial=null,t&&t(e)):(x.hub.m.enocean.SENDER_ID||(x.hub.m.enocean.SENDER_ID=r,localStorage&&localStorage.setItem("x.hub.m.enocean.SENDER_ID",r)),a._baseID=r,t&&t());});});},ESP3.prototype.removeSerial=function(e,t){this._serial.setListener(null),this._serial.close(),this._serial=null,this._baseID=null,t&&t();},ESP3.prototype.getSerial=function(){return this._serial;},ESP3.prototype.addListener=function(e){e&&-1==this._listeners.indexOf(e)&&this._listeners.push(e);},ESP3.prototype.removeListener=function(e){if(e){var t=this._listeners.indexOf(e);-1!=t&&this._listeners.splice(t,1);}},ESP3.prototype.readBaseID=function(e){var t=this,a=new ESP3_Frame(5,new Buffer("08","hex"));this.sendFrame(a,!0,function(a,r){if(a)return t._logger.log("warn","read base id error:"+a.stack),void(e&&e(a));if(r&&r.retCode)return(a=new Error("read BaseID error")).code=r.retCode,t._logger.log("warn","read base id error return code:"+r.retCode),void(e&&e(a));var n=r.resData.toString("hex");e&&e(null,n.toLowerCase());},8e3);},ESP3.prototype.startLearn=function(e,t,a,r){if(this._serial){if((!t||t<=0)&&(t=3e4),this._learning)r&&r(new Error("learning another type right now"));else{this._learnHandler=e,this._learning=!0;var n=this;if(this._learnTO=setTimeout(function(){n._learning=!1,n._learnTO=null;var e=n._learnHandler;n._learnHandler=null,e&&e.onLearnTimeout&&e.onLearnTimeout();},t),a){var s=new SA_WR_LEARNMODE(1,a.extended?a.extended:0,0);this.sendSACommand(s,!0,function(e){r&&r(e);});}else r&&r();}}else r&&r(new Error("port not opened"));},ESP3.prototype.stopLearn=function(e,t,a){if(this._learnTO&&clearTimeout(this._learnTO),this._learning=!1,this._learnHandler=null,this._learnTO=null,t){a&&a();var r=this;setTimeout(function(){var e=new SA_WR_LEARNMODE(0,t.extended?t.extended:0,0);r.sendSACommand(e,!0,function(e){a&&a(e);});},2e3);}else a&&a();},ESP3.prototype.sendTelegram=function(e,t,a){this.sendPacket(e.toPacket(),t,a);},ESP3.prototype.sendResponse=function(e,t){this._logger.log("trace","send RESPONSE:"+JSON.stringify(e.toJSON())),this.sendPacket(e.toPacket(),!1,t);},ESP3.prototype.sendSACommand=function(e,t,a){this._logger.log("trace","send SA_COMMAND:"+JSON.stringify(e.toJSON())),this.sendPacket(e.toPacket(),t,a);},ESP3.prototype.sendCommandCommand=function(e,t,a){this._logger.log("trace","send COMMAND_COMMAND:"+JSON.stringify(e.toJSON())),this.sendPacket(e.toPacket(),t,a);},ESP3.prototype.sendPacket=function(e,t,a){this.sendFrame(e.toFrame(),t,a);},ESP3.prototype.sendFrame=function(e,t,a,r){var n={frame:e,callback:a,timeout:null,response:t,to:r},s=this._frameBuffer.length;this._frameBuffer.push(n),0==s&&this._sendNextFrame();},ESP3.prototype._sendNextFrame=function(){if(0!=this._frameBuffer.length){var e=this._frameBuffer[0],t=e.frame,a=e.callback,r=e.response;if(!this._serial)return a&&a(new Error("port not opened")),this._frameBuffer.splice(0,1),void this._sendNextFrame();var n=this,s=t.toBuffer();this._logger.log("trace","send raw frame:"+s.toString("hex")),this._serial.sendPacket(s,function(t){if(t||!r){try{a&&a(t);}catch(e){}n._frameBuffer.splice(0,1),n._sendNextFrame();}else{var s=e.to;s||(s=ESP3.RESPONSE_TO),e.timeout=setTimeout(function(){var e=n._frameBuffer[0];if(e){var t=e.callback,a=new Error("enocean response timeout");a.code=100;try{t&&t(a);}catch(e){}}n._frameBuffer.splice(0,1),n._sendNextFrame();},s);}});}},ESP3.prototype.onSerialData=function(e){this._rdata=Buffer.concat([this._rdata,e]);for(var t=this._rdata,a=0;a<t.length;){if(85==t[a]){if(a+6>=t.length)break;var r=(t[a+1]<<8)+t[a+2],n=t[a+3],s=t[a+5];if(t.length<a+r+n+7)break;if(x.hub.m.enocean.CRC8(t.slice(a+1,a+5))==s){var o=t[a+r+n+6];if(x.hub.m.enocean.CRC8(t.slice(a+6,a+6+r+n))==o){var i={type:t[a+4],dataLen:r,optLen:n,radioType:t[a+6],data:t.slice(a+6,a+6+r),optData:t.slice(a+6+r,a+6+r+n),rawByte:t.slice(0,a+6+r+n+1).toString("hex")},l=new ESP3_Frame(i.type,i.data,i.optData);166!=i.radioType&&210!=i.radioType&&165!=i.radioType&&246!=i.radioType&&213!=i.radioType||(i.senderId=i.data.slice(r-5,r-1).toString("hex"));try{this._onEOFrame(l,i);}catch(e){this._logger.log("warn","process frame exception:"+e.stack);}a=a+6+r+n+1;}else a++;}else a++;}else a++;}0!=a&&t.length>0&&a<=t.length&&(t=t.slice(a)),this._rdata=t;},ESP3.prototype.onSerialError=function(e){this._serial.setListener(null),this._serial=null;},ESP3.prototype._onEOFrame=function(e,t){this._logger.log("trace","receive raw frame:"+t.rawByte),this._logger.log("debug","receive enocean frame:"+JSON.stringify(e.toJSON())),this._listeners.forEach(function(a){a._onEOFrame&&a._onEOFrame(e,t.rawByte);});var a=e.toPacket();a&&this._onEOPacket(a);},ESP3.prototype._onEOPacket=function(e){this._logger.log("debug","receive enocean packet:"+JSON.stringify(e.toJSON())),this._listeners.forEach(function(t){t._onEOPacket&&t._onEOPacket(e);}),e instanceof RADIO_ERP1_Packet?this._onEORadio_ERP1(e):e instanceof Response_Packet?this._onEOResponse_Packet(e):e instanceof EVENT_Packet&&this._onEOEvent_Packet(e);},ESP3.prototype._onEORadio_ERP1=function(e){var t=e.toRadioTelegram();t&&this._onEO_ERP1_Telegram(t);},ESP3.prototype._onEOResponse_Packet=function(e){try{var t=e.toResponse();this._onEO_Response(t);}catch(e){}if(0!=this._frameBuffer.length){var a=this._frameBuffer[0],r=a.callback,n=a.timeout;n&&clearTimeout(n);try{r&&r(null,e);}catch(e){}this._frameBuffer.splice(0,1),this._sendNextFrame();}},ESP3.prototype._onEOEvent_Packet=function(e){var t=e.toEvent();t&&this._onEO_Event(t);},ESP3.prototype._onEO_ERP1_Telegram=function(e){this._logger.log("debug","receive enocean telegram:"+JSON.stringify(e.toJSON())),64!=e.rorg?(this._listeners.forEach(function(t){t._onEOTelegram&&t._onEOTelegram(e);}),49==e.rorg&&(e=this._controller._secHandler.resolve(e))&&this._listeners.forEach(function(t){t._onEOTelegram&&t._onEOTelegram(e);}),this._learning&&this._learnHandler&&this._learnHandler.onTelegram&&this._learnHandler.onTelegram(e)):this._cdmHandler.receiveChainedTelegram(e);},ESP3.prototype._onEO_Response=function(e){this._logger.log("debug","receive enocean response:"+JSON.stringify(e.toJSON()));},ESP3.prototype._onEO_Event=function(e){this._logger.log("debug","receive enocean event:"+JSON.stringify(e.toJSON())),this._learning&&this._learnHandler&&this._learnHandler.onEvent&&this._learnHandler.onEvent(e);},ESP3.ESP3_Frame=ESP3_Frame,ESP3.Telegram=Telegram,ESP3.RADIO_ERP1_Packet=RADIO_ERP1_Packet,ESP3.Event=Event,ESP3.Response=Response,ESP3.COMMAND_COMMAND=COMMAND_COMMAND,ESP3.SA_COMMAND=SA_COMMAND,ESP3;}(),x.hub.m.enocean.ESP2=function(){var Telegram=function Telegram(e,t){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.ESP2.Telegram"),this._type=e,this._data=t;};Telegram.prototype.toBuffer=function(){var e=new Buffer(3+this._data.length+1),t=0;e.writeUInt8(165,0),e.writeUInt8(90,1);var a=this._type<<5|this._data.length+1&31;t+=a,e.writeUInt8(a,2);for(var r=0;r<this._data.length;r++){var n=this._data.readUInt8(r);e.writeUInt8(n,r+3),t+=n;}return t&=255,e.writeUInt8(t,e.length-1),e;},Telegram.resolve=function(n,s){switch(n){case 0:return t.resolve(s);case 3:return e.resolve(s);case 4:return a.resolve(s);case 5:return r.resolve(s);default:return null;}};var e=function(){var TRT=function TRT(e){Telegram.call(this,3,e);};return(TRT.prototype=new Telegram()).constructor=TRT,TRT.prototype.getData=function(){return this._data.slice(1,5);},TRT.prototype.getSenderID=function(){return this._data.slice(5,9).toString("hex");},TRT.prototype.getStatus=function(){return this._data.readUInt8(9);},TRT.prototype.toJSON=function(){return{type:"TRT",org:"0x"+this._data.slice(0,1).toString("hex"),data:this.getData().toString("hex"),senderID:this.getSenderID(),status:this.getStatus()};},TRT.prototype.fromPayload=function(e){this._data=e._data;},TRT.resolve=function(e){return e&&e.length?new TRT(e):null;},TRT;}(),t=function(){var RRT=function RRT(e){Telegram.call(this,0,e);};return(RRT.prototype=new Telegram()).constructor=RRT,RRT.prototype.getData=function(){return this._data.slice(1,5);},RRT.prototype.getSenderID=function(){return this._data.slice(5,9).toString("hex");},RRT.prototype.getStatus=function(){return this._data.readUInt8(9);},RRT.prototype.toJSON=function(){return{type:"RRT",org:"0x"+this._data.slice(0,1).toString("hex"),data:this.getData().toString("hex"),senderID:this.getSenderID(),status:this.getStatus()};},RRT.prototype.toPayload=function(){return n.resolve(this._data);},RRT.resolve=function(e){return e&&e.length?new RRT(e):null;},RRT;}(),a=function(){var RCT=function RCT(e){Telegram.call(this,4,e);};(RCT.prototype=new Telegram()).constructor=RCT,RCT.prototype.toJSON=function(){return{type:"RCT",org:"0x"+this._data.readUInt8(0).toString(16)};},RCT.resolve=function(e){if(!e||!e.length)return null;var t=e[0];switch(t){case 88:return new OK();case 25:return new ERR();case 34:return new ERR_TX_IDRANGE();case 26:return new ERR_IDRANGE();case 8:case 11:case 9:case 10:return new ERR_SYNTAX(t);case 152:return new INF_BASEID(e.slice(1,5).toString("hex"));case 136:return new INF_RX_SENSITIVITY(e[2]);case 140:return new INF_SW_VER(e.slice(1));default:return null;}};var OK=function OK(){RCT.call(this,new Buffer([88,0,0,0,0,0,0,0,0]));};OK.prototype=new RCT(),OK.prototype.constructor=OK,OK.prototype.toJSON=function(){var e=RCT.prototype.toJSON.call(this);return e.subtype="OK",e;};var ERR=function ERR(){RCT.call(this,new Buffer([25,0,0,0,0,0,0,0,0]));};ERR.prototype=new RCT(),ERR.prototype.constructor=ERR,ERR.prototype.toJSON=function(){var e=RCT.prototype.toJSON.call(this);return e.subtype="ERR",e;};var ERR_SYNTAX=function ERR_SYNTAX(e){RCT.call(this,new Buffer([e,0,0,0,0,0,0,0,0]));};ERR_SYNTAX.prototype=new RCT(),ERR_SYNTAX.prototype.constructor=ERR_SYNTAX,ERR_SYNTAX.prototype.getField=function(){return this._data.readUInt8(0);},ERR_SYNTAX.prototype.getFieldName=function(){switch(this._data.readUInt8(0)){case 8:return"H_SEQ";case 9:return"LENGTH";case 10:return"CHKSUM";case 11:return"ORG";default:return"UNKNOWN";}},ERR_SYNTAX.prototype.toJSON=function(){var e=RCT.prototype.toJSON.call(this);return e.subtype="ERR_SYNTAX",e.field=this.getFieldName(),e;};var ERR_TX_IDRANGE=function ERR_TX_IDRANGE(){RCT.call(this,new Buffer([34,0,0,0,0,0,0,0,0]));};ERR_TX_IDRANGE.prototype=new RCT(),ERR_TX_IDRANGE.prototype.constructor=ERR_TX_IDRANGE,ERR_TX_IDRANGE.prototype.toJSON=function(){var e=RCT.prototype.toJSON.call(this);return e.subtype="ERR_TX_IDRANGE",e;};var ERR_IDRANGE=function ERR_IDRANGE(){RCT.call(this,new Buffer([26,0,0,0,0,0,0,0,0]));};ERR_IDRANGE.prototype=new RCT(),ERR_IDRANGE.prototype.constructor=ERR_IDRANGE,ERR_IDRANGE.prototype.toJSON=function(){var e=RCT.prototype.toJSON.call(this);return e.subtype="ERR_IDRANGE",e;};var INF_BASEID=function INF_BASEID(e){RCT.call(this,new Buffer("98"+e+"00000000","hex"));};INF_BASEID.prototype=new RCT(),INF_BASEID.prototype.constructor=INF_BASEID,INF_BASEID.prototype.getBaseID=function(){return this._data.slice(1,5).toString("hex");},INF_BASEID.prototype.toJSON=function(){var e=RCT.prototype.toJSON.call(this);return e.subtype="INF_BASEID",e.baseID=this.getBaseID(),e;};var INF_RX_SENSITIVITY=function INF_RX_SENSITIVITY(e){RCT.call(this,new Buffer([136,255&e,0,0,0,0,0,0,0]));};INF_RX_SENSITIVITY.prototype=new RCT(),INF_RX_SENSITIVITY.prototype.constructor=INF_RX_SENSITIVITY;var INF_SW_VER=function INF_SW_VER(e){RCT.call(this,new Buffer("8C"+e.toString("hex"),"hex"));};return INF_SW_VER.prototype=new RCT(),INF_SW_VER.prototype.constructor=INF_SW_VER,RCT.OK=OK,RCT.ERR=ERR,RCT.ERR_SYNTAX=ERR_SYNTAX,RCT.ERR_TX_IDRANGE=ERR_TX_IDRANGE,RCT.ERR_IDRANGE=ERR_IDRANGE,RCT.INF_BASEID=INF_BASEID,RCT.INF_RX_SENSITIVITY=INF_RX_SENSITIVITY,RCT.INF_SW_VER=INF_SW_VER,RCT;}(),r=function(){var TCT=function TCT(e){Telegram.call(this,5,e);};(TCT.prototype=new Telegram()).constructor=TCT,TCT.prototype.toJSON=function(){return{type:"TCT",org:"0x"+this._data.readUInt8(0).toString(16)};},TCT.resolve=function(e){if(!e||!e.length)return null;switch(e[0]){case 24:return new SET_BASEID(e.slice(1,4).toString("hex"));case 88:return new RD_BASEID();case 8:return new SET_RX_SENSITIVITY(e[2]);case 72:return new RD_RX_SENSITIVITY();case 75:return new RD_SW_VER();case 10:return new RESET();default:return null;}};var SET_BASEID=function SET_BASEID(e){TCT.call(this,new Buffer("18"+e+"0000000000","hex"));};SET_BASEID.prototype=new TCT(),SET_BASEID.prototype.constructor=SET_BASEID,SET_BASEID.prototype.getBaseID=function(){return this._data.slice(1,5).toString("hex");},SET_BASEID.prototype.toJSON=function(){var e=TCT.prototype.toJSON.call(this);return e.subtype="SET_BASEID",e.baseID=this.getBaseID(),e;};var RD_BASEID=function RD_BASEID(){TCT.call(this,new Buffer("58000000000000000000","hex"));};RD_BASEID.prototype=new TCT(),RD_BASEID.prototype.constructor=RD_BASEID,RD_BASEID.prototype.toJSON=function(){var e=TCT.prototype.toJSON.call(this);return e.subtype="RD_BASEID",e;};var SET_RX_SENSITIVITY=function SET_RX_SENSITIVITY(e){TCT.call(this,new Buffer([8,255&e,0,0,0,0,0,0,0,0]));};SET_RX_SENSITIVITY.prototype=new TCT(),SET_RX_SENSITIVITY.prototype.constructor=SET_RX_SENSITIVITY,SET_RX_SENSITIVITY.prototype.getSensitivity=function(){return this._data.readUInt8(1);},SET_RX_SENSITIVITY.prototype.toJSON=function(){var e=TCT.prototype.toJSON.call(this);return e.subtype="SET_RX_SENSITIVITY",e.sensitivity=this.getSensitivity(),e;};var RD_RX_SENSITIVITY=function RD_RX_SENSITIVITY(){TCT.call(this,new Buffer("48000000000000000000","hex"));};RD_RX_SENSITIVITY.prototype=new TCT(),RD_RX_SENSITIVITY.prototype.constructor=RD_RX_SENSITIVITY,RD_RX_SENSITIVITY.prototype.toJSON=function(){var e=TCT.prototype.toJSON.call(this);return e.subtype="RD_RX_SENSITIVITY",e;};var RESET=function RESET(){TCT.call(this,new Buffer("0A000000000000000000","hex"));};RESET.prototype=new TCT(),RESET.prototype.constructor=RESET,RESET.prototype.toJSON=function(){var e=TCT.prototype.toJSON.call(this);return e.subtype="RESET",e;};var RD_SW_VER=function RD_SW_VER(){TCT.call(this,new Buffer("4B000000000000000000","hex"));};return RD_SW_VER.prototype=new TCT(),RD_SW_VER.prototype.constructor=RD_SW_VER,RD_SW_VER.prototype.toJSON=function(){var e=TCT.prototype.toJSON.call(this);return e.subtype="RD_SW_VER",e;},TCT.SET_BASEID=SET_BASEID,TCT.RD_BASEID=RD_BASEID,TCT.SET_RX_SENSITIVITY=SET_RX_SENSITIVITY,TCT.RD_RX_SENSITIVITY=RD_RX_SENSITIVITY,TCT.RESET=RESET,TCT.RD_SW_VER=RD_SW_VER,TCT;}(),n=function(){var Payload=function Payload(e,t){if(e&&t){var a=Buffer.alloc(1);a.writeUInt8(e),this._data=Buffer.concat([a,t]);}};Payload.prototype.getData=function(){throw new Error("not implemented by this child class");},Payload.prototype.getSenderID=function(){throw new Error("not implemented by this child class");},Payload.prototype.getStatus=function(){throw new Error("not implemented by this child class");},Payload.prototype.toJSON=function(){return{type:null,org:"0x"+this._data.slice(0,1).toString("hex"),data:this.getData().toString("hex"),senderID:this.getSenderID(),status:this.getStatus()};},Payload.resolve=function(e){if(!e||!e.length)return null;switch(e[0]){case 5:return RPS.resolve(e.slice(1));case 6:return BS1.resolve(e.slice(1));case 7:return BS4.resolve(e.slice(1));default:return null;}};var RPS=function RPS(e,t,a){var r=Buffer.alloc(9);r.writeUInt8(e,0),r.writeUInt8(0,1),r.writeUInt8(0,2),r.writeUInt8(0,3);for(var n=0,s=4;n<8;n+=2,s++){var o=t.substr(n,2);r.writeUInt8(parseInt(o,16),s);}r.writeUInt8(a,8),Payload.call(this,5,r);};RPS.prototype=new Payload(),RPS.prototype.constructor=RPS,RPS.prototype.getData=function(){return this._data.slice(1,2);},RPS.prototype.getSenderID=function(){return this._data.slice(5,9).toString("hex");},RPS.prototype.getStatus=function(){return this._data.readUInt8(9);},RPS.prototype.toJSON=function(){var e=Payload.prototype.toJSON.call(this);return e.type="RPS",e;},RPS.resolve=function(e){var t=e.readUInt8(0),a=e.slice(4,8).toString("hex"),r=e.readUInt8(8);return new RPS(t,a,r);};var BS1=function BS1(e,t,a){var r=Buffer.alloc(9);r.writeUInt8(e,0),r.writeUInt8(0,1),r.writeUInt8(0,2),r.writeUInt8(0,3);for(var n=0,s=4;n<8;n+=2,s++){var o=t.substr(n,2);r.writeUInt8(parseInt(o,16),s);}r.writeUInt8(a,8),Payload.call(this,6,r);};BS1.prototype=new Payload(),BS1.prototype.constructor=BS1,BS1.prototype.isTeachIn=function(){return 0==(8&this._data.readUInt8(1));},BS1.prototype.getData=function(){return this._data.slice(1,2);},BS1.prototype.getSenderID=function(){return this._data.slice(5,9).toString("hex");},BS1.prototype.getStatus=function(){return this._data.readUInt8(9);},BS1.prototype.toJSON=function(){var e=Payload.prototype.toJSON.call(this);return e.type="1BS",e.teachin=this.isTeachIn(),e;},BS1.resolve=function(e){var t=e.readUInt8(0),a=e.slice(4,8).toString("hex"),r=e.readUInt8(8);return new BS1(t,a,r);};var BS4=function BS4(e,t,a){for(var r=Buffer.alloc(9),n=0;n<4;n++){r.writeUInt8(e.readUInt8(n),n);}for(var s=0,o=4;s<8;s+=2,o++){var i=t.substr(s,2);r.writeUInt8(parseInt(i,16),o);}r.writeUInt8(a,8),Payload.call(this,7,r);};return BS4.prototype=new Payload(),BS4.prototype.constructor=BS4,BS4.prototype.isTeachIn=function(){return 0==(8&this.getData().readUInt8(3));},BS4.prototype.getProfile=function(){var e=this.getData(),t=e.readUInt8(0)>>2,a=(3&e.readUInt8(0))<<5|e.readUInt8(1)>>3&31;return Buffer.from([7,t,a]);},BS4.prototype.getProfileText=function(){var e=this.getProfile().toString("hex");return e.substr(0,2)+"-"+e.substr(2,2)+"-"+e.substr(4,2);},BS4.prototype.getManufacturerId=function(){var e=this.getData().slice(1,3);return e.writeUInt8(7&e.readUInt8(0),0),e.toString("hex");},BS4.prototype.getLearnType=function(){return this.getData().readUInt8(3)>>7&1;},BS4.prototype.getEEPResult=function(){return this.getData().readUInt8(3)>>6&1;},BS4.prototype.getLearnResult=function(){return this.getData().readUInt8(3)>>5&1;},BS4.prototype.getLearnStaus=function(){return this.getData().readUInt8(3)>>4&1;},BS4.prototype.getData=function(){return this._data.slice(1,5);},BS4.prototype.getSenderID=function(){return this._data.slice(5,9).toString("hex");},BS4.prototype.getStatus=function(){return this._data.readUInt8(9);},BS4.prototype.toJSON=function(){var e=Payload.prototype.toJSON.call(this);return e.type="4BS",e.teachin=this.isTeachIn(),e.teachin&&(e.teachin_info={profile:this.getProfileText(),learn_type:this.getLearnType(),eep_result:this.getEEPResult(),learn_result:this.getLearnResult(),learn_status:this.getLearnStaus()},e.teachin_info.learn_type&&(e.teachin_info.manufactureID=this.getManufacturerId())),e;},BS4.resolve=function(e){var t=e.slice(0,4),a=e.slice(4,8).toString("hex"),r=e.readUInt8(8);return new BS4(t,a,r);},Payload.RPS=RPS,Payload.BS1=BS1,Payload.BS4=BS4,Payload;}(),ESP2=function ESP2(e,t){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.ESP2"),this._controller=e,this._listeners=[],e&&this._listeners.push(e),this._baudrate=t,this._baudrate||(this._baudrate=9600),this._serial=null,this._baseID=null,this._rdata=new Buffer([]),this._telegramBuffer=[],this._learnHandler=null,this._learning=!1,this._learnTO=null;};return ESP2.RESPONSE_TO=1500,ESP2.prototype.attachSerial=function(e,t){var a=this;this._serial=new x.hub.m.enocean.Serial(e,this._baudrate),this._serial.setListener(this),this._serial.open(function(e){if(e)return a._serial.setListener(null),a._serial=null,void(t&&t(e));a.readBaseID(function(e,r){e?(a._serial.setListener(null),a._serial.close(),a._serial=null,t&&t(e)):(a._baseID=r,t&&t());});});},ESP2.prototype.removeSerial=function(e,t){this._serial.setListener(null),this._serial.close(),this._serial=null,this._baseID=null,t&&t();},ESP2.prototype.getSerial=function(){return this._serial;},ESP2.prototype.readBaseID=function(e){var t=this,n=new r.RD_BASEID();this.sendTelegram(n,2e3,function(r,n){if(r)return t._logger.log("warn","read base id error:"+r.stack),void(e&&e(r));if(!(n instanceof a.INF_BASEID))return r=new Error("read base id failed"),t._logger.log("warn","read base id failed:"+n.retCode),void(e&&e(r));var s=n.getBaseID();e&&e(null,s.toLowerCase());});},ESP2.prototype.sendTelegram=function(e,t,a){this._logger.log("debug","send enocean telegram:"+JSON.stringify(e.toJSON()));var r={telegram:e,callback:a,timeout:null,to:t},n=this._telegramBuffer.length;this._telegramBuffer.push(r),0==n&&this._sendNextTelegram();},ESP2.prototype._sendNextTelegram=function(){if(0!=this._telegramBuffer.length){var t=this._telegramBuffer[0],a=t.telegram,n=t.callback,s=!0;if((a instanceof r.RESET||a instanceof e)&&(s=!1),!this._serial)return n&&n(new Error("port not opened")),this._telegramBuffer.splice(0,1),void this._sendNextTelegram();var o=this,i=a.toBuffer();this._logger.log("trace","send raw telegram:"+i.toString("hex")),this._serial.sendPacket(i,function(e){if(e||!s){try{n&&n(e);}catch(e){}return o._telegramBuffer.splice(0,1),void o._sendNextTelegram();}var a=t.to;a||(a=ESP2.RESPONSE_TO),t.timeout=setTimeout(function(){var e=new Error("enocean response timeout");e.code=100;try{n&&n(e);}catch(e){}o._telegramBuffer.splice(0,1),o._sendNextTelegram();},a);});}},ESP2.prototype.onSerialData=function(e){this._rdata=Buffer.concat([this._rdata,e]);for(var t=this._rdata,a=0;a<t.length;){if(165==t[a]){if(a+a>=t.length)break;if(90==t[a+1]){if(a+2>=t.length)break;var r=t[a+2]>>5&7,n=31&t[a+2];if(n<=2)a+=3;else{if(a+3+n>t.length)break;e=t.slice(a+3,a+3+n-1);for(var s=t[a+3+n-1],o=0,i=a+2;i<a+3+n-1;i++){o+=t[i];}if((o&=255)==s){this._logger.log("trace","hseq:"+r+" len:"+n+" data:"+e.toString("hex")+" crc:"+s.toString(16));var l=Telegram.resolve(r,e);try{l&&this._onESP2Telegram(l);}catch(e){this._logger.log("warn","process esp2 telegram exception:"+e.stack);}a=a+3+n;}else this._logger.log("trace","acctual crc:"+o.toString(16)+" expected crc:"+s.toString(16)),a=a+3+n;}}else a+=2;}else a++;}0!=a&&t.length>0&&a<=t.length&&(t=t.slice(a)),this._rdata=t;},ESP2.prototype.onSerialError=function(e){this._serial.setListener(null),this._serial=null;},ESP2.prototype._onESP2Telegram=function(n){if(!(n instanceof e||n instanceof r)){if(this._logger.log("debug","receive enocean telegram:"+JSON.stringify(n.toJSON())),n instanceof t){var s=n.toPayload();this._logger.log("debug","receive enocean payload:"+JSON.stringify(s.toJSON())),this._listeners.forEach(function(e){e._onESP2Telegram&&e._onESP2Telegram(n);});}if(0!=this._telegramBuffer.length&&n instanceof a){var o=this._telegramBuffer[0],i=o.callback,l=o.timeout;l&&clearTimeout(l);try{i&&i(null,n);}catch(e){}this._telegramBuffer.splice(0,1),this._sendNextTelegram();}}},ESP2.TRT=e,ESP2.Payload=n,ESP2.Telegram=Telegram,ESP2;}(),x.hub.m.enocean.profiles=function(){var Profile=function Profile(e){this._address=e?e.address:null,this._senderID=e?e.senderID:null,this._data=e?e.data:null,this._params=e?e.params:null,this._vendor="general",this._virtual=!1,this._eepAlias=null,this.setDefaultParams(),this._states={},this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.profiles."+(this._data?this._data:"Profile"));};Profile.prototype.getAddress=function(){return this._address;},Profile.prototype.getData=function(){return this._data;},Profile.prototype.finalize=function(e){e&&e();},Profile.prototype.evalData=function(e,t,a){var r=this.evalTelegram(t);if(r){var n=this.checkStateChange(r);a&&a(null,n);}else a&&a(new Error("data format invalid"));},Profile.prototype.evalTelegram=function(e){return null;},Profile.prototype.getStatesBuffer=function(){return this._states;},Profile.prototype.getBufferedState=function(e){var t=this.getStatesBuffer();return t&&t[e]?t[e].value:null;},Profile.prototype.getCurrentStates=function(){var e={},t=this.getStatesBuffer();for(var a in t){t.hasOwnProperty(a)&&t[a]&&(e[a]=t[a].value);}return e;},Profile.prototype.getStatesLegacy=function(){var e=this.getCurrentStates();return{type:"ENOCEAN",adr:this._address,data:this._data,vendor:this._vendor,state:e};},Profile.prototype.checkStateChange=function(e){var t=this._states,a=[],r=new Date().getTime();for(var n in e){var s={};s.key=n,s.value=e[n],s.changed=!1;var o=t[n]?t[n].value:null;o!=e[n]&&(s.oldvalue=o,s.changed=!0),this._states[n]={value:e[n],time:r},a.push(s);}return a;},Profile.prototype.setDefaultParams=function(){},Profile.prototype.activeStateChange=function(e){var t=this.checkStateChange(e);t.length>0&&require("x.hub.m.enocean.js")._onEOEvents(this,t);},Profile.prototype.toJSON=function(){return{type:"ENOCEAN",address:this._address,data:this._data,senderID:this._senderID,vendor:this._vendor,virtual:this._virtual,params:this._params};},Profile.prototype.fromJSON=function(e){return e&&e.address&&e.data?e.data!=this._data?null:(this._address=e.address,this._senderID=e.senderID,this._vendor=e.vendor?e.vendor:this._vendor,this._virtual=!!e.virtual,this._params=e.params,this.setDefaultParams(),this):null;},Profile.prototype.toDBJSON=function(){return{id:this._address,senderID:this._senderID,eep:this._data,vendor:this._vendor,params:this._params,virtual:this._virtual};},Profile.prototype.fromDBJSON=function(e){return e&&e.id&&e.eep?e.eep!=this._data?null:(this._address=e.id,this._senderID=e.senderID,this._vendor=e.vendor?e.vendor:this._vendor,this._virtual=!!e.virtual,this._params=e.params,this.setDefaultParams(),this):null;};var SiegeniaWindow=function SiegeniaWindow(e){Profile.call(this,e),this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.profiles.SiegeniaWindow"),this._data="d2-06-50",this._vendor="siegenia",this._desc="Window",this._states={counter00:{value:"?",time:-1},counter01:{value:"?",time:-1},counter02:{value:"?",time:-1},counter03:{value:"?",time:-1},counter04:{value:"?",time:-1},counter05:{value:"?",time:-1},counter06:{value:"?",time:-1},counter07:{value:"?",time:-1},counter08:{value:"?",time:-1},counter09:{value:"?",time:-1},counter0A:{value:"?",time:-1},aliveTimeout:{value:!1,time:-1}};var t=this;this._params=e?e.params:null,this._params||(this._params={alive:900,sync:0,eep:1,type:0,alarm:0,alarm_sens:0}),this._aliveTO=setTimeout(function(){t._aliveTimeout();},2*this._params.alive*1e3),this._lastAlarm=null;};SiegeniaWindow.TEMPALTE={id:null,eep:null,desc:"Window",manufacturer:"SIEGENIA-AUBI KG",vendor:"siegenia",params:{alive:900,sync:0,eep:1,type:0,alarm:0,alarm_sens:0}},(SiegeniaWindow.prototype=new Profile()).constructor=SiegeniaWindow,SiegeniaWindow.prototype.evalTelegram=function(e){var t={};if(210==e.rorg){var a={data:e.userData,rssi:e.optData?e.optData.dBm:0,status:e.status};if(1==a.data[0]&&8==a.data.length){var r={AM:(128&a.data[1])>>7,WDS:239&a.data[1],CT:(a.data[2]<<24)+(a.data[3]<<16)+(a.data[4]<<8)+a.data[5],CB:a.data[6]>>7,BS:127&a.data[6],MOE:a.data[7]>>6,ACE:(48&a.data[7])>>4,MAE:(12&a.data[7])>>2,AE:3&a.data[7]};switch(t={type:1,TBT:!1,batteryOK:!0,battery:r.BS,motionSensor:r.MOE,accelerationSensor:r.ACE,magneticSensor:r.MAE,error:r.AE,count:r.CT},r.CB&&(t.batteryOK=!1),t.battery>100&&(t.battery=100),t.code=r.WDS,r.WDS){case 0:t.state="?",t.handle="?",t.counter00=r.CT;break;case 1:t.state="closed",t.handle="closed",t.counter01=r.CT;break;case 2:t.state="closed",t.handle="open",t.counter02=r.CT;break;case 3:t.state="closed",t.handle="tilted",t.counter03=r.CT;break;case 4:t.state="open",t.handle="closed",t.counter04=r.CT;break;case 5:t.state="open",t.handle="open",t.TBT=!0,t.counter05=r.CT;break;case 6:t.state="open",t.handle="tilted",t.TBT=!0,t.counter06=r.CT;break;case 7:t.state="tilted",t.handle="closed",t.TBT=!0,t.counter07=r.CT;break;case 8:t.state="tilted",t.handle="open",t.TBT=!0,t.counter08=r.CT;break;case 9:t.state="tilted",t.handle="tilted",t.counter09=r.CT;break;case 10:t.state="?",t.handle="?",t.counter0A=r.CT;}}else if(2==a.data[0]&&2==a.data.length){if(t.type=2,1===(15&a.data[1]))t.burglary=!0;else t.burglary=!1;}else if(17==a.data[0]&&2==a.data.length){switch(t.type=17,(192&a.data[1])>>6){case 0:t.calibrationState="ok";break;case 1:t.calibrationState="error";break;case 2:t.calibrationState="invalid";break;case 3:t.calibrationState="not_supported";}var n=63&a.data[1];switch(t.calibrationStep=n,n){case 0:t.calibrationCasement="none",t.calibrationHandle="none";break;case 1:t.calibrationCasement="closed",t.calibrationHandle="closed";break;case 2:t.calibrationCasement="closed",t.calibrationHandle="open";break;case 3:t.calibrationCasement="closed",t.calibrationHandle="tilted";break;case 4:t.calibrationCasement="open",t.calibrationHandle="closed";break;case 5:t.calibrationCasement="open",t.calibrationHandle="open";break;case 6:t.calibrationCasement="open",t.calibrationHandle="tilted";break;case 7:t.calibrationCasement="tilted",t.calibrationHandle="closed";break;case 8:t.calibrationCasement="tilted",t.calibrationHandle="open";break;case 9:t.calibrationCasement="tilted",t.calibrationHandle="tilted";}}}return t;},SiegeniaWindow.prototype.evalData=function(e,t,a){var r=this;r._states.aliveTimeout.value=!1,clearTimeout(this._aliveTO),this._aliveTO=setTimeout(function(){r._aliveTimeout();},2*this._params.alive*1e3);var n=this.evalTelegram(t);if(n){if(2==n.type){var s=new Date().getTime();if(this._lastAlarm&&s-this._lastAlarm<4e3)return void(a&&a(new Error("duplicated alarm")));this._lastAlarm=s;}var o=[];n.aliveMsg||(o=this.checkStateChange(n)),a&&a(null,o);}else a&&a(new Error("data format invalid"));},SiegeniaWindow.prototype.checkStateChange=function(e){var t=this._states,a=[];for(var r in e){if("aliveMsg"!=r&&"type"!=r){var n={};n.key=r,n.value=e[r],n.changed=!1;var s=t[r]?t[r].value:null;s!=e[r]&&(n.oldvalue=s,n.changed=!0),"burglary"!=r&&"calibrationState"!=r&&"calibrationCasement"!=r&&"calibrationHandle"!=r&&(this._states[r]={value:e[r],time:new Date().getTime()}),a.push(n);}}return a;},SiegeniaWindow.prototype._resolveStates=function(e,t){var a={};if(210==e[0]){var r={data:e.slice(1,e.length-5),rssi:t[5],status:e[e.length-1]};if(1==r.data[0]&&8==r.data.length){var n={AM:(128&r.data[1])>>7,WDS:239&r.data[1],CT:(r.data[2]<<24)+(r.data[3]<<16)+(r.data[4]<<8)+r.data[5],CB:r.data[6]>>7,BS:127&r.data[6],MOE:r.data[7]>>6,ACE:(48&r.data[7])>>4,MAE:(12&r.data[7])>>2,AE:3&r.data[7]};switch(a={aliveMsg:1==n.AM,TBT:!1,batteryOK:!0,battery:n.BS,motionSensor:n.MOE,accelerationSensor:n.ACE,magneticSensor:n.MAE,error:n.AE,count:n.CT},n.CB&&(a.batteryOK=!1),a.battery>100&&(a.battery=100),n.WDS){case 0:a.state="closed",a.handle="closed",a.counter00=n.CT;break;case 1:a.state="closed",a.handle="open",a.counter01=n.CT;break;case 2:a.state="open",a.handle="open",a.counter02=n.CT;break;case 3:a.state="closed",a.handle="tilted",a.counter03=n.CT;break;case 4:a.state="tilted",a.handle="tilted",a.counter04=n.CT;break;case 5:a.state="closed",a.handle="tilted",a.TBT=!0,a.counter05=n.CT;break;case 6:a.state="tilted",a.handle="tilted",a.TBT=!0,a.counter06=n.CT;break;case 7:a.state="closed",a.handle="open",a.TBT=!0,a.counter07=n.CT;break;case 8:a.state="open",a.handle="open",a.TBT=!0,a.counter08=n.CT;break;case 9:a.state="open",a.handle="closed",a.counter09=n.CT;break;case 10:a.state="open",a.handle="tilted",a.counter0A=n.CT;}}else if(2==r.data[0]&&2==r.data.length){if(1===(15&r.data[1]))a.burglary=!0;else a.burglary=!1;}else if(17==r.data[0]&&2==r.data.length){switch((192&r.data[1])>>6){case 0:a.calibrationState="ok";break;case 1:a.calibrationState="error";break;case 2:a.calibrationState="invalid";break;case 3:a.calibrationState="not_supported";}switch(63&r.data[1]){case 0:a.calibrationCasement="none",a.calibrationHandle="none";break;case 1:a.calibrationCasement="closed",a.calibrationHandle="closed";break;case 2:a.calibrationCasement="closed",a.calibrationHandle="open";break;case 3:a.calibrationCasement="closed",a.calibrationHandle="tilted";break;case 4:a.calibrationCasement="open",a.calibrationHandle="closed";break;case 5:a.calibrationCasement="open",a.calibrationHandle="open";break;case 6:a.calibrationCasement="open",a.calibrationHandle="tilted";break;case 7:a.calibrationCasement="tilted",a.calibrationHandle="closed";break;case 8:a.calibrationCasement="tilted",a.calibrationHandle="open";break;case 9:a.calibrationCasement="tilted",a.calibrationHandle="tilted";}}}return a;},SiegeniaWindow.prototype._aliveTimeout=function(){this.activeStateChange({aliveTimeout:!0});},SiegeniaWindow.prototype.fromJSON=function(e){return Profile.prototype.fromJSON.call(this,e)?(this._params||(this._params={alive:900,sync:0,eep:1,type:0,alarm:0,alarm_sens:0}),this):null;},SiegeniaWindow.prototype.fromDBJSON=function(e){return Profile.prototype.fromDBJSON.call(this,e)?(this._params||(this._params={alive:900,sync:0,eep:1,type:0,alarm:0,alarm_sens:0}),this):null;};var MacoWindow=function MacoWindow(e){Profile.call(this,e),this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.profiles.MacoWindow"),this._data="d5-xx-xx",this._desc="Window",this._vendor="maco";};MacoWindow.TEMPALTE={id:null,eep:null,desc:"Window",manufacturer:"Mayer & Co Beschläge GmbH"},(MacoWindow.prototype=new Profile()).constructor=MacoWindow,MacoWindow.prototype.evalData=function(e,t,a){var r=this._resolveStates(e,t);if(r){var n=this.checkStateChange(r);a&&a(null,n);}else a&&a(new Error("data format invalid"));},MacoWindow.prototype._resolveStates=function(e,t){var a={};if(213==e[0]){var r={data:e.slice(1,e.length-5),rssi:t[5],status:e[e.length-1]},n={WIN:(48&r.data[0])>>4,LRN:(8&r.data[0])>>3,BS:(6&r.data[0])>>1,BAL:1&r.data[0]};switch(n.WIN){case 0:a.state="unused";break;case 1:a.state="tilted";break;case 2:a.state="open";break;case 3:a.state="closed";}a.learn=n.LRN,a.battery=n.BS,a.alarm=n.BAL;}return a;},MacoWindow.prototype.toDBJSON=function(){return{id:this._address,eep:this._data,desc:this._desc,manufacturer:"Mayer & Co Beschläge GmbH",vendor:this._vendor};};var SodaHandle=function SodaHandle(e){Profile.call(this,e),this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.profiles.SodaHandle"),this._data="f6-so-da";};SodaHandle.TEMPALTE={id:null,eep:null},(SodaHandle.prototype=new Profile()).constructor=SodaHandle,SodaHandle.prototype.evalTelegram=function(e){var t={};if(246==e.rorg)switch(e.userData){case 240:t.state="tilted";break;case 192:t.state="open";break;case 208:t.state="closed";}return t;},SodaHandle.prototype.evalData=function(e,t,a){var r=this.evalTelegram(t);if(r){var n=this.checkStateChange(r);a&&a(null,n);}else a&&a(new Error("data format invalid"));},SodaHandle.prototype.toJSON=function(e,t){return{address:this._address,data:this._data,vendor:"soda"};},SodaHandle.prototype.toDBJSON=function(){return{id:this._address,eep:this._data,desc:"Window_Handle",manufacturer:"SODA",vendor:"soda"};};var F6=function F6(e){Profile.call(this,e),this._data="f6-??-??";};(F6.prototype=new Profile()).constructor=F6;var F6_01_01=function F6_01_01(e){F6.call(this,e),this._data="f6-01-01",this._longPressThreshold=1e3;};F6_01_01.STATES=["button"],F6_01_01.COMMANDS=["shortPress","longPress","press","release"],(F6_01_01.prototype=new F6()).constructor=F6_02_01,F6_01_01.prototype.evalTelegram=function(e){var t={};if(246==e.rorg){var a=e.userData>>4&1?"pressed":"released";t.button=a;}return t;},F6_01_01.prototype.buildData=function(e){return e<<4;},F6_01_01.prototype.checkStateChange=function(e){var t=this._states,a=[],r=new Date().getTime();for(var n in e){var s={};s.key=n,s.value=e[n],s.changed=!1;var o=t[n]?t[n].value:null,i=t[n]?t[n].time:null,l=e[n];o!=l&&(s.oldvalue=o,s.changed=!0),this._states[n]={value:e[n],time:r},s.changed&&a.push(s),"pressed"==o&&"released"==l&&(!i||r-i<this._longPressThreshold?((s={}).key=n,s.value="shortPress",s.changed=!0):((s={}).key=n,s.value="longPress",s.changed=!0),a.push(s));}return a;},F6_01_01.prototype.executeCommand=function(e,t,a){var r,n;if(this._senderID){if(t&&t.value){var s=this,o=100;switch(t.value){case"longPress":o=this._longPressThreshold;case"shortPress":r=this.buildData(1),n=new x.hub.m.enocean.ESP3.Telegram.RPS(r,this._senderID,1,1,0,null),e.sendTelegram(n,!0,function(t){t?a&&a(t):(s.activeStateChange({button:"pressed"}),setTimeout(function(){r=s.buildData(0),n=new x.hub.m.enocean.ESP3.Telegram.RPS(r,s._senderID,1,1,0,null),e.sendTelegram(n,!0,function(e){s.activeStateChange({button:"released"}),a&&a(e);});},o));});break;case"press":r=this.buildData(1),n=new x.hub.m.enocean.ESP3.Telegram.RPS(r,this._senderID,1,1,0,null),e.sendTelegram(n,!0,function(e){s.activeStateChange({button:"pressed"}),a&&a(e);});break;case"release":r=this.buildData(0),n=new x.hub.m.enocean.ESP3.Telegram.RPS(r,this._senderID,1,1,0,null),e.sendTelegram(n,!0,function(e){s.activeStateChange({button:"released"}),a&&a(e);});}}else a&&a(new Error("command invalid"));}else a&&a(new Error("sender id is null"));};var F6_02_01=function F6_02_01(e){F6.call(this,e),this._data="f6-02-01",this._longPressThreshold=1e3;};F6_02_01.STATES=["buttonAI","buttonAO","buttonBI","buttonBO"],F6_02_01.COMMANDS=["shortPressAI","longPressAI","pressAI","releaseAI","shortPressAO","longPressAO","pressAO","releaseAO","shortPressBI","longPressBI","pressBI","releaseBI","shortPressBO","longPressBO","pressBO","releaseBO"],F6_02_01.prototype=new F6(),F6_02_01.prototype.constructor=F6_02_01,F6_02_01.prototype.evalTelegram=function(e){var t={};if(246==e.rorg){var a,r,n,s,o=e.userData>>5&7,i=e.userData>>4&1,l=e.userData>>1&7,u=1&e.userData,c=e.t21,h=e.nu,_=i?"pressed":"released";if(1==c&&1==h){switch(o){case 0:a=_;break;case 1:r=_;break;case 2:n=_;break;case 3:s=_;}if(u)switch(l){case 0:a=_;break;case 1:r=_;break;case 2:n=_;break;case 3:s=_;}}else if(1==c&&0==h&&0===o)a=_,r=_,n=_,s=_;a&&(t.buttonAI=a),r&&(t.buttonAO=r),n&&(t.buttonBI=n),s&&(t.buttonBO=s);}return t;},F6_02_01.prototype.buildData=function(e,t,a,r){return e<<5|t<<4|a<<1|r;},F6_02_01.prototype.checkStateChange=function(e){var t=this._states,a=[],r=new Date().getTime();for(var n in e){var s={};s.key=n,s.value=e[n],s.changed=!1;var o=t[n]?t[n].value:null,i=t[n]?t[n].time:null,l=e[n];o!=l&&(s.oldvalue=o,s.changed=!0),this._states[n]={value:e[n],time:r},s.changed&&("pressed"==l||"released"==l&&"pressed"==o)&&a.push(s),"pressed"==o&&"released"==l&&(!i||r-i<this._longPressThreshold?((s={}).key=n,s.value="shortPress",s.changed=!0):((s={}).key=n,s.value="longPress",s.changed=!0),a.push(s));}return a;},F6_02_01.prototype.executeCommand=function(e,t,a){var r,n;if(this._senderID){if(t&&t.value){var s=this,o=100,i=t.value.substr(t.value.length-2),l={},u=0;switch(i){case"AI":u=0;break;case"AO":u=1;break;case"BI":u=2;break;case"BO":u=3;}switch(t.value){case"longPressAI":case"longPressAO":case"longPressBI":case"longPressBO":o=this._longPressThreshold;case"shortPressAI":case"shortPressAO":case"shortPressBI":case"shortPressBO":r=this.buildData(u,1,0,0),n=new x.hub.m.enocean.ESP3.Telegram.RPS(r,this._senderID,1,1,0,null),e.sendTelegram(n,!0,function(t){t?a&&a(t):(l["button"+i]="pressed",s.activeStateChange(l),setTimeout(function(){r=s.buildData(0,0,0,0),n=new x.hub.m.enocean.ESP3.Telegram.RPS(r,s._senderID,1,1,0,null),e.sendTelegram(n,!0,function(e){l["button"+i]="released",s.activeStateChange(l),a&&a(e);});},o));});break;case"pressAI":case"pressAO":case"pressBI":case"pressBO":r=this.buildData(u,1,0,0),n=new x.hub.m.enocean.ESP3.Telegram.RPS(r,this._senderID,1,1,0,null),e.sendTelegram(n,!0,function(e){l["button"+i]="pressed",s.activeStateChange(l),a&&a(e);});break;case"releaseAI":case"releaseAO":case"releaseBI":case"releaseBO":r=s.buildData(0,0,0,0),n=new x.hub.m.enocean.ESP3.Telegram.RPS(r,this._senderID,1,1,0,null),e.sendTelegram(n,!0,function(e){l["button"+i]="released",s.activeStateChange(l),a&&a(e);});break;default:a&&a(new Error("unknow command"));}}else a&&a(new Error("command invalid"));}else a&&a(new Error("sender id is null"));};var F6_02_02=function F6_02_02(e){F6_02_01.call(this,e),this._data="f6-02-02";};F6_02_01.STATES=["buttonAI","buttonAO","buttonBI","buttonBO"],F6_02_02.COMMANDS=["shortPressAI","longPressAI","pressAI","releaseAI","shortPressAO","longPressAO","pressAO","releaseAO","shortPressBI","longPressBI","pressBI","releaseBI","shortPressBO","longPressBO","pressBO","releaseBO"],(F6_02_02.prototype=new F6_02_01()).constructor=F6_02_02;var F6_02_03=function F6_02_03(e){F6.call(this,e),this._data="f6-02-03";};F6_02_03.STATES=["state"],F6_02_03.COMMANDS=["auto","manu","dimUp","dimDown"],(F6_02_03.prototype=new F6()).constructor=F6_02_03,F6_02_03.prototype.evalTelegram=function(e){var t={};if(246==e.rorg)switch(e.userData){case 48:t.state="auto";break;case 16:t.state="manu";break;case 112:t.state="dimUp";break;case 80:t.state="dimDown";}return t;},F6_02_03.prototype.executeCommand=function(e,t,a){var r,n;if(this._senderID){if(t&&t.value){switch(t.value){case"auto":r=48;break;case"manu":r=16;break;case"dimUp":r=112;break;case"dimDown":r=80;break;default:a&&a(new Error("unknow command"));}this.activeStateChange({state:t.value}),n=new x.hub.m.enocean.ESP3.Telegram.RPS(r,this._senderID,1,1,0,null),e.sendTelegram(n,!0,function(e){a&&a(e);});}else a&&a(new Error("command invalid"));}else a&&a(new Error("sender id is null"));};var F6_02_04=function F6_02_04(e){F6_02_01.call(this,e),this._data="f6-02-04",this._longPressThreshold=1e3;};F6_02_04.STATES=["buttonAI","buttonAO","buttonBI","buttonBO","energyBow"],(F6_02_04.prototype=new F6_02_01()).constructor=F6_02_04,F6_02_04.prototype.evalTelegram=function(e){var t={};if(246==e.rorg){var a=e.userData>>7&1,r=e.userData>>3&1,n=e.userData>>2&1,s=e.userData>>1&1,o=1&e.userData;t.energyBow=a?"pressed":"released",t.buttonBI=r?"pressed":"released",t.buttonBO=n?"pressed":"released",t.buttonAI=s?"pressed":"released",t.buttonAO=o?"pressed":"released";}return t;};var F6_03_01=function F6_03_01(e){F6_02_01.call(this,e),this._data="f6-03-01",this._longPressThreshold=1e3;};F6_03_01.STATES=["buttonAI","buttonAO","buttonBI","buttonBO","buttonCI","buttonCO","buttonDI","buttonDO"],F6_03_01.COMMANDS=["shortPressAI","longPressAI","pressAI","releaseAI","shortPressAO","longPressAO","pressAO","releaseAO","shortPressBI","longPressBI","pressBI","releaseBI","shortPressBO","longPressBO","pressBO","releaseBO","shortPressCI","longPressCI","pressCI","releaseCI","shortPressCO","longPressCO","pressCO","releaseCO","shortPressDI","longPressDI","pressDI","releaseDI","shortPressDO","longPressDO","pressDO","releaseDO"],(F6_03_01.prototype=new F6_02_01()).constructor=F6_03_01,F6_03_01.prototype.evalTelegram=function(e){var t={};if(246==e.rorg){var a,r,n,s,o,i,l,u,c=e.userData>>5&7,h=e.userData>>4&1,_=e.userData>>1&7,p=1&e.userData,d=e.t21,v=e.nu,f=h?"pressed":"released";if(0==d&&1==v){switch(c){case 0:a=f;break;case 1:r=f;break;case 2:n=f;break;case 3:s=f;break;case 4:o=f;break;case 5:i=f;break;case 6:l=f;break;case 7:u=f;}if(p)switch(_){case 0:a=f;break;case 1:r=f;break;case 2:n=f;break;case 3:s=f;break;case 4:o=f;break;case 5:i=f;break;case 6:l=f;break;case 7:u=f;}}else if(0==d&&0==v)switch(c){case 0:case 7:a=f,r=f,n=f,s=f,o=f,i=f,l=f,u=f;}a&&(t.buttonAI=a),r&&(t.buttonAO=r),n&&(t.buttonBI=n),s&&(t.buttonBO=s),o&&(t.buttonCI=o),i&&(t.buttonCO=i),l&&(t.buttonDI=l),u&&(t.buttonDO=u);}return t;},F6_03_01.prototype.executeCommand=function(e,t,a){var r,n;if(this._senderID){if(t&&t.value){var s=this,o=100,i=t.value.substr(t.value.length-2),l={},u=0;switch(i){case"AI":u=0;break;case"AO":u=1;break;case"BI":u=2;break;case"BO":u=3;break;case"CI":u=4;break;case"CO":u=5;break;case"DI":u=6;break;case"DO":u=7;}switch(t.value){case"longPressAI":case"longPressAO":case"longPressBI":case"longPressBO":case"longPressCI":case"longPressCO":case"longPressDI":case"longPressDO":o=this._longPressThreshold;case"shortPressAI":case"shortPressAO":case"shortPressBI":case"shortPressBO":case"shortPressCI":case"shortPressCO":case"shortPressDI":case"shortPressDO":r=this.buildData(u,1,0,0),n=new x.hub.m.enocean.ESP3.Telegram.RPS(r,this._senderID,1,1,0,null),e.sendTelegram(n,!0,function(t){t?a&&a(t):(l["button"+i]="pressed",s.activeStateChange(l),setTimeout(function(){r=s.buildData(0,0,0,0),n=new x.hub.m.enocean.ESP3.Telegram.RPS(r,s._senderID,1,1,0,null),e.sendTelegram(n,!0,function(e){l["button"+i]="released",s.activeStateChange(l),a&&a(e);});},o));});break;case"pressAI":case"pressAO":case"pressBI":case"pressBO":case"pressCI":case"pressCO":case"pressDI":case"pressDO":r=this.buildData(u,1,0,0),n=new x.hub.m.enocean.ESP3.Telegram.RPS(r,this._senderID,1,1,0,null),e.sendTelegram(n,!0,function(e){l["button"+i]="pressed",s.activeStateChange(l),a&&a(e);});break;case"releaseAI":case"releaseAO":case"releaseBI":case"releaseBO":case"releaseCI":case"releaseCO":case"releaseDI":case"releaseDO":r=s.buildData(0,0,0,0),n=new x.hub.m.enocean.ESP3.Telegram.RPS(r,this._senderID,1,1,0,null),e.sendTelegram(n,!0,function(e){l["button"+i]="released",s.activeStateChange(l),a&&a(e);});break;default:a&&a(new Error("unknow command"));}}else a&&a(new Error("command invalid"));}else a&&a(new Error("sender id is null"));};var F6_03_02=function F6_03_02(e){F6_03_01.call(this,e),this._data="f6-03-02";};F6_03_02.STATES=["buttonAI","buttonAO","buttonBI","buttonBO","buttonCI","buttonCO","buttonDI","buttonDO"],F6_03_02.COMMANDS=["shortPressAI","longPressAI","pressAI","releaseAI","shortPressAO","longPressAO","pressAO","releaseAO","shortPressBI","longPressBI","pressBI","releaseBI","shortPressBO","longPressBO","pressBO","releaseBO","shortPressCI","longPressCI","pressCI","releaseCI","shortPressCO","longPressCO","pressCO","releaseCO","shortPressDI","longPressDI","pressDI","releaseDI","shortPressDO","longPressDO","pressDO","releaseDO"],(F6_03_02.prototype=new F6_03_01()).constructor=F6_03_02;var F6_04_01=function F6_04_01(e){F6.call(this,e),this._data="f6-04-01";};F6_04_01.STATES=["keycard"],(F6_04_01.prototype=new F6()).constructor=F6_04_01,F6_04_01.prototype.evalTelegram=function(e){var t={};if(246==e.rorg){var a=e.t21,r=e.nu,n=e.userData;1==a&&1==r&&112==n?t.keycard="inserted":1==a&&0==r&&0==n&&(t.keycard="takeout");}return t;};var F6_04_02=function F6_04_02(e){F6.call(this,e),this._data="f6-04-02";};F6_04_02.STATES=["keycard"],(F6_04_02.prototype=new F6()).constructor=F6_04_02,F6_04_02.prototype.evalTelegram=function(e){var t={};if(246==e.rorg){var a=e.userData>>7&1,r=e.userData>>2&1;1==a&&1==r?t.keycard="inserted":0==a&&0==r&&(t.keycard="takeout");}return t;};var F6_05_00=function F6_05_00(e){F6.call(this,e),this._data="f6-05-00";};F6_05_00.STATES=["wind","lowbat"],(F6_05_00.prototype=new F6()).constructor=F6_05_00,F6_05_00.prototype.evalTelegram=function(e){var t={};if(246==e.rorg)switch(e.userData){case 0:t.wind="ok",this._states.lowbat||(t.lowbat=!1);break;case 16:t.wind="alarm",this._states.lowbat||(t.lowbat=!1);break;case 48:t.lowbat=!0;}return t;};var F6_05_01=function F6_05_01(e){F6.call(this,e),this._data="f6-05-01";};F6_05_01.COMMANDS=["reset"],F6_05_01.STATES=["water"],(F6_05_01.prototype=new F6()).constructor=F6_05_01,F6_05_01.prototype.evalTelegram=function(e){var t={};if(246==e.rorg){var a=e.t21,r=e.nu,n=e.userData;1==a&&1==r&&17==n&&(t.water="alarm");}return t;},F6_05_01.prototype.executeCommand=function(e,t,a){if(t&&t.value){if("reset"===t.value)this.activeStateChange({water:"ok"}),a&&a();else a&&a(new Error("no such command"));}else a&&a(new Error("command invalid"));};var F6_05_02=function F6_05_02(e){F6.call(this,e),this._data="f6-05-02";};F6_05_02.STATES=["smoke","lowbat"],(F6_05_02.prototype=new F6()).constructor=F6_05_02,F6_05_02.prototype.evalTelegram=function(e){var t={};if(246==e.rorg)switch(e.userData){case 0:t.smoke="ok",this._states.lowbat||(t.lowbat=!1);break;case 16:t.smoke="alarm",this._states.lowbat||(t.lowbat=!1);break;case 48:t.lowbat=!0;}return t;};var F6_10_00=function F6_10_00(e){F6.call(this,e),this._data="f6-10-00";};F6_10_00.STATES=["window","handle_pos","handle_raw"],(F6_10_00.prototype=new F6()).constructor=F6_10_00,F6_10_00.prototype.evalTelegram=function(e){var t={};if(246==e.rorg){var a=e.userData,r=parseInt("11010000",2),n=parseInt("11000000",2),s=parseInt("11110000",2),o=parseInt("11110000",2),i=parseInt("11110000",2),l=parseInt("11010000",2);0==(a&r^n)?(t.window="open",t.handle_pos="middle"):0==(a&s^o)?(t.window="closed",t.handle_pos="down"):0==(a&i^l)&&(t.window="tilted",t.handle_pos="up"),t.handle_raw=a;}return t;};var F6_10_01=function F6_10_01(e){F6.call(this,e),this._data="f6-10-01";};F6_10_01.STATES=["window","handle_pos","handle_raw"],(F6_10_01.prototype=new F6()).constructor=F6_10_01,F6_10_01.prototype.evalTelegram=function(e){var t={};if(246==e.rorg){e.userData;var a=15&e.userData,r=parseInt("1101",2),n=parseInt("1100",2),s=parseInt("1111",2),o=parseInt("1111",2),i=parseInt("1111",2),l=parseInt("1101",2);0==(a&r^n)?(t.window="open",t.handle_pos="middle"):0==(a&s^o)?(t.window="closed",t.handle_pos="down"):0==(a&i^l)&&(t.window="tilted",t.handle_pos="up"),t.handle_raw=a;}return t;};var D5=function D5(e){Profile.call(this,e),this._data="d5-??-??";};(D5.prototype=new Profile()).constructor=D5;var D5_00_01=function D5_00_01(e){D5.call(this,e),this._data="d5-00-01";};D5_00_01.STATES=["contact","contact_raw"],(D5_00_01.prototype=new D5()).constructor=D5_00_01,D5_00_01.prototype.evalTelegram=function(e){var t={};if(213==e.rorg){var a=e.userData;if(1==(a>>3&1)){var r=1&a;t.contact=r?"closed":"open",t.contact_raw=r;}}return t;};var A5=function A5(e){Profile.call(this,e),this._data="a5-??-??",this.TEACH_IN_VARIATION=2,this.UNIQUE_GATEWAY_SENDERID=!0;};(A5.prototype=new Profile()).constructor=A5,A5.prototype.getTeachinType=function(){return"4BS";},A5.prototype.isTeachinBidirectional=function(){return!1;};var A5_02=function A5_02(e){A5.call(this,e),this._data="a5-02-??",this._tmpMin=-40,this._tmpMax=0;};A5_02.STATES=["temperature","temperature_raw"],(A5_02.prototype=new A5()).constructor=A5_02,A5_02.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(2);if(1==(a>>3&1)){var n=r;t.temperature=parseFloat(((255-n)/255*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1)),t.temperature_raw=n;}}return t;};var A5_02_01=function A5_02_01(e){A5_02.call(this,e),this._data="a5-02-01",this._tmpMin=-40,this._tmpMax=0;};A5_02_01.STATES=["temperature","temperature_raw"],(A5_02_01.prototype=new A5_02()).constructor=A5_02_01;var A5_02_02=function A5_02_02(e){A5_02.call(this,e),this._data="a5-02-02",this._tmpMin=-30,this._tmpMax=10;};A5_02_02.STATES=["temperature","temperature_raw"],(A5_02_02.prototype=new A5_02()).constructor=A5_02_02;var A5_02_03=function A5_02_03(e){A5_02.call(this,e),this._data="a5-02-03",this._tmpMin=-20,this._tmpMax=20;};A5_02_03.STATES=["temperature","temperature_raw"],(A5_02_03.prototype=new A5_02()).constructor=A5_02_03;var A5_02_04=function A5_02_04(e){A5_02.call(this,e),this._data="a5-02-04",this._tmpMin=-10,this._tmpMax=30;};A5_02_04.STATES=["temperature","temperature_raw"],(A5_02_04.prototype=new A5_02()).constructor=A5_02_04;var A5_02_05=function A5_02_05(e){A5_02.call(this,e),this._data="a5-02-05",this._tmpMin=0,this._tmpMax=40;};A5_02_05.STATES=["temperature","temperature_raw"],(A5_02_05.prototype=new A5_02()).constructor=A5_02_05;var A5_02_06=function A5_02_06(e){A5_02.call(this,e),this._data="a5-02-06",this._tmpMin=10,this._tmpMax=50;};A5_02_06.STATES=["temperature","temperature_raw"],(A5_02_06.prototype=new A5_02()).constructor=A5_02_06;var A5_02_07=function A5_02_07(e){A5_02.call(this,e),this._data="a5-02-07",this._tmpMin=20,this._tmpMax=60;};A5_02_07.STATES=["temperature","temperature_raw"],(A5_02_07.prototype=new A5_02()).constructor=A5_02_07;var A5_02_08=function A5_02_08(e){A5_02.call(this,e),this._data="a5-02-08",this._tmpMin=30,this._tmpMax=70;};A5_02_08.STATES=["temperature","temperature_raw"],(A5_02_08.prototype=new A5_02()).constructor=A5_02_08;var A5_02_09=function A5_02_09(e){A5_02.call(this,e),this._data="a5-02-09",this._tmpMin=40,this._tmpMax=80;};A5_02_09.STATES=["temperature","temperature_raw"],(A5_02_09.prototype=new A5_02()).constructor=A5_02_09;var A5_02_0A=function A5_02_0A(e){A5_02.call(this,e),this._data="a5-02-0a",this._tmpMin=50,this._tmpMax=90;};A5_02_0A.STATES=["temperature","temperature_raw"],(A5_02_0A.prototype=new A5_02()).constructor=A5_02_0A;var A5_02_0B=function A5_02_0B(e){A5_02.call(this,e),this._data="a5-02-0b",this._tmpMin=60,this._tmpMax=100;};A5_02_0B.STATES=["temperature","temperature_raw"],(A5_02_0B.prototype=new A5_02()).constructor=A5_02_0B;var A5_02_10=function A5_02_10(e){A5_02.call(this,e),this._data="a5-02-10",this._tmpMin=-60,this._tmpMax=20;};A5_02_10.STATES=["temperature","temperature_raw"],(A5_02_10.prototype=new A5_02()).constructor=A5_02_10;var A5_02_11=function A5_02_11(e){A5_02.call(this,e),this._data="a5-02-11",this._tmpMin=-50,this._tmpMax=30;};A5_02_11.STATES=["temperature","temperature_raw"],(A5_02_11.prototype=new A5_02()).constructor=A5_02_11;var A5_02_12=function A5_02_12(e){A5_02.call(this,e),this._data="a5-02-12",this._tmpMin=-40,this._tmpMax=40;};A5_02_12.STATES=["temperature","temperature_raw"],(A5_02_12.prototype=new A5_02()).constructor=A5_02_12;var A5_02_13=function A5_02_13(e){A5_02.call(this,e),this._data="a5-02-13",this._tmpMin=-30,this._tmpMax=50;};A5_02_13.STATES=["temperature","temperature_raw"],(A5_02_13.prototype=new A5_02()).constructor=A5_02_13;var A5_02_14=function A5_02_14(e){A5_02.call(this,e),this._data="a5-02-14",this._tmpMin=-20,this._tmpMax=60;};A5_02_14.STATES=["temperature","temperature_raw"],(A5_02_14.prototype=new A5_02()).constructor=A5_02_14;var A5_02_15=function A5_02_15(e){A5_02.call(this,e),this._data="a5-02-15",this._tmpMin=-10,this._tmpMax=70;};A5_02_15.STATES=["temperature","temperature_raw"],(A5_02_15.prototype=new A5_02()).constructor=A5_02_15;var A5_02_16=function A5_02_16(e){A5_02.call(this,e),this._data="a5-02-16",this._tmpMin=0,this._tmpMax=80;};A5_02_16.STATES=["temperature","temperature_raw"],(A5_02_16.prototype=new A5_02()).constructor=A5_02_16;var A5_02_17=function A5_02_17(e){A5_02.call(this,e),this._data="a5-02-17",this._tmpMin=10,this._tmpMax=90;};A5_02_17.STATES=["temperature","temperature_raw"],(A5_02_17.prototype=new A5_02()).constructor=A5_02_17;var A5_02_18=function A5_02_18(e){A5_02.call(this,e),this._data="a5-02-18",this._tmpMin=20,this._tmpMax=100;};A5_02_18.STATES=["temperature","temperature_raw"],(A5_02_18.prototype=new A5_02()).constructor=A5_02_18;var A5_02_19=function A5_02_19(e){A5_02.call(this,e),this._data="a5-02-19",this._tmpMin=30,this._tmpMax=110;};A5_02_19.STATES=["temperature","temperature_raw"],(A5_02_19.prototype=new A5_02()).constructor=A5_02_19;var A5_02_1A=function A5_02_1A(e){A5_02.call(this,e),this._data="a5-02-1a",this._tmpMin=40,this._tmpMax=120;};A5_02_1A.STATES=["temperature","temperature_raw"],(A5_02_1A.prototype=new A5_02()).constructor=A5_02_1A;var A5_02_1B=function A5_02_1B(e){A5_02.call(this,e),this._data="a5-02-1b",this._tmpMin=50,this._tmpMax=130;};A5_02_1B.STATES=["temperature","temperature_raw"],(A5_02_1B.prototype=new A5_02()).constructor=A5_02_1B;var A5_02_20=function A5_02_20(e){A5.call(this,e),this._data="a5-02-20",this._tmpMin=-10,this._tmpMax=41.2;};A5_02_20.STATES=["temperature","temperature_raw"],(A5_02_20.prototype=new A5()).constructor=A5_02_20,A5_02_20.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt16BE(1);if(1==(a>>3&1)){var n=1023&r;t.temperature=parseFloat(((1023-n)/1023*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1)),t.temperature_raw=n;}}return t;};var A5_02_30=function A5_02_30(e){A5_02_20.call(this,e),this._data="a5-02-30",this._tmpMin=-40,this._tmpMax=62.3;};A5_02_30.STATES=["temperature","temperature_raw"],(A5_02_30.prototype=new A5_02_20()).constructor=A5_02_30;var A5_04=function A5_04(e){A5.call(this,e),this._data="a5-04-??",this._humMin=0,this._humMax=100,this._tempMin=0,this._tempMax=40;};A5_04.STATES=["humidity","humidity_raw","temperature","temperature_raw","available"],(A5_04.prototype=new A5()).constructor=A5_04,A5_04.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(2),n=e.userData.readUInt8(1);if(1==(a>>3&1)){var s=n;t.humidity=parseFloat((s/250*(this._humMax-this._humMin)+this._humMin).toFixed(1)),t.humidity_raw=s;var o=r;t.temperature=parseFloat((o/250*(this._tempMax-this._tempMin)+this._tempMin).toFixed(1)),t.temperature_raw=o;var i=a>>1&1;t.available=!!i;}}return t;};var A5_04_01=function A5_04_01(e){A5_04.call(this,e),this._data="a5-04-01";};A5_04_01.STATES=A5_04.STATES,(A5_04_01.prototype=new A5_04()).constructor=A5_04_01;var A5_04_02=function A5_04_02(e){A5_04.call(this,e),this._data="a5-04-02",this._tempMin=-20,this._tempMax=60;};A5_04_02.STATES=A5_04.STATES,(A5_04_02.prototype=new A5_04()).constructor=A5_04_02;var A5_04_03=function A5_04_03(e){A5_04.call(this,e),this._data="a5-04-03",this._tempMin=-20,this._tempMax=60;};A5_04_03.STATES=["humidity","humidity_raw","temperature","temperature_raw","type"],(A5_04_03.prototype=new A5_04()).constructor=A5_04_03,A5_04_03.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt16BE(1),n=e.userData.readUInt8(0);if(1==(a>>3&1)){var s=n;t.humidity=parseFloat((s/255*(this._humMax-this._humMin)+this._humMin).toFixed(1)),t.humidity_raw=s;var o=1023&r;t.temperature=parseFloat((o/1023*(this._tempMax-this._tempMin)+this._tempMin).toFixed(1)),t.temperature_raw=o;var i=1&a;t.type=i?"event":"heartbeat";}}return t;};var A5_06=function A5_06(e){A5.call(this,e),this._data="a5-06-??",this._svcMin=0,this._svcMax=5.1,this._ill2Min=300,this._ill2Max=3e4,this._ill1Min=600,this._ill1Max=6e4;};A5_06.STATES=["voltage","voltage_raw","illumination2","illumination2_raw","illumination1","illumination1_raw","illumination","illumination_raw","range","range_raw"],(A5_06.prototype=new A5()).constructor=A5_06,A5_06.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(2),n=e.userData.readUInt8(1),s=e.userData.readUInt8(0);if(1==(a>>3&1)){var o=s;t.voltage=parseFloat((o/255*(this._svcMax-this._svcMin)+this._svcMin).toFixed(1)),t.voltage_raw=o;var i=n;t.illumination2=parseFloat((i/255*(this._ill2Max-this._ill2Min)+this._ill2Min).toFixed(1)),t.illumination2_raw=i;var l=r;t.illumination1=parseFloat((l/255*(this._ill1Max-this._ill1Min)+this._ill1Min).toFixed(1)),t.illumination1_raw=l;var u=1&a;switch(u){case 0:t.range="db1",t.illumination=t.illumination1,t.illumination_raw=l;break;case 1:t.range="db2",t.illumination=t.illumination2,t.illumination_raw=l;}t.range_raw=u;}}return t;};var A5_06_01=function A5_06_01(e){A5_06.call(this,e),this._data="a5-06-01";};A5_06_01.STATES=A5_06.STATES,(A5_06_01.prototype=new A5_06()).constructor=A5_06_01;var A5_06_02=function A5_06_02(e){A5_06.call(this,e),this._data="a5-06-02",this._ill2Min=0,this._ill2Max=510,this._ill1Min=0,this._ill1Max=1020;};A5_06_02.STATES=A5_06.STATES,(A5_06_02.prototype=new A5_06()).constructor=A5_06_02;var A5_06_03=function A5_06_03(e){A5_06.call(this,e),this._data="a5-06-03",this._svcMin=0,this._svcMax=5.1;};A5_06_03.STATES=["voltage","voltage_raw","illumination","illumination_raw"],(A5_06_03.prototype=new A5_06()).constructor=A5_06_03,A5_06_03.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt16BE(1),n=e.userData.readUInt8(0);if(1==(a>>3&1)){var s=n;t.voltage=parseFloat((s/255*(this._svcMax-this._svcMin)+this._svcMin).toFixed(1)),t.voltage_raw=s;var o=r>>6&1023;t.illumination=o,t.illumination_raw=o;}}return t;};var A5_06_04=function A5_06_04(e){A5_06.call(this,e),this._data="a5-06-04",this._tmpMin=-20,this._tmpMax=60;};A5_06_04.STATES=["temperature","temperature_raw","illumination","illumination_raw","energy","energy_raw","temperature_avail","energy_avail"],(A5_06_04.prototype=new A5_06()).constructor=A5_06_04,A5_06_04.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt16BE(1),n=e.userData.readUInt8(0);if(1==(a>>3&1)){var s=n;t.temperature=parseFloat((s/255*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1)),t.temperature_raw=s;var o=r;t.illumination=o,t.illumination_raw=o;var i=a>>4&15;t.energy=parseFloat((i/15*100).toFixed(1)),t.energy_raw=i;var l=a>>1&1;t.temperature_avail=!!l,t.temperature_avail||delete t.temperature;var u=1&a;t.energy_avail=!!u,t.energy_avail||delete t.energy;}}return t;};var A5_06_05=function A5_06_05(e){A5_06.call(this,e),this._data="a5-06-05",this._ill2Min=0,this._ill2Max=5100,this._ill1Min=0,this._ill1Max=10200;};A5_06_05.STATES=A5_06.STATES,(A5_06_05.prototype=new A5_06()).constructor=A5_06_05;var A5_07=function A5_07(e){A5.call(this,e),this._data="a5-07-??",this._params||(this._params={reset_timeout:30}),this._resetTO=null;};A5_07.COMMANDS=["reset"],(A5_07.prototype=new A5()).constructor=A5_07,A5_07.prototype._startPIROffTO=function(){if(this._resetTO&&(clearTimeout(this._resetTO),this._resetTO=null),this._params.reset_timeout&&!(this._params.reset_timeout<0)){var e=this;this._resetTO=setTimeout(function(){e._resetTO=null,e._reset();},1e3*this._params.reset_timeout);}},A5_07.prototype._stopPIROffTO=function(){this._resetTO&&(clearTimeout(this._resetTO),this._resetTO=null);},A5_07.prototype._reset=function(){this._resetTO&&(clearTimeout(this._resetTO),this._resetTO=null);var e={key:"state",value:"off",changed:!1},t=this._states.state?this._states.state.value:null;"off"!=t&&(e.oldvalue=t,e.changed=!0),this._states.state={value:"off",time:new Date().getTime()},require("x.hub.m.enocean.js")._onEOEvents(this,[e]);},A5_07.prototype.executeCommand=function(e,t,a){if(t&&t.value){if("reset"===t.value)this._reset(),a&&a();else a&&a(new Error("no such command"));}else a&&a(new Error("command invalid"));},A5_07.prototype.fromJSON=function(e){return Profile.prototype.fromJSON.call(this,e)?(this._params||(this._params={reset_timeout:30}),this):null;},A5_07.prototype.fromDBJSON=function(e){return Profile.prototype.fromDBJSON.call(this,e)?(this._params||(this._params={reset_timeout:30}),this):null;};var A5_07_01=function A5_07_01(e){A5_07.call(this,e),this._data="a5-07-01";};A5_07_01.COMMANDS=["reset"],A5_07_01.STATES=["voltage","voltage_raw","state","state_raw","voltage_avail"],(A5_07_01.prototype=new A5_07()).constructor=A5_07_01,A5_07_01.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(2),n=e.userData.readUInt8(0);if(1==(a>>3&1)){var s=n;t.voltage=parseFloat((s/250*5).toFixed(1)),t.voltage_raw=s;var o=r;t.state=o>=128?"on":"off",t.state_raw=o;var i=1&a;t.voltage_avail=!!i,t.voltage_avail||delete t.voltage;}}return"on"==t.state?this._startPIROffTO():"off"==t.state&&this._stopPIROffTO(),t;};var A5_07_02=function A5_07_02(e){A5_07.call(this,e),this._data="a5-07-02";};A5_07_02.COMMANDS=["reset"],A5_07_02.STATES=["voltage","voltage_raw","state","state_raw"],(A5_07_02.prototype=new A5_07()).constructor=A5_07_02,A5_07_02.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(0);if(1==(a>>3&1)){var n=r;t.voltage=parseFloat((n/250*5).toFixed(1)),t.voltage_raw=n;var s=a>>7&1;t.state=s?"on":"off",t.state_raw=s;}}return"on"==t.state?this._startPIROffTO():"off"==t.state&&this._stopPIROffTO(),t;};var A5_07_03=function A5_07_03(e){A5_07.call(this,e),this._data="a5-07-03";};A5_07_03.COMMANDS=["reset"],A5_07_03.STATES=["voltage","voltage_raw","illumination","illumination_raw","state","state_raw"],(A5_07_03.prototype=new A5_07()).constructor=A5_07_03,A5_07_03.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt16BE(1),n=e.userData.readUInt8(0);if(1==(a>>3&1)){var s=n;t.voltage=parseFloat((s/250*5).toFixed(1)),t.voltage_raw=s;var o=r>>6&1023;t.illumination=o,t.illumination_raw=o;var i=a>>7&1;t.state=i?"on":"off",t.state_raw=i;}}return"on"==t.state?this._startPIROffTO():"off"==t.state&&this._stopPIROffTO(),t;};var A5_08=function A5_08(e){A5.call(this,e),this._data="a5-08-??",this._svcMin=0,this._svcMax=5.1,this._illMin=0,this._illMax=510,this._tmpMin=0,this._tmpMax=51;};(A5_08.prototype=new A5()).constructor=A5_08,A5_08.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(2),n=e.userData.readUInt8(1),s=e.userData.readUInt8(0);if(1==(a>>3&1)){var o=s;t.voltage=parseFloat((o/255*(this._svcMax-this._svcMin)+this._svcMin).toFixed(1)),t.voltage_raw=o;var i=n;t.illumination=parseFloat((i/255*(this._illMax-this._illMin)+this._illMin).toFixed(1)),t.illumination_raw=i;var l=r;t.temperature=parseFloat((l/255*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1)),t.temperature_raw=l;var u=a>>1&1;switch(u){case 0:t.state="on";break;case 1:t.state="off";}t.state_raw=u;var c=1&a;switch(c){case 0:t.button="pressed";break;case 1:t.button="released";}t.button_raw=c;}}return t;};var A5_08_01=function A5_08_01(e){A5_08.call(this,e),this._data="a5-08-01";};A5_08_01.STATES=["voltage","voltage_raw","illumination","illumination_raw","temperature","temperature_raw","state","state_raw","button","button_raw"],(A5_08_01.prototype=new A5_08()).constructor=A5_08_01;var A5_08_02=function A5_08_02(e){A5_08.call(this,e),this._data="a5-08-02",this._illMax=1020;};A5_08_02.STATES=["voltage","voltage_raw","illumination","illumination_raw","temperature","temperature_raw","state","state_raw","button","button_raw"],(A5_08_02.prototype=new A5_08()).constructor=A5_08_02;var A5_08_03=function A5_08_03(e){A5_08.call(this,e),this._data="a5-08-03",this._illMax=1530,this._tmpMin=-30,this._tmpMax=50;};A5_08_03.STATES=["voltage","voltage_raw","illumination","illumination_raw","temperature","temperature_raw","state","state_raw","button","button_raw"],(A5_08_03.prototype=new A5_08()).constructor=A5_08_03;var A5_09=function A5_09(e){A5.call(this,e),this._data="a5-09-??";};(A5_09.prototype=new A5()).constructor=A5_09;var A5_09_02=function A5_09_02(e){A5_09.call(this,e),this._data="a5-09-02",this._svcMin=0,this._svcMax=5.1,this._gasMin=0,this._gasMax=1020,this._tmpMin=0,this._tmpMax=51;};A5_09_02.STATES=["voltage","voltage_raw","gas","gas_raw","temperature","temperature_raw","temperature_available"],(A5_09_02.prototype=new A5_09()).constructor=A5_09_02,A5_09_02.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(2),n=e.userData.readUInt8(1),s=e.userData.readUInt8(0);if(1==(a>>3&1)){var o=s;t.voltage=parseFloat((o/255*(this._svcMax-this._svcMin)+this._svcMin).toFixed(1)),t.voltage_raw=o;var i=n;t.gas=parseFloat((i/255*(this._gasMax-this._gasMin)+this._gasMin).toFixed(1)),t.gas_raw=i;var l=r;t.temperature=parseFloat((l/255*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1)),t.temperature_raw=l;var u=a>>1&1;t.temperature_available=!!u,u||delete t.temperature;}}return t;};var A5_09_04=function A5_09_04(e){A5_09.call(this,e),this._data="a5-09-04",this._humMin=0,this._humMax=100,this._gasMin=0,this._gasMax=2550,this._tmpMin=0,this._tmpMax=51;};A5_09_04.STATES=["humidity","humidity_raw","gas","gas_raw","temperature","temperature_raw","temperature_available","humidity_available"],(A5_09_04.prototype=new A5_09()).constructor=A5_09_04,A5_09_04.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(2),n=e.userData.readUInt8(1),s=e.userData.readUInt8(0);if(1==(a>>3&1)){var o=s;t.humidity=parseFloat((o/255*(this._humMax-this._humMin)+this._humMin).toFixed(1)),t.humidity_raw=o;var i=n;t.gas=parseFloat((i/255*(this._gasMax-this._gasMin)+this._gasMin).toFixed(1)),t.gas_raw=i;var l=r;t.temperature=parseFloat((l/255*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1)),t.temperature_raw=l;var u=a>>2&1;t.humidity_available=!!u,u||delete t.humidity;var c=a>>1&1;t.temperature_available=!!c,c||delete t.temperature;}}return t;};var A5_09_05=function A5_09_05(e){A5_09.call(this,e),this._data="a5-09-05";};A5_09_05.STATES=["voc","voc_raw","voc_id","voc_id_raw","scale"],(A5_09_05.prototype=new A5_09()).constructor=A5_09_05,A5_09_05.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(2),n=e.userData.readUInt16BE(0);if(1==(a>>3&1)){var s=3&a,o=1;switch(s){case 0:o=.01;break;case 1:o=.1;break;case 2:o=1;break;case 3:o=10;}t.scale=o;var i=n;t.voc=n*o,t.voc_raw=i;var l=r;switch(s){case 0:t.voc_id="VOCT";break;case 1:t.voc_id="Formaldehyde";break;case 2:t.voc_id="Benzene";break;case 3:t.voc_id="Styrene";break;case 4:t.voc_id="Toluene";break;case 5:t.voc_id="Tetrachloroethylene";break;case 6:t.voc_id="Xylene";break;case 7:t.voc_id="n-Hexane";break;case 8:t.voc_id="n-Octane";break;case 9:t.voc_id="Cyclopentane";break;case 10:t.voc_id="Methanol";break;case 11:t.voc_id="Ethanol";break;case 12:t.voc_id="1-Pentanol";break;case 13:t.voc_id="Acetone";break;case 14:t.voc_id="ethylene Oxide";break;case 15:t.voc_id="Acetaldehyde ue";break;case 16:t.voc_id="Acetic Acid";break;case 17:t.voc_id="Propionice Acid";break;case 18:t.voc_id="Valeric Acid";break;case 19:t.voc_id="Butyric Acid";break;case 20:t.voc_id="Ammoniac";break;case 22:t.voc_id="Hydrogen Sulfide";break;case 23:t.voc_id="Dimethylsulfide";break;case 24:t.voc_id="2-Butanol";break;case 25:t.voc_id="2-Methylpropanol";break;case 26:t.voc_id="Diethyl ether";break;case 255:t.voc_id="ozone";}t.voc_id_raw=l;}}return t;};var A5_09_06=function A5_09_06(e){A5_09.call(this,e),this._data="a5-09-06";};A5_09_06.STATES=["radon"],(A5_09_06.prototype=new A5_09()).constructor=A5_09_06,A5_09_06.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt16BE(0);if(1==(a>>3&1)){var n=r>>6&1023;t.radon=n;}}return t;};var A5_09_07=function A5_09_07(e){A5_09.call(this,e),this._data="a5-09-07";};A5_09_07.STATES=["pm10","pm25","pm1","pm10_active","pm25_active","pm25_active"],(A5_09_07.prototype=new A5_09()).constructor=A5_09_07,A5_09_07.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt16BE(2),n=e.userData.readUInt16BE(1),s=e.userData.readUInt16BE(0);if(1==(a>>3&1)){var o=s>>7&511;t.pm10=o;var i=n>>6&511;t.pm25=i;var l=r>>5&511;t.pm1=l;var u=a>>2&1;t.pm10_active=!!u,u||delete t.pm10;var c=a>>1&1;t.pm25_active=!!c,c||delete t.pm25;var h=1&a;t.pm1_active=!!h,h||delete t.pm1;}}return t;};var A5_09_08=function A5_09_08(e){A5_09.call(this,e),this._data="a5-09-08";};A5_09_08.STATES=["co2","co2_raw"],(A5_09_08.prototype=new A5_09()).constructor=A5_09_08,A5_09_08.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(2);if(1==(a>>3&1)){var n=r;t.co2=parseFloat((n/255*2e3).toFixed(1)),t.co2_raw=n;}}return t;};var A5_09_09=function A5_09_09(e){A5_09.call(this,e),this._data="a5-09-09";};A5_09_09.STATES=["co2","co2_raw","power_failure_detected"],(A5_09_09.prototype=new A5_09()).constructor=A5_09_09,A5_09_09.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(2);if(1==(a>>3&1)){var n=r;t.co2=parseFloat((n/255*2e3).toFixed(1)),t.co2_raw=n;var s=a>>2&1;t.power_failure_detected=!!s;}}return t;};var A5_09_0A=function A5_09_0A(e){A5_09.call(this,e),this._data="a5-09-0a",this._svcMin=2,this._svcMax=5,this._tmpMin=-20,this._tmpMax=60;};A5_09_0A.STATES=["voltage","voltage_raw","gas","gas_raw","temperature","temperature_raw","temperature_available","voltage_available"],(A5_09_0A.prototype=new A5_09()).constructor=A5_09_0A,A5_09_0A.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(2),n=e.userData.readUInt16BE(0);if(1==(a>>3&1)){var s=n;t.gas=s,t.gas_raw=s;var o=r;t.temperature=parseFloat((o/255*(this._tmpMax-this._tmpMin)+this._tmpMin).toFixed(1)),t.temperature_raw=o;var i=a>>4&15;t.voltage=parseFloat((i/15*(this._svcMax-this._svcMin)+this._svcMin).toFixed(1)),t.voltage_raw=i;var l=a>>1&1;t.temperature_available=!!l,l||delete t.temperature;var u=1&a;t.voltage_available=!!u,u||delete t.voltage;}}return t;};var A5_09_0B=function A5_09_0B(e){A5_09.call(this,e),this._data="a5-09-0b",this._svcMin=2,this._svcMax=5;};A5_09_0B.STATES=["voltage","voltage_raw","radio","radio_raw","scale","unit","unit_raw","voltage_available"],(A5_09_0B.prototype=new A5_09()).constructor=A5_09_0B,A5_09_0B.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt16BE(2),n=e.userData.readUInt8(0);if(1==(a>>3&1)){var s=n>>4&15;t.voltage=parseFloat((s/15*(this._svcMax-this._svcMin)+this._svcMin).toFixed(1)),t.voltage_raw=s;var o=1;switch(a>>4&15){case 0:o=.001;break;case 1:o=.01;break;case 2:o=.1;break;case 3:o=1;break;case 4:o=10;break;case 5:o=100;break;case 6:o=1e3;break;case 7:o=1e4;break;case 8:o=1e5;}t.scale=o;var i=r;t.radio=i/10*o,t.radio_raw=i;var l=a>>1&3;switch(l){case 0:t.unit="μSv/h";break;case 1:t.unit="cpm";break;case 2:t.unit="Bq/L";break;case 3:t.unit="Bq/kg";}t.unit_raw=l;var u=1&a;t.voltage_available=!!u,u||delete t.voltage;}}return t;};var A5_09_0C=function A5_09_0C(e){A5_09.call(this,e),this._data="a5-09-0c";};A5_09_0C.STATES=["voc","voc_raw","voc_id","voc_id_raw","unit","unit_raw","scale"],(A5_09_0C.prototype=new A5_09()).constructor=A5_09_0C,A5_09_0C.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(2),n=e.userData.readUInt16BE(0);if(1==(a>>3&1)){var s=3&a,o=1;switch(s){case 0:o=.01;break;case 1:o=.1;break;case 2:o=1;break;case 3:o=10;}t.scale=o;var i=a>>1&1;switch(i){case 0:t.unit="ppb";break;case 1:t.unit="μSv/m3";}t.unit_raw=i;var l=n;t.voc=n*o,t.voc_raw=l;var u=r;switch(s){case 0:t.voc_id="VOCT";break;case 1:t.voc_id="Formaldehyde";break;case 2:t.voc_id="Benzene";break;case 3:t.voc_id="Styrene";break;case 4:t.voc_id="Toluene";break;case 5:t.voc_id="Tetrachloroethylene";break;case 6:t.voc_id="Xylene";break;case 7:t.voc_id="n-Hexane";break;case 8:t.voc_id="n-Octane";break;case 9:t.voc_id="Cyclopentane";break;case 10:t.voc_id="Methanol";break;case 11:t.voc_id="Ethanol";break;case 12:t.voc_id="1-Pentanol";break;case 13:t.voc_id="Acetone";break;case 14:t.voc_id="ethylene Oxide";break;case 15:t.voc_id="Acetaldehyde ue";break;case 16:t.voc_id="Acetic Acid";break;case 17:t.voc_id="Propionice Acid";break;case 18:t.voc_id="Valeric Acid";break;case 19:t.voc_id="Butyric Acid";break;case 20:t.voc_id="Ammoniac";break;case 22:t.voc_id="Hydrogen Sulfide";break;case 23:t.voc_id="Dimethylsulfide";break;case 24:t.voc_id="2-Butanol";break;case 25:t.voc_id="2-Methylpropanol";break;case 26:t.voc_id="Diethyl ether";break;case 27:t.voc_id="Naphthalene";break;case 28:t.voc_id="4-Phenylcyclohexene";break;case 29:t.voc_id="Limonene";break;case 30:t.voc_id="Trichloroethylene";break;case 31:t.voc_id="Isovaleric acid";break;case 32:t.voc_id="Indole";break;case 33:t.voc_id="Cadaverine";break;case 34:t.voc_id="Putrescine";break;case 35:t.voc_id="Caproic acid";break;case 255:t.voc_id="ozone";}t.voc_id_raw=u;}}return t;};var A5_10=function A5_10(e){A5.call(this,e),this._data="a5-10-??";};(A5_10.prototype=new A5()).constructor=A5_10;var A5_10_01=function A5_10_01(e){A5_10.call(this,e),this._data="a5-10-01",this._params||(this._params={minSP:18,maxSP:26});};A5_10_01.STATES=["fan_speed","fan_speed_raw","setpoint","setpoint_raw","temperature","temperature_raw","button","button_raw"],(A5_10_01.prototype=new A5_10()).constructor=A5_10_01,A5_10_01.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(2),n=e.userData.readUInt8(1),s=e.userData.readUInt8(0);if(1==(a>>3&1)){var o=s;t.fan_speed=o<=144?"3":o<=164?"2":o<=189?"1":o<=209?"0":"auto",t.fan_speed_raw=o;var i=n;t.setpoint=parseFloat((i/255*(this._params.maxSP-this._params.minSP)+this._params.minSP).toFixed(1)),t.setpoint_raw=i;var l=r;t.temperature=parseFloat(((255-l)/255*40).toFixed(1)),t.temperature_raw=l;var u=1&a;switch(u){case 0:t.button="pressed";break;case 1:t.button="released";}t.button_raw=u;}}return t;},A5_10_01.prototype.fromJSON=function(e){return Profile.prototype.fromJSON.call(this,e)?(this._params||(this._params={minSP:18,maxSP:26}),this):null;},A5_10_01.prototype.fromDBJSON=function(e){return Profile.prototype.fromDBJSON.call(this,e)?(this._params||(this._params={minSP:18,maxSP:26}),this):null;};var A5_10_02=function A5_10_02(e){A5_10_01.call(this,e),this._data="a5-10-02";};A5_10_02.STATES=["fan_speed","fan_speed_raw","setpoint","setpoint_raw","temperature","temperature_raw","slider","slider_raw"],(A5_10_02.prototype=new A5_10_01()).constructor=A5_10_02,A5_10_02.prototype.evalTelegram=function(e){var t=A5_10_01.prototype.evalTelegram.call(this,e);if(0==Object.keys(t).length)return t;delete t.button,delete t.button_raw;var a=1&e.userData.readUInt8(3);return t.slider=a?"day":"night",t.slider_raw=a,t;};var A5_10_03=function A5_10_03(e){A5_10_01.call(this,e),this._data="a5-10-03",this.TEACH_IN_VARIATION=1;};A5_10_03.STATES=["setpoint","setpoint_raw","temperature","temperature_raw"],(A5_10_03.prototype=new A5_10_01()).constructor=A5_10_03,A5_10_03.prototype.evalTelegram=function(e){var t=A5_10_01.prototype.evalTelegram.call(this,e);return 0==Object.keys(t).length||(delete t.fan_speed,delete t.fan_speed_raw,delete t.button,delete t.button_raw),t;};var A5_10_04=function A5_10_04(e){A5_10_01.call(this,e),this._data="a5-10-04";};A5_10_04.STATES=["fan_speed","fan_speed_raw","setpoint","setpoint_raw","temperature","temperature_raw"],(A5_10_04.prototype=new A5_10_01()).constructor=A5_10_04,A5_10_04.prototype.evalTelegram=function(e){var t=A5_10_01.prototype.evalTelegram.call(this,e);return 0==Object.keys(t).length||(delete t.button,delete t.button_raw),t;};var A5_10_05=function A5_10_05(e){A5_10_01.call(this,e),this._data="a5-10-05";};A5_10_05.STATES=["setpoint","setpoint_raw","temperature","temperature_raw","button","button_raw"],(A5_10_05.prototype=new A5_10_01()).constructor=A5_10_05,A5_10_05.prototype.evalTelegram=function(e){var t=A5_10_01.prototype.evalTelegram.call(this,e);return 0==Object.keys(t).length||(delete t.fan_speed,delete t.fan_speed_raw),t;};var A5_10_06=function A5_10_06(e){A5_10_02.call(this,e),this._data="a5-10-06";};A5_10_06.STATES=["setpoint","setpoint_raw","temperature","temperature_raw","slider","slider_raw"],(A5_10_06.prototype=new A5_10_02()).constructor=A5_10_06,A5_10_06.prototype.evalTelegram=function(e){var t=A5_10_02.prototype.evalTelegram.call(this,e);return 0==Object.keys(t).length||(delete t.fan_speed,delete t.fan_speed_raw),t;};var A5_10_07=function A5_10_07(e){A5_10_01.call(this,e),this._data="a5-10-07";};A5_10_07.STATES=["fan_speed","fan_speed_raw","temperature","temperature_raw"],(A5_10_07.prototype=new A5_10_01()).constructor=A5_10_07,A5_10_07.prototype.evalTelegram=function(e){var t=A5_10_01.prototype.evalTelegram.call(this,e);return 0==Object.keys(t).length||(delete t.setpoint,delete t.setpoint_raw,delete t.button,delete t.button_raw),t;};var A5_10_08=function A5_10_08(e){A5_10_01.call(this,e),this._data="a5-10-08",this._params=null;};A5_10_08.STATES=["fan_speed","fan_speed_raw","temperature","temperature_raw","button","button_raw"],(A5_10_08.prototype=new A5_10_01()).constructor=A5_10_08,A5_10_08.prototype.evalTelegram=function(e){var t=A5_10_01.prototype.evalTelegram.call(this,e);return 0==Object.keys(t).length||(delete t.setpoint,delete t.setpoint_raw),t;},A5_10_08.prototype.fromJSON=function(e){return Profile.prototype.fromJSON.call(this,e);},A5_10_08.prototype.fromDBJSON=function(e){return Profile.prototype.fromDBJSON.call(this,e);};var A5_10_09=function A5_10_09(e){A5_10_02.call(this,e),this._data="a5-10-09",this._params=null;};A5_10_09.STATES=["fan_speed","fan_speed_raw","temperature","temperature_raw","slider","slider_raw"],(A5_10_09.prototype=new A5_10_02()).constructor=A5_10_09,A5_10_09.prototype.evalTelegram=function(e){var t=A5_10_02.prototype.evalTelegram.call(this,e);return 0==Object.keys(t).length||(delete t.setpoint,delete t.setpoint_raw),t;},A5_10_09.prototype.fromJSON=function(e){return Profile.prototype.fromJSON.call(this,e);},A5_10_09.prototype.fromDBJSON=function(e){return Profile.prototype.fromDBJSON.call(this,e);};var A5_10_0A=function A5_10_0A(e){A5_10_01.call(this,e),this._data="a5-10-0a";};A5_10_0A.STATES=["setpoint","setpoint_raw","temperature","temperature_raw","contact","contact_raw"],(A5_10_0A.prototype=new A5_10_01()).constructor=A5_10_0A,A5_10_0A.prototype.evalTelegram=function(e){var t=A5_10_01.prototype.evalTelegram.call(this,e);if(0==Object.keys(t).length)return t;delete t.fan_speed,delete t.fan_speed_raw,delete t.button,delete t.button_raw;var a=1&e.userData.readUInt8(3);return t.contact=a?"open":"closed",t.contact_raw=a,t;};var A5_10_0B=function A5_10_0B(e){A5_10_0A.call(this,e),this._data="a5-10-0b",this._params=null;};A5_10_0B.STATES=["temperature","temperature_raw","contact","contact_raw"],(A5_10_0B.prototype=new A5_10_0A()).constructor=A5_10_0B,A5_10_0B.prototype.evalTelegram=function(e){var t=A5_10_0A.prototype.evalTelegram.call(this,e);return 0==Object.keys(t).length||(delete t.setpoint,delete t.setpoint_raw),t;},A5_10_0B.prototype.fromJSON=function(e){return Profile.prototype.fromJSON.call(this,e);},A5_10_0B.prototype.fromDBJSON=function(e){return Profile.prototype.fromDBJSON.call(this,e);};var A5_10_0C=function A5_10_0C(e){A5_10_08.call(this,e),this._data="a5-10-0c";};A5_10_0C.STATES=["temperature","temperature_raw","button","button_raw"],(A5_10_0C.prototype=new A5_10_08()).constructor=A5_10_0C,A5_10_0C.prototype.evalTelegram=function(e){var t=A5_10_08.prototype.evalTelegram.call(this,e);return 0==Object.keys(t).length||(delete t.fan_speed,delete t.fan_speed_raw),t;};var A5_10_0D=function A5_10_0D(e){A5_10_09.call(this,e),this._data="a5-10-0d";};A5_10_0D.STATES=["temperature","temperature_raw","slider","slider_raw"],(A5_10_0D.prototype=new A5_10_09()).constructor=A5_10_0D,A5_10_0D.prototype.evalTelegram=function(e){var t=A5_10_09.prototype.evalTelegram.call(this,e);return 0==Object.keys(t).length||(delete t.fan_speed,delete t.fan_speed_raw),t;};var A5_10_10=function A5_10_10(e){A5_10.call(this,e),this._data="a5-10-10",this._params||(this._params={minSP:18,maxSP:26});};A5_10_10.STATES=["setpoint","setpoint_raw","humidity","humidity_raw","temperature","temperature_raw","button","button_raw"],(A5_10_10.prototype=new A5_10()).constructor=A5_10_10,A5_10_10.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(2),n=e.userData.readUInt8(1),s=e.userData.readUInt8(0);if(1==(a>>3&1)){var o=s;t.setpoint=parseFloat((o/255*(this._params.maxSP-this._params.minSP)+this._params.minSP).toFixed(1)),t.setpoint_raw=o;var i=n;t.humidity=parseFloat((i/250*100).toFixed(1)),t.humidity_raw=i;var l=r;t.temperature=parseFloat((l/250*40).toFixed(1)),t.temperature_raw=l;var u=1&a;switch(u){case 0:t.button="pressed";break;case 1:t.button="released";}t.button_raw=u;}}return t;},A5_10_10.prototype.fromJSON=function(e){return Profile.prototype.fromJSON.call(this,e)?(this._params||(this._params={minSP:18,maxSP:26}),this):null;},A5_10_10.prototype.fromDBJSON=function(e){return Profile.prototype.fromDBJSON.call(this,e)?(this._params||(this._params={minSP:18,maxSP:26}),this):null;};var A5_10_11=function A5_10_11(e){A5_10_10.call(this,e),this._data="a5-10-11";};A5_10_11.STATES=["setpoint","setpoint_raw","humidity","humidity_raw","temperature","temperature_raw","slider","slider_raw"],(A5_10_11.prototype=new A5_10_10()).constructor=A5_10_11,A5_10_11.prototype.evalTelegram=function(e){var t=A5_10_10.prototype.evalTelegram.call(this,e);if(0==Object.keys(t).length)return t;delete t.button,delete t.button_raw;var a=1&e.userData.readUInt8(3);return t.slider=a?"day":"night",t.slider_raw=a,t;};var A5_10_12=function A5_10_12(e){A5_10_10.call(this,e),this._data="a5-10-12";};A5_10_12.STATES=["setpoint","setpoint_raw","humidity","humidity_raw","temperature","temperature_raw"],(A5_10_12.prototype=new A5_10_10()).constructor=A5_10_12,A5_10_12.prototype.evalTelegram=function(e){var t=A5_10_10.prototype.evalTelegram.call(this,e);return 0==Object.keys(t).length||(delete t.button,delete t.button_raw),t;};var A5_10_13=function A5_10_13(e){A5_10_10.call(this,e),this._data="a5-10-13";};A5_10_13.STATES=["humidity","humidity_raw","temperature","temperature_raw","button","button_raw"],(A5_10_13.prototype=new A5_10_10()).constructor=A5_10_13,A5_10_13.prototype.evalTelegram=function(e){var t=A5_10_10.prototype.evalTelegram.call(this,e);return 0==Object.keys(t).length||(delete t.setpoint,delete t.setpoint_raw),t;};var A5_10_14=function A5_10_14(e){A5_10_11.call(this,e),this._data="a5-10-14";};A5_10_14.STATES=["humidity","humidity_raw","temperature","temperature_raw","slider","slider_raw"],(A5_10_14.prototype=new A5_10_11()).constructor=A5_10_14,A5_10_14.prototype.evalTelegram=function(e){var t=A5_10_11.prototype.evalTelegram.call(this,e);return 0==Object.keys(t).length||(delete t.setpoint,delete t.setpoint_raw),t;};var A5_11=function A5_11(e){A5.call(this,e),this._data="a5-11-??";};(A5_11.prototype=new A5()).constructor=A5_11;var A5_11_03=function A5_11_03(e){A5_11.call(this,e),this._data="a5-11-03";};A5_11_03.STATES=["position","angle","position_flag","position_flag_raw","angle_flag","angle_flag_raw","error","error_raw","end_position","end_position_raw","state","state_raw","service_mode","position_mode","power","energy","current","voltage","power_raw","power_unit","energy_unit","current_unit","voltage_unit","power_unit_raw"],(A5_11_03.prototype=new A5_11()).constructor=A5_11_03,A5_11_03.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(2),n=e.userData.readUInt8(1),s=e.userData.readUInt8(0);if(1==(a>>3&1)){var o=s;t.position=o;var i=n>>7&1,l=127&n;t.angle=2*(i?0-l:l);var u=r>>7&1;t.position_flag=!!u,t.position_flag_raw=u;var c=r>>6&1;t.angle_flag=!!c,t.angle_flag_raw=c;var h=r>>4&3;switch(t.error_raw=h,h){case 0:t.error="no_error";break;case 1:t.error="no_end_position";break;case 2:t.error="intern_failure";}var _=r>>2&3;switch(t.end_position_raw=_,_){case 0:t.end_position="no_end_position";break;case 1:t.end_position="end_position_not_reach";break;case 2:t.end_position="fully_open";break;case 3:t.end_position="fully_closed";}var p=3&r;switch(t.state_raw=p,p){case 0:t.state="no_status";break;case 1:t.state="stopped";break;case 2:t.state="opens";break;case 3:t.state="closes";}var d=a>>7&1;t.service_mode=d;var v=a>>6&1;t.position_mode=v;}}return t;};var A5_11_04=function A5_11_04(e){A5_11.call(this,e),this._data="a5-11-04";};A5_11_04.STATES=["state","state_raw","level","rgb","power","energy","current","voltage","power_raw","power_unit","energy_unit","current_unit","voltage_unit","power_unit_raw","op_hour","error","error_raw","service_mode","op_hour_flag","op_hour_flag_raw","mode_raw"],(A5_11_04.prototype=new A5_11()).constructor=A5_11_04,A5_11_04.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(2),n=e.userData.readUInt8(1),s=e.userData.readUInt8(0);if(1==(a>>3&1)){var o=a>>7&1;t.service_mode=o;var i=a>>6&1;t.op_hour_flag=!!i,t.op_hour_flag_raw=i;var l=a>>4&3;switch(t.error_raw=l,l){case 0:t.error="no_error";break;case 1:t.error="lamp_failure";break;case 2:t.error="intern_failure";break;case 3:t.error="extern_failure";}var u=1&a;t.state=u?"on":"off",t.state_raw=u;var c=a>>1&3;switch(t.mode_raw=c,c){case 0:t.level=s,t.op_hour=n<<8|r;break;case 1:var h=s.toString(16);h.length<2&&(h="0"+h);var _=n.toString(16);_.length<2&&(_="0"+_);var p=r.toString(16);p.length<2&&(p="0"+p),t.rgb=h.toUpperCase()+_.toUpperCase()+p.toUpperCase();break;case 2:t.power_raw=s<<8|n,t.power_unit_raw=r;var d=["mW","W","kW","MW","Wh","kWh","MWh","GWh","mA","1/10A","mV","1/10V"];r<=3?(t.power=t.power_raw,t.power_unit=d[r]):r<=7?(t.energy=t.power_raw,t.energy_unit=d[r]):r<=9?(t.current=t.power_raw,t.current_unit=d[r]):r<=11&&(t.voltage=t.power_raw,t.voltage_unit=d[r]);}}}return t;};var A5_12=function A5_12(e){A5.call(this,e),this._data="a5-12-??";};A5_12.STATES=["meter_raw","channel_raw","type_raw","scale_raw","scale","meter","current","cumulative"],(A5_12.prototype=new A5()).constructor=A5_12,A5_12.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt32BE(0);if(1==(a>>3&1)){var n=r>>8&16777215;t.meter_raw=n;var s=a>>4&15;t.channel_raw=s;var o=a>>2&1;t.type_raw=o;var i=3&a;switch(t.scale_raw=i,i){case 0:t.scale=1,t.meter=n;break;case 1:t.scale=.1,t.meter=.1*n;break;case 2:t.scale=.01,t.meter=.01*n;break;case 3:t.scale=.001,t.meter=.001*n;}o?t.current=t.meter:t.cumulative=t.meter;}}return t;};var A5_12_00=function A5_12_00(e){A5_12.call(this,e),this._data="a5-12-00";};A5_12_00.STATES=["current","counter","channel"],(A5_12_00.prototype=new A5_12()).constructor=A5_12_00,A5_12_00.prototype.evalTelegram=function(e){var t=A5_12.prototype.evalTelegram.call(this,e);return t.counter=t.cumulative,t.channel=t.channel_raw,t;};var A5_12_01=function A5_12_01(e){A5_12.call(this,e),this._data="a5-12-01";};A5_12_01.STATES=["power","energy","tariff"],(A5_12_01.prototype=new A5_12()).constructor=A5_12_01,A5_12_01.prototype.evalTelegram=function(e){var t=A5_12.prototype.evalTelegram.call(this,e);return t.energy=t.cumulative,t.power=t.current,t.tariff=t.channel_raw,t;};var A5_12_02=function A5_12_02(e){A5_12.call(this,e),this._data="a5-12-02";};A5_12_02.STATES=["volume","flow","tariff"],(A5_12_02.prototype=new A5_12()).constructor=A5_12_02,A5_12_02.prototype.evalTelegram=function(e){var t=A5_12.prototype.evalTelegram.call(this,e);return t.volume=t.cumulative,t.flow=t.current,t.tariff=t.channel_raw,t;};var A5_12_03=function A5_12_03(e){A5_12_02.call(this,e),this._data="a5-12-03";};A5_12_03.STATES=["volume","flow","tariff"],(A5_12_03.prototype=new A5_12_02()).constructor=A5_12_03;var A5_13=function A5_13(e){A5.call(this,e),this._data="a5-13-??";};A5_13.STATES=["lux","lux_raw","temperature","temperature_raw","wind","wind_raw","day_night","rain","sun_west","sun_west_raw","sun_south","sun_south_raw","sun_east","sun_east_raw","hemisphere","day","month","year","date_src","weekday","hour","min","sec","time_format","am_pm","time_src","elv","azm","latitude","longitude","latitude_raw","longitude_raw"],(A5_13.prototype=new A5()).constructor=A5_13,A5_13.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(2),n=e.userData.readUInt8(1),s=e.userData.readUInt8(0);if(1==(a>>3&1))switch(a>>4&15){case 1:var o=s;t.lux=parseFloat((o/255*1e3).toFixed(1)),t.lux_raw=o;var i=n;t.temperature=parseFloat((i/255*120-40).toFixed(1)),t.temperature_raw=i;var l=r;t.wind=parseFloat((l/255*70).toFixed(1)),t.wind_raw=l;var u=a>>2&1;t.day_night=u?"night":"day";var c=a>>1&1;t.rain=c?"true":"false";break;case 2:var h=s;t.sun_west=parseFloat((h/255*150).toFixed(1)),t.sun_west_raw=h;var _=n;t.sun_south=parseFloat((_/255*150).toFixed(1)),t.sun_south_raw=i;var p=r;t.sun_east=parseFloat((p/255*150).toFixed(1)),t.sun_east_raw=p;var d=a>>2&1;t.hemisphere=d?"south":"north";break;case 3:var v=15&s;t.day=v;var f=7&n;t.month=f;var m=127&r;t.year=m+2e3;var g=1&a;t.date_src=g?"gps":"rtc";break;case 4:var w=s>>5&7;t.weekday=w;var y=31&s;t.hour=y;var S=63&n;t.min=S;var b=63&r;t.sec=b;var T=a>>2&1;t.time_format=T?"12":"24";var I=a>>1&1;t.am_pm=I?"pm":"am";var E=1&a;t.time_src=E?"gps":"rtc";break;case 5:var k=s;t.elv=k-90,t.elv_raw=k;var A=511&e.userData.readUInt16BE(1);t.azm=A,t.azm_raw=A;break;case 6:var O=(s>>4&15)<<8|n,C=(15&s)<<8|r;t.latitude=parseFloat((O/4095*180-90).toFixed(1)),t.latitude_raw=O,t.longitude=parseFloat((C/4095*360-180).toFixed(1)),t.longitude_raw=C;}}return t;};var A5_13_01=function A5_13_01(e){A5_13.call(this,e),this._data="a5-13-01";};A5_13_01.STATES=["lux","lux_raw","temperature","temperature_raw","wind","wind_raw","day_night","rain","sun_west","sun_west_raw","sun_south","sun_south_raw","sun_east","sun_east_raw","hemisphere","day","month","year","date_src","weekday","hour","min","sec","time_format","am_pm","time_src","elv","azm","latitude","longitude","latitude_raw","longitude_raw"],(A5_13_01.prototype=new A5_13()).constructor=A5_13_01;var A5_13_02=function A5_13_02(e){A5_13.call(this,e),this._data="a5-13-02";};A5_13_02.STATES=["sun_west","sun_west_raw","sun_south","sun_south_raw","sun_east","sun_east_raw","hemisphere"],(A5_13_02.prototype=new A5_13()).constructor=A5_13_02;var A5_13_03=function A5_13_03(e){A5_13.call(this,e),this._data="a5-13-03";};A5_13_03.STATES=["day","month","year","date_src"],(A5_13_03.prototype=new A5_13()).constructor=A5_13_03;var A5_13_04=function A5_13_04(e){A5_13.call(this,e),this._data="a5-13-04";};A5_13_04.STATES=["weekday","hour","min","sec","time_format","am_pm","time_src"],(A5_13_04.prototype=new A5_13()).constructor=A5_13_04;var A5_13_05=function A5_13_05(e){A5_13.call(this,e),this._data="a5-13-05";};A5_13_05.STATES=["elv","azm"],(A5_13_05.prototype=new A5_13()).constructor=A5_13_05;var A5_13_06=function A5_13_06(e){A5_13.call(this,e),this._data="a5-13-06";};A5_13_06.STATES=["latitude","longitude"],(A5_13_06.prototype=new A5_13()).constructor=A5_13_06;var A5_14_01=function A5_14_01(e){Profile.call(this,e),this._data="a5-14-01";};A5_14_01.STATES=["voltage","voltage_raw","state"],(A5_14_01.prototype=new Profile()).constructor=A5_14_01,A5_14_01.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(0);if(1==(a>>3&1)){var n=r;t.voltage=n/250*5,t.voltage_raw=n;var s=1&a;switch(s){case 0:t.state="closed";break;case 1:t.state="open";}t.state_raw=s;}}return t;};var A5_14_02=function A5_14_02(e){Profile.call(this,e),this._data="a5-14-02";};A5_14_02.STATES=["voltage","voltage_raw","illumination","illumination_raw","state"],(A5_14_02.prototype=new Profile()).constructor=A5_14_02,A5_14_02.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(1),n=e.userData.readUInt8(0);if(1==(a>>3&1)){var s=n;t.voltage=s/250*5,t.voltage_raw=s;var o=r;t.illumination=o/250*1e3,t.illumination_raw=o;var i=1&a;switch(t.state_raw=i,i){case 0:t.state="closed";break;case 1:t.state="open";}}}return t;};var A5_14_03=function A5_14_03(e){Profile.call(this,e),this._data="a5-14-03";};A5_14_03.STATES=["voltage","voltage_raw","state","viberation"],(A5_14_03.prototype=new Profile()).constructor=A5_14_03,A5_14_03.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(0);if(1==(a>>3&1)){var n=r;t.voltage=n/250*5,t.voltage_raw=n;var s=a>>1&1;switch(1&a){case 0:t.state="closed";break;case 1:t.state="open";}switch(s){case 0:t.viberation=!1;break;case 1:t.viberation=!0;}}}return t;};var A5_14_04=function A5_14_04(e){Profile.call(this,e),this._data="a5-14-04";};A5_14_04.STATES=["voltage","voltage_raw","illumination","illumination_raw","state","viberation"],(A5_14_04.prototype=new Profile()).constructor=A5_14_04,A5_14_04.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(1),n=e.userData.readUInt8(0);if(1==(a>>3&1)){var s=n;t.voltage=s/250*5,t.voltage_raw=s;var o=r;t.illumination=o/250*1e3,t.illumination_raw=o;var i=a>>1&1;switch(1&a){case 0:t.state="closed";break;case 1:t.state="open";}switch(i){case 0:t.viberation=!1;break;case 1:t.viberation=!0;}}}return t;};var A5_14_05=function A5_14_05(e){Profile.call(this,e),this._data="a5-14-05";};A5_14_05.STATES=["voltage","voltage_raw","viberation"],(A5_14_05.prototype=new Profile()).constructor=A5_14_05,A5_14_05.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(0);if(1==(a>>3&1)){var n=r;switch(t.voltage=n/250*5,t.voltage_raw=n,a>>1&1){case 0:t.viberation=!1;break;case 1:t.viberation=!0;}}}return t;};var A5_14_06=function A5_14_06(e){Profile.call(this,e),this._data="a5-14-06";};A5_14_06.STATES=["voltage","voltage_raw","illumination","illumination_raw","viberation"],(A5_14_06.prototype=new Profile()).constructor=A5_14_06,A5_14_06.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(1),n=e.userData.readUInt8(0);if(1==(a>>3&1)){var s=n;t.voltage=s/250*5,t.voltage_raw=s;var o=r;switch(t.illumination=o/250*1e3,t.illumination_raw=o,a>>1&1){case 0:t.viberation=!1;break;case 1:t.viberation=!0;}}}return t;};var A5_14_07=function A5_14_07(e){Profile.call(this,e),this._data="a5-14-07";};A5_14_07.STATES=["voltage","voltage_raw","state","lock"],(A5_14_07.prototype=new Profile()).constructor=A5_14_07,A5_14_07.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(0);if(1==(a>>3&1)){var n=r;t.voltage=n/250*5,t.voltage_raw=n;var s=a>>1&1;switch(a>>2&1){case 0:t.state="closed";break;case 1:t.state="open";}switch(s){case 0:t.lock="locked";break;case 1:t.lock="unlocked";}}}return t;};var A5_14_08=function A5_14_08(e){Profile.call(this,e),this._data="a5-14-08";};A5_14_08.STATES=["voltage","voltage_raw","state","lock","viberation"],(A5_14_08.prototype=new Profile()).constructor=A5_14_08,A5_14_08.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(0);if(1==(a>>3&1)){var n=r;t.voltage=n/250*5,t.voltage_raw=n;var s=a>>1&1,o=1&a;switch(a>>2&1){case 0:t.state="closed";break;case 1:t.state="open";}switch(s){case 0:t.lock="locked";break;case 1:t.lock="unlocked";}switch(o){case 0:t.viberation=!1;break;case 1:t.viberation=!0;}}}return t;};var A5_14_09=function A5_14_09(e){Profile.call(this,e),this._data="a5-14-09";};A5_14_09.STATES=["voltage","voltage_raw","state"],(A5_14_09.prototype=new Profile()).constructor=A5_14_09,A5_14_09.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(0);if(1==(a>>3&1)){var n=r;switch(t.voltage=n/250*5,t.voltage_raw=n,a>>1&3){case 0:t.state="closed";break;case 1:t.state="tilted";break;case 2:t.state="reserved";break;case 3:t.state="open";}}}return t;};var A5_14_0A=function A5_14_0A(e){Profile.call(this,e),this._data="a5-14-0a";};A5_14_0A.STATES=["voltage","voltage_raw","state","viberation"],(A5_14_0A.prototype=new Profile()).constructor=A5_14_0A,A5_14_0A.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(0);if(1==(a>>3&1)){var n=r;t.voltage=n/250*5,t.voltage_raw=n;var s=1&a;switch(a>>1&3){case 0:t.state="closed";break;case 1:t.state="tilted";break;case 2:t.state="reserved";break;case 3:t.state="open";}switch(s){case 0:t.viberation=!1;break;case 1:t.viberation=!0;}}}return t;};var A5_20_04=function A5_20_04(e){A5.call(this,e),this._data="a5-20-04",this.TEACH_IN_VARIATION=3,this._defaultSetpoint=15,this._defaultWakeupCycle=3,this._defaultDisplay=0,this._states={pending:{value:!1,time:new Date().getTime()}},this._valve_new=null,this._setpoint_new=null,this._measurement_new=null,this._wakeup_cycle_new=null,this._display_new=null,this._button_lock_new=null,this._service_command_new=null;};A5_20_04.COMMANDS=["setValve","setTo","up","down","measureOn","measureOff","setWakeup","setDisplay","buttonLock","buttonUnlock","openValve","closeValve","init"],A5_20_04.STATES=["valve","measurement","button_lock","temperature_selection","feed_temperature","setpoint","error","temperature","wakeup_cycle","display","pending"],(A5_20_04.prototype=new A5()).constructor=A5_20_04,A5_20_04.prototype.setDefaultParams=function(){this._params||(this._params={}),void 0!==this._params.wakeup_cycle&&null!=this._params.wakeup_cycle||(this._params.wakeup_cycle=this._defaultWakeupCycle),void 0!==this._params.display&&null!=this._params.display||(this._params.display=this._defaultDisplay);},A5_20_04.prototype.getStatesBuffer=function(){var e=JSON.parse(JSON.stringify(this._states));return e.wakeup_cycle={value:this._params.wakeup_cycle,time:-1},e.display={value:this._params.display,time:-1},void 0!==this._wakeup_cycle_new&&null!=this._wakeup_cycle_new&&(e.wakeup_cycle={value:this._wakeup_cycle_new,time:-1}),void 0!==this._display_new&&null!=this._display_new&&(e.display={value:this._display_new,time:-1}),void 0!==this._valve_new&&null!=this._valve_new&&(e.valve={value:this._valve_new,time:-1}),void 0!==this._setpoint_new&&null!=this._setpoint_new&&(e.setpoint={value:this._setpoint_new,time:-1}),void 0!==this._measurement_new&&null!=this._measurement_new&&(e.measurement={value:this._measurement_new,time:-1}),void 0!==this._button_lock_new&&null!=this._button_lock_new&&(e.button_lock={value:this._button_lock_new,time:-1}),e;},A5_20_04.prototype.getCurrentStates=function(){var e={},t=this.getStatesBuffer();for(var a in t){t.hasOwnProperty(a)&&t[a]&&(e[a]=t[a].value);}return e;},A5_20_04.prototype.executeCommand=function(e,t,a){var r,n,s,o=new Date().getTime();if(t&&t.value){"setValve"==t.value.substr(0,8)&&t.value.length>8?(r=t.value.substr(8),t={value:"setValve",ext:r}):"setTo"==t.value.substr(0,5)&&t.value.length>5?(r=t.value.substr(5),t={value:"setTo",ext:r}):"tempTo"==t.value.substr(0,6)&&t.value.length>6?(r=t.value.substr(6),t={value:"setTo",ext:r}):"up"==t.value.substr(0,2)&&t.value.length>2?(r=t.value.substr(2),t={value:"up",ext:r}):"down"==t.value.substr(0,4)&&t.value.length>4?(r=t.value.substr(4),t={value:"down",ext:r}):"setWakeup"==t.value.substr(0,9)&&t.value.length>9?(r=t.value.substr(9),t={value:"setWakeup",ext:r}):"setDisplay"==t.value.substr(0,10)&&t.value.length>10&&(r=t.value.substr(10),t={value:"setDisplay",ext:r});this._states;var i=[];switch(t.value){case"setValve":if(void 0===t.ext||null==t.ext)return void(a&&a(new Error("set valve value invalid")));(r=parseInt(t.ext))<0&&(r=0),r>100&&(r=100),this._valve_new=r,this._states.pending={value:!0,time:o},n={key:"valve",value:r,changed:!1},(s=this._states.valve?this._states.valve.value:null)!=r&&(n.oldvalue=s,n.changed=!0),i.push(n);break;case"setTo":if(void 0===t.ext||null==t.ext)return void(a&&a(new Error("set valve value invalid")));(r=parseFloat(t.ext))<10&&(r=10),r>30&&(r=30),this._setpoint_new=r,this._states.pending={value:!0,time:o},n={key:"setpoint",value:this._setpoint_new,changed:!1},(s=this._states.setpoint?this._states.setpoint.value:null)!=this._setpoint_new&&(n.oldvalue=s,n.changed=!0),i.push(n);break;case"up":if(r=t.ext,t.ext||(r=.5),r=parseFloat(r),void 0!==this._setpoint_new&&null!=this._setpoint_new)this._setpoint_new+=r;else{if(!this._states||!this._states.setpoint||void 0===this._states.setpoint.value||null==this._states.setpoint.value)return void(a&&a(new Error("not current setpoint value")));this._setpoint_new=this._states.setpoint.value+r;}this._setpoint_new<10&&(this._setpoint_new=10),this._setpoint_new>30&&(this._setpoint_new=30),this._states.pending={value:!0,time:o},n={key:"setpoint",value:this._setpoint_new,changed:!1},(s=this._states.setpoint?this._states.setpoint.value:null)!=this._setpoint_new&&(n.oldvalue=s,n.changed=!0),i.push(n);break;case"down":if(r=t.ext,t.ext||(r=.5),r=parseFloat(r),void 0!==this._setpoint_new&&null!=this._setpoint_new)this._setpoint_new-=r;else{if(!this._states||!this._states.setpoint||void 0===this._states.setpoint.value||null==this._states.setpoint.value)return void(a&&a(new Error("not current setpoint value")));this._setpoint_new=this._states.setpoint.value-r;}this._setpoint_new<10&&(this._setpoint_ne=10),this._setpoint_new>30&&(this._setpoint_new=30),this._states.pending={value:!0,time:o},n={key:"setpoint",value:this._setpoint_new,changed:!1},(s=this._states.setpoint?this._states.setpoint.value:null)!=this._setpoint_new&&(n.oldvalue=s,n.changed=!0),i.push(n);break;case"measureOn":this._measurement_new="active",this._states.pending={value:!0,time:o},n={key:"measurement",value:this._measurement_new,changed:!1},(s=this._states.measurement?this._states.measurement.value:null)!=this._measurement_new&&(n.oldvalue=s,n.changed=!0),i.push(n);break;case"measureOff":this._measurement_new="inactive",this._states.pending={value:!0,time:o},n={key:"measurement",value:this._measurement_new,changed:!1},(s=this._states.measurement?this._states.measurement.value:null)!=this._measurement_new&&(n.oldvalue=s,n.changed=!0),i.push(n);break;case"setWakeup":if(void 0===t.ext||null==t.ext)return void(a&&a(new Error("set wakup cycle value invalid")));r=parseInt(t.ext),this._wakeup_cycle_new=r,this._states.pending={value:!0,time:o},n={key:"wakeup_cycle",value:this._wakeup_cycle_new,changed:!1},(s=this._params.wakeup_cycle)!=this._wakeup_cycle_new&&(n.oldvalue=s,n.changed=!0),i.push(n);break;case"setDisplay":if(void 0===t.ext||null==t.ext)return void(a&&a(new Error("set display orientation value invalid")));r=parseInt(t.ext),this._display_new=r,this._states.pending={value:!0,time:o},n={key:"display",value:this._display_new,changed:!1},(s=this._params.display)!=this._display_new&&(n.oldvalue=s,n.changed=!0),i.push(n);break;case"buttonLock":this._button_lock_new="locked",this._states.pending={value:!0,time:o},n={key:"button_lock",value:this._button_lock_new,changed:!1},(s=this._states.button_lock?this._states.button_lock.value:null)!=this._button_lock_new&&(n.oldvalue=s,n.changed=!0),i.push(n);break;case"buttonUnlock":this._button_lock_new="unlocked",this._states.pending={value:!0,time:o},n={key:"button_lock",value:this._button_lock_new,changed:!1},(s=this._states.button_lock?this._states.button_lock.value:null)!=this._button_lock_new&&(n.oldvalue=s,n.changed=!0),i.push(n);break;case"openValve":this._service_command_new=1,this._states.pending={value:!0,time:o};break;case"closeValve":this._service_command_new=3,this._states.pending={value:!0,time:o};break;case"init":this._service_command_new=2,this._states.pending={value:!0,time:o};}if(i.length>0)require("x.hub.m.enocean.js")._onEOEvents(this,i);a&&a();}else a&&a(new Error("command invalid"));},A5_20_04.prototype.evalData=function(e,t,a){var r=this.evalTelegram(t);if(r){var n=this;this._sendResponse(e,r,function(e,t){var r=n.checkStateChange(t);a&&a(null,r);});}else a&&a(new Error("data format invalid"));},A5_20_04.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(2),n=e.userData.readUInt8(1),s=e.userData.readUInt8(0);if(1==(a>>3&1)){var o=s;t.valve=o;var i=n,l=r,u=a>>7&1;t.measurement=u?"inactive":"active";var c=a>>2&1;t.button_lock=c?"locked":"unlocked";var h=a>>1&1,_=1&a;switch(t.temperature_selection=h?"setpoint":"feed_temperature",h){case 0:t.feed_temperature=parseFloat((i/255*60+20).toFixed(1));break;case 1:t.setpoint=parseFloat((i/255*20+10).toFixed(1));}if(0==_)t.error="no_error",t.temperature=parseFloat((l/255*20+10).toFixed(1));else switch(l){case 17:t.error="measurement_error";break;case 18:t.error="battery_empty";break;case 20:t.error="frost_protection";break;case 33:t.error="blocked_valve";break;case 36:t.error="end_point_detection_error";break;case 40:t.error="no_valve";break;case 49:t.error="not_taught_in";break;case 53:t.error="no_response_from_controller";break;case 54:t.error="teach_in_error";break;default:t.error="unknow_error";}}}return t;},A5_20_04.prototype._sendResponse=function(e,t,a){var r=new Date().getTime(),n=JSON.parse(JSON.stringify(t));this._states.pending={value:!1,time:r};var s,o,i,l=!1;void 0!==this._valve_new&&null!=this._valve_new?(s=this._valve_new,this._states.valve={value:this._valve_new,time:r},this._valve_new=null,delete n.valve):s=void 0!==t.valve&&null!=t.valve?t.valve:this._states.valve?this._states.valve.value:null,void 0!==s&&null!=s||(s=0,n.valve=0),void 0!==this._setpoint_new&&null!=this._setpoint_new?(o=Math.round((this._setpoint_new-10)/20*255),this._states.setpoint={value:this._setpoint_new,time:r},this._setpoint_new=null,delete n.setpoint):void 0!==t.setpoint&&null!=t.setpoint?o=Math.round((t.setpoint-10)/20*255):this._states.setpoint&&"undefined"!=this._states.setpoint.value&&null!=this._states.setpoint.value&&(o=Math.round((this._states.setpoint.value-10)/20*255)),void 0!==o&&null!=o||(o=this._defaultSetpoint,o=Math.round((o-10)/20*255),n.setpoint=this._defaultSetpoint),void 0!==this._measurement_new&&null!=this._measurement_new?(i="active"==this._measurement_new?0:1,this._states.measurement={value:this._measurement_new,time:r},this._measurement_new=null,delete n.measurement):void 0!==t.measurement&&null!=t.measurement?i="active"==t.measurement?0:1:this._states.measurement&&"undefined"!=this._states.measurement.value&&null!=this._states.measurement.value&&(i="active"==this._states.measurement.value?0:1),void 0!==i&&null!=i||(i=0,n.measurement="active");var u=this._params.wakeup_cycle;void 0!==this._wakeup_cycle_new&&null!=this._wakeup_cycle_new&&(u=this._wakeup_cycle_new,this._params.wakeup_cycle=this._wakeup_cycle_new,l=!0,this._wakeup_cycle_new=null),void 0!==u&&null!=u||(u=this._defaultWakeupCycle,this._params.wakeup_cycle=u);var c=this._params.display;void 0!==this._display_new&&null!=this._display_new&&(c=this._display_new,this._params.display=this._display_new,l=!0,this._display_new=null),void 0!==c&&null!=c||(c=this._defaultDisplay,this._params.display=c);var h;void 0!==this._button_lock_new&&null!=this._button_lock_new?(h="locked"==this._button_lock_new?1:0,this._states.button_lock={value:this._button_lock_new,time:r},this._button_lock_new=null,delete n.button_lock):void 0!==t.button_lock&&null!=t.button_lock?h="locked"==t.button_lock?1:0:this._states.button_lock&&this._states.button_lock.value&&(h="locked"==this._states.button_lock.value?1:0),void 0!==h&&null!=h||(h=0,n.button_lock="unlocked");var _=0;void 0!==this._service_command_new&&null!=this._service_command_new&&(_=this._service_command_new,this._service_command_new=null);var p=new Buffer([s,o,(1&i)<<6|63&u,(3&c)<<4|8|(1&h)<<2|3&_]);l&&require("x.hub.m.enocean.js")._deviceHandler.deviceParamsUpdated();var d=this._senderID;d||(d=x.hub.m.enocean.SENDER_ID);var v=new x.hub.m.enocean.ESP3.Telegram.ADT(165,p,this._address,d,0);e.sendTelegram(v,!0,function(e){a&&a(e,n);});};var A5_30=function A5_30(e){A5.call(this,e),this._data="a5-30-??";};(A5_30.prototype=new A5()).constructor=A5_30;var A5_30_01=function A5_30_01(e){Profile.call(this,e),this._data="a5-30-01";};A5_30_01.STATES=["battery_low","battery_raw","state","state_raw"],(A5_30_01.prototype=new A5_30()).constructor=A5_30_01,A5_30_01.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(2),n=e.userData.readUInt8(1);if(1==(a>>3&1)){var s=n;t.battery_low=s<=120,t.battery_raw=s;var o=r;t.state=o<=195?"closed":"open",t.state_raw=o;}}return t;};var A5_30_02=function A5_30_02(e){Profile.call(this,e),this._data="a5-30-01´";};A5_30_02.STATES=["state"],(A5_30_02.prototype=new A5_30()).constructor=A5_30_02,A5_30_02.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3);if(1==(a>>3&1)){var r=1&a;t.state=r?"open":"closed";}}return t;};var A5_30_03=function A5_30_03(e){Profile.call(this,e),this._data="a5-30-03";};A5_30_03.STATES=["temperature","temperature_raw","wake","input3","input2","input1","input0"],(A5_30_03.prototype=new A5_30()).constructor=A5_30_03,A5_30_03.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(2),n=e.userData.readUInt8(1);if(1==(a>>3&1)){var s=n;t.temperature=(255-s)/255*40,t.temperature_raw=s;var o=r>>4&1;t.wake=o;var i=r>>3&1;t.input3=i;var l=r>>2&1;t.input2=l;var u=r>>1&1;t.input1=u;var c=1&r;t.input0=c;}}return t;};var A5_30_04=function A5_30_04(e){Profile.call(this,e),this._data="a5-30-04";};A5_30_04.STATES=["analog_input","input2","input1","input0"],(A5_30_04.prototype=new A5_30()).constructor=A5_30_04,A5_30_04.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(2);if(1==(a>>3&1)){var n=r;t.analog_input=n;var s=a>>2&1;t.input2=s;var o=a>>1&1;t.input1=o;var i=1&a;t.input0=i;}}return t;};var A5_38=function A5_38(e){A5.call(this,e),this._data="a5-38-??";};(A5_38.prototype=new A5()).constructor=A5_38;var A5_38_08=function A5_38_08(e){A5_38.call(this,e),this._data="a5-38-08";};(A5_38_08.prototype=new A5_38()).constructor=A5_38_08,A5_38_08.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(2),n=e.userData.readUInt8(1),s=e.userData.readUInt8(0);if(1==(a>>3&1))if(2===s){var o=n;t.level=Math.round(o/255*100);var i=r;t.ramp=i;var l=a>>2&1;t.dim_range=l?"relative":"absolute";var u=a>>1&1;t.store_final_value=u;var c=1&a;t.state=c?"on":"off";}}return t;},A5_38_08.prototype.switching=function(e,t,a){var r=this._senderID;this._senderID||(r=x.hub.m.enocean.SENDER_ID);var n=t.TIM>>8&255,s=255&t.TIM,o=8|(1&t.LCK)<<2|(1&t.DEL)<<1|1&t.SW,i=new Buffer([1,n,s,o]),l=new x.hub.m.enocean.ESP3.Telegram.BS4(i,r,0);l.setDstId(this._address),e.sendTelegram(l,!0,function(e){a&&a(e);});},A5_38_08.prototype.dimming=function(e,t,a){var r=this._senderID;this._senderID||(r=x.hub.m.enocean.SENDER_ID);var n=t.EDIM,s=t.RMP,o=8|(1&t.EDIMR)<<2|(1&t.STR)<<1|1&t.SW,i=new Buffer([2,n,s,o]),l=new x.hub.m.enocean.ESP3.Telegram.BS4(i,r,0);l.setDstId(this._address),e.sendTelegram(l,!0,function(e){a&&a(e);});},A5_38_08.prototype.blind=function(e,t,a){var r=this._senderID;if(this._senderID||(r=x.hub.m.enocean.SENDER_ID),r){var n=t.P1,s=t.P2,o=(15&t.FUNC)<<4|8|(1&t.SSF)<<2|(1&t.PAF)<<1|1&t.SMF,i=new Buffer([7,n,s,o]),l=new x.hub.m.enocean.ESP3.Telegram.BS4(i,r,0);l.setDstId(this._address),e.sendTelegram(l,!0,function(e){a&&a(e);});}else a&&a(new Error("no senderID"));};var A5_3F_7F=function A5_3F_7F(e){A5.call(this,e),this._data="a5-3F-7F";};(A5_3F_7F.prototype=new A5()).constructor=A5_3F_7F;var D2=function D2(e){Profile.call(this,e),this._data="d2-??-??",this.UNIQUE_GATEWAY_SENDERID=!0;};(D2.prototype=new Profile()).constructor=D2;var D2_01=function D2_01(e){D2.call(this,e),this._data="d2-01-??",this._lastQuery={},this._initCount=0;};D2_01.STATES=["power_failure_detection","power_failure","over_current_switch_off","error_level","io_channel","local_control","output_value","output_state"],(D2_01.prototype=new D2()).constructor=D2_01,D2_01.prototype.init=function(e){var t=this.getIOs();if(t.length>0){var a=require("x.hub.m.enocean.js")._esp3,r=0,n=this,cb=function cb(){++r<t.length?n.statusQuery(a,{IO:t[r]},cb):e&&e();};this.statusQuery(a,{IO:t[r]},cb);}else e&&e();},D2_01.prototype.getStatesBuffer=function(){return 0==Object.keys(this._states).length?(this._initCount<=100&&this._initCount%10==0||this._initCount>=100&&this._initCount<=600&&this._initCount%60==0?this.init():this._initCount=0,this._initCount++):this._initCount=0,this._states;},D2_01.prototype.getIOs=function(){return[];},D2_01.prototype.setOutput=function(e,t,a){var r=this._senderID;this._senderID||(r=x.hub.m.enocean.SENDER_ID);var n=(7&t.DV)<<5|31&t.IO,s=127&t.OV,o=new Buffer([1,n,s]),i=new x.hub.m.enocean.ESP3.Telegram.VLD(o,r,0);this._senderID!=this._address&&i.setDstId(this._address),e.sendTelegram(i,!0,function(e){a&&a(e);});},D2_01.prototype.setLocal=function(e,t,a){var r=(1&t.DE)<<7|2,n=(1&t.OC)<<7|(1&t.RO)<<6|(1&t.LC)<<5|31&t.IO,s=(15&t.DT2)<<4|15&t.DT3,o=(1&t.DN)<<7|(1&t.PF)<<6|(3&t.DS)<<4|15&t.DT1,i=new Buffer([r,n,s,o]),l=new x.hub.m.enocean.ESP3.Telegram.VLD(i,x.hub.m.enocean.SENDER_ID,0);l.setDstId(this._address),e.sendTelegram(l,!0,function(e){a&&a(e);});},D2_01.prototype.statusQuery=function(e,t,a){if(this._senderID){this._lastQuery[t.IO]=new Date().getTime();var r=31&t.IO,n=new Buffer([3,r]),s=new x.hub.m.enocean.ESP3.Telegram.VLD(n,this._senderID,0);s.setDstId(this._address),e.sendTelegram(s,!0,function(e){a&&a(e);});}else a&&a(new Error("no senderID"));},D2_01.prototype.measurementQuery=function(e,t,a){var r=(1&t.QU)<<5|31&t.IO,n=new Buffer([6,r]),s=new x.hub.m.enocean.ESP3.Telegram.VLD(n,this._senderID,0);s.setDstId(this._address),e.sendTelegram(s,!0,function(e){a&&a(e);});},D2_01.prototype.evalTelegram=function(e){var t={};if(210==e.rorg){var a,r=e.userData.readUInt8(0);switch(15&r){case 4:if(3==e.userData.length){var n=(a=r)>>7&1,s=a>>6&1,o=(a=e.userData.readUInt8(1))>>7&1,i=a>>5&3,l=31&a,u=(a=e.userData.readUInt8(2))>>7&1,c=127&a;t.power_failure_detection=!!n,t.power_failure=!!s,t.over_current_switch_off=o,t.error_level=i,t.io_channel=l,t.local_control=!!u,t.output_value=c,t.output_state=c?"on":"off";}break;case 7:if(6==e.userData.length){var h=(a=e.userData.readUInt8(1))>>5&7,_=(l=31&a,a=e.userData.readUInt32BE(2));switch(h){case 0:t.unit="Ws";break;case 1:t.unit="Wh";break;case 2:t.unit="KWh";break;case 3:t.unit="W";break;case 4:t.unit="KW";}t.io_channel=l,t.value=_;}}}return t;};var D2_01_00=function D2_01_00(e){D2_01.call(this,e),this._data="d2-01-00";};D2_01_00.COMMANDS=["on","off","toggle"],D2_01_00.STATES=["power_failure_detection","power_failure","over_current_switch_off","error_level","io_channel","local_control","output_value","output_state"],(D2_01_00.prototype=new D2_01()).constructor=D2_01_00,D2_01_00.prototype.getIOs=function(){return[0];},D2_01_00.prototype.executeCommand=function(e,t,a){if(t&&t.value){var r=this;switch(t.value){case"on":this.activeStateChange({output_value:100,output_state:"on"}),this.setOutput(e,{DV:0,IO:0,OV:100},a);break;case"off":this.activeStateChange({output_value:0,output_state:"off"}),this.setOutput(e,{DV:0,IO:0,OV:0},a);break;case"toggle":if(!this._states.output_state)return void this.init(function(){setTimeout(function(){r._states.output_state?r.executeCommand(e,t,a):a&&a(new Error("unkown current status"));},200);});var n="on"==this._states.output_state.value?"off":"on";this.executeCommand(e,{value:n},a);}}else a&&a(new Error("command invalid"));};var D2_01_01=function D2_01_01(e){D2_01_00.call(this,e),this._data="d2-01-01";};D2_01_01.COMMANDS=["on","off","toggle"],D2_01_01.STATES=["power_failure_detection","power_failure","over_current_switch_off","error_level","io_channel","local_control","output_value","output_state"],(D2_01_01.prototype=new D2_01_00()).constructor=D2_01_01;var D2_01_03=function D2_01_03(e){D2_01_00.call(this,e),this._data="d2-01-03",this._lastOnLevel=-1;};(D2_01_03.prototype=new D2_01_00()).constructor=D2_01_03,D2_01_03.prototype.evalData=function(e,t,a){var r=this.evalTelegram(t);if(r){0!=r.output_value&&"off"!=r.output_state||this._states.output_value&&this._states.output_value.value&&(this._lastOnLevel=this._states.output_value.value);var n=this.checkStateChange(r);a&&a(null,n);}else a&&a(new Error("data format invalid"));},D2_01_03.prototype.executeCommand=function(e,t,a){if(t&&t.value){var r;"dimTo"==t.value.substr(0,5)&&t.value.length>5?(r=t.value.substr(5),t={value:"dimTo",ext:r}):"toggleTo"==t.value.substr(0,8)&&t.value.length>8&&(r=t.value.substr(8),t={value:"toggleTo",ext:r});new Date().getTime();var n=this;switch(t.value){case"on":-1!=(r=this._lastOnLevel)&&0!=r||(r=100),this.setOutput(e,{DV:0,IO:0,OV:r},function(e){e||n.activeStateChange({output_value:r,output_state:"on"}),a&&a(e);});break;case"off":this._states.output_value&&this._states.output_value.value&&(this._lastOnLevel=this._states.output_value.value),this.setOutput(e,{DV:0,IO:0,OV:0},function(e){e||n.activeStateChange({output_value:0,output_state:"off"}),a&&a(e);});break;case"toggle":if(!this._states.output_state)return void this.init(function(){setTimeout(function(){n._states.output_state?n.executeCommand(e,t,a):a&&a(new Error("unkown current status"));},200);});var s="on"==this._states.output_state.value?"off":"on";this.executeCommand(e,{value:s},a);break;case"toggleTo":if(!this._states.output_state)return void this.init(function(){setTimeout(function(){n._states.output_state?n.executeCommand(e,t,a):a&&a(new Error("unkown current status"));},200);});"on"==this._states.output_state.value?this.executeCommand(e,{value:"off"},a):this.executeCommand(e,{value:"dimTo",ext:t.ext},a);break;case"dimTo":if(void 0===t.ext||null==t.ext)return void(a&&a(new Error("dim to value invalid")));(r=parseFloat(t.ext))<0&&(r=0),r>100&&(r=100),this.setOutput(e,{DV:0,IO:0,OV:r},function(e){e||n.activeStateChange({output_value:r,output_state:0==r?"off":"on"}),a&&a(e);});break;case"dimUp":if(!this._states.output_state)return void this.init(function(){setTimeout(function(){n._states.output_state?n.executeCommand(e,t,a):a&&a(new Error("unkown current status"));},200);});r=parseInt(this._states.output_value.value),(r+=5)>100&&(r=100),this.executeCommand(e,{value:"dimTo",ext:r},a);break;case"dimDown":if(!this._states.output_state)return void this.init(function(){setTimeout(function(){n._states.output_state?n.executeCommand(e,t,a):a&&a(new Error("unkown current status"));},200);});r=parseInt(this._states.output_value.value),(r-=5)<0&&(r=0),this.executeCommand(e,{value:"dimTo",ext:r},a);break;default:a&&a(new Error("unknow command"));}}else a&&a(new Error("command invalid"));};var D2_01_11=function D2_01_11(e){D2_01.call(this,e),this._data="d2-01-11";};D2_01_11.COMMANDS=["ch1On","ch1Off","ch1Toggle","ch2On","ch2Off","ch2Toggle"],D2_01_11.STATES=["power_failure_detection","power_failure","over_current_switch_off","error_level","io_channel","local_control","output_value","output_state","ch1_output_value","ch1_output_state","ch2_output_value","ch2_output_state"],(D2_01_11.prototype=new D2_01()).constructor=D2_01_11,D2_01_11.prototype.getIOs=function(){return[0,1];},D2_01_11.prototype.evalTelegram=function(e){var t=D2_01.prototype.evalTelegram.call(this,e);if(t)switch(t.io_channel){case 0:t.ch1_output_value=t.output_value,t.ch1_output_state=t.output_state;break;case 1:t.ch2_output_value=t.output_value,t.ch2_output_state=t.output_state;}return t;},D2_01_11.prototype.executeCommand=function(e,t,a){if(t&&t.value){var r,n=this;switch(t.value){case"ch1On":this.activeStateChange({ch1_output_value:100,ch1_output_state:"on"}),this.setOutput(e,{DV:0,IO:0,OV:100},a);break;case"ch1Off":this.activeStateChange({ch1_output_value:0,ch1_output_state:"off"}),this.setOutput(e,{DV:0,IO:0,OV:0},a);break;case"ch1Toggle":if(!this._states.output_state)return void this.init(function(){setTimeout(function(){n._states.output_state?n.executeCommand(e,t,a):a&&a(new Error("unkown current status"));},200);});r="on"==this._states.ch1_output_state.value?"off":"on",this.activeStateChange({ch1_output_value:"on"==r?100:0,ch1_output_state:r}),this.executeCommand(e,{value:"on"==r?"ch1On":"ch1Off"},a);break;case"ch2On":this.activeStateChange({ch2_output_value:100,ch2_output_state:"on"}),this.setOutput(e,{DV:0,IO:1,OV:100},a);break;case"ch2Off":this.activeStateChange({ch2_output_value:0,ch2_output_state:"off"}),this.setOutput(e,{DV:0,IO:1,OV:0},a);break;case"ch2Toggle":if(!this._states.output_state)return void this.init(function(){setTimeout(function(){n._states.output_state?n.executeCommand(e,t,a):a&&a(new Error("unkown current status"));},200);});r="on"==this._states.ch2_output_state.value?"off":"on",this.activeStateChange({ch2_output_value:"on"==r?100:0,ch2_output_state:r}),this.executeCommand(e,{value:"on"==r?"ch2On":"ch2Off"},a);break;default:a&&a(new Error("unknown command"));}}else a&&a(new Error("command invalid"));};var D2_01_13=function D2_01_13(e){D2_01.call(this,e),this._data="d2-01-13",this._queryInterval=3e4;};D2_01_13.COMMANDS=["ch1On","ch1Off","ch1Toggle","ch2On","ch2Off","ch2Toggle","ch3On","ch3Off","ch3Toggle","ch4On","ch4Off","ch4Toggle"],D2_01_13.STATES=["power_failure_detection","power_failure","over_current_switch_off","error_level","io_channel","local_control","output_value","output_state","ch1_output_value","ch1_output_state","ch2_output_value","ch2_output_state","ch3_output_value","ch3_output_state","ch4_output_value","ch4_output_state"],(D2_01_13.prototype=new D2_01()).constructor=D2_01_13,D2_01_13.prototype.getStatesBuffer=function(){var e=[];return this._states.ch1_output_state||(!this._lastQuery[0]||now-this._lastQuery[0]>this._queryInterval)&&e.push(0),this._states.ch2_output_state||(!this._lastQuery[1]||now-this._lastQuery[1]>this._queryInterval)&&e.push(1),this._states.ch3_output_state||(!this._lastQuery[2]||now-this._lastQuery[2]>this._queryInterval)&&e.push(2),this._states.ch4_output_state||(!this._lastQuery[3]||now-this._lastQuery[3]>this._queryInterval)&&e.push(3),e.length>0&&this._queryStates(e),this._states;},D2_01_13.prototype._queryStates=function(e,t){var a=require("x.hub.m.enocean.js")._esp3,r=0,n=this,cb=function cb(){++r<e.length?n.statusQuery(a,{IO:e[r]},cb):t&&t();};this.statusQuery(a,{IO:e[r]},cb);},D2_01_13.prototype.getIOs=function(){return[0,1,2,3];},D2_01_13.prototype.evalTelegram=function(e){var t=D2_01.prototype.evalTelegram.call(this,e);if(t)switch(t.io_channel){case 0:t.ch1_output_value=t.output_value,t.ch1_output_state=t.output_state;break;case 1:t.ch2_output_value=t.output_value,t.ch2_output_state=t.output_state;break;case 2:t.ch3_output_value=t.output_value,t.ch3_output_state=t.output_state;break;case 3:t.ch4_output_value=t.output_value,t.ch4_output_state=t.output_state;}return t;},D2_01_13.prototype.executeCommand=function(e,t,a){if(t&&t.value){var r,n,s,o,i,l,u=this;switch(t.value?t.value.substr(0,3):null){case"ch1":n=0,s="ch1_output_value",o="ch1_output_state";break;case"ch2":n=1,s="ch2_output_value",o="ch2_output_state";break;case"ch3":n=2,s="ch3_output_value",o="ch3_output_state";break;case"ch4":n=3,s="ch4_output_value",o="ch4_output_state";}switch(t.value){case"ch1On":case"ch2On":case"ch3On":case"ch4On":(l={})[s]=100,l[o]="on",i={DV:0,IO:n,OV:100},this.activeStateChange(l),this.setOutput(e,i,a);break;case"ch1Off":case"ch2Off":case"ch3Off":case"ch4Off":(l={})[s]=0,l[o]="off",i={DV:0,IO:n,OV:0},this.activeStateChange(l),this.setOutput(e,i,a);break;case"ch1Toggle":case"ch2Toggle":case"ch3Toggle":case"ch4Toggle":if(!this._states.output_state)return void this.init(function(){setTimeout(function(){u._states.output_state?u.executeCommand(e,t,a):a&&a(new Error("unkown current status"));},200);});if(!this._states[o])return void(a&&a(new Error("state unknown")));r="on"==this._states[o].value?"off":"on",(l={})[s]="on"==r?100:0,l[o]=r,i={DV:0,IO:n,OV:"on"==r?100:0},this.activeStateChange(l),this.setOutput(e,i,a);break;default:a&&a(new Error("unknown command"));}}else a&&a(new Error("command invalid"));};var D2_01_14=function D2_01_14(e){D2_01.call(this,e),this._data="d2-01-14",this._queryInterval=3e4;};D2_01_14.COMMANDS=["ch1On","ch1Off","ch1Toggle","ch2On","ch2Off","ch2Toggle","ch3On","ch3Off","ch3Toggle","ch4On","ch4Off","ch4Toggle","ch5On","ch5Off","ch5Toggle","ch6On","ch6Off","ch6Toggle","ch7On","ch7Off","ch7Toggle","ch8On","ch8Off","ch8Toggle"],D2_01_14.STATES=["power_failure_detection","power_failure","over_current_switch_off","error_level","io_channel","local_control","output_value","output_state","ch1_output_value","ch1_output_state","ch2_output_value","ch2_output_state","ch3_output_value","ch3_output_state","ch4_output_value","ch4_output_state","ch5_output_value","ch5_output_state","ch6_output_value","ch6_output_state","ch7_output_value","ch7_output_state","ch8_output_value","ch8_output_state"],(D2_01_14.prototype=new D2_01()).constructor=D2_01_14,D2_01_14.prototype._queryStates=function(e,t){var a=require("x.hub.m.enocean.js")._esp3,r=0,n=this,cb=function cb(){++r<e.length?n.statusQuery(a,{IO:e[r]},cb):t&&t();};this.statusQuery(a,{IO:e[r]},cb);},D2_01_14.prototype.getStatesBuffer=function(){var e=new Date().getTime(),t=[];return this._states.ch1_output_state||(!this._lastQuery[0]||e-this._lastQuery[0]>this._queryInterval)&&t.push(0),this._states.ch2_output_state||(!this._lastQuery[1]||e-this._lastQuery[1]>this._queryInterval)&&t.push(1),this._states.ch3_output_state||(!this._lastQuery[2]||e-this._lastQuery[2]>this._queryInterval)&&t.push(2),this._states.ch4_output_state||(!this._lastQuery[3]||e-this._lastQuery[3]>this._queryInterval)&&t.push(3),this._states.ch5_output_state||(!this._lastQuery[4]||e-this._lastQuery[4]>this._queryInterval)&&t.push(4),this._states.ch6_output_state||(!this._lastQuery[5]||e-this._lastQuery[5]>this._queryInterval)&&t.push(5),this._states.ch7_output_state||(!this._lastQuery[6]||e-this._lastQuery[6]>this._queryInterval)&&t.push(6),this._states.ch8_output_state||(!this._lastQuery[7]||e-this._lastQuery[7]>this._queryInterval)&&t.push(7),t.length>0&&this._queryStates(t),this._states;},D2_01_14.prototype.getIOs=function(){return[0,1,2,3,4,5,6,7];},D2_01_14.prototype.evalTelegram=function(e){var t=D2_01.prototype.evalTelegram.call(this,e);if(t)switch(t.io_channel){case 0:t.ch1_output_value=t.output_value,t.ch1_output_state=t.output_state;break;case 1:t.ch2_output_value=t.output_value,t.ch2_output_state=t.output_state;break;case 2:t.ch3_output_value=t.output_value,t.ch3_output_state=t.output_state;break;case 3:t.ch4_output_value=t.output_value,t.ch4_output_state=t.output_state;break;case 4:t.ch5_output_value=t.output_value,t.ch5_output_state=t.output_state;break;case 5:t.ch6_output_value=t.output_value,t.ch6_output_state=t.output_state;break;case 6:t.ch7_output_value=t.output_value,t.ch7_output_state=t.output_state;break;case 7:t.ch8_output_value=t.output_value,t.ch8_output_state=t.output_state;}return t;},D2_01_14.prototype.executeCommand=function(e,t,a){if(t&&t.value){var r,n,s,o,i,l,u=this;switch(t.value?t.value.substr(0,3):null){case"ch1":n=0,s="ch1_output_value",o="ch1_output_state";break;case"ch2":n=1,s="ch2_output_value",o="ch2_output_state";break;case"ch3":n=2,s="ch3_output_value",o="ch3_output_state";break;case"ch4":n=3,s="ch4_output_value",o="ch4_output_state";break;case"ch5":n=4,s="ch5_output_value",o="ch5_output_state";break;case"ch6":n=5,s="ch6_output_value",o="ch6_output_state";break;case"ch7":n=6,s="ch7_output_value",o="ch7_output_state";break;case"ch8":n=7,s="ch8_output_value",o="ch8_output_state";}switch(t.value){case"ch1On":case"ch2On":case"ch3On":case"ch4On":case"ch5On":case"ch6On":case"ch7On":case"ch8On":(l={})[s]=100,l[o]="on",i={DV:0,IO:n,OV:100},this.activeStateChange(l),this.setOutput(e,i,a);break;case"ch1Off":case"ch2Off":case"ch3Off":case"ch4Off":case"ch5Off":case"ch6Off":case"ch7Off":case"ch8Off":(l={})[s]=0,l[o]="off",i={DV:0,IO:n,OV:0},this.activeStateChange(l),this.setOutput(e,i,a);break;case"ch1Toggle":case"ch2Toggle":case"ch3Toggle":case"ch4Toggle":case"ch5Toggle":case"ch6Toggle":case"ch7Toggle":case"ch8Toggle":if(!this._states.output_state)return void this.init(function(){setTimeout(function(){u._states.output_state?u.executeCommand(e,t,a):a&&a(new Error("unkown current status"));},200);});if(!this._states[o])return void(a&&a(new Error("state unknown")));r="on"==this._states[o].value?"off":"on",(l={})[s]="on"==r?100:0,l[o]=r,i={DV:0,IO:n,OV:"on"==r?100:0},this.activeStateChange(l),this.setOutput(e,i,a);break;default:a&&a(new Error("unknown command"));}}else a&&a(new Error("command invalid"));};var D2_05=function D2_05(e){D2.call(this,e),this._data="d2-05-??";};(D2_05.prototype=new D2()).constructor=D2_05;var D2_05_00=function D2_05_00(e){D2_05.call(this,e),this._data="d2-05-00";};D2_05_00.COMMANDS=["moveUp","moveDown","moveTo","stepUp","stepDown","lamellaUp","lamellaDown","lamellaTo","stop","setRunTime","setRotationTime","setParams[15.2s]:[10,20,30ms]:[0-3]"],D2_05_00.STATES=["state","angle","lock","channel"],(D2_05_00.prototype=new D2_05()).constructor=D2_05_00,D2_05_00.prototype.init=function(e){var t=require("x.hub.m.enocean.js")._esp3;this.query(t,{CHN:0},e);},D2_05_00.prototype.getStatesBuffer=function(){return 0==Object.keys(this._states).length&&this.init(),this._states;},D2_05_00.prototype.goToPositionAngle=function(e,t,a){var r=this._senderID;this._senderID||(r=x.hub.m.enocean.SENDER_ID);var n=127&t.POS,s=127&t.ANG,o=(7&t.REPO)<<4|7&t.LOCK,i=(15&t.CHN)<<4|1,l=new Buffer([n,s,o,i]),u=new x.hub.m.enocean.ESP3.Telegram.VLD(l,r,0);u.setDstId(this._address),e.sendTelegram(u,!0,function(e){a&&a(e);});},D2_05_00.prototype.stop=function(e,t,a){var r=this._senderID;this._senderID||(r=x.hub.m.enocean.SENDER_ID);var n=(15&t.CHN)<<4|2,s=new Buffer([n]),o=new x.hub.m.enocean.ESP3.Telegram.VLD(s,r,0);o.setDstId(this._address),e.sendTelegram(o,!0,function(e){a&&a(e);});},D2_05_00.prototype.query=function(e,t,a){var r=this._senderID;this._senderID||(r=x.hub.m.enocean.SENDER_ID);var n=(15&t.CHN)<<4|3,s=new Buffer([n]),o=new x.hub.m.enocean.ESP3.Telegram.VLD(s,r,0);o.setDstId(this._address),e.sendTelegram(o,!0,function(e){a&&a(e);});},D2_05_00.prototype.setParameters=function(e,t,a){var r=this._senderID;this._senderID||(r=x.hub.m.enocean.SENDER_ID);var n=t.VERT>>8&127,s=255&t.VERT,o=255&t.ROT,i=7&t.AA,l=(15&t.CHN)<<4|5,u=new Buffer([n,s,o,i,l]),c=new x.hub.m.enocean.ESP3.Telegram.VLD(u,r,0);c.setDstId(this._address),e.sendTelegram(c,!0,function(e){a&&a(e);});},D2_05_00.prototype.evalTelegram=function(e){var t={};if(210==e.rorg){var a=e.userData.length;if(4===(15&e.userData.readUInt8(a-1)))if(4==e.userData.length){var r=127&e.userData.readUInt8(0);t.state=r;var n=127&e.userData.readUInt8(1);switch(t.angle=n,7&e.userData.readUInt8(2)){case 0:t.lock="normal";break;case 1:t.lock="blockage_mode";break;case 2:t.lock="alarm_mode";}var s=e.userData.readUInt8(3)>>4&15;t.channel=s;}}return t;},D2_05_00.prototype.executeCommand=function(e,t,a){if(t&&t.value){var r;"moveTo"==t.value.substr(0,6)&&t.value.length>6?(r=t.value.substr(6),t={value:"moveTo",ext:r}):"lamellaTo"==t.value.substr(0,9)&&t.value.length>9?(r=t.value.substr(9),t={value:"lamellaTo",ext:r}):"setRunTime"==t.value.substr(0,10)&&t.value.length>10?(r=t.value.substr(10),t={value:"setRunTime",ext:r}):"setRotationTime"==t.value.substr(0,15)&&t.value.length>15?(r=t.value.substr(15),t={value:"setRotationTime",ext:r}):"setParams"==t.value.substr(0,9)&&t.value.length>9&&(r=t.value.substr(9),t={value:"setParams",ext:r});var n=new Date().getTime(),s=this;switch(t.value){case"moveUp":this.goToPositionAngle(e,{POS:0,ANG:0,REPO:0,LOCK:0,CHN:0},a);break;case"moveDown":this.goToPositionAngle(e,{POS:100,ANG:100,REPO:0,LOCK:0,CHN:0},a);break;case"moveTo":if(void 0===t.ext||null==t.ext)return void(a&&a(new Error("move to value invalid")));(r=parseFloat(t.ext))<0&&(r=0),r>100&&(r=100),this._states.state={value:r,time:n},this.goToPositionAngle(e,{POS:r,ANG:255,REPO:0,LOCK:0,CHN:0},a);break;case"stepUp":if(!this._states.state)return void this.init(function(){setTimeout(function(){s._states.state?s.executeCommand(e,t,a):a&&a(new Error("get device status failed"));},200);});if(255==this._states.state.value||255==this._states.angle.value)return void(a&&a(new Error("device status unknonw")));0!=this._states.angle.value?((r=this._states.angle.value-10)<0&&(r=0),this._states.angle={value:r,time:n},this.goToPositionAngle(e,{POS:255,ANG:r,REPO:0,LOCK:0,CHN:0},a)):((r=this._states.state.value-5)<0&&(r=0),this._states.state={value:r,time:n},this.goToPositionAngle(e,{POS:r,ANG:0,REPO:0,LOCK:0,CHN:0},a));break;case"stepDown":if(!this._states.state)return void this.init(function(){setTimeout(function(){s._states.state?s.executeCommand(e,t,a):a&&a(new Error("get device status failed"));},200);});if(255==this._states.state.value||255==this._states.angle.value)return void(a&&a(new Error("device status unknonw")));100!=this._states.angle.value?((r=this._states.angle.value+10)>100&&(r=100),this._states.angle={value:r,time:n},this.goToPositionAngle(e,{POS:255,ANG:r,REPO:0,LOCK:0,CHN:0},a)):((r=this._states.state.value+5)>100&&(r=100),this._states.state={value:r,time:n},this.goToPositionAngle(e,{POS:r,ANG:100,REPO:0,LOCK:0,CHN:0},a));break;case"lamellaUp":this.goToPositionAngle(e,{POS:255,ANG:0,REPO:0,LOCK:0,CHN:0},a);break;case"lamellaDown":this.goToPositionAngle(e,{POS:255,ANG:100,REPO:0,LOCK:0,CHN:0},a);break;case"lamellaTo":if(void 0===t.ext||null==t.ext)return void(a&&a(new Error("lamella to value invalid")));(r=parseFloat(t.ext))<0&&(r=0),r>100&&(r=100),this._states.angle={value:r,time:n},this.goToPositionAngle(e,{POS:255,ANG:r,REPO:0,LOCK:0,CHN:0},a);break;case"stop":this.stop(e,{CHN:0},a);break;case"setRunTime":if(!t.ext)return void(a&&a(new Error("parameters is null")));(i=100*parseFloat(t.ext))<=499&&(i=500),l=255,u=7,this.setParameters(e,{VERT:i,ROT:l,AA:u,CHN:0},a);break;case"setRotationTime":if(!t.ext)return void(a&&a(new Error("parameters is null")));i=32767,l=parseInt(t.ext)/10,u=7,this.setParameters(e,{VERT:i,ROT:l,AA:u,CHN:0},a);break;case"setParams":if(!t.ext)return void(a&&a(new Error("parameters is null")));var o=t.ext.split(":");if(3!=o.length)return void(a&&a(new Error("parameters format invalid")));var i=o[0]?100*parseFloat(o[0]):32767;i<=499&&(i=32767);var l=o[1]?parseInt(o[1])/10:255,u=o[2]?parseInt(o[2]):7;this.setParameters(e,{VERT:i,ROT:l,AA:u,CHN:0},a);break;default:a&&a(new Error("unknow command"));}}else a&&a(new Error("command invalid"));};var D2_05_01=function D2_05_01(e){D2_05_00.call(this,e),this._data="d2-05-01",this._ch1QueryCount=0,this._ch1QueryTO=null,this._ch1QueryTimestamp=0;};D2_05_01.COMMANDS=["ch1moveUp","ch1moveDown","ch1moveTo","ch1stepUp","ch1stepDown","ch1lamellaUp","ch1lamellaDown","ch1lamellaTo","ch1stop","ch2moveUp","ch2moveDown","ch2moveTo","ch2stepUp","ch2stepDown","ch2lamellaUp","ch2lamellaDown","ch2lamellaTo","ch2stop","ch3moveUp","ch3moveDown","ch3moveTo","ch3stepUp","ch3stepDown","ch3lamellaUp","ch3lamellaDown","ch3lamellaTo","ch3stop","ch4moveUp","ch4moveDown","ch4moveTo","ch4stepUp","ch4stepDown","ch4lamellaUp","ch4lamellaDown","ch4lamellaTo","ch4stop","ch1setRunTime","ch2setRunTime","ch3setRunTime","ch4setRunTime","ch1setRotationTime","ch2setRotationTime","ch3setRotationTime","ch4setRotationTime","ch1setParams[15.2s]:[10,20,30ms]:[0-3]","ch2setParams","ch3setParams","ch4setParams"],D2_05_01.STATES=["ch1state","ch1angle","ch1lock","ch2state","ch2angle","ch2lock","ch3state","ch3angle","ch3lock","ch4state","ch4angle","ch4lock","channel"],(D2_05_01.prototype=new D2_05_00()).constructor=D2_05_01,D2_05_01.prototype.init=function(e){this._queryStates([0,1,2,3],e);},D2_05_01.prototype.getStatesBuffer=function(){var e=[];return this._states.ch1state||e.push(0),this._states.ch2state||e.push(1),this._states.ch3state||e.push(2),this._states.ch4state||e.push(3),e.length>0&&this._queryStates(e),this._states;},D2_05_01.prototype._queryStates=function(e,t){var a=require("x.hub.m.enocean.js")._esp3,r=0,n=this,cb=function cb(){++r<e.length?n.query(a,{CHN:e[r]},cb):t&&t();};this.query(a,{CHN:e[r]},cb);},D2_05_01.prototype.evalTelegram=function(e){var t=D2_05_00.prototype.evalTelegram.call(this,e);if(t)switch(t.channel){case 0:t.ch1state=t.state,t.ch1angle=t.angle,t.ch1lock=t.lock;break;case 1:t.ch2state=t.state,t.ch2angle=t.angle,t.ch2lock=t.lock;break;case 2:t.ch3state=t.state,t.ch3angle=t.angle,t.ch3lock=t.lock;break;case 3:t.ch4state=t.state,t.ch4angle=t.angle,t.ch4lock=t.lock;}return t;},D2_05_01.prototype.executeCommand=function(e,t,a){if(t&&t.value){var r,n,s,o,i=null;switch((t=JSON.parse(JSON.stringify(t))).value.substr(0,3)){case"ch1":i=0,r="ch1state",n="ch1angle","ch1lock";break;case"ch2":i=1,r="ch2state",n="ch2angle","ch2lock";break;case"ch3":i=2,r="ch3state",n="ch3angle","ch3lock";break;case"ch4":i=3,r="ch4state",n="ch4angle","ch4lock";break;default:a&&a(new Error("unknown command"));}t.value=t.value.substr(3),"moveTo"==t.value.substr(0,6)&&t.value.length>6?(o=t.value.substr(6),t={value:"moveTo",ext:o}):"lamellaTo"==t.value.substr(0,9)&&t.value.length>9?(o=t.value.substr(9),t={value:"lamellaTo",ext:o}):"setRunTime"==t.value.substr(0,10)&&t.value.length>10?(o=t.value.substr(10),t={value:"setRunTime",ext:o}):"setRotationTime"==t.value.substr(0,15)&&t.value.length>15?(o=t.value.substr(15),t={value:"setRotationTime",ext:o}):"setParams"==t.value.substr(0,9)&&t.value.length>9&&(o=t.value.substr(9),t={value:"setParams",ext:o});new Date().getTime();var l=this;switch(t.value){case"moveUp":this.goToPositionAngle(e,{POS:0,ANG:0,REPO:0,LOCK:0,CHN:i},a);break;case"moveDown":this.goToPositionAngle(e,{POS:100,ANG:100,REPO:0,LOCK:0,CHN:i},a);break;case"moveTo":if(void 0===t.ext||null==t.ext)return void(a&&a(new Error("move to value invalid")));(o=parseFloat(t.ext))<0&&(o=0),o>100&&(o=100),(s={})[r]=o,this.activeStateChange(s),this.goToPositionAngle(e,{POS:o,ANG:255,REPO:0,LOCK:0,CHN:i},a);break;case"stepUp":if(!this._states[r])return void this.init(function(){setTimeout(function(){l._states[r]?l.executeCommand(e,t,a):a&&a(new Error("get device status failed"));},200);});if(255==this._states[r].value||255==this._states[n].value)return void(a&&a(new Error("device status unknonw")));0!=this._states[n].value?((o=this._states[n].value-10)<0&&(o=0),(s={})[n]=o,this.activeStateChange(s),this.goToPositionAngle(e,{POS:255,ANG:o,REPO:0,LOCK:0,CHN:i},a)):((o=this._states[r].value-5)<0&&(o=0),(s={})[r]=o,this.activeStateChange(s),this.goToPositionAngle(e,{POS:o,ANG:0,REPO:0,LOCK:0,CHN:i},a));break;case"stepDown":if(!this._states[r])return void this.init(function(){setTimeout(function(){l._states[r]?l.executeCommand(e,t,a):a&&a(new Error("get device status failed"));},200);});if(255==this._states[r].value||255==this._states[n].value)return void(a&&a(new Error("device status unknonw")));100!=this._states[n].value?((o=this._states[n].value+10)>100&&(o=100),(s={})[n]=o,this.activeStateChange(s),this.goToPositionAngle(e,{POS:255,ANG:o,REPO:0,LOCK:0,CHN:i},a)):((o=this._states[r].value+5)>100&&(o=100),(s={})[r]=o,this.activeStateChange(s),this.goToPositionAngle(e,{POS:o,ANG:100,REPO:0,LOCK:0,CHN:i},a));break;case"lamellaUp":this.goToPositionAngle(e,{POS:255,ANG:0,REPO:0,LOCK:0,CHN:i},a);break;case"lamellaDown":this.goToPositionAngle(e,{POS:255,ANG:100,REPO:0,LOCK:0,CHN:i},a);break;case"lamellaTo":if(void 0===t.ext||null==t.ext)return void(a&&a(new Error("lamella to value invalid")));(o=parseFloat(t.ext))<0&&(o=0),o>100&&(o=100),(s={})[n]=o,this.goToPositionAngle(e,{POS:255,ANG:o,REPO:0,LOCK:0,CHN:i},a);break;case"stop":this.stop(e,{CHN:i},a);break;case"setRunTime":if(!t.ext)return void(a&&a(new Error("parameters is null")));(u=100*parseFloat(t.ext))<=499&&(u=500),h=255,_=7,this.setParameters(e,{VERT:u,ROT:h,AA:_,CHN:i},a);break;case"setRotationTime":if(!t.ext)return void(a&&a(new Error("parameters is null")));u=32767,h=parseInt(t.ext)/10,_=7,this.setParameters(e,{VERT:u,ROT:h,AA:_,CHN:i},a);break;case"setParams":if(!t.ext)return void(a&&a(new Error("parameters is null")));var u,c=t.ext.split(":");if(3!=c.length)return void(a&&a(new Error("parameters format invalid")));(u=c[0]?100*parseFloat(c[0]):32767)<=499&&(u=32767);var h=c[1]?parseInt(c[1])/10:255,_=c[2]?parseInt(c[2]):7;this.setParameters(e,{VERT:u,ROT:h,AA:_,CHN:i},a);break;default:a&&a(new Error("unknow command"));}}else a&&a(new Error("command invalid"));};var D2_06=function D2_06(e){D2.call(this,e),this._data="d2-06-??";};(D2_06.prototype=new D2()).constructor=D2_06;var D2_06_01=function D2_06_01(e){D2.call(this,e),this._data="d2-06-01",this._states={pending:{value:!1,time:new Date().getTime()}},this._vacation_new=null,this._hccr_new=null,this._blcr_new=null,this._suir_new=null,this._vbir_new=null;};D2_06_01.COMMANDS=["vacationOn","vacationOff","handleClosedClickOn","handleClosedClickOff","batteryLowClickOn","batteryLowClickOff","setSensorUpdateInterval","setVacationBlinkInterval"],D2_06_01.STATES=["bal","ppal","state","handle","window","br","bl","motion","vacation","temperature","humidity","illumination","battery","hccr","blcr","suir","vbir"],(D2_06_01.prototype=new D2_06()).constructor=D2_06_01,D2_06_01.prototype.executeCommand=function(e,t,a){var r,n=new Date().getTime();if(t&&t.value){"setSensorUpdateInterval"==t.value.substr(0,23)&&t.value.length>23?(r=t.value.substr(23),t={value:"setSensorUpdateInterval",ext:r}):"setVacationBlinkInterval"==t.value.substr(0,24)&&t.value.length>24&&(r=t.value.substr(24),t={value:"setVacationBlinkInterval",ext:r});switch(t.value){case"vacationOn":this._vacation_new="on",this._states.pending={value:!0,time:n},this.activeStateChange({vacation:"on"});break;case"vacationOff":this._vacation_new="off",this._states.pending={value:!0,time:n},this.activeStateChange({vacation:"off"});break;case"handleClosedClickOn":this._hccr_new="on",this._states.pending={value:!0,time:n},this.activeStateChange({hccr:"on"});break;case"handleClosedClickOff":this._hccr_new="off",this._states.pending={value:!0,time:n},this.activeStateChange({hccr:"off"});break;case"batteryLowClickOn":this._blcr_new="on",this._states.pending={value:!0,time:n},this.activeStateChange({blcr:"on"});break;case"batteryLowClickOff":this._blcr_new="off",this._states.pending={value:!0,time:n},this.activeStateChange({blcr:"off"});break;case"setSensorUpdateInterval":if(void 0===t.ext||null==t.ext)return void(a&&a(new Error("set sensor update interval value invalid")));(r=parseInt(t.ext))<5&&(r=5),r>65535&&(r=65535),this._suir_new=r,this._states.pending={value:!0,time:n},this.activeStateChange({suir:r});break;case"setVacationBlinkInterval":if(void 0===t.ext||null==t.ext)return void(a&&a(new Error("set vacation blink interval value invalid")));(r=parseInt(t.ext))<3&&(r=3),r>255&&(r=255),this._vbir_new=r,this._states.pending={value:!0,time:n},this.activeStateChange({vbir:r});}a&&a();}else a&&a(new Error("command invalid"));},D2_06_01.prototype.evalData=function(e,t,a){var r=this.evalTelegram(t);if(this._vacation_new&&delete r.vacation,this._hccr_new&&delete r.hccr,this._blcr_new&&delete r.blcr,this._suir_new&&delete r.suir,this._vbir_new&&delete r.vbir,210==t.rorg&&0==t.userData.readUInt8(0)&&this._sendResponse(e),r){var n=this.checkStateChange(r);a&&a(null,n);}else a&&a(new Error("data format invalid"));},D2_06_01.prototype.evalTelegram=function(e){var t,a,r,n,s,o={};if(210==e.rorg)switch(e.userData.readUInt8(0)){case 0:var i=15&(t=e.userData.readUInt8(1)),l=(a=e.userData.readUInt8(2))>>4&15,u=15&a,c=(r=e.userData.readUInt8(3))>>4&15,h=15&r,_=(n=e.userData.readUInt8(4))>>4&15,p=15&n,d=e.userData.readUInt8(5),v=s=e.userData.readUInt8(6),f=e.userData.readUInt16BE(7),m=e.userData.readUInt8(9)>>3&31;switch(t>>4&15){case 0:o.bal="ok";break;case 1:o.bal="alarm";break;case 14:o.bal="invalid";break;case 15:o.bal="unsupported";}switch(i){case 0:o.ppal="ok";break;case 1:o.ppal="alarm";break;case 14:o.ppal="invalid";break;case 15:o.ppal="unsupported";}switch(l){case 0:o.handle="undefined";break;case 1:o.handle="up";break;case 2:o.handle="down";break;case 3:o.handle="left";break;case 4:o.handle="right";break;case 14:o.handle="invalid";break;case 15:o.handle="unsupported";}switch(u){case 0:o.window="undefined";break;case 1:o.window="not_tilted";break;case 2:o.window="tilted";break;case 14:o.window="invalid";break;case 15:o.window="unsupported";}switch(c){case 0:o.br="unchanged";break;case 1:o.br="pressed";break;case 2:o.br="releaseed";break;case 14:o.br="invalid";break;case 15:o.br="unsupported";}switch(h){case 0:o.bl="unchanged";break;case 1:o.bl="pressed";break;case 2:o.bl="releaseed";break;case 14:o.bl="invalid";break;case 15:o.bl="unsupported";}switch(_){case 0:o.motion="ok";break;case 1:o.motion="alarm";break;case 14:o.motion="invalid";break;case 15:o.motion="unsupported";}switch(p){case 0:o.vacation="unchanged";break;case 1:o.vacation="on";break;case 2:o.vacation="off";break;case 14:o.vacation="invalid";break;case 15:o.vacation="unsupported";}if(254==d?o.temperature="invalid":255==d?o.temperature="unsupported":d<=250&&(o.temperature=parseFloat((d/250*80-20).toFixed(2))),254==v?o.humidity="invalid":255==v?o.humidity="unsupported":v<=200&&(o.humidity=parseFloat((v/2).toFixed(1))),65534==f?o.illumination="invalid":65535==f?o.illumination="unsupported":60001==f?o.illumination="over_range":f<=6e4&&(o.illumination=f),m<=20&&(o.battery=5*m),"undefined"==o.window||"invalid"==o.window||"unsupported"==o.window||"not_tilted"==o.window)switch(o.handle){case"undefined":case"unsupported":o.state="undefined";break;case"up":o.state="tilted";break;case"down":o.state="closed";break;case"left":case"right":o.state="open";break;case"invalid":o.state="invalid";}else"tilted"==o.window&&(o.state="tilted");break;case 16:var g=(s=e.userData.readUInt8(1))>>7&1,w=s>>6&1,y=s>>5&1,S=e.userData.readUInt16BE(2),b=e.userData.readUInt8(4);o.vacation=g?"on":"off",o.hccr=w?"on":"off",o.blcr=y?"on":"off",S>=5&&(o.suir=S),b>=3&&(o.vbir=b);}return o;},D2_06_01.prototype._sendResponse=function(e,t){var a=0;this._vacation_new&&"on"==this._vacation_new&&(a=1);var r=0;this._hccr_new&&"off"==this._hccr_new?r=1:this._hccr_new&&"on"==this._hccr_new&&(r=2);var n=0;this._blcr_new&&"off"==this._blcr_new?n=1:this._blcr_new&&"on"==this._blcr_new&&(n=2);var s=0;this._suir_new&&(s=this._suir_new);var o=0;this._vbir_new&&(o=this._vbir_new);var i=new Buffer([128,128|(1&a)<<5|(3&r)<<3|(3&n)<<1,s>>8&255,255&s,o]),l=this._senderID;l||(l=x.hub.m.enocean.SENDER_ID);var u=new x.hub.m.enocean.ESP3.Telegram.VLD(i,l,0),c=this;e.sendTelegram(u,!0,function(e){c._vacation_new=null,c._hccr_new=null,c._blcr_new=null,c._suir_new=null,c._vbir_new=null;var i={pending:!1};i.vacation=a?"on":"off",r&&(i.hccr=1==r?"off":"on"),n&&(i.blcr=1==n?"off":"on"),s&&(i.suir=s),o&&(i.vbir=o),c.activeStateChange(i),t&&t(e);});};var D2_06_02=function D2_06_02(e){D2.call(this,e),this._data="d2-06-02",this._states={pending:{value:!1,time:new Date().getTime()}},this._vacation_new=null,this._lacs_new=null,this._blcs_new=null,this._suis_new=null,this._vbis_new=null;};D2_06_02.COMMANDS=["vacationOn","vacationOff","lockActiveClickOn","lockActiveClickOff","batteryLowClickOn","batteryLowClickOff","setSensorUpdateInterval","setVacationBlinkInterval"],D2_06_02.STATES=["operation_mode","handle","window","state","temperature","humidity","battery","vacation","hccr","blcr","suir","vbir"],(D2_06_02.prototype=new D2_06()).constructor=D2_06_02,D2_06_02.prototype.executeCommand=function(e,t,a){var r,n=new Date().getTime();if(t&&t.value){"setSensorUpdateInterval"==t.value.substr(0,23)&&t.value.length>23?(r=t.value.substr(23),t={value:"setSensorUpdateInterval",ext:r}):"setVacationBlinkInterval"==t.value.substr(0,24)&&t.value.length>24&&(r=t.value.substr(24),t={value:"setVacationBlinkInterval",ext:r});switch(t.value){case"vacationOn":this._vacation_new="on",this._states.pending={value:!0,time:n},this.activeStateChange({vacation:"on"});break;case"vacationOff":this._vacation_new="off",this._states.pending={value:!0,time:n},this.activeStateChange({vacation:"off"});break;case"lockActiveClickOn":this._lacs_new="on",this._states.pending={value:!0,time:n},this.activeStateChange({hccr:"on"});break;case"lockActiveClickOff":this._lacs_new="off",this._states.pending={value:!0,time:n},this.activeStateChange({hccr:"off"});break;case"batteryLowClickOn":this._blcs_new="on",this._states.pending={value:!0,time:n},this.activeStateChange({blcr:"on"});break;case"batteryLowClickOff":this._blcs_new="off",this._states.pending={value:!0,time:n},this.activeStateChange({blcr:"off"});break;case"setSensorUpdateInterval":if(void 0===t.ext||null==t.ext)return void(a&&a(new Error("set sensor update interval value invalid")));(r=parseInt(t.ext))<5&&(r=5),r>65535&&(r=65535),this._suis_new=r,this._states.pending={value:!0,time:n},this.activeStateChange({suir:r});break;case"setVacationBlinkInterval":if(void 0===t.ext||null==t.ext)return void(a&&a(new Error("set vacation blink interval value invalid")));(r=parseInt(t.ext))<3&&(r=3),r>255&&(r=255),this._vbis_new=r,this._states.pending={value:!0,time:n},this.activeStateChange({vbir:r});}a&&a();}else a&&a(new Error("command invalid"));},D2_06_02.prototype.evalData=function(e,t,a){var r=this.evalTelegram(t);if(this._vacation_new&&delete r.vacation,this._lacs_new&&delete r.hccr,this._blcs_new&&delete r.blcr,this._suis_new&&delete r.suir,this._vbis_new&&delete r.vbir,210==t.rorg&&0==t.userData.readUInt8(0)&&this._sendResponse(e),r){var n=this.checkStateChange(r);a&&a(null,n);}else a&&a(new Error("data format invalid"));},D2_06_02.prototype.evalTelegram=function(e){var t,a={};if(210==e.rorg)switch(e.userData.readUInt8(0)){case 0:var r=(t=e.userData.readUInt8(1))>>4&3,n=t>>2&3,s=3&t,o=e.userData.readUInt8(2),i=e.userData.readUInt8(3),l=e.userData.readUInt8(4)>>3&31;switch(t>>6&3){case 0:a.operation_mode="standard";break;case 1:a.operation_mode="hst";}switch(r){case 0:a.lock="unlocked";break;case 1:a.lock="locked";}switch(n){case 0:a.window="not_tilted";break;case 1:a.window="tilted";}switch(s){case 0:a.alarm="ok";break;case 1:a.alarm="burglary_alarm";break;case 2:a.alarm="unlock_alarm";}if(254==o?a.temperature="invalid":255==o?a.temperature="unsupported":o<=250&&(a.temperature=parseFloat((o/250*80-20).toFixed(2))),254==i?a.humidity="invalid":255==i?a.humidity="unsupported":i<=200&&(a.humidity=parseFloat((i/2).toFixed(1))),l<=20&&(a.battery=5*l),"tilted"==a.window)a.state="tilted";else switch(a.lock){case"unlocked":a.state="open";break;case"locked":a.state="closed";}break;case 16:var u=(t=e.userData.readUInt8(1))>>7&1,c=t>>6&1,h=t>>5&1,_=e.userData.readUInt16BE(2),p=e.userData.readUInt8(4);a.vacation=u?"on":"off",a.hccr=c?"on":"off",a.blcr=h?"on":"off",_>=5&&(a.suir=_),p>=3&&(a.vbir=p);}return a;},D2_06_02.prototype._sendResponse=function(e,t){var a=0;this._vacation_new&&"on"==this._vacation_new?a=1:this._vacation_new&&"off"==this._vacation_new&&(a=2);var r=0;this._lacs_new&&"off"==this._lacs_new?r=1:this._lacs_new&&"on"==this._lacs_new&&(r=2);var n=0;this._blcs_new&&"off"==this._blcs_new?n=1:this._blcs_new&&"on"==this._blcs_new&&(n=2);var s=0;this._suis_new&&(s=this._suis_new);var o=0;this._vbis_new&&(o=this._vbis_new);var i=new Buffer([128,128|(3&a)<<4|(3&r)<<2|3&n,s>>8&255,255&s,o]),l=this._senderID;l||(l=x.hub.m.enocean.SENDER_ID);var u=new x.hub.m.enocean.ESP3.Telegram.VLD(i,l,0),c=this;e.sendTelegram(u,!0,function(e){c._vacation_new=null,c._lacs_new=null,c._blcs_new=null,c._suis_new=null,c._vbis_new=null;var i={pending:!1};i.vacation=a?"on":"off",r&&(i.hccr=1==r?"off":"on"),n&&(i.blcr=1==n?"off":"on"),s&&(i.suir=s),o&&(i.vbir=o),c.activeStateChange(i),t&&t(e);});};var D2_20=function D2_20(e){D2.call(this,e),this._data="d2-20-??";};(D2_20.prototype=new D2()).constructor=D2_20;var D2_20_XX=function D2_20_XX(e){D2_20.call(this,e),this._data="d2-20-00",this._poller=null,this._pollInterval=6e4;};D2_20_XX.COMMANDS=["setFanLevel","fanLevelUp","fanLevelDown","requestStatus","setHumLevel","setCo2Level"],D2_20_XX.STATES=["filter_remaining_time","operating_time","temperature","message_code","anti_freeze","current_fan_level","set_fan_level"],(D2_20_XX.prototype=new D2_20()).constructor=D2_20_XX,D2_20_XX.prototype.init=function(e){var t=this,a=Math.floor(6e3*Math.random())+1e3;setTimeout(function(){var a=require("x.hub.m.enocean.js")._esp3;t.executeCommand(a,{value:"requestStatus"},e),t._restartPoller(a);},a);},D2_20_XX.prototype.finalize=function(e){this._poller&&clearInterval(this._poller),e&&e();},D2_20_XX.prototype._restartPoller=function(e){this._poller&&clearInterval(this._poller);var t=this;this._poller=setInterval(function(){t.executeCommand(e,{value:"requestStatus"});},this._pollInterval);},D2_20_XX.prototype.executeCommand=function(e,t,a){var r,n;new Date().getTime();if(t&&t.value){if("setFanLevel"==t.value.substr(0,11)&&t.value.length>11)r=t.value.substr(11),t={value:"setFanLevel",ext:r};else if("fanLevelUp"==t.value){if(void 0===(n=this.getBufferedState("set_fan_level"))||null==n)return void(a&&a(new Error("fanLevelUp unknown current fan level")));if(6==n)return void(a&&a());t={value:"setFanLevel",ext:n+1};}else if("fanLevelDown"==t.value){if(void 0===(n=this.getBufferedState("set_fan_level"))||null==n)return void(a&&a(new Error("fanLevelUp unknown current fan level")));if(0==n)return void(a&&a());t={value:"setFanLevel",ext:n-1};}else if("setHumLevel"==t.value.substr(0,11)&&t.value.length>11){if(5!=(n=this.getBufferedState("set_fan_level")))return void(a&&a(new Error("humidity regulation not active")));r=t.value.substr(11),t={value:"setHumLevel",ext:r};}else if("setCo2Level"==t.value.substr(0,11)&&t.value.length>11){if(6!=(n=this.getBufferedState("set_fan_level")))return void(a&&a(new Error("co2 regulation not active")));r=t.value.substr(11),t={value:"setCo2Level",ext:r};}var s,o=this;switch(t.value){case"setFanLevel":if(void 0===t.ext||null==t.ext)return void(a&&a(new Error("setFanLevel value invalid")));if((s=parseInt(t.ext))<0||s>6)return void(a&&a(new Error("setFanLevel value invalid")));if(5==s||6==s)return this.activeStateChange({set_fan_level:s}),this._activateSensorRegulation(s),void(a&&a());this._deactivateSensorRegulation(),this._sendResponse(e,{LS:s,RS:1},function(t){t||o.activeStateChange({set_fan_level:s}),o._restartPoller(e),a&&a(t);});break;case"setHumLevel":if(void 0===t.ext||null==t.ext)return void(a&&a(new Error("setHumLevel value invalid")));if((s=parseInt(t.ext))<0||s>4)return void(a&&a(new Error("setHumLevel value invalid")));this._sendResponse(e,{LS:s,RS:1},function(t){o._restartPoller(e),a&&a(t);});break;case"setCo2Level":if(void 0===t.ext||null==t.ext)return void(a&&a(new Error("setCo2Level value invalid")));if((s=parseInt(t.ext))<0||s>4)return void(a&&a(new Error("setCo2Level value invalid")));this._sendResponse(e,{LS:s,RS:1},function(t){o._restartPoller(e),a&&a(t);});break;case"requestStatus":this._sendResponse(e,{LS:5,RS:1},function(e){a&&a(e);});break;default:a&&a(new Error("unknown command"));}}else a&&a(new Error("command invalid"));},D2_20_XX.prototype.evalData=function(e,t,a){var r=this.evalTelegram(t);this._states&&this._states.set_fan_level||(r.set_fan_level=r.current_fan_level),this._states&&this._states.set_fan_level&&5!=this._states.set_fan_level.value&&6!=this._states.set_fan_level.value&&(r.set_fan_level=r.current_fan_level);var n=this.checkStateChange(r);a&&a(null,n);},D2_20_XX.prototype.evalTelegram=function(e){var t,a={};if(210==e.rorg)if(1==e.userData.length)t=7&e.userData.readUInt8(0),a.current_fan_level=t;else{var r=e.userData.readUInt8(0),n=e.userData.readUInt8(1),s=e.userData.readUInt16LE(2),o=e.userData.readUInt8(4),i=e.userData.readUInt8(5),l=e.userData.readUInt8(6),u=e.userData.readUInt16LE(7),c=e.userData.readUInt8(9),h=e.userData.readUInt8(10),_=e.userData.readInt16BE(11),p=e.userData.readUInt8(13),d=p>>4&1;t=7&p,a.filter_remaining_time=o+":"+s+":"+n+":"+r,a.operating_time=c+":"+u+":"+l+":"+i,a.temperature=_/10,a.message_code=h,a.anti_freeze=d?"on":"off",a.current_fan_level=t;}return a;},D2_20_XX.prototype._sendResponse=function(e,t,a){var r=this._senderID;this._senderID||(r=x.hub.m.enocean.SENDER_ID);var n=t.LS,s=t.RS,o=new Buffer([n,s]),i=new x.hub.m.enocean.ESP3.Telegram.VLD(o,r,0);this._senderID!=this._address&&i.setDstId(this._address),e.sendTelegram(i,!0,function(e){a&&a(e);});},D2_20_XX.prototype._activateSensorRegulation=function(e){var t=require("x.hub.m.enocean.js").getRehauHandler();t&&t.activateSensorRegulation(this.getAddress(),e);},D2_20_XX.prototype._deactivateSensorRegulation=function(){var e=require("x.hub.m.enocean.js").getRehauHandler();e&&e.deactivateSensorRegulation(this.getAddress());};var Eltako_Contact=function Eltako_Contact(e){F6_10_00.call(this,e),this._data="eltako_contact",this._vendor="eltako",this._eepAlias="f6-10-00";};Eltako_Contact.STATES=["contact","contact_raw"],(Eltako_Contact.prototype=new F6_10_00()).constructor=Eltako_Contact,Eltako_Contact.prototype.evalTelegram=function(e){var t={};if(246==e.rorg){var a=e.userData;240==a?t.contact="closed":224==a&&(t.contact="open"),t.contact_raw=a;}return t;};var Eltako_Motion=function Eltako_Motion(e){A5_08_01.call(this,e),this._data="eltako_motion",this._vendor="eltako",this._eepAlias="a5-08-01";};Eltako_Motion.STATES=["voltage","voltage_raw","illumination","illumination_raw","state","state_raw"],(Eltako_Motion.prototype=new A5_08_01()).constructor=Eltako_Motion,Eltako_Motion.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=(e.userData.readUInt8(2),e.userData.readUInt8(1)),n=e.userData.readUInt8(0);if(1==(a>>3&1)){var s=n;t.voltage=parseFloat((s/255*5.1).toFixed(1)),t.voltage_raw=s;var o=r;t.illumination=parseFloat((o/255*2048).toFixed(1)),t.illumination_raw=o;var i=a>>1&1;switch(i){case 0:t.state="on";break;case 1:t.state="off";}t.state_raw=i;}}return t;};var Eltako_Switch=function Eltako_Switch(e){A5_38_08.call(this,e),this._data="eltako_switch",this._vendor="eltako",this._eepAlias="f6-02-01";};Eltako_Switch.COMMANDS=["on","off","toggle"],Eltako_Switch.STATES=["state"],(Eltako_Switch.prototype=new A5_38_08()).constructor=Eltako_Switch,Eltako_Switch.prototype.getTeachinType=function(){return"4BS";},Eltako_Switch.prototype.handleLearnTelegram=function(e,t){t&&246==t.rorg&&require("x.hub.m.enocean.js")._deviceHandler.onLearnDevice({address:e._learnAddress,senderID:e._learnSenderID,data:e._learnProfile,vendor:e._learnVendor},{address:t.senderID,senderID:e._learnSenderID,data:this._data,vendor:this._vendor},function(t,a){e._learnFinish(t,0,a);});},Eltako_Switch.prototype.getTeachinTelegram=function(e,t,a){var r=new Buffer([224,64,13,128]);return new x.hub.m.enocean.ESP3.Telegram.BS4(r,t,0);},Eltako_Switch.prototype.evalTelegram=function(e){var t={};if(246==e.rorg)switch(e.userData){case 112:t.state="on";break;case 80:t.state="off";}return t;},Eltako_Switch.prototype.executeCommand=function(e,t,a){if(t&&t.value){new Date().getTime();switch(t.value){case"on":this.switching(e,{TIM:0,LCK:0,DEL:0,SW:1},function(e){a&&a(e);});break;case"off":this.switching(e,{TIM:0,LCK:0,DEL:0,SW:0},function(e){a&&a(e);});break;case"toggle":if(!this._states.state)return void(a&&a(new Error("unknow previous switch state")));"on"==this._states.state.value?this.executeCommand(e,{value:"off"},a):this.executeCommand(e,{value:"on"},a);break;default:a&&a(new Error("unknow command"));}}else a&&a(new Error("command invalid"));};var e,t=(((e=function e(_e3){Eltako_Switch.call(this,_e3),this.TEACH_IN_VARIATION=3,this._data="eltako_tf_switch";}).prototype=new Eltako_Switch()).constructor=e,e.prototype.handleTeachinTelegram=function(e,t){if(t&&165==t.rorg&&t.userData){var a=t.userData.toString("hex"),r=e._teachSenderID;a&&r&&r.substr(2)==a.substr(0,6)&&require("x.hub.m.enocean.js")._deviceHandler.onLearnDevice({address:e._teachID,senderID:e._teachSenderID,data:e._teachProfile,vendor:e._teachVendor},{address:t.senderID,senderID:e._teachSenderID,data:e._teachProfile,vendor:e._teachVendor},function(t,a){e._teachFinish(t,a);});}},e),Eltako_Dimmer=function Eltako_Dimmer(e){A5_38_08.call(this,e),this._data="eltako_dimmer",this._vendor="eltako",this._eepAlias="a5-38-08",this._lastOnLevel=-1;};Eltako_Dimmer.COMMANDS=["on","off","toggle","dimTo","dimUp","dimDown","toggleTo","setRampTime"],Eltako_Dimmer.STATES=["state","level","ramp_time"],(Eltako_Dimmer.prototype=new A5_38_08()).constructor=Eltako_Dimmer,Eltako_Dimmer.prototype.setDefaultParams=function(){this._params||(this._params={}),void 0!==this._params.ramp_time&&null!=this._params.ramp_time||(this._params.ramp_time=0);},Eltako_Dimmer.prototype.handleLearnTelegram=function(e,t){t&&165==t.rorg&&require("x.hub.m.enocean.js")._deviceHandler.onLearnDevice({address:e._learnAddress,senderID:e._learnSenderID,data:e._learnProfile,vendor:e._learnVendor},{address:t.senderID,senderID:e._learnSenderID,data:this._data,vendor:this._vendor},function(t,a){e._learnFinish(t,0,a);});},Eltako_Dimmer.prototype.getTeachinTelegram=function(e,t,a){var r=new Buffer([224,64,13,128]);return new x.hub.m.enocean.ESP3.Telegram.BS4(r,t,0);},Eltako_Dimmer.prototype.getStatesBuffer=function(){var e=JSON.parse(JSON.stringify(this._states));return e.ramp_time={value:this._params.ramp_time,time:-1},e;},Eltako_Dimmer.prototype.getCurrentStates=function(){var e={},t=this.getStatesBuffer();for(var a in t.level&&0==t.level.value&&t.state&&(t.state.value="off"),t.state&&"off"==t.state.value&&t.level&&(t.level.value=0),t){t.hasOwnProperty(a)&&t[a]&&(e[a]=t[a].value);}return e;},Eltako_Dimmer.prototype.evalData=function(e,t,a){var r=this.evalTelegram(t);if(r){0==r.level&&(r.state="off"),"off"==r.state&&(r.level=0),0!=r.level&&"off"!=r.state||this._states.level&&this._states.level.value&&(this._lastOnLevel=this._states.level.value);var n=this.checkStateChange(r);a&&a(null,n);}else a&&a(new Error("data format invalid"));},Eltako_Dimmer.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(2),n=e.userData.readUInt8(1),s=e.userData.readUInt8(0);if(1==(a>>3&1))if(2===s){var o=n;t.level=o;var i=r;t.ramp=i;var l=a>>2&1;t.dim_range=l?"relative":"absolute";var u=a>>1&1;t.store_final_value=u;var c=1&a;t.state=c?"on":"off";}}return t;},Eltako_Dimmer.prototype.executeCommand=function(e,t,a){if(t&&t.value){var r;"dimTo"==t.value.substr(0,5)&&t.value.length>5?(r=t.value.substr(5),t={value:"dimTo",ext:r}):"toggleTo"==t.value.substr(0,8)&&t.value.length>8?(r=t.value.substr(8),t={value:"toggleTo",ext:r}):"setRampTime"==t.value.substr(0,11)&&t.value.length>11&&(r=t.value.substr(11),t={value:"setRampTime",ext:r});new Date().getTime();var n=this;switch(t.value){case"on":-1!=(r=this._lastOnLevel)&&0!=r||(r=100),this.dimming(e,{EDIM:r,RMP:this._params.ramp_time,EDIMR:0,STR:0,SW:1},function(e){e||n.activeStateChange({level:r,state:"on"}),a&&a(e);});break;case"off":this._states.level&&this._states.level.value&&(this._lastOnLevel=this._states.level.value),this.dimming(e,{EDIM:0,RMP:this._params.ramp_time,EDIMR:0,STR:0,SW:0},function(e){e||n.activeStateChange({level:0,state:"off"}),a&&a(e);});break;case"toggle":if(!this._states.state)return void(a&&a(new Error("unknow previous dimmer state")));"on"==this._states.state.value?this.executeCommand(e,{value:"off"},a):this.executeCommand(e,{value:"on"},a);break;case"toggleTo":if(!this._states.state)return void(a&&a(new Error("unknow previous dimmer state")));"on"==this._states.state.value?this.executeCommand(e,{value:"off"},a):this.executeCommand(e,{value:"dimTo",ext:t.ext},a);break;case"dimTo":if(void 0===t.ext||null==t.ext)return void(a&&a(new Error("dim to value invalid")));if((r=parseFloat(t.ext))<0&&(r=0),r>100&&(r=100),0==r)return void this.executeCommand(e,{value:"off"},a);this.dimming(e,{EDIM:r,RMP:this._params.ramp_time,EDIMR:0,STR:0,SW:1},function(e){e||n.activeStateChange({level:r,state:"on"}),a&&a(e);});break;case"dimUp":if(!this._states.level)return void(a&&a(new Error("unknow previous dimmer level")));r=parseInt(this._states.level.value),(r+=5)>100&&(r=100),this.dimming(e,{EDIM:r,RMP:this._params.ramp_time,EDIMR:0,STR:0,SW:1},function(e){e||n.activeStateChange({level:r,state:"on"}),a&&a(e);});break;case"dimDown":if(!this._states.level)return void(a&&a(new Error("unknow previous dimmer level")));if(r=parseInt(this._states.level.value),(r-=5)<0&&(r=0),0==r)return void this.executeCommand(e,{value:"off"},a);this.dimming(e,{EDIM:r,RMP:this._params.ramp_time,EDIMR:0,STR:0,SW:1},function(e){e||n.activeStateChange({level:r,state:"on"}),a&&a(e);});break;case"setRampTime":if(!t.ext)return void(a&&a(new Error("parameters is null")));(r=parseInt(r))>255&&(r=255),r<0&&(r=0),this._params.ramp_time=r,require("x.hub.m.enocean.js")._deviceHandler.deviceParamsUpdated(this,function(e){a&&a(e);});break;default:a&&a(new Error("unknow command"));}}else a&&a(new Error("command invalid"));};var a,r=(((a=function a(e){Eltako_Dimmer.call(this,e),this.TEACH_IN_VARIATION=3,this._data="eltako_tf_dimmer";}).prototype=new Eltako_Dimmer()).constructor=a,a.prototype.handleTeachinTelegram=function(e,t){if(t&&165==t.rorg&&t.userData){var a=t.userData.toString("hex"),r=e._teachSenderID;a&&r&&r.substr(2)==a.substr(0,6)&&require("x.hub.m.enocean.js")._deviceHandler.onLearnDevice({address:e._teachID,senderID:e._teachSenderID,data:e._teachProfile,vendor:e._teachVendor},{address:t.senderID,senderID:e._teachSenderID,data:e._teachProfile,vendor:e._teachVendor},function(t,a){e._teachFinish(t,a);});}},a),Eltako_Dimmer2=function Eltako_Dimmer2(e){Eltako_Dimmer.call(this,e),this._data="eltako_dimmer2",this._vendor="eltako",this._eepAlias="f6-02-01";};Eltako_Dimmer2.COMMANDS=["on","off","toggle","dimTo","dimUp","dimDown","toggleTo","setRampTime"],Eltako_Dimmer2.STATES=["state","ramp_time"],(Eltako_Dimmer2.prototype=new Eltako_Dimmer()).constructor=Eltako_Dimmer,Eltako_Dimmer2.prototype.handleLearnTelegram=function(e,t){t&&246==t.rorg&&require("x.hub.m.enocean.js")._deviceHandler.onLearnDevice({address:e._learnAddress,senderID:e._learnSenderID,data:e._learnProfile,vendor:e._learnVendor},{address:t.senderID,senderID:e._learnSenderID,data:this._data,vendor:this._vendor},function(t,a){e._learnFinish(t,0,a);});},Eltako_Dimmer2.prototype.evalTelegram=function(e){var t={};if(246==e.rorg)switch(e.userData){case 112:t.state="on";break;case 80:t.state="off";}return t;};var Eltako_FSUD=function Eltako_FSUD(e){Eltako_Dimmer.call(this,e),this._data="eltako_fsud";};Eltako_FSUD.COMMANDS=["on","off","toggle","dimTo","dimUp","dimDown","toggleTo","setRampTime"],Eltako_FSUD.STATES=["state","ramp_time"],(Eltako_FSUD.prototype=new Eltako_Dimmer()).constructor=Eltako_Dimmer,Eltako_FSUD.prototype.getTeachinTelegram=function(e,t,a){var r=new Buffer([2,0,0,0]);return new x.hub.m.enocean.ESP3.Telegram.BS4(r,t,0);};var Eltako_Blind=function Eltako_Blind(e){A5_3F_7F.call(this,e),this._data="eltako_blind",this._vendor="eltako",this._eepAlias="f6-02-01",this._syncRunning=!1,this._syncTO=null,this._syncCB=null;};Eltako_Blind.COMMANDS=["up","down","stop","stepUp","stepDown","setRV","setRunTime","moveTo","sync"],Eltako_Blind.STATES=["pos","sync"],(Eltako_Blind.prototype=new A5_3F_7F()).constructor=Eltako_Blind,Eltako_Blind.prototype.setDefaultParams=function(){this._params||(this._params={}),void 0!==this._params.rv&&null!=this._params.rv||(this._params.rv=200),void 0!==this._params.rt&&null!=this._params.rt||(this._params.rt=200);},Eltako_Blind.prototype.handleLearnTelegram=function(e,t){t&&246==t.rorg&&require("x.hub.m.enocean.js")._deviceHandler.onLearnDevice({address:e._learnAddress,senderID:e._learnSenderID,data:e._learnProfile,vendor:e._learnVendor},{address:t.senderID,senderID:e._learnSenderID,data:this._data,vendor:this._vendor},function(t,a){e._learnFinish(t,0,a);});},Eltako_Blind.prototype.getTeachinTelegram=function(e,t,a){var r=new Buffer([255,248,13,128]);return new x.hub.m.enocean.ESP3.Telegram.BS4(r,t,0);},Eltako_Blind.prototype.getStatesBuffer=function(){var e=JSON.parse(JSON.stringify(this._states));return e.sync||(e.sync={value:!1,time:-1}),e.rv={value:this._params.rv,time:-1},e.rt={value:this._params.rt,time:-1},e;},Eltako_Blind.prototype.evalData=function(e,t,a){var r=this.evalTelegram(t);if(r){var n=this.checkStateChange(r);r.sync&&this._syncRunning&&(this._syncRunning=!1,this._syncTO&&(clearTimeout(this._syncTO),this._syncTO=null),this._syncCB&&(this._syncCB(),this._syncCB=null)),a&&a(null,n);}else a&&a(new Error("data format invalid"));},Eltako_Blind.prototype.evalTelegram=function(e){var t={};if(246==e.rorg)switch(e.userData){case 112:t.sync=!0,t.pos=0;break;case 80:t.sync=!0,t.pos=100;}else if(165==e.rorg){var a=e.userData.readUInt16BE(0),r=e.userData.readUInt8(2),n=this._params.rt;n||(n=200);var s=this._states.pos?this._states.pos.value:null;if(s||(s=0),void 0!==s&&null!=s){var o=10*a/n;switch(r){case 1:t.pos=Math.max(0,Math.round(s-o));break;case 2:t.pos=Math.min(100,Math.round(s+o));}}}return t;},Eltako_Blind.prototype.executeCommand=function(e,t,a){if(t&&t.value){var r;"stepUp"==t.value.substr(0,6)&&t.value.length>6?(r=t.value.substr(6),t={value:"stepUp",ext:r}):"stepDown"==t.value.substr(0,8)&&t.value.length>8?(r=t.value.substr(8),t={value:"stepDown",ext:r}):"setRV"==t.value.substr(0,5)&&t.value.length>5?(r=t.value.substr(5),t={value:"setRV",ext:r}):"setRunTime"==t.value.substr(0,10)&&t.value.length>10?(r=t.value.substr(10),t={value:"setRunTime",ext:r}):"moveTo"==t.value.substr(0,6)&&t.value.length>6&&(r=t.value.substr(6),t={value:"moveTo",ext:r});new Date().getTime();var n=this._params.rv;n||(n=200);var s,o,i=this._params.rt;switch(i||(i=200),t.value){case"up":s=n,this.doReq(e,{TIME:s,CMD:1,LCK:0,TYPE:0},function(e){a&&a(e);});break;case"down":s=n,this.doReq(e,{TIME:s,CMD:2,LCK:0,TYPE:0},function(e){a&&a(e);});break;case"stop":s=0,this.doReq(e,{TIME:s,CMD:0,LCK:0,TYPE:0},function(e){a&&a(e);});break;case"stepUp":(s=void 0===t.ext||null==t.ext?i/100:parseFloat(t.ext)/100*i)<1&&(s=1),this.doReq(e,{TIME:s,CMD:1,LCK:0,TYPE:0},function(e){a&&a(e);});break;case"stepDown":(s=void 0===t.ext||null==t.ext?i/100:parseFloat(t.ext)/100*i)<1&&(s=1),this.doReq(e,{TIME:s,CMD:2,LCK:0,TYPE:0},function(e){a&&a(e);});break;case"moveTo":if(void 0===t.ext||null==t.ext)return void(a&&a(new Error("value invalid")));o=parseInt(t.ext);var l,u=0;if(this._states&&this._states.pos&&void 0!==this._states.pos.value&&null!=this._states.pos.value&&(u=this._states.pos.value),(s=(o-u)/100*i)>0)l=2;else if(s<0)s=0-s,l=1;else if(0==s)return void(a&&a());this.doReq(e,{TIME:s,CMD:l,LCK:0,TYPE:1},function(e){a&&a(e);});break;case"sync":this.snyc(e,function(e){a&&a(e);});break;case"setRV":if(!t.ext)return void(a&&a(new Error("parameters is null")));(r=parseInt(r))>200&&(r=200),r<0&&(r=0),this._params.rv=r,require("x.hub.m.enocean.js")._deviceHandler.deviceParamsUpdated(this,function(e){a&&a(e);});break;case"setRunTime":if(!t.ext)return void(a&&a(new Error("parameters is null")));(r=parseInt(r))>200&&(r=200),r<0&&(r=0),this._params.rt=r,require("x.hub.m.enocean.js")._deviceHandler.deviceParamsUpdated(this,function(e){a&&a(e);});break;default:a&&a(new Error("unknow command"));}}else a&&a(new Error("command invalid"));},Eltako_Blind.prototype.snyc=function(e,t){if(this._syncRunning)t&&t(new Error("sync running"));else{var a=this,r=this._params.rv;r||(r=200),this._syncRunning=!0,this._syncTO=setTimeout(function(){a._syncRunning=!1,a._syncTO=null,a._states.pos={value:0,time:new Date().getTime()};},1e3*(r+2)),this.doReq(e,{TIME:r,CMD:1,LCK:0,TYPE:0},function(e){t&&t(e);});}},Eltako_Blind.prototype.doReq=function(e,t,a){var r,n,s=this._senderID;this._senderID||(s=x.hub.m.enocean.SENDER_ID),t.TYPE?(r=Math.round(10*t.TIME)>>8&255,n=255&Math.round(10*t.TIME)):(r=0,n=255&Math.round(t.TIME));var o=t.CMD,i=8|(1&t.LCK)<<2|(1&t.TYPE)<<1,l=new Buffer([r,n,o,i]),u=new x.hub.m.enocean.ESP3.Telegram.BS4(l,s,0);u.setDstId(this._address),e.sendTelegram(u,!0,function(e){a&&a(e);});};var n,s=(((n=function n(e){Eltako_Blind.call(this,e),this.TEACH_IN_VARIATION=3,this._data="eltako_tf_blind";}).prototype=new Eltako_Blind()).constructor=n,n.prototype.handleTeachinTelegram=function(e,t){if(t&&165==t.rorg&&t.userData){var a=t.userData.toString("hex"),r=e._teachSenderID;a&&r&&r.substr(2)==a.substr(0,6)&&require("x.hub.m.enocean.js")._deviceHandler.onLearnDevice({address:e._teachID,senderID:e._teachSenderID,data:e._teachProfile,vendor:e._teachVendor},{address:t.senderID,senderID:e._teachSenderID,data:e._teachProfile,vendor:e._teachVendor},function(t,a){e._teachFinish(t,a);});}},n),Eltako_Weather=function Eltako_Weather(e){A5_04_02.call(this,e),this._data="eltako_weather",this._vendor="eltako",this._eepAlias="a5-04-02",this._engMax=7.2,this._engMin=0;};Eltako_Weather.STATES=["energy","energy_raw","humidity","humidity_raw","temperature","temperature_raw","available"],(Eltako_Weather.prototype=new A5_04_02()).constructor=Eltako_Weather,Eltako_Weather.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(2),n=e.userData.readUInt8(1),s=e.userData.readUInt8(0);if(1==(a>>3&1)){var o=s;t.energy=parseFloat((o/250*(this._engMax-this._engMin)+this._engMin).toFixed(1)),t.energy_raw=o;var i=n;t.humidity=parseFloat((i/250*(this._humMax-this._humMin)+this._humMin).toFixed(1)),t.humidity_raw=i;var l=r;t.temperature=parseFloat((l/250*(this._tempMax-this._tempMin)+this._tempMin).toFixed(1)),t.temperature_raw=l;var u=a>>1&1;t.available=!!u;}}return t;};var Eltako_Lux=function Eltako_Lux(e){A5_06_01.call(this,e),this._data="eltako_lux",this._vendor="eltako",this._eepAlias="a5-06-01",this._ill1Max=3e4,this._ill1Min=300;};Eltako_Lux.STATES=["illumination2","illumination2_raw","illumination1","illumination1_raw","illumination","illumination_raw"],(Eltako_Lux.prototype=new A5_06_01()).constructor=Eltako_Lux,Eltako_Lux.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=(e.userData.readUInt8(2),e.userData.readUInt8(1)),n=e.userData.readUInt8(0);if(1==(a>>3&1)){var s=n;t.illumination2=s,t.illumination2_raw=s;var o=r;t.illumination1=parseFloat((o/255*(this._ill1Max-this._ill1Min)+this._ill1Min).toFixed(1)),t.illumination1_raw=o,t.illumination=o?t.illumination1:t.illumination2,t.illumination_raw=o?t.illumination1_raw:t.illumination2_raw;}}return t;};var Eltako_Lux2=function Eltako_Lux2(e){A5_06_02.call(this,e),this._data="eltako_lux2",this._vendor="eltako",this._eepAlias="a5-06-02",this._ill2Min=0,this._ill2Max=1024;};Eltako_Lux2.STATES=A5_06_02.STATES,(Eltako_Lux2.prototype=new A5_06_02()).constructor=Eltako_Lux2;var Eltako_Buttons=function Eltako_Buttons(e){F6.call(this,e),this._data="eltako_buttons",this._vendor="eltako",this._eepAlias="f6-02-01",this._longPressThreshold=1e3,this.BUTTONS=["button1","button2","button3","button4"];};Eltako_Buttons.STATES=["button1","button2","button3","button4"],Eltako_Buttons.EVENTS=["shortPress","longPress","press","release"],(Eltako_Buttons.prototype=new F6()).constructor=Eltako_Buttons,Eltako_Buttons.prototype.evalTelegram=function(e){var t={};if(246==e.rorg)switch(e.userData){case 112:this.BUTTONS[0]&&(t[this.BUTTONS[0]]="pressed");break;case 80:this.BUTTONS[1]&&(t[this.BUTTONS[1]]="pressed");break;case 48:this.BUTTONS[2]&&(t[this.BUTTONS[2]]="pressed");break;case 16:this.BUTTONS[3]&&(t[this.BUTTONS[3]]="pressed");break;case 0:for(var a=0;a<this.BUTTONS.length;a++){this.BUTTONS[a]&&(t[this.BUTTONS[a]]="released");}}return t;},Eltako_Buttons.prototype.checkStateChange=function(e){var t=this._states,a=[],r=new Date().getTime();for(var n in e){var s={};s.key=n,s.value=e[n],s.changed=!1;var o=t[n]?t[n].value:null,i=t[n]?t[n].time:null,l=e[n];o==l&&"pressed"!=l||(s.oldvalue=o,s.changed=!0),this._states[n]={value:e[n],time:r},s.changed&&("pressed"==l||"released"==l&&"pressed"==o)&&a.push(s),"pressed"==o&&"released"==l&&(!i||r-i<this._longPressThreshold?((s={}).key=n,s.value="shortPress",s.changed=!0):((s={}).key=n,s.value="longPress",s.changed=!0),a.push(s));}return a;};var Eltako_Button1=function Eltako_Button1(e){Eltako_Buttons.call(this,e),this._data="eltako_button1",this.BUTTONS=[null,null,null,"button"];};Eltako_Button1.STATES=["button"],(Eltako_Button1.prototype=new Eltako_Buttons()).constructor=Eltako_Button1;var Eltako_Sender2=function Eltako_Sender2(e){Eltako_Buttons.call(this,e),this._data="eltako_sender2",this.BUTTONS=["A1","A3"];};Eltako_Sender2.STATES=["A1","A3"],(Eltako_Sender2.prototype=new Eltako_Buttons()).constructor=Eltako_Sender2;var Eltako_Sender4=function Eltako_Sender4(e){Eltako_Buttons.call(this,e),this._data="eltako_sender4",this.BUTTONS=["E1","E2","E3","E4"];};Eltako_Sender4.STATES=["E1","E2","E3","E4"],(Eltako_Sender4.prototype=new Eltako_Buttons()).constructor=Eltako_Sender4;var Eltako_Button2=function Eltako_Button2(e){Eltako_Buttons.call(this,e),this._data="eltako_button2",this.BUTTONS=["buttonO","buttonI"];};Eltako_Button2.STATES=["buttonO","buttonI"],(Eltako_Button2.prototype=new Eltako_Buttons()).constructor=Eltako_Button2;var Eltako_Button4=function Eltako_Button4(e){Eltako_Buttons.call(this,e),this._data="eltako_button4",this.BUTTONS=["BO","BI","AO","AI"];};Eltako_Button4.STATES=["BO","BI","AO","AI"],(Eltako_Button4.prototype=new Eltako_Buttons()).constructor=Eltako_Button4;var Eltako_FSM60B=function Eltako_FSM60B(e){Eltako_Buttons.call(this,e),this._data="eltako_fsm60b";};Eltako_FSM60B.STATES=["button"],(Eltako_FSM60B.prototype=new Eltako_Buttons()).constructor=Eltako_FSM60B,Eltako_FSM60B.prototype.evalTelegram=function(e){var t={};if(246==e.rorg)switch(e.userData){case 112:case 80:case 16:t.button="pressed";break;case 0:t.button="released";}return t;};var Eltako_FKF=function Eltako_FKF(e){F6.call(this,e),this._data="eltako_fkf",this._vendor="eltako",this._eepAlias="f6-04-01";};Eltako_FKF.STATES=["keycard"],(Eltako_FKF.prototype=new F6()).constructor=Eltako_FKF,Eltako_FKF.prototype.evalTelegram=function(e){var t={};if(246==e.rorg)switch(e.userData){case 16:t.keycard="inserted";case 0:t.keycard="takeout";}return t;};var Eltako_FKC=function Eltako_FKC(e){F6.call(this,e),this._data="eltako_fkc",this._vendor="eltako",this._eepAlias="f6-04-01";};Eltako_FKC.STATES=["keycard"],(Eltako_FKC.prototype=new F6()).constructor=Eltako_FKC,Eltako_FKC.prototype.evalTelegram=function(e){var t={};if(246==e.rorg)switch(e.userData){case 48:t.keycard="guest_card";case 32:t.keycard="service_card";case 16:t.keycard="inserted";case 0:t.keycard="takeout";}return t;};var Eltako_Thermo=function Eltako_Thermo(e){A5_10_06.call(this,e),this._data="eltako_thermo",this._vendor="eltako",this._eepAlias="a5-10-06";};Eltako_Thermo.STATES=["setpoint","setpoint_raw","temperature","temperature_raw","night_reduce","night_reduce_raw"],(Eltako_Thermo.prototype=new A5_10_06()).constructor=Eltako_Thermo,Eltako_Thermo.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(2),n=e.userData.readUInt8(1),s=e.userData.readUInt8(0);if(1==(a>>3&1)){var o=s;t.night_reduce=o<=6?0:o<=12?1:o<=19?2:o<=25?3:o<=31?4:5,t.night_reduce_raw=o;var i=n;t.setpoint=parseFloat((i/255*40).toFixed(1)),t.setpoint_raw=i;var l=r;t.temperature=parseFloat(((255-l)/255*40).toFixed(1)),t.temperature_raw=l;}}return t;};var Eltako_FTR65HB=function Eltako_FTR65HB(e){Eltako_Thermo.call(this,e),this._data="eltako_ftr65hb",this._vendor="eltako",this._eepAlias="a5-10-06";};Eltako_FTR65HB.STATES=["setpoint","setpoint_raw","temperature","temperature_raw"],(Eltako_FTR65HB.prototype=new Eltako_Thermo()).constructor=Eltako_FTR65HB,Eltako_FTR65HB.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(2),n=e.userData.readUInt8(1);if(1==(a>>3&1)){var s=n;t.setpoint=parseFloat((s/255*40).toFixed(1)),t.setpoint_raw=s;var o=r;t.temperature=parseFloat(((255-o)/255*40).toFixed(1)),t.temperature_raw=o;}}return t;};var Eltako_FUTH55D=function Eltako_FUTH55D(e){Eltako_Thermo.call(this,e),this._data="eltako_futh55d",this._vendor="eltako",this._eepAlias="a5-10-12";};Eltako_FUTH55D.STATES=["setpoint","setpoint_raw","temperature","temperature_raw","night_reduce","night_reduce_raw"],(Eltako_FUTH55D.prototype=new Eltako_Thermo()).constructor=Eltako_FUTH55D;var Eltako_FUTH65D=function Eltako_FUTH65D(e){Eltako_Thermo.call(this,e),this._data="eltako_futh65d",this._vendor="eltako",this._eepAlias="a5-10-12";};Eltako_FUTH65D.STATES=["setpoint","setpoint_raw","temperature","temperature_raw","night_reduce","night_reduce_raw"],(Eltako_FUTH65D.prototype=new Eltako_Thermo()).constructor=Eltako_FUTH65D;var Eltako_FTR78S=function Eltako_FTR78S(e){A5_10_03.call(this,e),this._data="eltako_ftr78s",this._vendor="eltako",this._eepAlias="a5-10-03";};Eltako_FTR78S.STATES=["setpoint","setpoint_raw","temperature","temperature_raw"],(Eltako_FTR78S.prototype=new A5_10_03()).constructor=Eltako_FTR78S,Eltako_FTR78S.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(2),n=e.userData.readUInt8(1);if(1==(a>>3&1)){var s=n;t.setpoint=parseFloat((s/255*22+8).toFixed(1)),t.setpoint_raw=s;var o=r;t.temperature=parseFloat(((255-o)/255*40).toFixed(1)),t.temperature_raw=o;}}return t;};var Eltako_Powermeter=function Eltako_Powermeter(e){A5_12_01.call(this,e),this._data="eltako_powermeter",this._vendor="eltako",this._eepAlias="a5-12-01";};Eltako_Powermeter.STATES=["power","energy","tariff"],(Eltako_Powermeter.prototype=new A5_12_01()).constructor=Eltako_Powermeter,Eltako_Powermeter.prototype.evalTelegram=function(e){var t=A5_12_01.prototype.evalTelegram.call(this,e);165==e.rorg&&143==e.userData.readUInt8(3)&&(t={});return t;};var Eltako_Powermeter2=function Eltako_Powermeter2(e){A5_12_01.call(this,e),this._data="eltako_powermeter2",this._vendor="eltako",this._eepAlias="a5-12-01";};Eltako_Powermeter2.STATES=["power","tariff"],(Eltako_Powermeter2.prototype=new A5_12_01()).constructor=Eltako_Powermeter,Eltako_Powermeter2.prototype.evalTelegram=function(e){var t=A5_12_01.prototype.evalTelegram.call(this,e);return delete t.energy,delete t.tariff,t;};var Eltako_FZS=function Eltako_FZS(e){Eltako_Buttons.call(this,e),this._data="eltako_fzs";};Eltako_FZS.STATES=["button"],(Eltako_FZS.prototype=new Eltako_Buttons()).constructor=Eltako_FZS,Eltako_FZS.prototype.evalTelegram=function(e){var t={};if(246==e.rorg)switch(e.userData){case 48:t.button="pressed";break;case 0:t.button="released";}return t;},Eltako_FZS.prototype.checkStateChange=function(e){var t=this._states,a=[],r=new Date().getTime();for(var n in e){var s={};s.key=n,s.value=e[n],s.changed=!1;var o=t[n]?t[n].value:null,i=t[n]?t[n].time:null,l=e[n];o!=l&&(s.oldvalue=o,s.changed=!0),this._states[n]={value:e[n],time:r},s.changed&&a.push(s),"pressed"==o&&"released"==l&&(!i||r-i<this._longPressThreshold?((s={}).key=n,s.value="shortPress",s.changed=!0):((s={}).key=n,s.value="longPress",s.changed=!0),a.push(s));}return a;};var Eltako_Relay2=function Eltako_Relay2(e){F6_02_01.call(this,e),this._data="eltako_relay2",this._vendor="eltako",this._eepAlias="f6-02-01";};Eltako_Relay2.STATES=["ch1","ch2"],(Eltako_Relay2.prototype=new F6_02_01()).constructor=Eltako_Relay2,Eltako_Relay2.prototype.evalTelegram=function(e){var t={};if(246==e.rorg)switch(e.userData){case 112:t.ch1="on";break;case 80:t.ch1="off";break;case 48:t.ch2="on";break;case 16:t.ch2="off";}return t;};var Eltako_Relay=function Eltako_Relay(e){F6_02_01.call(this,e),this._data="eltako_relay",this._vendor="eltako",this._eepAlias="f6-02-01";};Eltako_Relay.STATES=["state"],(Eltako_Relay.prototype=new F6_02_01()).constructor=Eltako_Relay,Eltako_Relay.prototype.evalTelegram=function(e){var t={};if(246==e.rorg)switch(e.userData){case 112:t.state="on";break;case 80:t.state="off";}return t;};var Eltako_Heat=function Eltako_Heat(e){A5_30_03.call(this,e),this._data="eltako_heat",this._vendor="eltako",this._eepAlias="a5-30-03";};Eltako_Heat.STATES=["temperature","temperature_raw","alarm","alarm_raw"],(Eltako_Heat.prototype=new A5_30_03()).constructor=Eltako_Heat,Eltako_Heat.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(2),n=e.userData.readUInt8(1);e.userData.readUInt8(0);if(1==(a>>3&1)){var s=n;t.temperature=parseFloat(((255-s)/255*40).toFixed(1)),t.temperature_raw=s;var o=r;t.alarm=15==o?"alarm":"ok",t.alarm_raw=o;}}return t;};var Eltako_Water_M3=function Eltako_Water_M3(e){A5_30_03.call(this,e),this._data="eltako_water_m3",this._vendor="eltako",this._eepAlias="a5-30-03";};Eltako_Water_M3.STATES=["water","water_raw"],(Eltako_Water_M3.prototype=new A5_30_03()).constructor=Eltako_Water_M3,Eltako_Water_M3.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(2);if(1==(a>>3&1)){var n=r;t.water=15==n,t.water_raw=n;}}return t;};var Eltako_Water_M4=function Eltako_Water_M4(e){A5_30_01.call(this,e),this._data="eltako_water_m4",this._vendor="eltako",this._eepAlias="a5-30-01";};Eltako_Water_M4.STATES=["water","water_raw"],(Eltako_Water_M4.prototype=new A5_30_01()).constructor=Eltako_Water_M4,Eltako_Water_M4.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(2);if(1==(a>>3&1)){var n=r;t.water=0==n,t.water_raw=n;}}return t;};var Peha_PowerSwitch=function Peha_PowerSwitch(e){A5_38_08.call(this,e),this.TEACH_IN_VARIATION=3,this._data="peha_powerswitch",this._vendor="peha",this._eepAlias="a5-38-08";};Peha_PowerSwitch.COMMANDS=["on","off","toggle"],Peha_PowerSwitch.STATES=["state","state_raw","level","rgb","power","energy","current","voltage","power_raw","power_unit","energy_unit","current_unit","voltage_unit","power_unit_raw","op_hour","error","error_raw","service_mode","op_hour_flag","op_hour_flag_raw","mode_raw"],(Peha_PowerSwitch.prototype=new A5_38_08()).constructor=Peha_PowerSwitch,Peha_PowerSwitch.prototype.getTeachinType=function(){return"4BS";},Peha_PowerSwitch.prototype.evalTelegram=function(e){return A5_11_04.prototype.evalTelegram.call(this,e);},Peha_PowerSwitch.prototype.executeCommand=function(e,t,a){if(t&&t.value){new Date().getTime();var r=this;switch(t.value){case"on":this.switching(e,{TIM:0,LCK:0,DEL:0,SW:1},function(e){e||r.activeStateChange({state:"on"}),a&&a(e);});break;case"off":this.switching(e,{TIM:0,LCK:0,DEL:0,SW:0},function(e){e||r.activeStateChange({state:"off"}),a&&a(e);});break;case"toggle":if(!this._states.state)return void(a&&a(new Error("unknow previous switch state")));"on"==this._states.state.value?this.executeCommand(e,{value:"off"},a):this.executeCommand(e,{value:"on"},a);break;default:a&&a(new Error("unknow command"));}}else a&&a(new Error("command invalid"));};var Peha_Switch=function Peha_Switch(e){Peha_PowerSwitch.call(this,e),this.TEACH_IN_VARIATION=3,this._data="peha_switch",this._vendor="peha",this._eepAlias="a5-38-08";};Peha_Switch.COMMANDS=["on","off","toggle"],Peha_Switch.STATES=["state","state_raw","level","rgb","power","energy","current","voltage","power_raw","power_unit","energy_unit","current_unit","voltage_unit","power_unit_raw","op_hour","error","error_raw","service_mode","op_hour_flag","op_hour_flag_raw","mode_raw"],(Peha_Switch.prototype=new Peha_PowerSwitch()).constructor=Peha_Switch,Peha_Switch.prototype.evalTelegram=function(e){var t=A5_11_04.prototype.evalTelegram.call(this,e);return delete t.power,delete t.energy,delete t.current,delete t.voltage,delete t.power_unit,delete t.energy_unit,delete t.current_unit,delete t.voltage_unit,t;};var Peha_Blind=function Peha_Blind(e){A5_38_08.call(this,e),this.TEACH_IN_VARIATION=3,this._data="peha_blind",this._vendor="peha",this._eepAlias="a5-38-08",this._initCount=0;};Peha_Blind.COMMANDS=["up","down","stop","stepUp","stepDown","moveTo","lamellaUp","lamellaDown","lamellaStepUp","lamellaStepDown","lamellaTo","setRunTime","setLamellaRuntime"],Peha_Blind.STATES=["position","angle","position_flag","position_flag_raw","angle_flag","angle_flag_raw","error","error_raw","end_position","end_position_raw","state","state_raw","service_mode","position_mode"],(Peha_Blind.prototype=new A5_38_08()).constructor=Peha_Blind,Peha_Blind.prototype.init=function(e){var t=require("x.hub.m.enocean.js")._esp3;this.blind(t,{P1:0,P2:0,FUNC:0,SSF:0,PAF:0,SMF:0},function(t){e&&e();});},Peha_Blind.prototype.getTeachinType=function(){return"4BS";},Peha_Blind.prototype.getStatesBuffer=function(){return 0==Object.keys(this._states).length?(this._initCount<=100&&this._initCount%10==0||this._initCount>=100&&this._initCount<=600&&this._initCount%60==0?this.init():this._initCount=0,this._initCount++):this._initCount=0,this._states;},Peha_Blind.prototype.evalTelegram=function(e){return A5_11_03.prototype.evalTelegram.call(this,e);},Peha_Blind.prototype.executeCommand=function(e,t,a){if(t&&t.value){new Date().getTime();var r,n,s=this;switch("stepUp"==t.value.substr(0,6)&&t.value.length>6?(r=t.value.substr(6),t={value:"stepUp",ext:r}):"stepDown"==t.value.substr(0,8)&&t.value.length>8?(r=t.value.substr(8),t={value:"stepDown",ext:r}):"setRunTime"==t.value.substr(0,10)&&t.value.length>10?(r=t.value.substr(10),t={value:"setRunTime",ext:r}):"moveTo"==t.value.substr(0,6)&&t.value.length>6&&(r=t.value.substr(6),t={value:"moveTo",ext:r}),t.value){case"up":this.blind(e,{P1:0,P2:0,FUNC:2,SSF:0,PAF:0,SMF:0},function(e){a&&a(e);});break;case"down":this.blind(e,{P1:0,P2:0,FUNC:3,SSF:0,PAF:0,SMF:0},function(e){a&&a(e);});break;case"stop":this.blind(e,{P1:0,P2:0,FUNC:1,SSF:0,PAF:0,SMF:0},function(e){a&&a(e);});break;case"stepUp":if(r=void 0===t.ext||null==t.ext?5:parseInt(t.ext),void 0===(n=this._states.position?this._states.position.value:null)||null==n)return this.blind(e,{P1:0,P2:0,FUNC:0,SSF:0,PAF:0,SMF:0}),void(a&&a(new Error("unknown position")));this._states.position_mode&&this._states.position_mode.value?(r=n+r)>100&&(r=100):(r=n-r)<0&&(r=0),this.blind(e,{P1:r,P2:0,FUNC:4,SSF:0,PAF:0,SMF:0},function(e){e||s.activeStateChange({position:r}),a&&a(e);});break;case"stepDown":if(r=void 0===t.ext||null==t.ext?5:parseInt(t.ext),void 0===(n=this._states.position?this._states.position.value:null)||null==n)return this.blind(e,{P1:0,P2:0,FUNC:0,SSF:0,PAF:0,SMF:0}),void(a&&a(new Error("unknown position")));this._states.position_mode&&this._states.position_mode.value?(r=n-r)<0&&(r=0):(r=n+r)>100&&(r=100),this.blind(e,{P1:r,P2:0,FUNC:4,SSF:0,PAF:0,SMF:0},function(e){e||s.activeStateChange({position:r}),a&&a(e);});break;case"moveTo":if(void 0===t.ext||null==t.ext)return void(a&&a(new Error("value invalid")));n=parseInt(t.ext),this.blind(e,{P1:n,P2:0,FUNC:4,SSF:0,PAF:0,SMF:0},function(e){e||s.activeStateChange({position:n}),a&&a(e);});break;case"setRunTime":if(!t.ext||-1==t.ext.indexOf(":"))return void(a&&a(new Error("value invalid")));var o=t.ext.split(":"),i=o[0],l=o[1];if(!i&&l)i=l;else if(i&&!l)l=i;else if(!i&&!l)return void(a&&a(new Error("value invalid")));i=parseInt(i),l=parseInt(l),this.blind(e,{P1:i,P2:l,FUNC:7,SSF:0,PAF:0,SMF:0},function(e){e||s.activeStateChange({position:r}),a&&a(e);});break;default:a&&a(new Error("unknow command"));}}else a&&a(new Error("command invalid"));};var BB_AA_CC=function BB_AA_CC(e){Profile.call(this,e),this._data="bb-aa-cc",this._vendor="rehau",this._eepAlias="d2-06-10",this._hopCount=0,this._saLearnMode=1,this._originalEEP="bb-aa-cc",this._reset_alarm_new=null,this._reset_pre_alarm_new=null,this._deviceTO=this._startTimeoutTimer(),this._alarmTO=null,this._prealarmTO=null;};BB_AA_CC.COMMANDS=["alertOn","alertOff","alertToggle","resetAlarm","resetPreAlarm","preAlarmOn","preAlarmOff","preAlarmToggle"],BB_AA_CC.STATES=["battery","pre_alarm","alarm","window","pre_alarm_enabled","error","pending","alarm_enabled","pre_alarm_enabled_device","timeout"],(BB_AA_CC.prototype=new Profile()).constructor=BB_AA_CC,BB_AA_CC.prototype.setDefaultParams=function(){var e=require("x.hub.m.enocean.js")._rehauHandler;if(e){var t=e.getSmartguardSetting(this._address),a=!0,r=!0;t&&(a=t.isAlarmActive(),r=t.isPreAlarmActive()),this.activeStateChange({pending:!1,alarm_enabled:a,pre_alarm_enabled:r,timeout:!1,alarm_task_active:e.getAlarm(),pre_alarm_task_active:e.getAlarm()});}},BB_AA_CC.prototype.getStatesBuffer=function(){return this._states;},BB_AA_CC.prototype.evalData=function(e,t,a){var r=this.evalTelegram(t);if(r){if(r.timeout=!1,this._deviceTO&&(clearTimeout(this._deviceTO),this._deviceTO=this._startTimeoutTimer()),208!=t.rorg){var n=!1;210==t.rorg&&2==t.userData.length&&(n=!0);var s=this.getBufferedState("alarm_task_active"),o=this.getBufferedState("pre_alarm_task_active"),i=this.getBufferedState("alarm_enabled"),l=this.getBufferedState("pre_alarm_enabled");r.pre_alarm?o&&l?this._startPreAlarmTimer():r.pre_alarm=!1:this._clearPreAlarmTimer(),r.alarm?s&&i?this._startAlarmTimer():r.alarm=!1:this._clearAlarmTimer();c=this.checkStateChange(r);var u=this;this._executePendingCommand(e,function(){u._reportStates(r);},n),a&&a(null,c);}else{var c=this.checkStateChange(r);a&&a(null,c);}}else a&&a(new Error("data format invalid"));},BB_AA_CC.prototype.evalTelegram=function(e){var t={},a=!1;if(210==e.rorg){var r;if(1==e.userData.length?c=e.userData.readUInt8(0):(r=e.userData.readUInt8(0),c=e.userData.readUInt8(1)),2==e.userData.length){var n=r;t.battery=n;}var s=c>>7&1,o=c>>6&1,i=c>>5&1,l=c>>4&1,u=15&c;t.pre_alarm=!!s,t.alarm=!!o,t.window=i?"closed":"open",t.pre_alarm_enabled_device=!!l,t.error=u,a=!0;}else if(208==e.rorg){var c=e.userData.readUInt8(0);t.battery=Math.round(c/100*255),t.battery_raw=c,a=!0;}return a?t:null;},BB_AA_CC.prototype.executeCommand=function(e,t,a){if(t&&t.value){switch(t.value){case"alertOn":this._setAlarm(!0);break;case"alertOff":this._setAlarm(!1);break;case"alertToggle":this._states&&this._states.alarm_enabled?this._setAlarm(!this._states.alarm_enabled.value):this._setAlarm(!0);break;case"resetAlarm":this._reset_alarm_new="on",this.activeStateChange({pending:!0});break;case"resetPreAlarm":this._reset_pre_alarm_new="on",this.activeStateChange({pending:!0});break;case"preAlarmOn":this._setPreAlarm(!0);break;case"preAlarmOff":this._setPreAlarm(!1);break;case"preAlarmToggle":this._states&&this._states.pre_alarm_enabled?this._setPreAlarm(!this._states.pre_alarm_enabled.value):this.pre_alarm_enabled(!0);break;case"alarmTaskOn":this._setAlarmTask(!0);break;case"alarmTaskOff":this._setAlarmTask(!1);break;case"preAlarmTaskOn":this._setPreAlarmTask(!0);break;case"preAlarmTaskOff":this._setPreAlarmTask(!1);break;default:return void(a&&a(new Error("unknow command")));}a&&a();}else a&&a(new Error("command invalid"));},BB_AA_CC.prototype._executePendingCommand=function(e,t,a){var r={AL:1,RSA:0,RSP:0,PAE:1},n=this._isAlarmActive();r.AL=n?1:0;var s=this._isPreAlarmActive();r.PAE=s?1:0,this._reset_alarm_new&&(r.RSA="on"==this._reset_alarm_new?1:0),this._reset_pre_alarm_new&&(r.RSP="on"==this._reset_pre_alarm_new?1:0);var o={pending:!1};1==r.RSP&&(o.pre_alarm=!1),1==r.RSA&&(o.alarm=!1),this._reset_alarm_new=null,this._reset_pre_alarm_new=null;var i=this;this._sendVLD(e,r,function(e){i.activeStateChange(o),t&&t(e);},a);},BB_AA_CC.prototype._sendVLD=function(e,t,a,r){var n=this._senderID;this._senderID||(n=x.hub.m.enocean.SENDER_ID);var s,o=(1&t.AL)<<7|(1&t.RSA)<<6|(1&t.RSP)<<5|(1&t.PAE)<<4;s=r?new Buffer([0,o]):new Buffer([o]);var i=new x.hub.m.enocean.ESP3.Telegram.VLD(s,n,0);i.setDstId(this._address),e.sendTelegram(i,!0,function(e){a&&a(e);});},BB_AA_CC.prototype._reportStates=function(e){if(e&&Object.keys(e).length>0){var t=require("x.hub.m.enocean.js").getRehauHandler();t&&(e.alarm_enabled=this.getBufferedState("alarm_enabled"),e.pre_alarm_enabled=this.getBufferedState("pre_alarm_enabled"),t.onReceiveWindowSensorStates(this,e));}},BB_AA_CC.prototype._setAlarm=function(e){this.activeStateChange({alarm_enabled:e}),require("x.hub.m.enocean.js")._rehauHandler.setSmartGuardAlarm(this._address,e);},BB_AA_CC.prototype._setPreAlarm=function(e){this.activeStateChange({pre_alarm_enabled:e}),require("x.hub.m.enocean.js")._rehauHandler.setSmartGuardPreAlarm(this._address,e);},BB_AA_CC.prototype._setAlarmTask=function(e){this.activeStateChange({alarm_task_active:e});},BB_AA_CC.prototype._setPreAlarmTask=function(e){this.activeStateChange({pre_alarm_task_active:e});},BB_AA_CC.prototype._isAlarmActive=function(){var e=!0,t=!0;if(this._states&&this._states.alarm_enabled&&(void 0!==(t=this._states.alarm_enabled.value)&&null!=t||(t=!0)),!t)return!1;var a=!1;return this._states&&this._states.alarm_task_active&&(void 0!==(a=this._states.alarm_task_active.value)&&null!=a||(a=!1),e=a),e;},BB_AA_CC.prototype._isPreAlarmActive=function(){var e=!0,t=!0;if(this._states&&this._states.pre_alarm_enabled&&(void 0!==(t=this._states.pre_alarm_enabled.value)&&null!=t||(t=!0)),!t)return!1;var a=!1;return this._states&&this._states.pre_alarm_task_active&&(void 0!==(a=this._states.pre_alarm_task_active.value)&&null!=a||(a=!1),e=a),e;},BB_AA_CC.prototype._startTimeoutTimer=function(){var e=this;return setTimeout(function(){e.activeStateChange({timeout:!0});},36e5);},BB_AA_CC.prototype._startPreAlarmTimer=function(){this._prealarmTO&&clearTimeout(this._prealarmTO);var e=this;this._prealarmTO=setTimeout(function(){e.activeStateChange({pre_alarm:!1});var t=e.getCurrentStates();e._reportStates(t);},1e4);},BB_AA_CC.prototype._clearPreAlarmTimer=function(){this._prealarmTO&&(clearTimeout(this._prealarmTO),this._prealarmTO=null);},BB_AA_CC.prototype._startAlarmTimer=function(){this._alarmTO&&clearTimeout(this._alarmTO);var e=this;this._alarmTO=setTimeout(function(){e.activeStateChange({alarm:!1});var t=e.getCurrentStates();e._reportStates(t);},12e4);},BB_AA_CC.prototype._clearAlarmTimer=function(){this._alarmTO&&(clearTimeout(this._alarmTO),this._alarmTO=null);},BB_AA_CC.prototype.toJSON=function(){return{type:"ENOCEAN",address:this._address,data:this._data,senderID:this._senderID,vendor:this._vendor,virtual:this._virtual,params:this._params,hopCount:this._hopCount,saLearnMode:this._saLearnMode,originalEEP:this._originalEEP};},BB_AA_CC.prototype.fromJSON=function(e){return e&&e.address&&e.data?e.data!=this._data?null:(this._address=e.address,this._senderID=e.senderID,this._vendor=e.vendor?e.vendor:this._vendor,this._virtual=!!e.virtual,this._params=e.params,this._hopCount=e.hopCount,this._saLearnMode=e.saLearnMode,e.originalEEP&&(this._originalEEP=e.originalEEP),this.setDefaultParams(),this):null;},BB_AA_CC.prototype.toDBJSON=function(){return{id:this._address,senderID:this._senderID,eep:this._data,vendor:this._vendor,params:this._params,virtual:this._virtual,hopCount:this._hopCount,saLearnMode:this._saLearnMode,originalEEP:this._originalEEP};},BB_AA_CC.prototype.fromDBJSON=function(e){return e&&e.id&&e.eep?e.eep!=this._data?null:(this._address=e.id,this._senderID=e.senderID,this._vendor=e.vendor?e.vendor:this._vendor,this._virtual=!!e.virtual,this._params=e.params,this._hopCount=e.hopCount,this._saLearnMode=e.saLearnMode,e.originalEEP&&(this._originalEEP=e.originalEEP),this.setDefaultParams(),this):null;};var D2_06_10=function D2_06_10(e){BB_AA_CC.call(this,e),this._data="d2-06-10";};(D2_06_10.prototype=new BB_AA_CC()).constructor=D2_06_10;var D2_06_FF=function D2_06_FF(e){BB_AA_CC.call(this,e),this._data="d2-06-ff";};(D2_06_FF.prototype=new BB_AA_CC()).constructor=D2_06_FF,D2_06_FF.prototype.evalTelegram=function(e){var t={},a=!1;if(210==e.rorg){var r;if(1==e.userData.length?u=e.userData.readUInt8(0):(r=e.userData.readUInt8(0),u=e.userData.readUInt8(1)),2==e.userData.length){var n=r;t.battery=n;}var s=u>>7&1,o=u>>6&1,i=u>>4&1,l=u>>2&3;t.pre_alarm=!!s,t.alarm=!!o,t.window=l?"closed":"open",t.pre_alarm_enabled_device=!!i,0==l?t.window="closed":1==l?t.window="tilted":3==l&&(t.window="open"),a=!0;}else if(208==e.rorg){var u=e.userData.readUInt8(0);t.battery=u,a=!0;}return a?t:null;};var SmartGuard2=function SmartGuard2(e){D2_06_FF.call(this,e),this._data="smartguard2",this._eepAlias="d2-06-11";};(SmartGuard2.prototype=new D2_06_FF()).constructor=SmartGuard2,SmartGuard2.prototype.evalTelegram=function(e){var t={},a=!1;if(210==e.rorg){var r;if(1==e.userData.length?c=e.userData.readUInt8(0):(r=e.userData.readUInt8(0),c=e.userData.readUInt8(1)),2==e.userData.length){var n=r;t.battery=n;}var s=c>>7&1,o=c>>6&1,i=c>>5&1,l=c>>4&1,u=c>>3&3;t.pre_alarm=!!s,t.alarm=!!o,t.window=i?"closed":"open",t.pre_alarm_enabled_device=!!l,1==i?t.window="closed":0==i&&(t.window="open"),1==u&&(t.window="tilted"),a=!0;}else if(208==e.rorg){var c=e.userData.readUInt8(0);t.battery=c,a=!0;}return a?t:null;};var Afriso_Water_Con=function Afriso_Water_Con(e){A5_30_03.call(this,e),this._data="afriso_water_con",this._vendor="afriso",this._eepAlias="a5-30-03";};(Afriso_Water_Con.prototype=new A5_30_03()).constructor=Afriso_Water_Con,Afriso_Water_Con.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(2),n=e.userData.readUInt8(1);if(1==(a>>3&1)){var s=n;t.temperature=(255-s)/255*40,t.temperature_raw=s;var o=r>>4&1;t.water=0==o;}}return t;};var Afriso_Water_Eco=function Afriso_Water_Eco(e){F6_05_01.call(this,e),this._data="afriso_water_eco",this._vendor="afriso",this._eepAlias="f6-05-01";};(Afriso_Water_Eco.prototype=new F6_05_01()).constructor=Afriso_Water_Eco,Afriso_Water_Eco.prototype.evalTelegram=function(e){var t={};if(246==e.rorg){e.t21;var a=e.nu;e.userData;1==a?t.water="true":0==a&&(t.water="false");}return t;},Afriso_Water_Eco.prototype.onLearn=function(){this._states.water={value:!1,time:new Date().getTime()};};var Afriso_ASD_10=function Afriso_ASD_10(e){A5_30_03.call(this,e),this._data="afriso_asd_10",this._vendor="afriso",this._eepAlias="a5-30-03";};(Afriso_ASD_10.prototype=new A5_30_03()).constructor=Afriso_ASD_10,Afriso_ASD_10.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(2),n=e.userData.readUInt8(1);if(1==(a>>3&1)){var s=n;t.temperature=(255-s)/255*40,t.temperature_raw=s;var o=r>>4&1;t.smoke=0==o;}}return t;};var Hoppe_Door=function Hoppe_Door(e){F6_10_00.call(this,e),this._data="hoppe_door",this._vendor="hoppe",this._eepAlias="f6-10-00";};Hoppe_Door.STATES=["door"],(Hoppe_Door.prototype=new F6_10_00()).constructor=Hoppe_Door,Hoppe_Door.prototype.evalTelegram=function(e){var t={};if(246==e.rorg){var a=e.userData,r=parseInt("11010000",2),n=parseInt("11000000",2),s=parseInt("11110000",2),o=parseInt("11110000",2);parseInt("11110000",2),parseInt("11010000",2);0==(a&r^n)?t.door="open":0==(a&s^o)&&(t.door="closed"),t.handle_raw=a;}return t;};var o=function(){var GP=function GP(e){Profile.call(this,e),this._data="gp",this._gpInfo=null;};return(GP.prototype=new Profile()).constructor=GP,GP.prototype.toJSON=function(){var e=Profile.prototype.toJSON.call(this);return e.gpInfo=this._gpInfo,e;},GP.prototype.fromJSON=function(e){return Profile.prototype.fromJSON.call(this,e)?(e&&e.gpInfo&&(this._gpInfo=e.gpInfo),this):null;},GP.prototype.toDBJSON=function(){var e=Profile.prototype.toDBJSON.call(this);return e.gpInfo=this._gpInfo,e;},GP.prototype.fromDBJSON=function(e){return Profile.prototype.fromDBJSON.call(this,e)?(e&&e.gpInfo&&(this._gpInfo=e.gpInfo),this):null;},GP;}(),i=function(){var Afriso_AIS_10_PRO=function Afriso_AIS_10_PRO(e){o.call(this,e),this._data="afriso_ais_10",this._vendor="afriso",this._eepAlias="gp";};return(Afriso_AIS_10_PRO.prototype=new o()).constructor=Afriso_AIS_10_PRO,Afriso_AIS_10_PRO.prototype.isGPMatch=function(e,t){return 45==e&&8==t;},Afriso_AIS_10_PRO.prototype.evalTelegram=function(e){var t={};if(178==e.rorg){var a=e.data.readUInt8(0)>>7&1,r=e.data.readUInt8(0)>>6&1,n=e.data.readUInt8(0)>>5&1;t.alarm=1==a?"on":"off",t.active=1==r?"on":"off",t.powerAlarm=1==n?"alarm":"no_change";}return t;},Afriso_AIS_10_PRO.prototype.executeCommand=function(e,t,a){if(t&&t.value){switch(t.value){case"arming":this._setActive(e,!0,a);break;case"disarming":this._setActive(e,!1,a);break;case"toggleArming":this._states&&this._states.active?this._setActive(e,"off"==this._states.active.value,a):this._setActive(e,!0,a);break;case"alarmOn":this._setAlarm(e,!0,a);break;case"alarmOff":this._setAlarm(e,!1,a);break;case"toggleAlarm":this._states&&this._states.alarm?this._setAlarm(e,"off"==this._states.alarm.value,a):this._setAlarm(e,!1,a);break;default:return void(a&&a(new Error("unknow command")));}a&&a();}else a&&a(new Error("command invalid"));},Afriso_AIS_10_PRO.prototype._setActive=function(e,t,a){var r=!1;this._states&&this._states.alarm&&"on"==this._states.alarm.value&&(r=!0),this._sendGPCD(e,r,t,a);},Afriso_AIS_10_PRO.prototype._setAlarm=function(e,t,a){var r=!0;this._states&&this._states.active&&"off"==this._states.active.value&&(r=!1),this._sendGPCD(e,t,r,a);},Afriso_AIS_10_PRO.prototype._sendGPCD=function(e,t,a,r){var n=this._senderID;this._senderID||(n=x.hub.m.enocean.SENDER_ID);var s=0;t&&(s|=128),a&&(s|=64);var o=new Buffer(1);o.writeUInt8(s,0);var i=new x.hub.m.enocean.ESP3.Telegram.GP_CD(o,n,0);i.setDstId(this._address),e.sendTelegram(i,!0,function(e){r&&r(e);});},Afriso_AIS_10_PRO;}(),l=function(){var TF_TTB=function TF_TTB(e){A5_07_01.call(this,e),this._data="eltako_tf_ttb",this._vendor="eltako",this._eepAlias="a5-07-01",this._params={reset_timeout:300};};(TF_TTB.prototype=new A5_07_01()).constructor=TF_TTB,TF_TTB.prototype.evalTelegram=function(e){return 246==e.rorg?F6_01_01.prototype.evalTelegram.call(this,e):165==e.rorg?A5_07_01.prototype.evalTelegram.call(this,e):{};},TF_TTB.prototype.checkStateChange=function(e){return e.button?F6_01_01.prototype.checkStateChange.call(this,e):A5_07_01.prototype.checkStateChange.call(this,e);},TF_TTB.prototype.fromJSON=function(e){return A5_07_01.prototype.fromJSON.call(this,e),this._params={reset_timeout:300},this;};var TF_RWB=function TF_RWB(e){A5_30_03.call(this,e),this._data="eltako_tf_smoke",this._vendor="eltako",this._eepAlias="a5-30-03";};TF_RWB.STATES=["temperature","temperature_raw","smoke","smoke_raw"],(TF_RWB.prototype=new A5_30_03()).constructor=TF_RWB,TF_RWB.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(2),n=e.userData.readUInt8(1);e.userData.readUInt8(0);if(1==(a>>3&1)){var s=n;t.temperature=parseFloat(((255-s)/255*40).toFixed(1)),t.temperature_raw=s;var o=r;t.smoke=15==o,t.smoke_raw=o;}}return t;};var TF_FKB=function TF_FKB(e){F6_10_00.call(this,e),this._data="eltako_tf_contact",this._vendor="eltako",this._eepAlias="d5-00-01";};TF_FKB.STATES=["contact","contact_raw","voltage","voltage_raw"],(TF_FKB.prototype=new D5_00_01()).constructor=TF_FKB,TF_FKB.prototype.evalTelegram=function(e){var t={};if(213==e.rorg){if(1==((r=e.userData)>>3&1)){var a=1&r;t.contact=a?"closed":"open",t.contact_raw=a;}}else if(165==e.rorg){var r=e.userData.readUInt8(3),n=(e.userData.readUInt8(2),e.userData.readUInt8(1)),s=e.userData.readUInt8(0);if(1==(r>>3&1)){var o=n;t.voltage=parseFloat(o/255*5).toFixed(1),t.voltage_raw=o;var i=s;t.energy=parseFloat(i/255*5).toFixed(1),t.energy_raw=i;}}return t;};var TF_BHSB_FBH=function TF_BHSB_FBH(e){Eltako_Motion.call(this,e),this._data="eltako_motion2",this._vendor="eltako",this._eepAlias="a5-08-01";};TF_BHSB_FBH.STATES=["voltage","voltage_raw","illumination","illumination_raw","state","state_raw"],(TF_BHSB_FBH.prototype=new Eltako_Motion()).constructor=TF_BHSB_FBH,TF_BHSB_FBH.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=(e.userData.readUInt8(2),e.userData.readUInt8(1)),n=e.userData.readUInt8(0);if(1==(a>>3&1)){var s=n;t.voltage=parseFloat((s/255*5.1).toFixed(1)),t.voltage_raw=s;var o=r;t.illumination=parseFloat((o/255*510).toFixed(1)),t.illumination_raw=o;var i=a;switch(i){case 13:t.state="on";break;case 15:t.state="off";}t.motion_raw=i;}}return t;};var TF_BHSB=function TF_BHSB(e){A5_07_01.call(this,e),this._data="eltako_tf_motion",this._vendor="eltako",this._eepAlias="a5-07-01";};TF_BHSB.STATES=["motion","motion_raw"],(TF_BHSB.prototype=new A5_07_01()).constructor=TF_BHSB,TF_BHSB.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(2);if(1==(a>>3&1)){var n=r;t.motion=200==n||255==n,t.motion_raw=n;}}return t;};var TF_Input=function TF_Input(e){A5_38_08.call(this,e),this._data="eltako_tf_input",this._vendor="eltako",this._eepAlias="a5-38-08";};TF_Input.STATES=["state","state_raw"],(TF_Input.prototype=new A5_38_08()).constructor=TF_Input,TF_Input.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3);1==(a>>3&1)&&(t.input=8!=a,t.input_raw=a);}return t;};var TF_Thermo=function TF_Thermo(e){A5_10_06.call(this,e),this._data="eltako_tf_thermo",this._vendor="eltako",this._eepAlias="a5-10-06";};TF_Thermo.STATES=["setpoint","setpoint_raw","temperature","temperature_raw","night_reduce","night_reduce_raw"],(TF_Thermo.prototype=new Eltako_Thermo()).constructor=TF_Thermo,TF_Thermo.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(2),n=e.userData.readUInt8(1);e.userData.readUInt8(0);if(1==(a>>3&1)){var s=n;t.setpoint=parseFloat((s/255*40).toFixed(1)),t.setpoint_raw=s;var o=r;t.temperature=parseFloat(((255-o)/255*40).toFixed(1)),t.temperature_raw=o;}}return t;};var TF_Lux=function TF_Lux(e){Eltako_Lux.call(this,e),this._data="eltako_tf_lux";};(TF_Lux.prototype=new Eltako_Lux()).constructor=TF_Lux;var Dimmer_Knob=function Dimmer_Knob(e){A5_38_08.call(this,e),this._data="eltako_dimmer_knob",this._vendor="eltako",this._eepAlias="a5-38-08";};Dimmer_Knob.STATES=["state","dimmerLevel"],(Dimmer_Knob.prototype=new A5_38_08()).constructor=Dimmer_Knob,Dimmer_Knob.prototype.evalTelegram=function(e){var t={};if(165==e.rorg){var a=e.userData.readUInt8(3),r=e.userData.readUInt8(2),n=e.userData.readUInt8(1),s=e.userData.readUInt8(0);if(1==(a>>3&1))if(2===s){var o=n;t.dimmerLevel=o;var i=r;t.ramp=i;var l=a>>2&1;t.dim_range=l?"relative":"absolute";var u=a>>1&1;t.store_final_value=u;var c=1&a;t.state=c?"on":"off";}}return t;};var TF_Alarm=function TF_Alarm(e){t.call(this,e),this.TEACH_IN_VARIATION=3,this._data="eltako_tf_alarm";};(TF_Alarm.prototype=new t()).constructor=TF_Alarm,TF_Alarm.prototype.evalTelegram=function(e){var t={};if(246==e.rorg)switch(e.userData){case 48:t.active=!0;break;case 16:t.active=!1;}else if(165==e.rorg){var a=e.userData.readUInt8(3);8==a?t.alarm="ok":9==a&&(t.alarm="alarm");}return t;},TF_Alarm.prototype.executeCommand=function(e,t,a){if(t&&t.value){var r=null;switch(t.value){case"triggerAlarm":r=new Buffer([1,0,0,9]);break;case"deactivate":r=new Buffer([1,0,0,12]);break;case"activate":r=new Buffer([1,0,0,8]);break;default:a&&a(new Error("unknow command"));}var n=this._senderID;this._senderID||(n=x.hub.m.enocean.SENDER_ID);var s=new x.hub.m.enocean.ESP3.Telegram.BS4(r,n,0);s.setDstId(this._address),e.sendTelegram(s,!0,function(e){a&&a(e);});}else a&&a(new Error("command invalid"));};var Eltako_F6T=function Eltako_F6T(e){Eltako_Buttons.call(this,e),this._data="eltako_f6t",this._vendor="eltako",this.BUTTONS=["buttonCO","buttonCI","buttonBO","buttonBI","buttonAO","buttonAI"];};return Eltako_F6T.STATES=["buttonCO","buttonCI","buttonBO","buttonBI","buttonAO","buttonAI"],(Eltako_F6T.prototype=new Eltako_Buttons()).constructor=Eltako_F6T,Eltako_F6T.prototype.evalTelegram=function(e){var t={};if(246==e.rorg){var a=parseInt(this._address,16),r=e.senderID?parseInt(e.senderID,16):null;if(r&&r==a+1)switch(e.userData){case 112:t.buttonCI="pressed";break;case 80:t.buttonCO="pressed";break;case 0:for(var n=0;n<this.BUTTONS.length;n++){this.BUTTONS[n]&&(t[this.BUTTONS[n]]="released");}}else switch(e.userData){case 112:t.buttonAI="pressed";break;case 80:t.buttonAO="pressed";break;case 48:t.buttonBI="pressed";break;case 16:t.buttonBO="pressed";break;case 0:for(n=0;n<this.BUTTONS.length;n++){this.BUTTONS[n]&&(t[this.BUTTONS[n]]="released");}}}return t;},{TF_TTB:TF_TTB,TF_RWB:TF_RWB,TF_FKB:TF_FKB,TF_BHSB:TF_BHSB,TF_BHSB_FBH:TF_BHSB_FBH,TF_Input:TF_Input,TF_Thermo:TF_Thermo,TF_Lux:TF_Lux,Dimmer_Knob:Dimmer_Knob,TF_Alarm:TF_Alarm,Eltako_F6T:Eltako_F6T};}(),u={"f6-??-??":F6,"f6-01-01":F6_01_01,"f6-02-01":F6_02_01,"f6-02-02":F6_02_02,"f6-02-03":F6_02_03,"f6-02-04":F6_02_04,"f6-03-01":F6_03_01,"f6-03-02":F6_03_02,"f6-04-01":F6_04_01,"f6-04-02":F6_04_02,"f6-05-00":F6_05_00,"f6-05-01":F6_05_01,"f6-05-02":F6_05_02,"f6-10-00":F6_10_00,"f6-10-01":F6_10_01,"d5-xx-xx":MacoWindow,"d5-??-??":D5,"d5-00-01":D5_00_01,"f6-so-da":SodaHandle,"a5-??-??":A5,"a5-02-01":A5_02_01,"a5-02-02":A5_02_02,"a5-02-03":A5_02_03,"a5-02-04":A5_02_04,"a5-02-05":A5_02_05,"a5-02-06":A5_02_06,"a5-02-07":A5_02_07,"a5-02-08":A5_02_08,"a5-02-09":A5_02_09,"a5-02-0a":A5_02_0A,"a5-02-0b":A5_02_0B,"a5-02-10":A5_02_10,"a5-02-11":A5_02_11,"a5-02-12":A5_02_12,"a5-02-13":A5_02_13,"a5-02-14":A5_02_14,"a5-02-15":A5_02_15,"a5-02-16":A5_02_16,"a5-02-17":A5_02_17,"a5-02-18":A5_02_18,"a5-02-19":A5_02_19,"a5-02-1a":A5_02_1A,"a5-02-1b":A5_02_1B,"a5-02-20":A5_02_20,"a5-02-30":A5_02_30,"a5-04-01":A5_04_01,"a5-04-02":A5_04_02,"a5-04-03":A5_04_03,"a5-06-01":A5_06_01,"a5-06-02":A5_06_02,"a5-06-03":A5_06_03,"a5-06-04":A5_06_04,"a5-06-05":A5_06_05,"a5-07-01":A5_07_01,"a5-07-02":A5_07_02,"a5-07-03":A5_07_03,"a5-08-01":A5_08_01,"a5-08-02":A5_08_02,"a5-08-03":A5_08_03,"a5-09-02":A5_09_02,"a5-09-04":A5_09_04,"a5-09-05":A5_09_05,"a5-09-06":A5_09_06,"a5-09-07":A5_09_07,"a5-09-08":A5_09_08,"a5-09-09":A5_09_09,"a5-09-0a":A5_09_0A,"a5-09-0b":A5_09_0B,"a5-09-0c":A5_09_0C,"a5-10-01":A5_10_01,"a5-10-02":A5_10_02,"a5-10-03":A5_10_03,"a5-10-04":A5_10_04,"a5-10-05":A5_10_05,"a5-10-06":A5_10_06,"a5-10-07":A5_10_07,"a5-10-08":A5_10_08,"a5-10-09":A5_10_09,"a5-10-0a":A5_10_0A,"a5-10-0b":A5_10_0B,"a5-10-0c":A5_10_0C,"a5-10-0d":A5_10_0D,"a5-10-10":A5_10_10,"a5-10-11":A5_10_11,"a5-10-12":A5_10_12,"a5-10-13":A5_10_13,"a5-10-14":A5_10_14,"a5-12-00":A5_12_00,"a5-12-01":A5_12_01,"a5-12-02":A5_12_02,"a5-12-03":A5_12_03,"a5-13-01":A5_13_01,"a5-13-02":A5_13_02,"a5-13-03":A5_13_03,"a5-13-04":A5_13_04,"a5-13-05":A5_13_05,"a5-13-06":A5_13_06,"a5-14-01":A5_14_01,"a5-14-02":A5_14_02,"a5-14-03":A5_14_03,"a5-14-04":A5_14_04,"a5-14-05":A5_14_05,"a5-14-06":A5_14_06,"a5-14-07":A5_14_07,"a5-14-08":A5_14_08,"a5-14-09":A5_14_09,"a5-14-0a":A5_14_0A,"a5-20-04":A5_20_04,"a5-30-01":A5_30_01,"a5-30-02":A5_30_02,"a5-30-03":A5_30_03,"a5-30-04":A5_30_04,"a5-38-08":A5_38_08,"d2-??-??":D2,"d2-01-00":D2_01_00,"d2-01-01":D2_01_01,"d2-01-03":D2_01_03,"d2-01-11":D2_01_11,"d2-01-13":D2_01_13,"d2-01-14":D2_01_14,"d2-05-00":D2_05_00,"d2-05-01":D2_05_01,"d2-06-01":D2_06_01,"d2-06-02":D2_06_02,"d2-06-10":D2_06_10,"d2-06-ff":D2_06_FF,smartguard2:SmartGuard2,"d2-06-50":SiegeniaWindow,"d2-20-00":D2_20_XX,eltako_dimmer:Eltako_Dimmer,eltako_dimmer2:Eltako_Dimmer2,eltako_fsud:Eltako_FSUD,eltako_motion:Eltako_Motion,eltako_contact:Eltako_Contact,eltako_weather:Eltako_Weather,eltako_lux:Eltako_Lux,eltako_lux2:Eltako_Lux2,eltako_sender2:Eltako_Sender2,eltako_sender4:Eltako_Sender4,eltako_button1:Eltako_Button1,eltako_button2:Eltako_Button2,eltako_button4:Eltako_Button4,eltako_blind:Eltako_Blind,eltako_fsm60b:Eltako_FSM60B,eltako_fkf:Eltako_FKF,eltako_fkc:Eltako_FKC,eltako_thermo:Eltako_Thermo,eltako_ftr65hb:Eltako_FTR65HB,eltako_futh55d:Eltako_FUTH55D,eltako_futh65d:Eltako_FUTH65D,eltako_ftr78s:Eltako_FTR78S,eltako_powermeter:Eltako_Powermeter,eltako_powermeter2:Eltako_Powermeter2,eltako_fzs:Eltako_FZS,eltako_switch:Eltako_Switch,eltako_relay:Eltako_Relay,eltako_relay2:Eltako_Relay2,eltako_heat:Eltako_Heat,eltako_water_m3:Eltako_Water_M3,eltako_water_m4:Eltako_Water_M4,eltako_tf_switch:t,eltako_tf_dimmer:r,eltako_tf_blind:s,peha_switch:Peha_Switch,peha_powerswitch:Peha_PowerSwitch,peha_blind:Peha_Blind,"bb-aa-cc":BB_AA_CC,afriso_water_con:Afriso_Water_Con,afriso_water_eco:Afriso_Water_Eco,afriso_asd_10:Afriso_ASD_10,hoppe_door:Hoppe_Door,gp:o,afriso_ais_10:i,eltako_tf_ttb:l.TF_TTB,eltako_tf_smoke:l.TF_RWB,eltako_tf_contact:l.TF_FKB,eltako_tf_motion:l.TF_BHSB,eltako_motion2:l.TF_BHSB_FBH,eltako_tf_thermo:l.TF_Thermo,eltako_tf_input:l.TF_Input,eltako_tf_lux:l.TF_Lux,eltako_dimmer_knob:l.Dimmer_Knob,eltako_tf_alarm:l.TF_Alarm,eltako_f6t:l.Eltako_F6T,parseDBJson:function parseDBJson(e){if(!e||!e.eep)return null;var t=this[e.eep];if(!t)return null;var a=new t();return a=a.fromDBJSON(e);},parseJson:function parseJson(e){if(!e||!e.data)return null;var t=this[e.data];if(!t)return null;var a=new t();return a=a.fromJSON(e);}};return u;}(),x.hub.m.enocean.SiegeniaHandler=function(){var Handler=function Handler(e){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.SiegeniaHandler"),this._esp3=e,this._esp3Listener=null,this._windowID=null,this._window=null,this._calibateListener=null;};return Handler.prototype.startCalibateWindow=function(e,t){if(this._calibateListener)t&&t(new Error("configuraion of window running"));else{this._calibateListener=t,this._windowID=e,this._window=new x.hub.m.enocean.profiles["d2-06-50"]();var a=this;this._esp3Listener={_onEOTelegram:function _onEOTelegram(e){var t=!1;if(a._windowID&&a._windowID==e.senderID?t=!0:a._windowID||210!=e.rorg||(t=!0),t&&a._calibateListener){var r=a._window.evalTelegram(e);r&&17==r.type&&a._calibateListener(null,e.senderID,r);}}},this._esp3.addListener(this._esp3Listener);}},Handler.prototype.stopCalibateWindow=function(){this._esp3Listener&&this._esp3.removeListener(this._esp3Listener),this._esp3Listener=null,this._calibateListener=null,this._windowID=null,this._window=null;},Handler.prototype.configWindow=function(e,t,a,r){t="FFFFFFFF",r||(r=x.hub.m.enocean.SENDER_ID),this._logger.log("info","config siegenia window:"+JSON.stringify(e)),this._logger.log("info","window id:FFFFFFFF sender id:"+r);var n=parseInt(e.alive),s=parseInt(e.sync),o=parseInt(e.eep),i=parseInt(e.type),l=parseInt(e.alarm),u=parseInt(e.alarm_sens),c=[128,2,127,240,1,140,57,45,245],h=[192,13,127,242,49,0,0,2,n>>8&255],_=[193,255&n,0,1,2,s>>8&255,255&s,0,2],p=[194,1,o,0,3,1,i,0,4],d=[195,1,l,0,5,1,u,0,0],v=[128,2,127,240,2,140,57,45,245],f=this;this._logger.log("info","send config siegenia window (data1):"+new Buffer(c).toString("hex")),this._esp3._recomm.sendRawSysEx(new Buffer(c),t,r,function(e){e&&(f._logger.log("warn","config siegenia window error (data1):"+e.message+" ["+e.code+"]"),100!=e.code)?a&&a(e):(f._logger.log("info","send config siegenia window (data2):"+new Buffer(h).toString("hex")),f._esp3._recomm.sendRawSysEx(new Buffer(h),t,r,function(e){e&&(f._logger.log("warn","config siegenia window error (data2):"+e.message+" ["+e.code+"]"),100!=e.code)?a&&a(e):(f._logger.log("info","send config siegenia window (data3):"+new Buffer(_).toString("hex")),f._esp3._recomm.sendRawSysEx(new Buffer(_),t,r,function(e){e&&(f._logger.log("warn","config siegenia window error (data3):"+e.message+" ["+e.code+"]"),100!=e.code)?a&&a(e):(f._logger.log("info","send config siegenia window (data4):"+new Buffer(p).toString("hex")),f._esp3._recomm.sendRawSysEx(new Buffer(p),t,r,function(e){e&&(f._logger.log("warn","config siegenia window error (data4):"+e.message+" ["+e.code+"]"),100!=e.code)?a&&a(e):(f._logger.log("info","send config siegenia window (data5):"+new Buffer(d).toString("hex")),f._esp3._recomm.sendRawSysEx(new Buffer(d),t,r,function(e){e&&(f._logger.log("warn","config siegenia window error (data5):"+e.message+" ["+e.code+"]"),100!=e.code)?a&&a(e):(f._logger.log("info","send config siegenia window (data6):"+new Buffer(v).toString("hex")),f._esp3._recomm.sendRawSysEx(new Buffer(v),t,r,function(e){e&&f._logger.log("warn","config siegenia window error (data5):"+e.message+" ["+e.code+"]"),e&&100!=e.code?a&&a(e):a&&a();}));}));}));}));}));});},Handler;}(),x.hub.m.enocean.RehauHandler=function(){var InoventAccessory=function InoventAccessory(e){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.RehauHandler.InoventAccessory"),this._inoventID=e,this._humiditySensorID=null,this._co2SensorID=null,this._humRegulationActive=!1,this._co2RegulationActive=!1,this._humidityState=null,this._humidityLevel=0,this._co2State=null,this._co2Level=0;};InoventAccessory.prototype.getHumiditySensorID=function(){return this._humiditySensorID;},InoventAccessory.prototype.setHumiditySensorID=function(e){this._humiditySensorID=e;},InoventAccessory.prototype.getCo2SensorID=function(){return this._co2SensorID;},InoventAccessory.prototype.setCo2SensorID=function(e){this._co2SensorID=e;},InoventAccessory.prototype.activateSensorRegulation=function(e){if(5==e)this._humRegulationActive=!0,this._co2RegulationActive=!1;else{if(6!=e)return this._humRegulationActive=!1,void(this._co2RegulationActive=!1);this._humRegulationActive=!1,this._co2RegulationActive=!0;}this._humidityLevel=0,this._co2Level=0,this._humRegulationActive&&this._humiditySensorID&&null!=this._humidityState&&this.executeHumidityRegulation(this._humidityState),this._co2RegulationActive&&this._co2SensorID&&null!=this._co2State&&this.executeCo2Regulation(this._co2State);},InoventAccessory.prototype.deactivateSensorRegulation=function(){this._humRegulationActive=!1,this._co2RegulationActive=!1,this._humidityLevel=0,this._co2Level=0;},InoventAccessory.prototype.executeHumidityRegulation=function(e){if(this._humidityState=e,this._logger.log("trace","["+this._inoventID+"] receive hum:"+e),this._humRegulationActive){var t=this._calculateHumidityLevel(e);this._logger.log("trace","["+this._inoventID+"] target level:"+t),(!this._humidityLevel||t!=this._humidityLevel&&this._exceedHumidityHysteresis(this._humidityLevel,e))&&this._changeHumLevel(t);}},InoventAccessory.prototype._calculateHumidityLevel=function(e){return e<=50?1:e<=60?2:e<=70?3:4;},InoventAccessory.prototype._exceedHumidityHysteresis=function(e,t){switch(e){case 1:return t>=55;case 2:return t<=45||t>=65;case 3:return t<=55||t>=75;case 4:return t<=65;}},InoventAccessory.prototype._changeHumLevel=function(e){var t=this;require("x.hub.m.enocean.js").executeCommand({address:this._inoventID},{value:"setHumLevel"+e},function(a){a&&a.error||(t._humidityLevel=e);});},InoventAccessory.prototype.executeCo2Regulation=function(e){if(this._co2State=e,this._logger.log("trace","["+this._inoventID+"] receive co2:"+e),this._co2RegulationActive){var t=this._calculateCo2Level(e);this._logger.log("trace","["+this._inoventID+"] target level:"+t),(!this._co2Level||t!=this._co2Level&&this._exceedCo2Hysteresis(this._co2Level,e))&&this._changeCo2Level(t);}},InoventAccessory.prototype._calculateCo2Level=function(e){return e<=600?1:e<=1e3?2:e<=1500?3:4;},InoventAccessory.prototype._exceedCo2Hysteresis=function(e,t){switch(e){case 1:return t>=700;case 2:return t<=500||t>=1100;case 3:return t<=900||t>=1600;case 4:return t<=1400;}},InoventAccessory.prototype._changeCo2Level=function(e){var t=this;require("x.hub.m.enocean.js").executeCommand({address:this._inoventID},{value:"setCo2Level"+e},function(a){a&&a.error||(t._co2Level=e);});},InoventAccessory.prototype.toJSON=function(){return{humidity:this._humiditySensorID,co2:this._co2SensorID};},InoventAccessory.prototype.fromJSON=function(e){e&&(this._humiditySensorID=e.humidity,this._co2SensorID=e.co2);};var WindowAlarm=function WindowAlarm(e){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.RehauHandler.WindowAlarm"),this._handler=e,this._active=!1,this._sensors={};};WindowAlarm.prototype.setAlarm=function(e){this._logger.log("trace","set alarm active:"+e),this._active=e;},WindowAlarm.prototype.getAlarm=function(){return this._active;},WindowAlarm.prototype.onReceiveWindowSensorStates=function(e,t){if(this._logger.log("trace","receive window:"+e.getAddress()+" states:"+JSON.stringify(t)),this._active){var a=e.getAddress(),r=this._sensors[a];r||(this._sensors[a]={lastEvent:"IDLE"},r=this._sensors[a]);if(this._logger.log("trace","last event for window:"+e.getAddress()+" is:"+r.lastEvent),t){if(t.pre_alarm&&"PRE_ALARM"!=r.lastEvent)return r.lastEvent="PRE_ALARM",this._logger.log("trace","window:"+e.getAddress()+" pre_alarm triggered"),void this.triggerAlarm(!0);if(t.alarm&&"ALARM"!=r.lastEvent)return r.lastEvent="ALARM",this._logger.log("trace","window:"+e.getAddress()+" alarm triggered"),void this.triggerAlarm();t.alarm||t.pre_alarm||(this._logger.log("trace","new event for window:"+e.getAddress()+" is:IDLE and stop timer"),r.lastEvent="IDLE");}}},WindowAlarm.prototype.triggerAlarm=function(e){require("x.hub.taskman.js").getRehauAlarmTaskManager().onWindowSensorAlarmTriggered(e);};var SmartguardSetting=function SmartguardSetting(e){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.RehauHandler.SmartguardSetting"),this._smartguardID=e,this._alarmActive=!0,this._prealarmActive=!0;};SmartguardSetting.prototype.isAlarmActive=function(){return!!this._alarmActive;},SmartguardSetting.prototype.isPreAlarmActive=function(){return!!this._prealarmActive;},SmartguardSetting.prototype.setAlarm=function(e){this._alarmActive=!!e;},SmartguardSetting.prototype.setPreAlarm=function(e){this._prealarmActive=!!e;},SmartguardSetting.prototype.toJSON=function(){return{alarm:this._alarmActive,pre_alarm:this._prealarmActive};},SmartguardSetting.prototype.fromJSON=function(e){e&&(this._alarmActive=e.alarm,this._prealarmActive=e.pre_alarm);};var Handler=function Handler(){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.RehauHandler"),this._mainHandler=null,this._windowAlarm=new WindowAlarm(this),this._inoventAccessories={},this._smartguardSettings={};};return Handler.prototype.REHAU_FILE="enocean_rehau.json",Handler.prototype.init=function(e,t){this._logger.log("trace","init");var a=this;if(this._mainHandler=e,e){var r=e.getDeviceHandler();r&&r.on("deleteDevice",function(e){a.onDeleteDevice(e);});}this._loadInoventAccessories(function(e,r,n){e&&a._logger.log("warn","init error:"+e.message),r&&(a._inoventAccessories=r),n&&(a._smartguardSettings=n),t&&t();});},Handler.prototype.getInoventAccessory=function(e){return e?this._inoventAccessories[e]:null;},Handler.prototype.deleteInoventAccessory=function(e,t){e&&this._inoventAccessories[e]?(delete this._inoventAccessories[e],this._saveData(t)):t&&t();},Handler.prototype.getSmartguardSetting=function(e){return e?this._smartguardSettings[e]:null;},Handler.prototype.deleteSmartguardSetting=function(e,t){e&&this._smartguardSettings[e]?(delete this._smartguardSettings[e],this._saveData(t)):t&&t();},Handler.prototype.setHumidityAccessory=function(e,t,a){if(e){var r=this.getInoventAccessory(e);if(r||(r=new InoventAccessory(e),this._inoventAccessories[e]=r),t&&"string"==typeof t&&"{"==t.charAt(0))try{t=JSON.parse(t);}catch(e){return void(a&&a(new Error("invalid humiditySensorID json: "+e.message)));}r.setHumiditySensorID(t),this._saveData(a);}else a&&a(new Error("inoventID is null"));},Handler.prototype.setCo2Accessory=function(e,t,a){if(e){var r=this.getInoventAccessory(e);r||(r=new InoventAccessory(e),this._inoventAccessories[e]=r),r.setCo2SensorID(t),this._saveData(a);}else a&&a(new Error("inoventID is null"));},Handler.prototype.activateSensorRegulation=function(e,t){var a=this.getInoventAccessory(e);a&&a.activateSensorRegulation(t);},Handler.prototype.deactivateSensorRegulation=function(e){var t=this.getInoventAccessory(e);t&&t.deactivateSensorRegulation();},Handler.prototype.isWindowOpen=function(){var e=this._mainHandler.getDeviceHandler(),t=e.findDeviceWithData("bb-aa-cc"),a=e.findDeviceWithData("d2-06-10"),r=e.findDeviceWithData("d2-06-ff"),n=e.findDeviceWithData("smartguard2");a&&(t=t.concat(a)),r&&(t=t.concat(r)),n&&(t=t.concat(n));for(var s=!1,o=0;o<t.length;o++){var i=t[o];if(i)if("open"==i.getBufferedState("window")){s=!0;break;}}return s;},Handler.prototype.setAlarm=function(e,t){this._windowAlarm.setAlarm(e);var a=this._mainHandler.getDeviceHandler(),r=a.findDeviceWithData("bb-aa-cc"),n=a.findDeviceWithData("d2-06-10"),s=a.findDeviceWithData("d2-06-ff"),o=a.findDeviceWithData("smartguard2");n&&(r=r.concat(n)),s&&(r=r.concat(s)),o&&(r=r.concat(o));for(var i=this._mainHandler.getESP3(),l=0;l<r.length;l++){var u=r[l];u&&(u.executeCommand(i,{value:e?"alarmTaskOn":"alarmTaskOff"}),u.executeCommand(i,{value:e?"preAlarmTaskOn":"preAlarmTaskOff"}));}t&&t();},Handler.prototype.getAlarm=function(){return this._windowAlarm.getAlarm();},Handler.prototype.setSmartGuardAlarm=function(e,t,a){if(e){var r=this._smartguardSettings[e];r||(r=new SmartguardSetting(e),this._smartguardSettings[e]=r),r.setAlarm(t),this._saveData(a);}else a&&a(new Error("smartguardID invalid"));},Handler.prototype.setSmartGuardPreAlarm=function(e,t,a){if(e){var r=this._smartguardSettings[e];r||(r=new SmartguardSetting(e),this._smartguardSettings[e]=r),r.setPreAlarm(t),this._saveData(a);}else a&&a(new Error("smartguardID invalid"));},Handler.prototype.onReceiveWindowSensorStates=function(e,t){this._windowAlarm.onReceiveWindowSensorStates(e,t);},Handler.prototype.onDeleteDevice=function(e){if(e){var t=e.getAddress();if(t)if(this.getInoventAccessory(t))this.deleteInoventAccessory(t);else if(this.getSmartguardSetting(t))this.deleteSmartguardSetting(t);else{var a=!1;for(var r in this._inoventAccessories){var n=this._inoventAccessories[r];n&&(n.getHumiditySensorID()==t&&(n.setHumiditySensorID(null),a=!0),n.getCo2SensorID()==t&&(n.setCo2SensorID(null),a=!0));}a&&this._saveData();}}},Handler.prototype.onDeviceEvent=function(e,t){if(e){var a="ENOCEAN";e.getType&&(a=e.getType()),a||(a="ENOCEAN");var r=e.getAddress();if(r)if("HM"==a){if(!t)return;for(var n in this._logger.log("trace","process homematic device ("+r+") events:"+JSON.stringify(t)),this._inoventAccessories){if(l=this._inoventAccessories[n]){var s=l.getHumiditySensorID();s&&s.key&&s.address==r&&null!=(i=t[s.key])&&null!=i&&l.executeHumidityRegulation(i);var o=l.getHumiditySensorID();o&&o.key&&o.address==r&&null!=(i=t[o.key])&&null!=i&&l.executeCo2Regulation(i);}}}else if("ENOCEAN"==a&&e.getData){this._logger.log("trace","process enocean device ("+r+") events:"+JSON.stringify(t));var i=null;switch(e.getData()){case"a5-04-01":case"a5-04-03":case"a5-10-12":i=function(e){for(var t=null,a=0;a<e.length;a++){var r=e[a];if(r&&"humidity"==r.key){t=r.value;break;}}return t;}(t);break;case"a5-09-08":case"a5-09-09":i=function(e){for(var t=null,a=0;a<e.length;a++){var r=e[a];if(r&&"co2"==r.key){t=r.value;break;}}return t;}(t);break;default:return;}if(null==i||null==i)return;for(var n in this._inoventAccessories){var l;(l=this._inoventAccessories[n])&&(l.getHumiditySensorID()==r&&l.executeHumidityRegulation(i),l.getCo2SensorID()==r&&l.executeCo2Regulation(i));}}}},Handler.prototype._loadInoventAccessories=function(e){var t=this;this._loadFile(function(a,r){if(a)e&&e(a);else{var n=t._jsonToAccessoriesMap(r),s=t._jsonToSmartGuardSettingsMap(r);e&&e(null,n,s);}});},Handler.prototype._jsonToAccessoriesMap=function(e){if(!e||!e.inovent)return{};var t={};for(var a in e.inovent){var r=e.inovent[a];if(r){var n=new InoventAccessory(a);n.fromJSON(r),t[a]=n;}}return t;},Handler.prototype._jsonToSmartGuardSettingsMap=function(e){if(!e||!e.smartguard)return{};var t={};for(var a in e.smartguard){var r=e.smartguard[a];if(r){var n=new SmartguardSetting(a);n.fromJSON(r),t[a]=n;}}return t;},Handler.prototype._loadFile=function(e){var t=this._getFilePath();fs_extra.ensureFile(t,function(a){a?e&&e(a):fs_extra.readFile(t,"utf8",function(t,a){if(t)e&&e(t);else if(a)try{var r=JSON.parse(a);e&&e(null,r);}catch(t){e&&e(t);}else e&&e(null,{});});});},Handler.prototype._getFilePath=function(){var e=require("x.hub.fileman.js").fileManager,t=require("path"),a=(require("fs"),e.getUserRootDataPath());return t.resolve(a,this.REHAU_FILE);},Handler.prototype._saveData=function(e){var t=this._accessoriesMapToJson(this._inoventAccessories),a=this._settingsMapToJson(this._smartguardSettings),r={inovent:t||{},smartguard:a||{}};this._saveFile(r,function(t){e&&e(t);});},Handler.prototype._accessoriesMapToJson=function(e){if(!e)return{};var t={};for(var a in e){var r=e[a];if(r){var n=r.toJSON();t[a]=n;}}return t;},Handler.prototype._settingsMapToJson=function(e){if(!e)return{};var t={};for(var a in e){var r=e[a];if(r){var n=r.toJSON();t[a]=n;}}return t;},Handler.prototype._saveFile=function(e,t){var a=this._getFilePath();fs_extra.writeFile(a,JSON.stringify(e,null,2),function(e){t&&t(e);});},Handler;}(),x.hub.m.enocean.SDK=function(){var SDK=function SDK(e){this._handler=e;};return SDK.prototype.send_SA_RD_LEARNEDCLIENTS=function(e,t){var a=new x.hub.m.enocean.ESP3.SA_COMMAND.SA_RD_LEARNEDCLIENTS();this._handler._esp3.sendSACommand(a,!0,function(e,a){t&&t(e,a);});},SDK.prototype.send_SA_WR_RESET=function(e,t){if(e&&e.saClientId){var a=new x.hub.m.enocean.ESP3.SA_COMMAND.SA_WR_RESET(e.saClientId);this._handler._esp3.sendSACommand(a,!0,function(e,a){t&&t(e,a);});}else t&&t(new Error("params invalid"));},SDK.prototype.send_SA_WR_POSTMASTER=function(e,t){if(e){e.mailboxCount||(e.mailboxCount=0);var a=new x.hub.m.enocean.ESP3.SA_COMMAND.SA_WR_POSTMASTER(e.mailboxCount);this._handler._esp3.sendSACommand(a,!0,t);}else t&&t(new Error("params invalid"));},SDK.prototype.send_CO_WR_REPEATER=function(e,t){if(e){e.enable||(e.enable=0),e.level||(e.level=0);var a=new x.hub.m.enocean.ESP3.COMMAND_COMMAND.CO_WR_REPEATER(e.enable,e.level);this._handler._esp3.sendCommandCommand(a,!0,t);}else t&&t(new Error("params invalid"));},SDK;}(),x.hub.m.enocean.Util={esp2toesp3:function esp2toesp3(e){if(!e)return null;if(!(e instanceof x.hub.m.enocean.ESP2.Telegram))return null;var t=e.toPayload();if(!t)return null;var a=t.getData(),r=t.getSenderID(),n=t.getStatus(),s=15&n;if(t instanceof x.hub.m.enocean.ESP2.Payload.RPS){a=a.readUInt8(0);var o=n>>5&1,i=n>>4&1;return new x.hub.m.enocean.ESP3.Telegram.RPS(a,r,o,i,s);}return t instanceof x.hub.m.enocean.ESP2.Payload.BS1?(a=a.readUInt8(0),new x.hub.m.enocean.ESP3.Telegram.BS1(a,r,s)):t instanceof x.hub.m.enocean.ESP2.Payload.BS4?new x.hub.m.enocean.ESP3.Telegram.BS4(a,r,s):null;},esp3toesp2:function esp3toesp2(e){if(!e)return null;if(!(e instanceof x.hub.m.enocean.ESP3.Telegram))return null;var t=null,a=e.userData,r=e.senderID;if(e instanceof x.hub.m.enocean.ESP3.Telegram.RPS){var n=e.t21<<5|e.nu<<4||e.rc;t=new x.hub.m.enocean.ESP2.Payload.RPS(a,r,n);}else if(e instanceof x.hub.m.enocean.ESP3.Telegram.BS1){n=15&e.rc;t=new x.hub.m.enocean.ESP2.Payload.BS1(a,r,n);}else if(e instanceof x.hub.m.enocean.ESP3.Telegram.BS4){n=15&e.rc;t=new x.hub.m.enocean.ESP2.Payload.BS4(a,r,n);}if(t){var s=new x.hub.m.enocean.ESP2.TRT();return s.fromPayload(t),s;}return null;},buffer2esp3:function buffer2esp3(e){if(85!=e[0])return null;if(6>=e.length)return null;var t=(e[1]<<8)+e[2],a=e[3],r=e[5];if(e.length<t+a+7)return null;if(x.hub.m.enocean.CRC8(e.slice(1,5))!=r)return null;var n=e[t+a+6];if(x.hub.m.enocean.CRC8(e.slice(6,6+t+a))!=n)return null;var s={type:e[4],dataLen:t,optLen:a,radioType:e[6],data:e.slice(6,6+t),optData:e.slice(6+t,6+t+a),rawByte:e.slice(0,6+t+a+1).toString("hex")},o=new x.hub.m.enocean.ESP3.ESP3_Frame(s.type,s.data,s.optData);166!=s.radioType&&210!=s.radioType&&165!=s.radioType&&246!=s.radioType&&213!=s.radioType||(s.senderId=s.data.slice(t-5,t-1).toString("hex"));var i=o.toPacket();return i&&i instanceof x.hub.m.enocean.ESP3.RADIO_ERP1_Packet?i.toRadioTelegram():null;}},x.hub.m.enocean.USBHandler=function(){var USB=function USB(e){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.USBHandler"),this._handler=e,this._usbDevices=[],this._connectedESP3=null,this._connectedESP2=null;};return USB.prototype.attachSerial=function(e){this._logger.log("debug","attach usb port:"+e);var t=this._usbDevices.length;this._usbDevices.push({port:e}),0==t&&this._attachNextDevice();},USB.prototype.removeSerial=function(e){var t;(this._logger.log("debug","remove usb port:"+e),this._connectedESP3&&this._connectedESP3.port==e)&&(this._connectedESP3=null,(t=this._handler._esp3.getSerial())&&t.getPort()==e&&this._handler._esp3.removeSerial(e));this._connectedESP2&&this._connectedESP2.port==e&&(this._connectedESP2=null,(t=this._handler._esp2.getSerial())&&t.getPort()==e&&this._handler._esp2.removeSerial(e));},USB.prototype._attachNextDevice=function(){if(0!=this._usbDevices.length){var e=this._usbDevices[0],t=this;this._logger.log("debug","connect usb port:"+e.port),this._testESP3(e.port,function(a){if(!a)return t._connectedESP3=e,t._usbDevices.splice(0,1),void t._attachNextDevice();t._testESP2(e.port,function(a){if(!a)return t._connectedESP2=e,t._usbDevices.splice(0,1),void t._attachNextDevice();t._usbDevices.splice(0,1),t._attachNextDevice();});});}},USB.prototype._testESP3=function(e,t){this._logger.log("debug","try esp3 on usb port:"+e);var a=this._handler._esp3;if(a.getSerial())return this._logger.log("debug","enocean usb device already exist"),void t(new Error("enocean usb device already exist"));var r=this;a.attachSerial(e,function(a){a?r._logger.log("debug",e+" is not a enocean usb device, error:"+a.message):r._logger.log("debug","success to connect to enocean usb device on port:"+e),t(a);});},USB.prototype._testESP2=function(e,t){this._logger.log("debug","try esp2 on usb port:"+e);var a=this._handler._esp2;if(a.getSerial())return this._logger.log("debug","FGW14 device already exist"),void t(new Error("FGW14 device already exist"));var r=this;a.attachSerial(e,function(a){a?r._logger.log("debug",e+" is not a FGW14 gateway, error:"+a.message):r._logger.log("debug","connect to FGW14 on port "+e+" success"),t(a);});},USB;}(),x.hub.m.enocean.Handler=function(){var Handler=function Handler(){this._logger=require("x.logger.js").getLogger("x.hub.m.enocean.Handler"),this._secHandler=new this.SecurityHandler(this),this._deviceHandler=new this.DeviceHandler(this),this._esp3=new x.hub.m.enocean.ESP3(this),this._esp2=new x.hub.m.enocean.ESP2(this),this._learnHandler=new this.LearnHandler(this),this._siegeniaHandler=new x.hub.m.enocean.SiegeniaHandler(this._esp3),this._rehauHandler=new x.hub.m.enocean.RehauHandler(),this._trackers=[],this._sdk=new x.hub.m.enocean.SDK(this),this._usb=new x.hub.m.enocean.USBHandler(this);};return util.inherits(Handler,EventEmitter),Handler.prototype.Serial=x.hub.m.enocean.Serial,Handler.prototype.SENSOR_FILE="enocean.json",Handler.prototype.SECURITY_FILE="enocean_sec.json",Handler.prototype.profiles=x.hub.m.enocean.profiles,Handler.prototype.ESP2=x.hub.m.enocean.ESP2,Handler.prototype.ESP3=x.hub.m.enocean.ESP3,Handler.prototype.SecurityHandler=x.hub.m.enocean.SecurityHandler,Handler.prototype.LearnHandler=x.hub.m.enocean.LearnHandler,Handler.prototype.DeviceHandler=x.hub.m.enocean.DeviceHandler,Handler.prototype.getDeviceHandler=function(){return this._deviceHandler;},Handler.prototype.getRehauHandler=function(){return this._rehauHandler;},Handler.prototype.getESP3=function(){return this._esp3;},Handler.prototype.init=function(e){localStorage&&localStorage.getItem("x.hub.m.enocean.SENDER_ID")&&(x.hub.m.enocean.SENDER_ID=localStorage.getItem("x.hub.m.enocean.SENDER_ID")),localStorage&&localStorage.getItem("x.hub.m.enocean.ESP2_BAUDRATE")&&(this._esp2._baudrate=parseInt(localStorage.getItem("x.hub.m.enocean.ESP2_BAUDRATE")));var t=this,a=require("x.hub.eventbus.js");a.on("x.hub.peripheralman.ADD_ENOCEAN",function(e){console.log("ADD_ENOCEAN",e),t._usb.attachSerial(e.port);}),a.on("x.hub.peripheralman.REMOVE_ENOCEAN",function(e){console.log("REMOVE_ENOCEAN",e),t._usb.removeSerial(e.port);}),a.on("x.hub.peripheralman.ADD_SEIRAL",function(e){console.log("ADD_SEIRAL",e),e.type||t._usb.attachSerial(e.port);}),a.on("x.hub.peripheralman.REMOVE_SEIRAL",function(e){console.log("REMOVE_SEIRAL",e),e.type||t._usb.removeSerial(e.port);}),global.ENOCEAN_PORT&&"A20"!=global.PLATFORM&&"PI2"!=global.PLATFORM&&t._usb.attachSerial(global.ENOCEAN_PORT),global.ENOCEAN_FGW14_PORT&&"A20"!=global.PLATFORM&&"PI2"!=global.PLATFORM&&t._usb.attachSerial(global.ENOCEAN_FGW14_PORT),a.on("gatewayevent",function(e,a,r){if(e&&a&&"ENOCEAN"!=a.address&&"STA"==r){var n={_type:e.type,_adr:e.adr,getType:function getType(){return this._type;},getAddress:function getAddress(){return this._adr;}};t._rehauHandler.onDeviceEvent(n,e.state);}}),this._secHandler.init(function(){t._rehauHandler.init(t,function(){t._deviceHandler.init(function(){e&&e({});});});});},Handler.prototype.getSystems=function(){return["enocean"];},Handler.prototype.addStateDevice=function(e,t){t&&t({});},Handler.prototype.getAllStates=function(){var e=[],t=this._deviceHandler.getAllDevices();for(var a in t){if(t.hasOwnProperty(a)){var r=t[a];r&&e.push({device:r.toJSON(),states:r.getStatesBuffer()});}}return e;},Handler.prototype.getStates=function(e){if(!e||!e.address)return null;var t=null,a=this._deviceHandler.getDevice(e.address.toLowerCase());return a&&(t=a.getStatesBuffer()),t;},Handler.prototype.getState=function(e,t,a){var r=this.getStates(e),n=null;return r&&void 0!==r[t]&&null!=r[t]?(n=r[t],a&&a({data:n})):a&&this.updateStates(e,function(e){e.error?a&&a(e):(e.data&&(n=r[t]),a({data:n}));}),n;},Handler.prototype.executeCommand=function(e,t,a){if(this._esp3._baseID){if(this._esp3._baseID.toLowerCase()==x.hub.m.enocean.SENDER_ID.toLowerCase()){if(e&&e.address){var r=e.address;r&&(r=r.toLowerCase());var n=this._deviceHandler.getDevice(r);n?n.executeCommand?n.executeCommand(this._esp3,t,function(e){a&&a({error:e});}):a&&a({error:new Error("device dese not support command")}):a&&a({error:new Error("no such device")});}else a&&a({error:new Error("device invalid")});}else a&&a({error:new Error("enocean stick has a different baseID")});}else a&&a({error:new Error("enocean stick not found")});},Handler.prototype.checkDeviceMatch=function(e,t){if(!(t&&t.device&&e&&e.device))return!1;var a=e.device.address;a&&(a=a.toLowerCase());var r=t.device.address;return r&&(r=r.toLowerCase()),a==r;},Handler.prototype.updateStates=function(e,t){t&&t({error:new Error("not supported yet")});},Handler.prototype.executeCommandLegacy=function(e,t,a,r){e?r&&r({error:new Error("not supported yet")}):this._esp3?t?this.executeCommand({address:t},{value:a},function(e){r&&r({error:e?e.error:null});}):r&&r({error:new Error("address invalid")}):r&&r({error:new Error("not inited")});},Handler.prototype.getAllStatesLegacy=function(e,t){var a=[],r=this.getAllStates(),n=this._secHandler.getUnsyncDevice(),s=this;r.forEach(function(e){if(e&&e.device&&e.states){var r=e.device.address,o={type:"ENOCEAN",adr:r,data:e.device.data,vendor:e.device.vendor,state:{}};for(var i in e.states){o.state[i]=e.states[i].value;}s._secHandler.isSecureDevice(r)?(o.deviceProtocol="secure",n[r]?o.state.security_state="nok":o.state.security_state="ok"):o.deviceProtocol="normal",t&&"1"==t.config&&(o.senderID=e.device.senderID,o.virtual=e.device.virtual,o.params=e.device.params,r&&n[r]&&(o.rlc_unsync=!0)),a.push(o);}}),e&&e({data:a});},Handler.prototype.getEnoceanInfo=function(){var e={baseID:x.hub.m.enocean.SENDER_ID,usb_connected:null!=this._esp3._serial,usb_baseID:this._esp3._baseID,num_free_senderID:this._deviceHandler.getFreeSenderIdCount(),fgw14_connected:null!=this._esp2.getSerial(),fgw14_baudrate:this._esp2._baudrate};return e.fgw14_connected&&(e.fgw14_port=this._esp2.getSerial().getPort(),e.fgw14_baseID=this._esp2._baseID),e;},Handler.prototype.learnDevice=function(e,t){var a=e?e.senderID:null,r=e?e.data:null,n=e?e.vendor:null,s=e?e.address:null;if(s){var o=this._deviceHandler.findDevice(e);if(!o)return void(t&&t({error:new Error("device not found")}));var i=o.toJSON();r=i.data,n=i.vendor,a||(sednerID=i.senderID);}var l={};l.saLearnMode=e?e.saLearnMode:null,this._learnHandler.learn(r,s,a,n,null,function(e,a,r){if(e)t&&t({error:e});else{var n={};1==a?n.op=1:(n=r.toJSON()).op=0,t&&t({data:n});}},l);},Handler.prototype.learnSoda=function(e){if(this._esp3._serial){var t=this,a=setTimeout(function(){t._esp3.removeListener(r),e&&e({error:new Error("learn timeout")});},2e4),r={_onEOTelegram:function _onEOTelegram(n){if(246==n.rorg&&(192==n.userData||208==n.userData||240==n.userData)){clearTimeout(a),t._esp3.removeListener(r);var s={address:n.senderID,data:"f6-so-da",vendor:"soda"};t.addSensor(n.senderID,"f6-so-da","soda",null,function(t){t.error?e&&e(t):e&&e({data:s});});}}};this._esp3.addListener(r);}else e&&e({error:new Error("port not opened")});},Handler.prototype.teachinDevice=function(e,t){if(e){if(e.data){e.adr&&!e.address&&(e.address=e.adr);var a,r=this._deviceHandler.findDevice(e);a=r?r.toJSON():e,e.data==a.data?e.vendor&&e.vendor!=a.vendor?t&&t({error:new Error("device of another vendor with the same address exists")}):this._learnHandler.teachin(a.data,a.address,a.senderID,a.vendor,function(e,a,r){if(e)t&&t({error:e});else{var n={};a&&(n=a.toJSON()),r&&(n.op=r),t&&t({data:n});}}):t&&t({error:new Error("device of another type with the same address exists")});}else t&&t({error:new Error("data is null")});}else t&&t({error:new Error("query is null")});},Handler.prototype.generateVirtualDevice=function(e,t){this._deviceHandler.generateVirtual(e,function(e,a){t&&t({error:e,data:a?a.toJSON():null});});},Handler.prototype.setFGW14Baudrate=function(e,t){this._esp2?(localStorage.setItem("x.hub.m.enocean.ESP2_BAUDRATE",e),this._esp2._baudrate=e,t&&t({})):t&&t({error:{code:"01000",message:"no esp2 object"}});},Handler.prototype.sendToFGW14=function(e,t){var a,r;if(this._logger.log("trace","stm -> fgw14, forward esp3 telegram:"+e.toString("hex")),!this._esp2&&!this._esp2.getSerial())return this._logger.log("trace","stm -> fgw14, fgw14 not connected"),a=new x.hub.m.enocean.ESP3.Response(1),r=a.toPacket().toFrame().toBuffer(),void(t&&t(r));var n=x.hub.m.enocean.Util.buffer2esp3(e);if(!n)return this._logger.log("trace","stm -> fgw14, invalid esp3 telegram"),a=new x.hub.m.enocean.ESP3.Response(3),r=a.toPacket().toFrame().toBuffer(),void(t&&t(r));var s=x.hub.m.enocean.Util.esp3toesp2(n);if(!s)return this._logger.log("trace","stm -> fgw14, failed to convert esp3 telegram to esp2 telegram"),a=new x.hub.m.enocean.ESP3.Response(3),r=a.toPacket().toFrame().toBuffer(),void(t&&t(r));this._logger.log("trace","stm -> fgw14, convert to esp2 telegram:"+s.toBuffer().toString("hex"));var o=this;this._esp2.sendTelegram(s,null,function(e){o._logger.log("trace","stm -> fgw14, forward finish "+(e?"failed:"+e.messsage:"success")),a=new x.hub.m.enocean.ESP3.Response(0),r=a.toPacket().toFrame().toBuffer(),t&&t(r);});},Handler.prototype._onESP2Telegram=function(e){if("CA"==global.HARDWARE_VERSION){var t=x.hub.m.enocean.Util.esp2toesp3(e);if(t){var a=this,r=t.toPacket().toFrame().toBuffer();this._logger.log("trace","convert to esp3 telegram:"+JSON.stringify(t.toJSON())),this._logger.log("trace","convert to esp3:"+r.toString("hex")+" and forward to stm");var n=require("x.hub.v6.js").getSTM();n&&n.sendCommand(144,r,function(e){a._logger.log("trace","forward to stm result:"+JSON.stringify(e));});}}},Handler.prototype._onEOFrame=function(e,t){this._trackers.forEach(function(a){a.onFrame(e,t);});},Handler.prototype._onEOTelegram=function(e){this._trackers.forEach(function(t){t.onTelegram(e);});var t=e.senderID,a=this._deviceHandler.getDevice(t);if(a){var r=this;a.evalData(this._esp3,e,function(e,t){e||0==t.length||r._onEOEvents(a,t);});}},Handler.prototype._onEOEvents=function(e,t){var a=require("x.hub.eventbus.js");this._trackers.forEach(function(a){a.onResolveEvents(e._address,t);}),this._rehauHandler.onDeviceEvent(e,t);var r=e.toJSON();r.sys="aio",r.type="ENOCEAN";for(var n,s=0,o=0;o<t.length;o++){var i=t[o];if(i)if("shortPress"==i.value||"longPress"==i.value||"pressed"==i.value||"released"==i.value)s++,(l={type:"ENOCEAN",adr:r.address,data:r.data,vendor:r.vendor,state:{}}).state[i.key]=i.value,a.emit("gatewayevent",l,{address:"ENOCEAN"},"BTN");else if("d2-06-50"==r.data&&"burglary"==i.key){var l;return(l={type:"ENOCEAN",adr:r.address,data:r.data,vendor:r.vendor,state:{}}).state[i.key]=i.value,void a.emit("gatewayevent",l,{address:"ENOCEAN"},"STA");}}s!=t.length?(n=e.getStatesLegacy())&&(a.emit("gatewayevent",n,{address:"ENOCEAN"},"STA"),a.emit("udpevent",n,"STA")):(n=e.getStatesLegacy())&&a.emit("udpevent",n,"STA");},Handler.prototype._saveEnoceanEvents=function(e,t){var a=require("x.hub.datastore.js").dataStore;a&&a.openDB(function(a,r){if(!a){for(var n=e._address,s=[],o=new Date().toISOString(),i=0;i<t.length;i++){var l=t[i];if(l&&l.changed){var u=l.key+":"+l.value,c=null;c=0==s.length?"SELECT '"+n+"' AS 'window', '"+u+"' AS 'state', '"+o+"' AS 'time'":"UNION ALL SELECT '"+n+"', '"+u+"', '"+o+"'",s.push(c);}}if(s.length>0){var h=s.join(" ");h="INSERT INTO windowstate(window, state, time) "+h,h+=";",r.run(h,function(e){r.close();});}}});},Handler.prototype.addSensor=function(e,t){if(e){if(e.data){if("siegenia"!=e.vendor||e.params){this._deviceHandler.addDevice(e,function(e,a){t&&t({error:e,data:a?a.toJSON():null});});}else t&&t({error:new Error("siegenia windows params is null")});}else t&&t({error:new Error("enocean profile is null")});}else t&&t({error:new Error("enocean device is null")});},Handler.prototype.updateSensor=function(e,t,a){e?t?this._deviceHandler.updateDevice(e,t,function(e,t){a&&a({error:e,data:t?t.toJSON():null});}):a&&a({error:new Error("device info is null")}):a&&a({error:new Error("device address is null")});},Handler.prototype.delSensor=function(e,t){if(e){var a={address:e};this._deviceHandler.deleteDevice(a,function(e){t&&t({error:e});});}else t&&t({error:new Error("enocean id is null")});},Handler.prototype.resetDefaultSenderID=function(e){x.hub.m.enocean.SENDER_ID=null,localStorage&&localStorage.setItem("x.hub.m.enocean.SENDER_ID",""),e&&e({});},Handler.prototype.setRehauAlarm=function(e,t){this._rehauHandler.setAlarm(e,t);},Handler.prototype.isRehauWindowOpen=function(){return this._rehauHandler.isWindowOpen();},Handler.prototype.setInoventHumidityAccessory=function(e,t,a){this._rehauHandler.setHumidityAccessory(e,t,function(e){a&&a({error:e});});},Handler.prototype.setInoventCo2Accessory=function(e,t,a){this._rehauHandler.setCo2Accessory(e,t,function(e){a&&a({error:e});});},Handler.prototype.getInoventAccessories=function(e,t){var a=this._rehauHandler.getInoventAccessory(e);t&&t({data:a?a.toJSON():{}});},Handler.prototype.__addTelegramTracker=function(e){e&&e.onTelegram&&e.onResolveEvents&&-1==this._trackers.indexOf(e)&&this._trackers.push(e);},Handler.prototype.__removeTelegramTracker=function(e){if(e){var t=this._trackers.indexOf(e);-1!=t&&this._trackers.splice(t,1);}},Handler.prototype.__sendEspFrame=function(e,t,a,r,n){var s=t?new Buffer(t,"hex"):null,o=a?new Buffer(a,"hex"):null;r=!!r;var i=new x.hub.m.enocean.ESP3.ESP3_Frame(e,s,o);this._esp3.sendFrame(i,r,function(e,t){n&&n({error:e,data:t?t.toJSON():null});});},Handler.prototype.__simulateRawEnoceanPacket=function(e,t){this._esp3.onSerialData(new Buffer(e,"hex")),t&&t();},Handler.prototype._doSDK=function(e,t){if(e&&e.method){var a="send_"+e.method;this._sdk[a]?this._sdk[a](e.params,function(e){t&&t({error:e});}):t&&t({error:new Error("no such method")});}else t&&t({error:new Error("data invalid")});},Handler;}(),"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new x.hub.m.enocean.Handler());