"use strict";var xnm=xnm||{};xnm.aio=xnm.aio||{},xnm.aio.nanoleaf=xnm.aio.nanoleaf||{},xnm.aio.nanoleaf={API_BASE_V1:"/api/v1",PORT_DEFAULT:16021,_logger:{log:function log(){}},_buildRequestOptions:function _buildRequestOptions(e,n,a,t){var o=xnm.aio.nanoleaf.API_BASE_V1;e.token&&"new"!==a.path&&(o+="/"+e.token),o+="/"+a.path;var r={host:e.ip,port:e.port,path:o,method:n,headers:{"Content-Type":'application/json; charset="utf-8"',Connection:"close"}};return"string"==typeof t&&(r.headers["Content-Length"]=t.length),r;},_handleResponse:function _handleResponse(e,n,a,t){if(200===a.statusCode){var o="";a.on("data",function(e){o+=String(e);}),a.on("end",function(){if("json"===n.dataType)try{o=JSON.parse(o);}catch(e){xnm.aio.nanoleaf._logger.log("error","[_handleResponse] Failed to parse result as JSON: "+e.message);}t&&t(null,{statusCode:a.statusCode,response:o}),t=null;});}else if(204===a.statusCode)t&&t(null,{statusCode:a.statusCode,response:null});else{var r=new Error(e+' request for "'+n.path+'" failed with status code '+a.statusCode);xnm.aio.nanoleaf._logger.log("error","[_handleResponse] "+r.message),t&&t(r,{statusCode:a.statusCode,response:null});}},doRequest:function doRequest(e,n,a,t){var o=null;if(void 0!==a.data&&null!==a.data)try{o=JSON.stringify(a.data);}catch(e){return xnm.aio.nanoleaf._logger.log("error","[doRequest] Failed to parse body. Error: "+e.message),void(t&&t(e,null));}var r=require("http"),i=xnm.aio.nanoleaf._buildRequestOptions(e,n,a,o),s=r.request(i,function(e){xnm.aio.nanoleaf._handleResponse(n,a,e,t);});"function"==typeof s.setEncoding&&s.setEncoding("utf8"),"function"==typeof s.on&&s.on("error",function(e){e&&xnm.aio.nanoleaf._logger.log("error","[doRequest] Error: "+e.message),t&&t(e),t=null;}),"number"!=typeof a.timeout||isNaN(a.timeout)||"function"!=typeof s.setTimeout||s.setTimeout(a.timeout),o&&s.write(o),s.end();},getType:function getType(e){switch(e){case"NL22":return"panel";case"NL29":return"canvas";case"NL42":return"shape";case"NL52":return"element";case"NL59":return"line";case"NL62":return"magrgb";default:return null;}},parseJSON:function parseJSON(e){if(!e.type&&e.model&&(e.type=this.getType(e.model)),!e||!e.ip||!e.type)return xnm.aio.nanoleaf._logger.log("warn","[parseJSON] Missing IP and/or type."),null;switch(e.type){case"panel":return new xnm.aio.nanoleaf.Panel(e.ip,e);case"canvas":return new xnm.aio.nanoleaf.Canvas(e.ip,e);case"shape":return new xnm.aio.nanoleaf.Shape(e.ip,e);case"element":return new xnm.aio.nanoleaf.Element(e.ip,e);case"line":return new xnm.aio.nanoleaf.Line(e.ip,e);case"magrgb":return new xnm.aio.nanoleaf.Magrgb(e.ip,e);default:return xnm.aio.nanoleaf._logger.log("warn","[parseJSON] Unknown type: "+e.type),null;}},rgb2hsv:function rgb2hsv(e){var n=0,a=0,t=0,o=0,r=0,i=0;if(6===(e=e.replace("#","")).length)n=e.substring(0,2),a=e.substring(2,4),t=e.substring(4,6);else{if(3!==e.length)return[o,r,i];n=e[0],n+=n,a=e[1],a+=a,t=e[2],t+=t;}n=parseInt(n,16)/255,a=parseInt(a,16)/255,t=parseInt(t,16)/255;var s=Math.min(Math.min(n,a),t),l=Math.max(Math.max(n,a),t),u=l-s;return o=-1,r=0,i=l,0!==l&&(o=0,r=u/l,0!==u&&(o=n===l?(a-t)/u:a===l?2+(t-n)/u:4+(n-a)/u,(o*=60)<0&&(o+=360))),[o=Math.round(o),r=Math.round(100*r),i=Math.round(100*i)];}},xnm.aio.nanoleaf.DM={MAP:{device:{command:[{type:"enum",name:"on",ref:{value:"on"}},{type:"enum",name:"off",ref:{value:"off"}},{type:"enum",name:"toggle",ref:{value:"toggle"}},{type:"int",name:"brightness",ref:{value:"brightness",ext:"%d",extMeta:"0-100"}},{type:"int",name:"brightness relative change",ref:{value:"brightnessInc",ext:"%d",extMeta:"-100-100"}},{type:"rgb",name:"color",ref:{value:"color",ext:"%rgb"}},{type:"int",name:"color temperature",ref:{value:"ct",ext:"%d",extMeta:"1200-6500"}},{type:"enum",name:"identify",ref:{value:"identify"}},{type:"dynamic",name:"set scene",ref:{value:"scene",ext:"%dynamic"}},{type:"enum",name:"select next scene",ref:{value:"sceneNext"}},{type:"enum",name:"select previous scene",ref:{value:"scenePrev"}},{type:"enum",name:"select random scene",ref:{value:"sceneRandom"}}],status:[{type:"enum",name:"state",ref:{value:"on",value_t:"state",options:["on","off"]}},{type:"int",name:"brightness",ref:{value:"brightness",extMeta:"0-100"}},{type:"enum",name:"color mode",ref:{value:"colorMode",options:["ct","effect","hs"]}},{type:"int",name:"color temperature",ref:{value:"ct",extMeta:"1200-6500"}},{type:"int",name:"hue",ref:{value:"hue",extMeta:"0-360"}},{type:"int",name:"saturation",ref:{value:"sat",extMeta:"0-100"}},{type:"dynamic",name:"scene name",ref:{value:"effectSelected",ext:"%dynamic"}},{type:"int",name:"scene index",ref:{value:"effectIndex"}},{type:"string",name:"device name",ref:{value:"name",value_t:"deviceName"}},{type:"string",name:"model",ref:{value:"model"}},{type:"string",name:"serial number",ref:{value:"serialNo"}},{type:"string",name:"firmware version",ref:{value:"firmwareVersion"}},{type:"int",name:"number of panels",ref:{value:"numPanels"}}],ipevt:[{type:"enum",name:"is on",ref:{value:"on",options:["true","false"]}},{type:"int",name:"brightness",ref:{value:"brightness",extMeta:"0-100"}},{type:"enum",name:"color mode",ref:{value:"colorMode",options:["ct","effect","hs"]}},{type:"int",name:"color temperature",ref:{value:"ct",extMeta:"1200-6500"}},{type:"int",name:"hue",ref:{value:"hue",extMeta:"0-360"}},{type:"int",name:"saturation",ref:{value:"sat",extMeta:"0-100"}},{type:"dynamic",name:"scene name",ref:{value:"effectSelected",ext:"%dynamic"}}]}},SYS:"nanoleaf",applyIPEventFilter:function applyIPEventFilter(e,n){if(!e||!e.type)return null;var a=xnm.aio.nanoleaf.DM.getIPevtMap(e);return a?{ipevt:a}:null;},applyUIFilter:function applyUIFilter(e,n,a){if(!e.sys)return null;var _contains=function _contains(e,n){if("*"===e||"*"===e[0])return!0;for(var a=0;a<e.length;a++){if(e[a]==n)return!0;}return!1;},_filter=function _filter(e,n){var t=[],o=null,r=xnm.aio.nanoleaf.DM.getCommandStatusMap(e,a);return r&&(o=function(e,n,a){var t=[];switch(a.catagory){case"command":e.command&&e.command.forEach(function(e){if(_contains(a.elems,e.type)){var n=JSON.parse(JSON.stringify(e));t.push(n);}});break;case"status":e.status&&e.status.forEach(function(e){if(_contains(a.elems,e.type)){var n=JSON.parse(JSON.stringify(e));t.push(n);}});}return t;}(r,0,n),t=t.concat(o)),t;},t=JSON.parse(JSON.stringify(e)),o=null;switch(n.catagory){case"command":o=_filter(e,n),t.command=o;break;case"status":o=_filter(e,n),t.status=o;break;default:return null;}return o&&0!=o.length?t:null;},createDevice:function createDevice(e,n,a){var t=xnm.aio.nanoleaf.DM;e?e.type?e.ip?a(null,e):a(new t.Error(t.Error.ERROR_CODE.INVALID,"IP is missing")):a(new t.Error(t.Error.ERROR_CODE.INVALID,"type is missing")):a(new t.Error(t.Error.ERROR_CODE.INVALID,"info is missing"));},deleteDevice:function deleteDevice(e,n,a){if(e.ip&&e.token){var t=xnm.aio.nanoleaf.parseJSON(e);t?t.deleteUser(function(e){a();}):a();}else a();},getCommandStatusMap:function getCommandStatusMap(e,n){return e.type?xnm.aio.nanoleaf.DM.MAP[e.type]:null;},getIPDeviceType:function getIPDeviceType(){return[{sys:xnm.aio.nanoleaf.DM.SYS,name:"Nanoleaf"}];},getIPevtMap:function getIPevtMap(e){var _xnm$aio$nanoleaf$DM$;return e.type&&((_xnm$aio$nanoleaf$DM$=xnm.aio.nanoleaf.DM.MAP[e.type])===null||_xnm$aio$nanoleaf$DM$===void 0?void 0:_xnm$aio$nanoleaf$DM$.ipevt)||null;},toGeneralDevice:function toGeneralDevice(e){return{type:"dimmer",commands:{brightness:{value:{type:"INT",min:0,max:100}},color:{value:{type:"RGB"}},colorTemperature:{value:{type:"INT",min:1200,max:6500}},down:{value:{type:"INT",min:-100,max:100}},off:{},on:{},toggle:{},up:{value:{type:"INT",min:-100,max:100}},white:{}},states:{brightness:{type:"INT",min:0,max:100,unit:"%"},colorTemperature:{type:"INT",min:1200,max:6500},state:{values:["on","off"]}},details:{commands:{brightness:{value:"brightness",ext:"%d",extMeta:"0-100"},color:{value:"color"},colorTemperature:{value:"ct",ext:"%d",extMeta:"1200-6500"},down:{value:"brightnessInc",ext:"-10"},off:{value:"off"},on:{value:"on"},toggle:{value:"toggle"},up:{value:"brightnessInc",ext:"10"},white:{value:"color",ext:"#FFFFFF"}},states:{brightness:{value:"brightness"},colorTemperature:{value:"ct"},state:{value:"on"}}}};},updateDevice:function updateDevice(e,n,a){var t=xnm.aio.nanoleaf.DM;e?e.type?e.ip?a(null,e):a(new t.Error(t.Error.ERROR_CODE.INVALID,"IP is missing")):a(new t.Error(t.Error.ERROR_CODE.INVALID,"type is missing")):a(new t.Error(t.Error.ERROR_CODE.INVALID,"info is missing"));}},xnm.aio.nanoleaf.DM.MAP.canvas={command:xnm.aio.nanoleaf.DM.MAP.device.command.slice(0),status:xnm.aio.nanoleaf.DM.MAP.device.status.slice(0),ipevt:xnm.aio.nanoleaf.DM.MAP.device.ipevt.slice(0)},xnm.aio.nanoleaf.DM.MAP.canvas.ipevt.push({type:"enum",name:"gesture: tap",ref:{value:"gestureTap",options:["single tap","double tap"]}},{type:"dynamic",name:"gesture: single tap on panel of ID",ref:{value:"gestureSingleTapPanel",ext:"%dynamic"}},{type:"dynamic",name:"gesture: double tap on panel of ID",ref:{value:"gestureDoubleTapPanel",ext:"%dynamic"}},{type:"enum",name:"gesture: swipe",ref:{value:"gestureSwipe",options:["swipe up","swipe down","swipe left","swipe right"]}}),xnm.aio.nanoleaf.DM.MAP.panel={command:xnm.aio.nanoleaf.DM.MAP.device.command.slice(0),status:xnm.aio.nanoleaf.DM.MAP.device.status.slice(0),ipevt:xnm.aio.nanoleaf.DM.MAP.device.ipevt.slice(0)},xnm.aio.nanoleaf.DM.MAP.panel.command.push({type:"enum",name:"Rhythm: select source",ref:{value:"rhythmMode",ext:"%e",extMeta:["aux","microphone"]}}),xnm.aio.nanoleaf.DM.MAP.panel.status.push({type:"enum",name:"Rhythm: connected",ref:{value:"rhythmConnected",options:["true","false"]}},{type:"enum",name:"Rhythm: state",ref:{value:"rhythmActive",options:["on","off"]}},{type:"enum",name:"Rhythm: source",ref:{value:"rhythmMode",options:["microphone","aux"]}},{type:"enum",name:"Rhythm: aux connected",ref:{value:"auxAvailable",options:["true","false"]}});{xnm.aio.nanoleaf.DM.MAP.element={command:xnm.aio.nanoleaf.DM.MAP.device.command.slice(0),status:xnm.aio.nanoleaf.DM.MAP.device.status.slice(0),ipevt:xnm.aio.nanoleaf.DM.MAP.device.ipevt.slice(0)};var e=xnm.aio.nanoleaf.DM.MAP.element.command.findIndex(function(e){return"ct"===e.ref.value;});e>=0&&xnm.aio.nanoleaf.DM.MAP.element.command.splice(e,1),xnm.aio.nanoleaf.DM.MAP.element.command.push({type:"int",name:"color temperature",ref:{value:"ct",ext:"%d",extMeta:"1500-4000"}});var n=xnm.aio.nanoleaf.DM.MAP.element.status.findIndex(function(e){return"ct"===e.ref.value;});n>=0&&xnm.aio.nanoleaf.DM.MAP.element.status.splice(n,1),xnm.aio.nanoleaf.DM.MAP.element.status.push({type:"int",name:"color temperature",ref:{value:"ct",extMeta:"1500-4000"}});}xnm.aio.nanoleaf.DM.MAP.line={command:xnm.aio.nanoleaf.DM.MAP.device.command.slice(0),status:xnm.aio.nanoleaf.DM.MAP.device.status.slice(0),ipevt:xnm.aio.nanoleaf.DM.MAP.device.ipevt.slice(0)},xnm.aio.nanoleaf.DM.MAP.shape={command:xnm.aio.nanoleaf.DM.MAP.device.command.slice(0),status:xnm.aio.nanoleaf.DM.MAP.device.status.slice(0),ipevt:xnm.aio.nanoleaf.DM.MAP.device.ipevt.slice(0)},xnm.aio.nanoleaf.DM.MAP.magrgb={command:xnm.aio.nanoleaf.DM.MAP.device.command.slice(0),status:xnm.aio.nanoleaf.DM.MAP.device.status.slice(0),ipevt:xnm.aio.nanoleaf.DM.MAP.device.ipevt.slice(0)},xnm.aio.nanoleaf.DM.Error=function(e,n){this.code=e,this.message=n,this.stack=new Error().stack;},xnm.aio.nanoleaf.DM.Error.prototype=new Error(),xnm.aio.nanoleaf.DM.Error.prototype.name="NanoleafDMError",xnm.aio.nanoleaf.DM.Error.prototype.code=0,xnm.aio.nanoleaf.DM.Error.ERROR_CODE={DEFAULT:0,INDEX_EXISTS:1,ID_EXISTS:2,INVALID:3,UNKNOWN:4,NOT_FOUND:5,IP_EXISTS:6},xnm.aio.nanoleaf.Device=function(e,n){this.ip=e,this.port=xnm.aio.nanoleaf.PORT_DEFAULT,this.token=null,this.type=null,n&&(this.firmware=n.firmware||null,this.id=n.id||null,this.model=n.model||null,this.port=n.port||this.port,this.token=n.token||null);},xnm.aio.nanoleaf.Device.prototype={authorize:function authorize(e){xnm.aio.nanoleaf._logger.log("debug","[Device.authorize] Sending request."),xnm.aio.nanoleaf.doRequest(this,"POST",{dataType:"json",path:"new",timeout:3e4},function(n,a){if(n)e&&e(n,null);else if(a.response){var t=a.response.auth_token;t&&"string"==typeof t?(xnm.aio.nanoleaf._logger.log("debug","[Device.authorize] Received auth token."),e&&e(null,t)):(n=new Error("Authorization response did not contain a token."),xnm.aio.nanoleaf._logger.log("error","[Device.authorize] "+n.message),e&&e(n,null));}else n=new Error("Authorization request did return neither error nor response. Status code: "+a.statusCode),xnm.aio.nanoleaf._logger.log("error","[Device.authorize] "+n.message),e&&e(n,null);});},cmdIdentify:function cmdIdentify(e){xnm.aio.nanoleaf._logger.log("trace","[Device.cmdIdentify] Sending request."),xnm.aio.nanoleaf.doRequest(this,"PUT",{path:"identify"},function(n,a){e&&e(n,null);});},cmdIncrementBrightness:function cmdIncrementBrightness(e,n){if("number"!=typeof e||isNaN(e)||e<-100||e>100){var a=new Error("Invalid value for brightness: "+e);return xnm.aio.nanoleaf._logger.log("error","[Device.cmdIncrementBrightness] "+a.message),void(n&&n(a,null));}var t={data:{brightness:{increment:e}},path:"state"};xnm.aio.nanoleaf._logger.log("trace","[Device.cmdIncrementBrightness] Sending request."),xnm.aio.nanoleaf.doRequest(this,"PUT",t,function(e,a){n&&n(e,null);});},cmdNextScene:function cmdNextScene(e){xnm.aio.nanoleaf._logger.log("trace","[Device.cmdNextScene] Requesting effectsList to find next scene.");var n=this;xnm.aio.nanoleaf.doRequest(this,"GET",{dataType:"json",path:"effects"},function(a,t){if(a)e&&e(a,null);else{var o=t.response.effectsList;if(!Array.isArray(o)||0===o.length)return a=new Error("effectsList is not an array or empty."),xnm.aio.nanoleaf._logger.log("error","[Device.cmdNextScene] "+a.message),void(e&&e(a,null));var r=t.response.select,i=o.indexOf(r)+1;i>=o.length&&(i=0);var s=o[i];n.cmdSetScene(s,e);}});},cmdOff:function cmdOff(e){xnm.aio.nanoleaf._logger.log("trace","[Device.cmdOff] Sending request."),xnm.aio.nanoleaf.doRequest(this,"PUT",{data:{on:{value:!1}},path:"state"},function(n,a){e&&e(n,null);});},cmdOn:function cmdOn(e){xnm.aio.nanoleaf._logger.log("trace","[Device.cmdOn] Sending request."),xnm.aio.nanoleaf.doRequest(this,"PUT",{data:{on:{value:!0}},path:"state"},function(n,a){e&&e(n,null);});},cmdPrevScene:function cmdPrevScene(e){xnm.aio.nanoleaf._logger.log("trace","[Device.cmdPrevScene] Requesting effectsList to find next scene.");var n=this;xnm.aio.nanoleaf.doRequest(this,"GET",{dataType:"json",path:"effects"},function(a,t){if(a)e&&e(a,null);else{var o=t.response.effectsList;if(!Array.isArray(o)||0===o.length)return a=new Error("effectsList is not an array or empty."),xnm.aio.nanoleaf._logger.log("error","[Device.cmdPrevScene] "+a.message),void(e&&e(a,null));var r=t.response.select,i=o.indexOf(r)-1;-1===i?i=o.length-1:i<-1&&(i=0);var s=o[i];n.cmdSetScene(s,e);}});},cmdRandomScene:function cmdRandomScene(e){xnm.aio.nanoleaf._logger.log("trace","[Device.cmdRandomScene] Requesting effectsList.");var n=this;xnm.aio.nanoleaf.doRequest(this,"GET",{dataType:"json",path:"effects"},function(a,t){if(a)e&&e(a,null);else{var o=t.response.effectsList;if(!Array.isArray(o)||0===o.length)return a=new Error("effectsList is not an array or empty."),xnm.aio.nanoleaf._logger.log("error","[Device.cmdRandomScene] "+a.message),void(e&&e(a,null));var r=t.response.select,i=o.indexOf(r);i>=0&&o.splice(i,1);var s=o[Math.floor(Math.random()*o.length)];n.cmdSetScene(s,e);}});},cmdSetBrightness:function cmdSetBrightness(e,n){if("number"!=typeof e||isNaN(e)||e<0||e>100){var a=new Error("Invalid value for brightness: "+e);return xnm.aio.nanoleaf._logger.log("error","[Device.cmdSetBrightness] "+a.message),void(n&&n(a,null));}var t={data:{brightness:{value:e}},path:"state"};xnm.aio.nanoleaf._logger.log("trace","[Device.cmdSetBrightness] Sending request."),xnm.aio.nanoleaf.doRequest(this,"PUT",t,function(e,a){n&&n(e,null);});},cmdSetColor:function cmdSetColor(e,n){var a=xnm.aio.nanoleaf.rgb2hsv(e),t={data:{hue:{value:a[0]},sat:{value:a[1]},brightness:{value:a[2]}},path:"state"};xnm.aio.nanoleaf._logger.log("trace","[Device.cmdSetColor] Sending request."),xnm.aio.nanoleaf.doRequest(this,"PUT",t,function(e,a){n&&n(e,null);});},cmdSetColorTemperature:function cmdSetColorTemperature(e,n){if("number"!=typeof e||isNaN(e)||e<1200||e>6500){var a=new Error("Invalid value for color temperature: "+e);return xnm.aio.nanoleaf._logger.log("error","[Device.cmdSetColorTemperature] "+a.message),void(n&&n(a,null));}var t={data:{ct:{value:e}},path:"state"};xnm.aio.nanoleaf._logger.log("trace","[Device.cmdSetColorTemperature] Sending request."),xnm.aio.nanoleaf.doRequest(this,"PUT",t,function(e,a){n&&n(e,null);});},cmdSetScene:function cmdSetScene(e,n){var a={data:{select:e},path:"effects"};xnm.aio.nanoleaf._logger.log("trace","[Device.cmdSetScene] Sending request."),xnm.aio.nanoleaf.doRequest(this,"PUT",a,function(e,a){n&&n(e,null);});},cmdToggle:function cmdToggle(e){xnm.aio.nanoleaf._logger.log("trace","[Device.cmdToggle] Requesting state first, before deciding command.");var n=this;xnm.aio.nanoleaf.doRequest(this,"GET",{dataType:"json",path:"state/on"},function(a,t){a?e&&e(a,null):t.response.value?n.cmdOff(e):n.cmdOn(e);});},deleteUser:function deleteUser(e){xnm.aio.nanoleaf._logger.log("debug","[Device.deleteUser] Sending request."),xnm.aio.nanoleaf.doRequest(this,"DELETE",{path:""},function(n,a){e(n);});},equalsTo:function equalsTo(e){return!!(e&&e instanceof xnm.aio.nanoleaf.Device)&&this.ip===e.ip&&this.type===e.type&&this.token===e.token;},executeCommand:function executeCommand(e,n,a){if(this.token){var t=xnm.aio.nanoleaf.parseJSON(e);if(t)switch(n.value){case"brightness":t.cmdSetBrightness(n.ext,a);break;case"brightnessInc":t.cmdIncrementBrightness(n.ext,a);break;case"color":t.cmdSetColor(n.ext,a);break;case"ct":t.cmdSetColorTemperature(n.ext,a);break;case"identify":t.cmdIdentify(a);break;case"off":t.cmdOff(a);break;case"on":t.cmdOn(a);break;case"rhythmMode":t.cmdSetRhythmMode(n.ext,a);break;case"scene":t.cmdSetScene(n.ext,a);break;case"sceneNext":t.cmdNextScene(a);break;case"scenePrev":t.cmdPrevScene(a);break;case"sceneRandom":t.cmdRandomScene(a);break;case"toggle":t.cmdToggle(a);break;default:var o=new Error("Unknown command: "+n.value);xnm.aio.nanoleaf._logger.log("warn","[Device.executeCommand] "+o.message),a(o,null);}else{var r=new Error("Could not create device from data.");a&&a(r,null);}}else{var i=new Error("Request not possible without a token.");a&&a(i,null);}},executeCommandCreator:function executeCommandCreator(e,n,a){n&&n.value?this.executeCommand(e,n,function(e){a&&a(e);}):a&&a(new Error("Command value is empty."));},getState:function getState(e){if(this.token){xnm.aio.nanoleaf._logger.log("trace","[Device.getState] Sending request."),xnm.aio.nanoleaf.doRequest(this,"GET",{dataType:"json",path:""},function(n,a){n?e&&e(n,null):e&&e(null,a.response);});}else{var n=new Error("Request not possible without a token.");e&&e(n,null);}},getStatesCreator:function getStatesCreator(e,n,a){this.getState(function(e,t){if(t){for(var o=t.effects,r=t.panelLayout,i=t.rhythm,s=t.state,l=[],u=0;u<n.length;u++){var c=n[u];if(c&&c.id&&c.status)switch(c.status.value){case"brightness":s.brightness&&l.push({id:c.id,status:s.brightness.value});break;case"colorMode":s.colorMode&&l.push({id:c.id,status:s.colorMode});break;case"ct":s.ct&&l.push({id:c.id,status:s.ct.value});break;case"hue":s.hue&&l.push({id:c.id,status:s.hue.value});break;case"on":s.on&&l.push({id:c.id,status:s.on.value?"on":"off"});break;case"sat":s.sat&&l.push({id:c.id,status:s.sat.value});break;case"effectSelected":"string"==typeof o.select&&l.push({id:c.id,status:o.select});break;case"effectIndex":if("string"==typeof o.select&&Array.isArray(o.effectsList)){var m=o.effectsList.indexOf(o.select);l.push({id:c.id,status:m});}break;case"name":"string"==typeof t.name&&l.push({id:c.id,status:t.name});break;case"serialNo":"string"==typeof t.serialNo&&l.push({id:c.id,status:t.serialNo});break;case"model":"string"==typeof t.model&&l.push({id:c.id,status:t.model});break;case"firmwareVersion":"string"==typeof t.firmwareVersion&&l.push({id:c.id,status:t.firmwareVersion});break;case"numPanels":r&&r.layout&&"number"==typeof r.layout.numPanels&&l.push({id:c.id,status:r.layout.numPanels});break;case"rhythmActive":i&&"boolean"==typeof i.rhythmActive&&l.push({id:c.id,status:i.rhythmActive?"on":"off"});break;case"rhythmConnected":i&&"boolean"==typeof i.rhythmConnected&&l.push({id:c.id,status:i.rhythmConnected?"true":"false"});break;case"rhythmMode":if(i&&"number"==typeof i.rhythmMode){var f="unknown";0===i.rhythmMode?f="microphone":1===i.rhythmMode&&(f="aux"),l.push({id:c.id,status:f});}break;case"auxAvailable":i&&"boolean"==typeof i.auxAvailable&&l.push({id:c.id,status:i.auxAvailable?"true":"false"});}}a&&a(null,l);}else a&&a(new Error("Failed to get states."));});},toJSON:function toJSON(){return{sys:xnm.aio.nanoleaf.DM.SYS,type:this.type,ip:this.ip,id:this.id,firmware:this.firmware,model:this.model,token:this.token};}},xnm.aio.nanoleaf.Shape=function(e,n){xnm.aio.nanoleaf.Device.call(this,e,n),this.type="shape";},xnm.aio.nanoleaf.Shape.prototype=Object.create(xnm.aio.nanoleaf.Device.prototype),xnm.aio.nanoleaf.Shape.constructor=xnm.aio.nanoleaf.Shape,xnm.aio.nanoleaf.Element=function(e,n){xnm.aio.nanoleaf.Device.call(this,e,n),this.type="element";},xnm.aio.nanoleaf.Element.prototype=Object.create(xnm.aio.nanoleaf.Device.prototype),xnm.aio.nanoleaf.Element.constructor=xnm.aio.nanoleaf.Element,xnm.aio.nanoleaf.Line=function(e,n){xnm.aio.nanoleaf.Device.call(this,e,n),this.type="line";},xnm.aio.nanoleaf.Line.prototype=Object.create(xnm.aio.nanoleaf.Device.prototype),xnm.aio.nanoleaf.Line.constructor=xnm.aio.nanoleaf.Line,xnm.aio.nanoleaf.Magrgb=function(e,n){xnm.aio.nanoleaf.Device.call(this,e,n),this.type="magrgb";},xnm.aio.nanoleaf.Magrgb.prototype=Object.create(xnm.aio.nanoleaf.Device.prototype),xnm.aio.nanoleaf.Magrgb.constructor=xnm.aio.nanoleaf.Magrgb,xnm.aio.nanoleaf.Canvas=function(e,n){xnm.aio.nanoleaf.Device.call(this,e,n),this.type="canvas";},xnm.aio.nanoleaf.Canvas.prototype=Object.create(xnm.aio.nanoleaf.Device.prototype),xnm.aio.nanoleaf.Canvas.constructor=xnm.aio.nanoleaf.Canvas,xnm.aio.nanoleaf.Panel=function(e,n){xnm.aio.nanoleaf.Device.call(this,e,n),this.type="panel";},xnm.aio.nanoleaf.Panel.prototype=Object.create(xnm.aio.nanoleaf.Device.prototype),xnm.aio.nanoleaf.Panel.constructor=xnm.aio.nanoleaf.Panel,xnm.aio.nanoleaf.Panel.prototype.cmdSetRhythmMode=function(e,n){if("aux"===e?e=1:"microphone"===e&&(e=0),"number"!=typeof e||isNaN(e)||e<0||e>1){var a=new Error("Invalid value for Rhythm mode: "+e);return xnm.aio.nanoleaf._logger.log("error","[Panel.cmdSetRhythmMode] "+a.message),void(n&&n(a,null));}var t={data:{rhythmMode:e},path:"rhythm/rhythmMode"};xnm.aio.nanoleaf._logger.log("trace","[Panel.cmdSetRhythmMode] Sending request."),xnm.aio.nanoleaf.doRequest(this,"PUT",t,function(e,a){n&&n(e,null);});},xnm.aio.nanoleaf.Handler=function(){var e=require("x.logger.js");e&&(xnm.aio.nanoleaf._logger=e.getLogger("xnm.aio.nanoleaf"));},xnm.aio.nanoleaf.Handler.prototype={devicemanager:xnm.aio.nanoleaf.DM,discoverWithTimeout:function discoverWithTimeout(e,n){var a=require("x.mdns.js");a.clearRecordBuffer();("number"!=typeof e||isNaN(e))&&(e=1e4),a.discoverServiceWithTimeout("_nanoleafapi._tcp.local",e,function(e,a){if(e)n&&n(e,null);else{for(var t=[],o=0;o<a.length;o++){var r=a[o];if(r.ip&&r.ip.length>0&&r.info){var i={firmware:r.info.srcvers,id:r.info.id,ip:r.ip[0],model:r.info.md,sys:xnm.aio.nanoleaf.DM.SYS};t.push(i);}}n&&n(e,t);}});},doCommand:function doCommand(e,n,a){var t=this.resolveDevice(e);t?t.executeCommandCreator(e,n,function(e){a&&a(e);}):a&&a(new Error("device format invalid"));},doStatus:function doStatus(e,n,a,t){var o=this.resolveDevice(n);if(o){var r=[{id:e,status:a}];o.getStatesCreator(null,r,function(e,n){e?t&&t(e):t&&t(null,n[0]);});}else t&&t(new Error("device format invalid"));},getDeviceCommands:function getDeviceCommands(e,n){var a=xnm.aio.nanoleaf.DM.applyUIFilter(e,{catagory:"command",elems:"*"}),t=a?a.command:[];n&&n(null,t);},getDeviceStatus:function getDeviceStatus(e,n){var a=xnm.aio.nanoleaf.DM.applyUIFilter(e,{catagory:"status",elems:"*"}),t=a?a.status:[];n&&n(null,t);},registModule:function registModule(e){e.register(xnm.aio.nanoleaf.DM.SYS,"nanoleaf");},resolveDevice:function resolveDevice(e){return e?xnm.aio.nanoleaf.parseJSON(e):null;}},"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(exports=module.exports=new xnm.aio.nanoleaf.Handler());