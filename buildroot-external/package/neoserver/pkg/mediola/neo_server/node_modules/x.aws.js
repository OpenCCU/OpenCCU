var x=x||{};x.aws=x.aws||{},x.aws.S3Client=function(){var NativClient=function NativClient(e){this._options=e,this._clientID=null,this._clientInitErr=null,this._init();};NativClient.prototype._init=function(e){var t={accessKey:this._options.accessKeyId,secretKey:this._options.secretAccessKey,sessionKey:this._options.sessionToken},i=this;XC.callHost("aws","buildS3Client",t,function(e){e.error?i._clientInitErr=e.error:e.clientID&&(i._clientID=e.clientID);},{once:!0});},NativClient.prototype.getObject2File=function(e,t,i){if(!this._clientID){var n=this._clientInitErr;return n||(n=new Error("native s3 client not properly initialized")),void(i&&i(n));}var s={clientID:this._clientID,bucket:e.Bucket,key:e.Key,filePath:t};XC.callHost("aws","getS3Object2File",s,function(e){var t=null;e&&e.error&&(t=new Error(e.error)),i&&i(t,e?e.file:null);},{once:!0});},NativClient.prototype.release=function(e){if(this._clientID){var t=this,i={clientID:this._clientID};XC.callHost("aws","releaseS3Client",i,function(i){t._clientID=null,e&&e(i?i.error:null);},{once:!0});}else e&&e();};var Client=function Client(e){if(this._options=e,this._s3Client=null,this._nativeS3Client=null,window.XCHost&&window.XCHost.getType&&("iOS"==window.XCHost.getType()||"Android"==window.XCHost.getType()))this._nativeS3Client=new NativClient(e);else{var t=require("aws-sdk");this._s3Client=new t.S3({apiVersion:"2006-03-01",region:"eu-central-1",accessKeyId:e.accessKeyId,secretAccessKey:e.secretAccessKey,sessionToken:e.sessionToken});}};return Client.prototype.getObject2File=function(e,t,i){if(e&&e.Bucket&&e.Key){var n=require("fs");if(this._s3Client){if(!t)return void(i&&i(new Error("dstFile invalid")));this._s3Client.getObject(e,function(e,s){e?i&&i(e):n.writeFile(t,s.Body,function(e){i&&i(e,t);});});}else this._nativeS3Client?this._nativeS3Client.getObject2File(e,t,function(e,t){i&&i(e,t);}):i&&i(new Error("aws s3 client not properly initialized"));}else i&&i(new Error("params invalid"));},Client.prototype.release=function(){if(this._s3Client&&(this._s3Client=null),this._nativeS3Client){var e=this;this._nativeS3Client.release(function(){e._nativeS3Client=null;});}},Client;}(),x.aws.Handler=function(){var Handler=function Handler(){};return Handler.prototype.getS3Client=function(e){if(!e||!e.accessKeyId||!e.secretAccessKey)throw new Error("options invalid");return new x.aws.S3Client(e);},Handler;}(),"undefined"!=typeof module&&null!=module&&(module.exports=new x.aws.Handler());